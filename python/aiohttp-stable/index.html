
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>aiohttp 3.6.2 documentation</title>
    <link rel="stylesheet" href="_static/aiohttp.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/_static/css/badge_only.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
 
<link rel="stylesheet" href="_static/custom.css" type="text/css" />


<link rel="canonical" href="http://docs.aiohttp.org/en/stable/index.html"/>

<meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />
<link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet">

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="welcome-to-aiohttp">
<h1>Welcome to AIOHTTP<a class="headerlink" href="#welcome-to-aiohttp" title="Permalink to this headline">¶</a></h1>
<p>Asynchronous HTTP Client/Server for <a class="reference internal" href="index.html#term-asyncio"><span class="xref std std-term">asyncio</span></a> and Python.</p>
<p>Current version is 3.6.2.</p>
<div class="section" id="key-features">
<h2>Key Features<a class="headerlink" href="#key-features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Supports both <a class="reference internal" href="index.html#aiohttp-client"><span class="std std-ref">Client</span></a> and <a class="reference internal" href="index.html#aiohttp-web"><span class="std std-ref">HTTP Server</span></a>.</p></li>
<li><p>Supports both <a class="reference internal" href="index.html#aiohttp-web-websockets"><span class="std std-ref">Server WebSockets</span></a> and
<a class="reference internal" href="index.html#aiohttp-client-websockets"><span class="std std-ref">Client WebSockets</span></a> out-of-the-box
without the Callback Hell.</p></li>
<li><p>Web-server has <a class="reference internal" href="index.html#aiohttp-web-middlewares"><span class="std std-ref">Middlewares</span></a>,
<a class="reference internal" href="index.html#aiohttp-web-signals"><span class="std std-ref">Signals</span></a> and pluggable routing.</p></li>
</ul>
</div>
<div class="section" id="library-installation">
<span id="aiohttp-installation"></span><h2>Library Installation<a class="headerlink" href="#library-installation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install aiohttp
</pre></div>
</div>
<p>You may want to install <em>optional</em> <a class="reference internal" href="index.html#term-cchardet"><span class="xref std std-term">cchardet</span></a> library as faster
replacement for <a class="reference internal" href="index.html#term-chardet"><span class="xref std std-term">chardet</span></a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install cchardet
</pre></div>
</div>
<p>For speeding up DNS resolving by client API you may install
<a class="reference internal" href="index.html#term-aiodns"><span class="xref std std-term">aiodns</span></a> as well.
This option is highly recommended:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install aiodns
</pre></div>
</div>
<div class="section" id="installing-speedups-altogether">
<h3>Installing speedups altogether<a class="headerlink" href="#installing-speedups-altogether" title="Permalink to this headline">¶</a></h3>
<p>The following will get you <code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> along with <a class="reference internal" href="index.html#term-chardet"><span class="xref std std-term">chardet</span></a>,
<a class="reference internal" href="index.html#term-aiodns"><span class="xref std std-term">aiodns</span></a> and <code class="docutils literal notranslate"><span class="pre">brotlipy</span></code> in one bundle. No need to type
separate commands anymore!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install aiohttp<span class="o">[</span>speedups<span class="o">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Client example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">aiohttp</span>
<span class="kn">import</span> <span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="s1">&#39;http://python.org&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>Server example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Anonymous&quot;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">handle</span><span class="p">),</span>
                <span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{name}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">handle</span><span class="p">)])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information please visit <a class="reference internal" href="index.html#aiohttp-client"><span class="std std-ref">Client</span></a> and
<a class="reference internal" href="index.html#aiohttp-web"><span class="std std-ref">Server</span></a> pages.</p>
</div>
<div class="section" id="what-s-new-in-aiohttp-3">
<h2>What’s new in aiohttp 3?<a class="headerlink" href="#what-s-new-in-aiohttp-3" title="Permalink to this headline">¶</a></h2>
<p>Go to <a class="reference internal" href="index.html#aiohttp-whats-new-3-0"><span class="std std-ref">What’s new in aiohttp 3.0</span></a> page for aiohttp 3.0 major release
changes.</p>
</div>
<div class="section" id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://aiohttp-demos.readthedocs.io/en/latest/index.html#aiohttp-demos-polls-beginning" title="(in aiohttp-demos v0.2)"><span class="xref std std-ref">Polls tutorial</span></a></p>
</div>
<div class="section" id="source-code">
<h2>Source code<a class="headerlink" href="#source-code" title="Permalink to this headline">¶</a></h2>
<p>The project is hosted on <a class="reference external" href="https://github.com/aio-libs/aiohttp">GitHub</a></p>
<p>Please feel free to file an issue on the <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues">bug tracker</a> if you have found a bug
or have some suggestion in order to improve the library.</p>
<p>The library uses <a class="reference external" href="https://travis-ci.com/aio-libs/aiohttp">Travis</a> for
Continuous Integration.</p>
</div>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Python 3.5.3+</p></li>
<li><p><em>async_timeout</em></p></li>
<li><p><em>attrs</em></p></li>
<li><p><em>chardet</em></p></li>
<li><p><em>multidict</em></p></li>
<li><p><em>yarl</em></p></li>
<li><p><em>Optional</em> <a class="reference internal" href="index.html#term-cchardet"><span class="xref std std-term">cchardet</span></a> as faster replacement for
<a class="reference internal" href="index.html#term-chardet"><span class="xref std std-term">chardet</span></a>.</p>
<p>Install it explicitly via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install cchardet
</pre></div>
</div>
</li>
<li><p><em>Optional</em> <a class="reference internal" href="index.html#term-aiodns"><span class="xref std std-term">aiodns</span></a> for fast DNS resolving. The
library is highly recommended.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install aiodns
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="communication-channels">
<h2>Communication channels<a class="headerlink" href="#communication-channels" title="Permalink to this headline">¶</a></h2>
<p><em>aio-libs</em> google group: <a class="reference external" href="https://groups.google.com/forum/#!forum/aio-libs">https://groups.google.com/forum/#!forum/aio-libs</a></p>
<p>Feel free to post your questions and ideas here.</p>
<p><em>gitter chat</em> <a class="reference external" href="https://gitter.im/aio-libs/Lobby">https://gitter.im/aio-libs/Lobby</a></p>
<p>We support <a class="reference external" href="https://stackoverflow.com/questions/tagged/aiohttp">Stack Overflow</a>.
Please add <em>aiohttp</em> tag to your question there.</p>
</div>
<div class="section" id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h2>
<p>Please read the <a class="reference internal" href="index.html#aiohttp-contributing"><span class="std std-ref">instructions for contributors</span></a>
before making a Pull Request.</p>
</div>
<div class="section" id="authors-and-license">
<h2>Authors and License<a class="headerlink" href="#authors-and-license" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> package is written mostly by Nikolay Kim and Andrew Svetlov.</p>
<p>It’s <em>Apache 2</em> licensed and freely available.</p>
<p>Feel free to improve this package and send a pull request to <a class="reference external" href="https://github.com/aio-libs/aiohttp">GitHub</a>.</p>
</div>
<div class="section" id="policy-for-backward-incompatible-changes">
<span id="aiohttp-backward-compatibility-policy"></span><h2>Policy for Backward Incompatible Changes<a class="headerlink" href="#policy-for-backward-incompatible-changes" title="Permalink to this headline">¶</a></h2>
<p><em>aiohttp</em> keeps backward compatibility.</p>
<p>After deprecating some <em>Public API</em> (method, class, function argument,
etc.) the library guaranties the usage of <em>deprecated API</em> is still
allowed at least for a year and half after publishing new release with
deprecation.</p>
<p>All deprecations are reflected in documentation and raises
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#DeprecationWarning" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>.</p>
<p>Sometimes we are forced to break the own rule for sake of very strong
reason.  Most likely the reason is a critical bug which cannot be
solved without major API change, but we are working hard for keeping
these changes as rare as possible.</p>
</div>
<div class="section" id="table-of-contents">
<h2>Table Of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound" id="mastertoc">
<span id="document-client"></span><div class="section" id="client">
<span id="aiohttp-client"></span><h3>Client<a class="headerlink" href="#client" title="Permalink to this headline">¶</a></h3>
<p>The page contains all information about aiohttp Client API:</p>
<div class="toctree-wrapper compound" id="id1">
<span id="document-client_quickstart"></span><div class="section" id="client-quickstart">
<span id="aiohttp-client-quickstart"></span><h4>Client Quickstart<a class="headerlink" href="#client-quickstart" title="Permalink to this headline">¶</a></h4>
<p>Eager to get started? This page gives a good introduction in how to
get started with aiohttp client API.</p>
<p>First, make sure that aiohttp is <a class="reference internal" href="index.html#aiohttp-installation"><span class="std std-ref">installed</span></a> and <em>up-to-date</em></p>
<p>Let’s get started with some simple examples.</p>
<div class="section" id="make-a-request">
<h5>Make a Request<a class="headerlink" href="#make-a-request" title="Permalink to this headline">¶</a></h5>
<p>Begin by importing the aiohttp module:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">aiohttp</span>
</pre></div>
</div>
<p>Now, let’s try to get a web-page. For example let’s query
<code class="docutils literal notranslate"><span class="pre">http://httpbin.org/get</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
<p>Now, we have a <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> called <code class="docutils literal notranslate"><span class="pre">session</span></code> and a
<a class="reference internal" href="index.html#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientResponse</span></code></a> object called <code class="docutils literal notranslate"><span class="pre">resp</span></code>. We can get all the
information we need from the response.  The mandatory parameter of
<a class="reference internal" href="index.html#aiohttp.ClientSession.get" title="aiohttp.ClientSession.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.get()</span></code></a> coroutine is an HTTP <em>url</em> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or
class:<cite>yarl.URL</cite> instance).</p>
<p>In order to make an HTTP POST request use <a class="reference internal" href="index.html#aiohttp.ClientSession.post" title="aiohttp.ClientSession.post"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.post()</span></code></a> coroutine:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Other HTTP methods are available as well:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/put&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/delete&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/patch&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don’t create a session per request. Most likely you need a session
per application which performs all requests altogether.</p>
<p>More complex cases may require a session per site, e.g. one for
Github and other one for Facebook APIs. Anyway making a session for
every request is a <strong>very bad</strong> idea.</p>
<p>A session contains a connection pool inside. Connection reusage and
keep-alives (both are on by default) may speed up total performance.</p>
</div>
<p>A session context manager usage is not mandatory
but <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">session.close()</span></code> method
should be called in this case, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">):</span>
    <span class="c1"># ...</span>
<span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="passing-parameters-in-urls">
<h5>Passing Parameters In URLs<a class="headerlink" href="#passing-parameters-in-urls" title="Permalink to this headline">¶</a></h5>
<p>You often want to send some sort of data in the URL’s query string. If
you were constructing the URL by hand, this data would be given as key/value
pairs in the URL after a question mark, e.g. <code class="docutils literal notranslate"><span class="pre">httpbin.org/get?key=val</span></code>.
Requests allows you to provide these arguments as a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, using the
<code class="docutils literal notranslate"><span class="pre">params</span></code> keyword argument. As an example, if you wanted to pass
<code class="docutils literal notranslate"><span class="pre">key1=value1</span></code> and <code class="docutils literal notranslate"><span class="pre">key2=value2</span></code> to <code class="docutils literal notranslate"><span class="pre">httpbin.org/get</span></code>, you would use the
following code:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="s1">&#39;value1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="s1">&#39;value2&#39;</span><span class="p">}</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">,</span>
                       <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="n">expect</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/get?key2=value2&amp;key1=value1&#39;</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="o">==</span> <span class="n">expect</span>
</pre></div>
</div>
<p>You can see that the URL has been correctly encoded by printing the URL.</p>
<p>For sending data with multiple values for the same key
<code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDict</span></code> may be used as well.</p>
<p>It is also possible to pass a list of 2 item tuples as parameters, in
that case you can specify multiple values for each key:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value2&#39;</span><span class="p">)]</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">,</span>
                       <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
    <span class="n">expect</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/get?key=value2&amp;key=value1&#39;</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="o">==</span> <span class="n">expect</span>
</pre></div>
</div>
<p>You can also pass <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> content as param, but beware – content
is not encoded by library. Note that <code class="docutils literal notranslate"><span class="pre">+</span></code> is not encoded:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">,</span>
                       <span class="n">params</span><span class="o">=</span><span class="s1">&#39;key=value+1&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;http://httpbin.org/get?key=value+1&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>aiohttp</em> internally performs URL canonization before sending request.</p>
<p>Canonization encodes <em>host</em> part by <a class="reference internal" href="index.html#term-idna"><span class="xref std std-term">IDNA</span></a> codec and applies
<a class="reference internal" href="index.html#term-requoting"><span class="xref std std-term">requoting</span></a> to <em>path</em> and <em>query</em> parts.</p>
<p>For example <code class="docutils literal notranslate"><span class="pre">URL('http://example.com/путь/%30?a=%31')</span></code> is converted to
<code class="docutils literal notranslate"><span class="pre">URL('http://example.com/%D0%BF%D1%83%D1%82%D1%8C/0?a=1')</span></code>.</p>
<p>Sometimes canonization is not desirable if server accepts exact
representation and does not requote URL itself.</p>
<p>To disable canonization use <code class="docutils literal notranslate"><span class="pre">encoded=True</span></code> parameter for URL construction:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="n">URL</span><span class="p">(</span><span class="s1">&#39;http://example.com/%30&#39;</span><span class="p">,</span> <span class="n">encoded</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Passing <em>params</em> overrides <code class="docutils literal notranslate"><span class="pre">encoded=True</span></code>, never use both options.</p>
</div>
</div>
<div class="section" id="response-content-and-status-code">
<h5>Response Content and Status Code<a class="headerlink" href="#response-content-and-status-code" title="Permalink to this headline">¶</a></h5>
<p>We can read the content of the server’s response and its status
code. Consider the GitHub time-line again:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/events&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
<p>prints out something like:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="mi">200</span>
<span class="s1">&#39;[{&quot;created_at&quot;:&quot;2015-06-12T14:06:22Z&quot;,&quot;public&quot;:true,&quot;actor&quot;:{...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> automatically decodes the content from the server. You can
specify custom encoding for the <a class="reference internal" href="index.html#aiohttp.ClientResponse.text" title="aiohttp.ClientResponse.text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">text()</span></code></a> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;windows-1251&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="binary-response-content">
<h5>Binary Response Content<a class="headerlink" href="#binary-response-content" title="Permalink to this headline">¶</a></h5>
<p>You can also access the response body as bytes, for non-text requests:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="sa">b</span><span class="s1">&#39;[{&quot;created_at&quot;:&quot;2015-06-12T14:06:22Z&quot;,&quot;public&quot;:true,&quot;actor&quot;:{...</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">gzip</span></code> and <code class="docutils literal notranslate"><span class="pre">deflate</span></code> transfer-encodings are automatically
decoded for you.</p>
<p>You can enable <code class="docutils literal notranslate"><span class="pre">brotli</span></code> transfer-encodings support,
just install  <a class="reference external" href="https://github.com/python-hyper/brotlipy">brotlipy</a>.</p>
</div>
<div class="section" id="json-request">
<h5>JSON Request<a class="headerlink" href="#json-request" title="Permalink to this headline">¶</a></h5>
<p>Any of session’s request methods like <a class="reference internal" href="index.html#aiohttp.request" title="aiohttp.request"><code class="xref py py-func docutils literal notranslate"><span class="pre">request()</span></code></a>,
<a class="reference internal" href="index.html#aiohttp.ClientSession.get" title="aiohttp.ClientSession.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.get()</span></code></a>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSesssion.post()</span></code> etc. accept
<cite>json</cite> parameter:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>By default session uses python’s standard <a class="reference external" href="https://docs.python.org/3/library/json.html#module-json" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code></a> module for
serialization.  But it is possible to use different
<code class="docutils literal notranslate"><span class="pre">serializer</span></code>. <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> accepts <code class="docutils literal notranslate"><span class="pre">json_serialize</span></code>
parameter:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ujson</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span>
        <span class="n">json_serialize</span><span class="o">=</span><span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">})</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">ujson</span></code> library is faster than standard <a class="reference external" href="https://docs.python.org/3/library/json.html#module-json" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code></a> but slightly
incompatible.</p>
</div>
</div>
<div class="section" id="json-response-content">
<h5>JSON Response Content<a class="headerlink" href="#json-response-content" title="Permalink to this headline">¶</a></h5>
<p>There’s also a built-in JSON decoder, in case you’re dealing with JSON data:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/events&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</pre></div>
</div>
<p>In case that JSON decoding fails, <a class="reference internal" href="index.html#aiohttp.ClientResponse.json" title="aiohttp.ClientResponse.json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">json()</span></code></a> will
raise an exception. It is possible to specify custom encoding and
decoder functions for the <a class="reference internal" href="index.html#aiohttp.ClientResponse.json" title="aiohttp.ClientResponse.json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">json()</span></code></a> call.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The methods above reads the whole response body into memory. If you are
planning on reading lots of data, consider using the streaming response
method documented below.</p>
</div>
</div>
<div class="section" id="streaming-response-content">
<h5>Streaming Response Content<a class="headerlink" href="#streaming-response-content" title="Permalink to this headline">¶</a></h5>
<p>While methods <a class="reference internal" href="index.html#aiohttp.ClientResponse.read" title="aiohttp.ClientResponse.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a>,
<a class="reference internal" href="index.html#aiohttp.ClientResponse.json" title="aiohttp.ClientResponse.json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">json()</span></code></a> and <a class="reference internal" href="index.html#aiohttp.ClientResponse.text" title="aiohttp.ClientResponse.text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">text()</span></code></a> are very
convenient you should use them carefully. All these methods load the
whole response in memory.  For example if you want to download several
gigabyte sized files, these methods will load all the data in
memory. Instead you can use the <a class="reference internal" href="index.html#aiohttp.ClientResponse.content" title="aiohttp.ClientResponse.content"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content</span></code></a>
attribute. It is an instance of the <a class="reference internal" href="index.html#aiohttp.StreamReader" title="aiohttp.StreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.StreamReader</span></code></a>
class. The <code class="docutils literal notranslate"><span class="pre">gzip</span></code> and <code class="docutils literal notranslate"><span class="pre">deflate</span></code> transfer-encodings are
automatically decoded for you:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/events&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>In general, however, you should use a pattern like this to save what is being
streamed to a file:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</pre></div>
</div>
<p>It is not possible to use <a class="reference internal" href="index.html#aiohttp.ClientResponse.read" title="aiohttp.ClientResponse.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a>,
<a class="reference internal" href="index.html#aiohttp.ClientResponse.json" title="aiohttp.ClientResponse.json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">json()</span></code></a> and <a class="reference internal" href="index.html#aiohttp.ClientResponse.text" title="aiohttp.ClientResponse.text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">text()</span></code></a> after
explicit reading from <a class="reference internal" href="index.html#aiohttp.ClientResponse.content" title="aiohttp.ClientResponse.content"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content</span></code></a>.</p>
</div>
<div class="section" id="more-complicated-post-requests">
<h5>More complicated POST requests<a class="headerlink" href="#more-complicated-post-requests" title="Permalink to this headline">¶</a></h5>
<p>Typically, you want to send some form-encoded data – much like an HTML form.
To do this, simply pass a dictionary to the <em>data</em> argument. Your
dictionary of data will automatically be form-encoded when the request is made:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="s1">&#39;value1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="s1">&#39;value2&#39;</span><span class="p">}</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="o">...</span>
  <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span>
  <span class="p">},</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you want to send data that is not form-encoded you can do it by
passing a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> instead of a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>. This data will be
posted directly and content-type set to ‘application/octet-stream’ by
default:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">Binary-data</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>If you want to send JSON data:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">})</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>To send text with appropriate content-type just use <code class="docutils literal notranslate"><span class="pre">text</span></code> attribute</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Тест&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="post-a-multipart-encoded-file">
<h5>POST a Multipart-Encoded File<a class="headerlink" href="#post-a-multipart-encoded-file" title="Permalink to this headline">¶</a></h5>
<p>To upload Multipart-encoded files:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/post&#39;</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;report.xls&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)}</span>

<span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
</pre></div>
</div>
<p>You can set the <code class="docutils literal notranslate"><span class="pre">filename</span></code> and <code class="docutils literal notranslate"><span class="pre">content_type</span></code> explicitly:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/post&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">FormData</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span>
               <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;report.xls&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">),</span>
               <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;report.xls&#39;</span><span class="p">,</span>
               <span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/vnd.ms-excel&#39;</span><span class="p">)</span>

<span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>If you pass a file object as data parameter, aiohttp will stream it to
the server automatically. Check <code class="xref py py-class docutils literal notranslate"><span class="pre">StreamReader</span></code>
for supported format information.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-multipart"><span class="std std-ref">Working with Multipart</span></a></p>
</div>
</div>
<div class="section" id="streaming-uploads">
<h5>Streaming uploads<a class="headerlink" href="#streaming-uploads" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp" title="aiohttp"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp</span></code></a> supports multiple types of streaming uploads, which allows you to
send large files without reading them into memory.</p>
<p>As a simple case, simply provide a file-like object for your body:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;massive-body&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
   <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>Or you can use <em>asynchronous generator</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">file_sender</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">64</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">chunk</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">chunk</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">64</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>

<span class="c1"># Then you can use file_sender as a data provider:</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">file_sender</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;huge_file&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
<p>Because the <a class="reference internal" href="index.html#aiohttp.ClientResponse.content" title="aiohttp.ClientResponse.content"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content</span></code></a> attribute is a
<a class="reference internal" href="index.html#aiohttp.StreamReader" title="aiohttp.StreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamReader</span></code></a> (provides async iterator protocol), you
can chain get and post requests together:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://python.org&#39;</span><span class="p">)</span>
<span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span>
                   <span class="n">data</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Python 3.5 has no native support for asynchronous generators, use
<code class="docutils literal notranslate"><span class="pre">async_generator</span></code> library as workaround.</p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.1: </span><code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> still supports <code class="docutils literal notranslate"><span class="pre">aiohttp.streamer</span></code> decorator but this
approach is deprecated in favor of <em>asynchronous generators</em> as
shown above.</p>
</div>
</div>
<div class="section" id="websockets">
<span id="aiohttp-client-websockets"></span><h5>WebSockets<a class="headerlink" href="#websockets" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp" title="aiohttp"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp</span></code></a> works with client websockets out-of-the-box.</p>
<p>You have to use the <a class="reference internal" href="index.html#aiohttp.ClientSession.ws_connect" title="aiohttp.ClientSession.ws_connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.ClientSession.ws_connect()</span></code></a> coroutine
for client websocket connection. It accepts a <em>url</em> as a first
parameter and returns <a class="reference internal" href="index.html#aiohttp.ClientWebSocketResponse" title="aiohttp.ClientWebSocketResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientWebSocketResponse</span></code></a>, with that
object you can communicate with websocket server using response’s
methods:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">ws_connect</span><span class="p">(</span><span class="s1">&#39;http://example.org/ws&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ws</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">WSMsgType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;close cmd&#39;</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send_str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;/answer&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">WSMsgType</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
            <span class="k">break</span>
</pre></div>
</div>
<p>You <strong>must</strong> use the only websocket task for both reading (e.g. <code class="docutils literal notranslate"><span class="pre">await</span>
<span class="pre">ws.receive()</span></code> or <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">for</span> <span class="pre">msg</span> <span class="pre">in</span> <span class="pre">ws:</span></code>) and writing but may have
multiple writer tasks which can only send data asynchronously (by
<code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">ws.send_str('data')</span></code> for example).</p>
</div>
<div class="section" id="timeouts">
<span id="aiohttp-client-timeouts"></span><h5>Timeouts<a class="headerlink" href="#timeouts" title="Permalink to this headline">¶</a></h5>
<p>Timeout settings are stored in <a class="reference internal" href="index.html#aiohttp.ClientTimeout" title="aiohttp.ClientTimeout"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientTimeout</span></code></a> data structure.</p>
<p>By default <em>aiohttp</em> uses a <em>total</em> 5min timeout, it means that the
whole operation should finish in 5 minutes.</p>
<p>The value could be overridden by <em>timeout</em> parameter for the session:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">timeout</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Timeout could be overridden for a request like <a class="reference internal" href="index.html#aiohttp.ClientSession.get" title="aiohttp.ClientSession.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.get()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Supported <a class="reference internal" href="index.html#aiohttp.ClientTimeout" title="aiohttp.ClientTimeout"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientTimeout</span></code></a> fields are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">total</span></code></p>
<blockquote>
<div><p>The whole operation time including connection
establishment, request sending and response reading.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">connect</span></code></p>
<blockquote>
<div><p>The time
consists connection establishment for a new connection or
waiting for a free connection from a pool if pool connection
limits are exceeded.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">sock_connect</span></code></p>
<blockquote>
<div><p>A timeout for connecting to a peer for a new connection, not
given from a pool.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">sock_read</span></code></p>
<blockquote>
<div><p>The maximum allowed timeout for period between reading a new
data portion from a peer.</p>
</div></blockquote>
</div></blockquote>
<p>All fields are floats, <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code> disables a particular timeout check, see the
<a class="reference internal" href="index.html#aiohttp.ClientTimeout" title="aiohttp.ClientTimeout"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientTimeout</span></code></a> reference for defaults and additional details.</p>
<p>Thus the default timeout is:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">sock_connect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sock_read</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-client_advanced"></span><div class="section" id="advanced-client-usage">
<span id="aiohttp-client-advanced"></span><h4>Advanced Client Usage<a class="headerlink" href="#advanced-client-usage" title="Permalink to this headline">¶</a></h4>
<div class="section" id="client-session">
<span id="aiohttp-client-session"></span><h5>Client Session<a class="headerlink" href="#client-session" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> is the heart and the main entry point for all
client API operations.</p>
<p>Create the session first, use the instance for performing HTTP
requests and initiating WebSocket connections.</p>
<p>The session contains a cookie storage and connection pool, thus
cookies and connections are shared between HTTP requests sent by the
same session.</p>
</div>
<div class="section" id="custom-request-headers">
<h5>Custom Request Headers<a class="headerlink" href="#custom-request-headers" title="Permalink to this headline">¶</a></h5>
<p>If you need to add HTTP headers to a request, pass them in a
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> to the <em>headers</em> parameter.</p>
<p>For example, if you want to specify the content-type directly:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://example.com/image&#39;</span>
<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;GIF89a</span><span class="se">\x01\x00\x01\x00\x00\xff\x00</span><span class="s1">,</span><span class="se">\x00\x00</span><span class="s1">&#39;</span>
          <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00\x01\x00\x01\x00\x00\x02\x00</span><span class="s1">;&#39;</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;content-type&#39;</span><span class="p">:</span> <span class="s1">&#39;image/gif&#39;</span><span class="p">}</span>

<span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
                   <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                   <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</pre></div>
</div>
<p>You also can set default headers for all session requests:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Basic bG9naW46cGFzcw==&quot;</span><span class="p">}</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://httpbin.org/headers&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">json_body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">json_body</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">==</span> \
            <span class="s1">&#39;Basic bG9naW46cGFzcw==&#39;</span>
</pre></div>
</div>
<p>Typical use case is sending JSON body. You can specify content type
directly as shown above, but it is more convenient to use special keyword
<code class="docutils literal notranslate"><span class="pre">json</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;example&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>For <em>text/plain</em></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;Привет, Мир!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-cookies">
<h5>Custom Cookies<a class="headerlink" href="#custom-cookies" title="Permalink to this headline">¶</a></h5>
<p>To send your own cookies to the server, you can use the <em>cookies</em>
parameter of <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> constructor:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/cookies&#39;</span>
<span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cookies_are&#39;</span><span class="p">:</span> <span class="s1">&#39;working&#39;</span><span class="p">}</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">ClientSession</span><span class="p">(</span><span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
        <span class="k">assert</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
           <span class="s2">&quot;cookies&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;cookies_are&quot;</span><span class="p">:</span> <span class="s2">&quot;working&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">httpbin.org/cookies</span></code> endpoint returns request cookies
in JSON-encoded body.
To access session cookies see <a class="reference internal" href="index.html#aiohttp.ClientSession.cookie_jar" title="aiohttp.ClientSession.cookie_jar"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ClientSession.cookie_jar</span></code></a>.</p>
</div>
<p><a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> may be used for sharing cookies
between multiple requests:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s1">&#39;http://httpbin.org/cookies/set?my_cookie=my_value&#39;</span><span class="p">)</span>
    <span class="n">filtered</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">cookie_jar</span><span class="o">.</span><span class="n">filter_cookies</span><span class="p">(</span>
        <span class="s1">&#39;http://httpbin.org&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">filtered</span><span class="p">[</span><span class="s1">&#39;my_cookie&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;my_value&#39;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/cookies&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">json_body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">json_body</span><span class="p">[</span><span class="s1">&#39;cookies&#39;</span><span class="p">][</span><span class="s1">&#39;my_cookie&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;my_value&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="response-headers-and-cookies">
<h5>Response Headers and Cookies<a class="headerlink" href="#response-headers-and-cookies" title="Permalink to this headline">¶</a></h5>
<p>We can view the server’s response <a class="reference internal" href="index.html#aiohttp.ClientResponse.headers" title="aiohttp.ClientResponse.headers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ClientResponse.headers</span></code></a> using
a <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.CIMultiDictProxy" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIMultiDictProxy</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">headers</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;ACCESS-CONTROL-ALLOW-ORIGIN&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CONTENT-TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DATE&#39;</span><span class="p">:</span> <span class="s1">&#39;Tue, 15 Jul 2014 16:49:51 GMT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SERVER&#39;</span><span class="p">:</span> <span class="s1">&#39;gunicorn/18.0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CONTENT-LENGTH&#39;</span><span class="p">:</span> <span class="s1">&#39;331&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CONNECTION&#39;</span><span class="p">:</span> <span class="s1">&#39;keep-alive&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>The dictionary is special, though: it’s made just for HTTP
headers. According to <a class="reference external" href="http://tools.ietf.org/html/rfc7230#section-3.2">RFC 7230</a>, HTTP Header names
are case-insensitive. It also supports multiple values for the same
key as HTTP protocol does.</p>
<p>So, we can access the headers using any capitalization we want:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;application/json&#39;</span>

<span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;application/json&#39;</span>
</pre></div>
</div>
<p>All headers are converted from binary data using UTF-8 with
<code class="docutils literal notranslate"><span class="pre">surrogateescape</span></code> option. That works fine on most cases but
sometimes unconverted data is needed if a server uses nonstandard
encoding. While these headers are malformed from <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc7230.html"><strong>RFC 7230</strong></a>
perspective they may be retrieved by using
<a class="reference internal" href="index.html#aiohttp.ClientResponse.raw_headers" title="aiohttp.ClientResponse.raw_headers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ClientResponse.raw_headers</span></code></a> property:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">raw_headers</span> <span class="o">==</span> <span class="p">(</span>
    <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;SERVER&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;nginx&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;DATE&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Sat, 09 Jan 2016 20:28:40 GMT&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;CONTENT-TYPE&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;text/html; charset=utf-8&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;CONTENT-LENGTH&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;12150&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;CONNECTION&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;keep-alive&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>If a response contains some <em>HTTP Cookies</em>, you can quickly access them:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://example.com/some/cookie/setting/url&#39;</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">cookies</span><span class="p">[</span><span class="s1">&#39;example_cookie_name&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Response cookies contain only values, that were in <code class="docutils literal notranslate"><span class="pre">Set-Cookie</span></code> headers
of the <strong>last</strong> request in redirection chain. To gather cookies between all
redirection requests please use <a class="reference internal" href="#aiohttp-client-session"><span class="std std-ref">aiohttp.ClientSession</span></a> object.</p>
</div>
</div>
<div class="section" id="redirection-history">
<h5>Redirection History<a class="headerlink" href="#redirection-history" title="Permalink to this headline">¶</a></h5>
<p>If a request was redirected, it is possible to view previous responses using
the <a class="reference internal" href="index.html#aiohttp.ClientResponse.history" title="aiohttp.ClientResponse.history"><code class="xref py py-attr docutils literal notranslate"><span class="pre">history</span></code></a> attribute:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://example.com/some/redirect/&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
<span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">URL</span><span class="p">(</span><span class="s1">&#39;http://example.com/some/other/url/&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">301</span>
<span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">URL</span><span class="p">(</span>
    <span class="s1">&#39;http://example.com/some/redirect/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If no redirects occurred or <code class="docutils literal notranslate"><span class="pre">allow_redirects</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>,
history will be an empty sequence.</p>
</div>
<div class="section" id="cookie-jar">
<h5>Cookie Jar<a class="headerlink" href="#cookie-jar" title="Permalink to this headline">¶</a></h5>
<div class="section" id="cookie-safety">
<span id="aiohttp-client-cookie-safety"></span><h6>Cookie Safety<a class="headerlink" href="#cookie-safety" title="Permalink to this headline">¶</a></h6>
<p>By default <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> uses strict version of
<a class="reference internal" href="index.html#aiohttp.CookieJar" title="aiohttp.CookieJar"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.CookieJar</span></code></a>. <span class="target" id="index-1"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2109.html"><strong>RFC 2109</strong></a> explicitly forbids cookie
accepting from URLs with IP address instead of DNS name
(e.g. <cite>http://127.0.0.1:80/cookie</cite>).</p>
<p>It’s good but sometimes for testing we need to enable support for such
cookies. It should be done by passing <cite>unsafe=True</cite> to
<a class="reference internal" href="index.html#aiohttp.CookieJar" title="aiohttp.CookieJar"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.CookieJar</span></code></a> constructor:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">jar</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">CookieJar</span><span class="p">(</span><span class="n">unsafe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">cookie_jar</span><span class="o">=</span><span class="n">jar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dummy-cookie-jar">
<span id="aiohttp-client-dummy-cookie-jar"></span><h6>Dummy Cookie Jar<a class="headerlink" href="#dummy-cookie-jar" title="Permalink to this headline">¶</a></h6>
<p>Sometimes cookie processing is not desirable. For this purpose it’s
possible to pass <a class="reference internal" href="index.html#aiohttp.DummyCookieJar" title="aiohttp.DummyCookieJar"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.DummyCookieJar</span></code></a> instance into client
session:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">jar</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">DummyCookieJar</span><span class="p">()</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">cookie_jar</span><span class="o">=</span><span class="n">jar</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="uploading-pre-compressed-data">
<h5>Uploading pre-compressed data<a class="headerlink" href="#uploading-pre-compressed-data" title="Permalink to this headline">¶</a></h5>
<p>To upload data that is already compressed before passing it to
aiohttp, call the request function with the used compression algorithm
name (usually <code class="docutils literal notranslate"><span class="pre">deflate</span></code> or <code class="docutils literal notranslate"><span class="pre">gzip</span></code>) as the value of the
<code class="docutils literal notranslate"><span class="pre">Content-Encoding</span></code> header:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">my_coroutine</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">my_data</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">my_data</span><span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;deflate&#39;</span><span class="p">}</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span>
                            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="disabling-content-type-validation-for-json-responses">
<h5>Disabling content type validation for JSON responses<a class="headerlink" href="#disabling-content-type-validation-for-json-responses" title="Permalink to this headline">¶</a></h5>
<p>The standard explicitly restricts JSON <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> HTTP header to
<code class="docutils literal notranslate"><span class="pre">application/json</span></code> or any extended form, e.g. <code class="docutils literal notranslate"><span class="pre">application/vnd.custom-type+json</span></code>.
Unfortunately, some servers send a wrong type, like <code class="docutils literal notranslate"><span class="pre">text/html</span></code>.</p>
<p>This can be worked around in two ways:</p>
<ol class="arabic">
<li><p>Pass the expected type explicitly (in this case checking will be strict, without the extended form support,
so <code class="docutils literal notranslate"><span class="pre">custom/xxx+type</span></code> won’t be accepted):</p>
<p><code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">resp.json(content_type='custom/type')</span></code>.</p>
</li>
<li><p>Disable the check entirely:</p>
<p><code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">resp.json(content_type=None)</span></code>.</p>
</li>
</ol>
</div>
<div class="section" id="client-tracing">
<span id="aiohttp-client-tracing"></span><h5>Client Tracing<a class="headerlink" href="#client-tracing" title="Permalink to this headline">¶</a></h5>
<p>The execution flow of a specific request can be followed attaching
listeners coroutines to the signals provided by the
<a class="reference internal" href="index.html#aiohttp.TraceConfig" title="aiohttp.TraceConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">TraceConfig</span></code></a> instance, this instance will be used as a
parameter for the <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> constructor having as a
result a client that triggers the different signals supported by the
<a class="reference internal" href="index.html#aiohttp.TraceConfig" title="aiohttp.TraceConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">TraceConfig</span></code></a>. By default any instance of
<a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> class comes with the signals ability
disabled. The following snippet shows how the start and the end
signals of a request flow can be followed:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">on_request_start</span><span class="p">(</span>
        <span class="n">session</span><span class="p">,</span> <span class="n">trace_config_ctx</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting request&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">on_request_end</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">trace_config_ctx</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ending request&quot;</span><span class="p">)</span>

<span class="n">trace_config</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TraceConfig</span><span class="p">()</span>
<span class="n">trace_config</span><span class="o">.</span><span class="n">on_request_start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">on_request_start</span><span class="p">)</span>
<span class="n">trace_config</span><span class="o">.</span><span class="n">on_request_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">on_request_end</span><span class="p">)</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span>
        <span class="n">trace_configs</span><span class="o">=</span><span class="p">[</span><span class="n">trace_config</span><span class="p">])</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://example.com/some/redirect/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">trace_configs</span></code> is a list that can contain instances of
<a class="reference internal" href="index.html#aiohttp.TraceConfig" title="aiohttp.TraceConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">TraceConfig</span></code></a> class that allow run the signals handlers coming
from different <a class="reference internal" href="index.html#aiohttp.TraceConfig" title="aiohttp.TraceConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">TraceConfig</span></code></a> instances.  The following example
shows how two different <a class="reference internal" href="index.html#aiohttp.TraceConfig" title="aiohttp.TraceConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">TraceConfig</span></code></a> that have a different
nature are installed to perform their job in each signal handle:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mylib.traceconfig</span> <span class="k">import</span> <span class="n">AuditRequest</span>
<span class="kn">from</span> <span class="nn">mylib.traceconfig</span> <span class="k">import</span> <span class="n">XRay</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span>
        <span class="n">trace_configs</span><span class="o">=</span><span class="p">[</span><span class="n">AuditRequest</span><span class="p">(),</span> <span class="n">XRay</span><span class="p">()])</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://example.com/some/redirect/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>All signals take as a parameters first, the <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a>
instance used by the specific request related to that signals and
second, a <code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNamespace</span></code> instance called
<code class="docutils literal notranslate"><span class="pre">trace_config_ctx</span></code>. The <code class="docutils literal notranslate"><span class="pre">trace_config_ctx</span></code> object can be used to
share the state through to the different signals that belong to the
same request and to the same <a class="reference internal" href="index.html#aiohttp.TraceConfig" title="aiohttp.TraceConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">TraceConfig</span></code></a> class, perhaps:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">on_request_start</span><span class="p">(</span>
        <span class="n">session</span><span class="p">,</span> <span class="n">trace_config_ctx</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">trace_config_ctx</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">on_request_end</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">trace_config_ctx</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">trace_config_ctx</span><span class="o">.</span><span class="n">start</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request took </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">trace_config_ctx</span></code> param is by default a
<code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleNampespace</span></code> that is initialized at the beginning of the
request flow. However, the factory used to create this object can be
overwritten using the <code class="docutils literal notranslate"><span class="pre">trace_config_ctx_factory</span></code> constructor param of
the <a class="reference internal" href="index.html#aiohttp.TraceConfig" title="aiohttp.TraceConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">TraceConfig</span></code></a> class.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">trace_request_ctx</span></code> param can given at the beginning of the
request execution, accepted by all of the HTTP verbs,  and will be
passed as a keyword argument for the <code class="docutils literal notranslate"><span class="pre">trace_config_ctx_factory</span></code>
factory. This param is useful to pass data that is only available at
request time, perhaps:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">on_request_start</span><span class="p">(</span>
        <span class="n">session</span><span class="p">,</span> <span class="n">trace_config_ctx</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">trace_config_ctx</span><span class="o">.</span><span class="n">trace_request_ctx</span><span class="p">)</span>


<span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://example.com/some/redirect/&#39;</span><span class="p">,</span>
            <span class="n">trace_request_ctx</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">})</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-client-tracing-reference"><span class="std std-ref">Tracing Reference</span></a> section for
more information about the different signals supported.</p>
</div>
</div>
<div class="section" id="connectors">
<h5>Connectors<a class="headerlink" href="#connectors" title="Permalink to this headline">¶</a></h5>
<p>To tweak or change <em>transport</em> layer of requests you can pass a custom
<em>connector</em> to <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> and family. For example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">()</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default <em>session</em> object takes the ownership of the connector, among
other things closing the connections once the <em>session</em> is closed. If
you are keen on share the same <em>connector</em> through different <em>session</em>
instances you must give the  <em>connector_owner</em> parameter as <strong>False</strong>
for each <em>session</em> instance.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-client-reference-connectors"><span class="std std-ref">Connectors</span></a> section for
more information about different connector types and
configuration options.</p>
</div>
<div class="section" id="limiting-connection-pool-size">
<h6>Limiting connection pool size<a class="headerlink" href="#limiting-connection-pool-size" title="Permalink to this headline">¶</a></h6>
<p>To limit amount of simultaneously opened connections you can pass <em>limit</em>
parameter to <em>connector</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<p>The example limits total amount of parallel connections to <cite>30</cite>.</p>
<p>The default is <cite>100</cite>.</p>
<p>If you explicitly want not to have limits, pass <cite>0</cite>. For example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>To limit amount of simultaneously opened connection to the same
endpoint (<code class="docutils literal notranslate"><span class="pre">(host,</span> <span class="pre">port,</span> <span class="pre">is_ssl)</span></code> triple) you can pass <em>limit_per_host</em>
parameter to <em>connector</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span><span class="n">limit_per_host</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<p>The example limits amount of parallel connections to the same to <cite>30</cite>.</p>
<p>The default is <cite>0</cite> (no limit on per host bases).</p>
</div>
<div class="section" id="tuning-the-dns-cache">
<h6>Tuning the DNS cache<a class="headerlink" href="#tuning-the-dns-cache" title="Permalink to this headline">¶</a></h6>
<p>By default <a class="reference internal" href="index.html#aiohttp.TCPConnector" title="aiohttp.TCPConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">TCPConnector</span></code></a> comes with the DNS cache
table enabled, and resolutions will be cached by default for <cite>10</cite> seconds.
This behavior can be changed either to change of the TTL for a resolution,
as can be seen in the following example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span><span class="n">ttl_dns_cache</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<p>or disabling the use of the DNS cache table, meaning that all requests will
end up making a DNS resolution, as the following example shows:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span><span class="n">use_dns_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="resolving-using-custom-nameservers">
<h6>Resolving using custom nameservers<a class="headerlink" href="#resolving-using-custom-nameservers" title="Permalink to this headline">¶</a></h6>
<p>In order to specify the nameservers to when resolving the hostnames,
<a class="reference internal" href="index.html#term-aiodns"><span class="xref std std-term">aiodns</span></a> is required:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp.resolver</span> <span class="k">import</span> <span class="n">AsyncResolver</span>

<span class="n">resolver</span> <span class="o">=</span> <span class="n">AsyncResolver</span><span class="p">(</span><span class="n">nameservers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;8.8.8.8&quot;</span><span class="p">,</span> <span class="s2">&quot;8.8.4.4&quot;</span><span class="p">])</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span><span class="n">resolver</span><span class="o">=</span><span class="n">resolver</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="unix-domain-sockets">
<h6>Unix domain sockets<a class="headerlink" href="#unix-domain-sockets" title="Permalink to this headline">¶</a></h6>
<p>If your HTTP server uses UNIX domain sockets you can use
<a class="reference internal" href="index.html#aiohttp.UnixConnector" title="aiohttp.UnixConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnixConnector</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">UnixConnector</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;/path/to/socket&#39;</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="named-pipes-in-windows">
<h6>Named pipes in Windows<a class="headerlink" href="#named-pipes-in-windows" title="Permalink to this headline">¶</a></h6>
<p>If your HTTP server uses Named pipes you can use
<code class="xref py py-class docutils literal notranslate"><span class="pre">NamedPipeConnector</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">NamedPipeConnector</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.\pipe\&lt;name-of-pipe&gt;&#39;</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
<p>It will only work with the ProactorEventLoop</p>
</div>
</div>
<div class="section" id="ssl-control-for-tcp-sockets">
<h5>SSL control for TCP sockets<a class="headerlink" href="#ssl-control-for-tcp-sockets" title="Permalink to this headline">¶</a></h5>
<p>By default <em>aiohttp</em> uses strict checks for HTTPS protocol. Certification
checks can be relaxed by setting <em>ssl</em> to <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>If you need to setup custom ssl parameters (use own certification
files for example) you can create a <a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> instance and
pass it into the proper <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sslcontext</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">(</span>
   <span class="n">cafile</span><span class="o">=</span><span class="s1">&#39;/path/to/ca-bundle.crt&#39;</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="n">sslcontext</span><span class="p">)</span>
</pre></div>
</div>
<p>If you need to verify <em>self-signed</em> certificates, you can do the
same thing as the previous example, but add another call to
<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext.load_cert_chain" title="(in Python v3.7)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ssl.SSLContext.load_cert_chain()</span></code></a> with the key pair:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sslcontext</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">(</span>
   <span class="n">cafile</span><span class="o">=</span><span class="s1">&#39;/path/to/ca-bundle.crt&#39;</span><span class="p">)</span>
<span class="n">sslcontext</span><span class="o">.</span><span class="n">load_cert_chain</span><span class="p">(</span><span class="s1">&#39;/path/to/client/public/device.pem&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;/path/to/client/private/device.key&#39;</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://example.com&#39;</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="n">sslcontext</span><span class="p">)</span>
</pre></div>
</div>
<p>There is explicit errors when ssl verification fails</p>
<p><a class="reference internal" href="index.html#aiohttp.ClientConnectorSSLError" title="aiohttp.ClientConnectorSSLError"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.ClientConnectorSSLError</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://expired.badssl.com/&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientConnectorSSLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#aiohttp.ClientConnectorCertificateError" title="aiohttp.ClientConnectorCertificateError"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.ClientConnectorCertificateError</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://wrong.host.badssl.com/&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientConnectorCertificateError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CertificateError</span><span class="p">)</span>
</pre></div>
</div>
<p>If you need to skip both ssl related errors</p>
<p><a class="reference internal" href="index.html#aiohttp.ClientSSLError" title="aiohttp.ClientSSLError"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.ClientSSLError</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://expired.badssl.com/&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSSLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://wrong.host.badssl.com/&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSSLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CertificateError</span><span class="p">)</span>
</pre></div>
</div>
<p>You may also verify certificates via <em>SHA256</em> fingerprint:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Attempt to connect to https://www.python.org</span>
<span class="c1"># with a pin to a bogus certificate:</span>
<span class="n">bad_fp</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;0&#39;</span><span class="o">*</span><span class="mi">64</span>
<span class="n">exc</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://www.python.org&#39;</span><span class="p">,</span>
                          <span class="n">ssl</span><span class="o">=</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">Fingerprint</span><span class="p">(</span><span class="n">bad_fp</span><span class="p">))</span>
<span class="k">except</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">FingerprintMismatch</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">exc</span> <span class="o">=</span> <span class="n">e</span>
<span class="k">assert</span> <span class="n">exc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="k">assert</span> <span class="n">exc</span><span class="o">.</span><span class="n">expected</span> <span class="o">==</span> <span class="n">bad_fp</span>

<span class="c1"># www.python.org cert&#39;s actual fingerprint</span>
<span class="k">assert</span> <span class="n">exc</span><span class="o">.</span><span class="n">got</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;...&#39;</span>
</pre></div>
</div>
<p>Note that this is the fingerprint of the DER-encoded certificate.
If you have the certificate in PEM format, you can convert it to
DER with e.g:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">openssl</span> <span class="n">x509</span> <span class="o">-</span><span class="ow">in</span> <span class="n">crt</span><span class="o">.</span><span class="n">pem</span> <span class="o">-</span><span class="n">inform</span> <span class="n">PEM</span> <span class="o">-</span><span class="n">outform</span> <span class="n">DER</span> <span class="o">&gt;</span> <span class="n">crt</span><span class="o">.</span><span class="n">der</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tip: to convert from a hexadecimal digest to a binary byte-string,
you can use <a class="reference external" href="https://docs.python.org/3/library/binascii.html#binascii.unhexlify" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">binascii.unhexlify()</span></code></a>.</p>
<p><em>ssl</em> parameter could be passed
to <a class="reference internal" href="index.html#aiohttp.TCPConnector" title="aiohttp.TCPConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">TCPConnector</span></code></a> as default, the value from
<a class="reference internal" href="index.html#aiohttp.ClientSession.get" title="aiohttp.ClientSession.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.get()</span></code></a> and others override default.</p>
</div>
</div>
<div class="section" id="proxy-support">
<h5>Proxy support<a class="headerlink" href="#proxy-support" title="Permalink to this headline">¶</a></h5>
<p>aiohttp supports plain HTTP proxies and HTTP proxies that can be upgraded to HTTPS
via the HTTP CONNECT method. aiohttp does not support proxies that must be
connected to via <code class="docutils literal notranslate"><span class="pre">https://</span></code>. To connect, use the <em>proxy</em> parameter:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://python.org&quot;</span><span class="p">,</span>
                           <span class="n">proxy</span><span class="o">=</span><span class="s2">&quot;http://proxy.com&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</pre></div>
</div>
<p>It also supports proxy authorization:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">proxy_auth</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">BasicAuth</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://python.org&quot;</span><span class="p">,</span>
                           <span class="n">proxy</span><span class="o">=</span><span class="s2">&quot;http://proxy.com&quot;</span><span class="p">,</span>
                           <span class="n">proxy_auth</span><span class="o">=</span><span class="n">proxy_auth</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</pre></div>
</div>
<p>Authentication credentials can be passed in proxy URL:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://python.org&quot;</span><span class="p">,</span>
            <span class="n">proxy</span><span class="o">=</span><span class="s2">&quot;http://user:pass@some.proxy.com&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Contrary to the <code class="docutils literal notranslate"><span class="pre">requests</span></code> library, it won’t read environment
variables by default. But you can do so by passing
<code class="docutils literal notranslate"><span class="pre">trust_env=True</span></code> into <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.ClientSession</span></code></a>
constructor for extracting proxy configuration from
<em>HTTP_PROXY</em> or <em>HTTPS_PROXY</em> <em>environment variables</em> (both are case
insensitive):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">trust_env</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://python.org&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</pre></div>
</div>
<p>Proxy credentials are given from <code class="docutils literal notranslate"><span class="pre">~/.netrc</span></code> file if present (see
<a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.ClientSession</span></code></a> for more details).</p>
</div>
<div class="section" id="graceful-shutdown">
<h5>Graceful Shutdown<a class="headerlink" href="#graceful-shutdown" title="Permalink to this headline">¶</a></h5>
<p>When <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> closes at the end of an <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span></code>
block (or through a direct <a class="reference internal" href="index.html#aiohttp.ClientSession.close" title="aiohttp.ClientSession.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.close()</span></code></a> call), the
underlying connection remains open due to asyncio internal details. In
practice, the underlying connection will close after a short
while. However, if the event loop is stopped before the underlying
connection is closed, an <code class="docutils literal notranslate"><span class="pre">ResourceWarning:</span> <span class="pre">unclosed</span> <span class="pre">transport</span></code>
warning is emitted (when warnings are enabled).</p>
<p>To avoid this situation, a small delay must be added before closing
the event loop to allow any open underlying connections to close.</p>
<p>For a <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> without SSL, a simple zero-sleep (<code class="docutils literal notranslate"><span class="pre">await</span>
<span class="pre">asyncio.sleep(0)</span></code>) will suffice:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">read_website</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://example.org/&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">read_website</span><span class="p">())</span>
<span class="c1"># Zero-sleep to allow underlying connections to close</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>For a <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> with SSL, the application must wait a
short duration before closing:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="c1"># Wait 250 ms for the underlying SSL connections to close</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.250</span><span class="p">))</span>
<span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that the appropriate amount of time to wait will vary from
application to application.</p>
<p>All if this will eventually become obsolete when the asyncio internals
are changed so that aiohttp itself can wait on the underlying
connection to close. Please follow issue <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/1925">#1925</a> for the progress
on this.</p>
</div>
</div>
<span id="document-client_reference"></span><div class="section" id="client-reference">
<span id="aiohttp-client-reference"></span><h4>Client Reference<a class="headerlink" href="#client-reference" title="Permalink to this headline">¶</a></h4>
<div class="section" id="client-session">
<h5>Client Session<a class="headerlink" href="#client-session" title="Permalink to this headline">¶</a></h5>
<p>Client session is the recommended interface for making HTTP requests.</p>
<p>Session encapsulates a <em>connection pool</em> (<em>connector</em> instance) and
supports keepalives by default. Unless you are connecting to a large,
unknown number of different servers over the lifetime of your
application, it is suggested you use a single session for the
lifetime of your application to benefit from connection pooling.</p>
<p>Usage example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">aiohttp</span>
<span class="kn">import</span> <span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://python.org&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fetch</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>The client session supports the context manager protocol for self closing.</p>
<dl class="class">
<dt id="aiohttp.ClientSession">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientSession</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">connector=None</em>, <em class="sig-param">loop=None</em>, <em class="sig-param">cookies=None</em>, <em class="sig-param">headers=None</em>, <em class="sig-param">skip_auto_headers=None</em>, <em class="sig-param">auth=None</em>, <em class="sig-param">json_serialize=json.dumps</em>, <em class="sig-param">version=aiohttp.HttpVersion11</em>, <em class="sig-param">cookie_jar=None</em>, <em class="sig-param">read_timeout=None</em>, <em class="sig-param">conn_timeout=None</em>, <em class="sig-param">timeout=sentinel</em>, <em class="sig-param">raise_for_status=False</em>, <em class="sig-param">connector_owner=True</em>, <em class="sig-param">auto_decompress=True</em>, <em class="sig-param">requote_redirect_url=False</em>, <em class="sig-param">trust_env=False</em>, <em class="sig-param">trace_configs=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession" title="Permalink to this definition">¶</a></dt>
<dd><p>The class for creating client sessions and making requests.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>connector</strong> (<em>aiohttp.connector.BaseConnector</em>) – BaseConnector
sub-class instance to support connection pooling.</p></li>
<li><p><strong>loop</strong> – <p><a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio-event-loop" title="(in Python v3.7)"><span class="xref std std-ref">event loop</span></a> used for
processing HTTP requests.</p>
<p>If <em>loop</em> is <code class="docutils literal notranslate"><span class="pre">None</span></code> the constructor
borrows it from <em>connector</em> if specified.</p>
<p><a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.get_event_loop" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.get_event_loop()</span></code></a> is used for getting default event
loop otherwise.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 2.0.</span></p>
</div>
</p></li>
<li><p><strong>cookies</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – Cookies to send with the request (optional)</p></li>
<li><p><strong>headers</strong> – <p>HTTP Headers to send with every request (optional).</p>
<p>May be either <em>iterable of key-value pairs</em> or
<a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a>
(e.g. <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>,
<a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.CIMultiDict" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIMultiDict</span></code></a>).</p>
</p></li>
<li><p><strong>skip_auto_headers</strong> – <p>set of headers for which autogeneration
should be skipped.</p>
<p><em>aiohttp</em> autogenerates headers like <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> or
<code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> if these headers are not explicitly
passed. Using <code class="docutils literal notranslate"><span class="pre">skip_auto_headers</span></code> parameter allows to skip
that generation. Note that <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> autogeneration can’t
be skipped.</p>
<p>Iterable of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <code class="xref py py-class docutils literal notranslate"><span class="pre">istr</span></code> (optional)</p>
</p></li>
<li><p><strong>auth</strong> (<a class="reference internal" href="index.html#aiohttp.BasicAuth" title="aiohttp.BasicAuth"><em>aiohttp.BasicAuth</em></a>) – an object that represents HTTP Basic
Authorization (optional)</p></li>
<li><p><strong>version</strong> – supported HTTP version, <code class="docutils literal notranslate"><span class="pre">HTTP</span> <span class="pre">1.1</span></code> by default.</p></li>
<li><p><strong>cookie_jar</strong> – <p>Cookie Jar, <code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractCookieJar</span></code> instance.</p>
<p>By default every session instance has own private cookie jar for
automatic cookies processing but user may redefine this behavior
by providing own jar implementation.</p>
<p>One example is not processing cookies at all when working in
proxy mode.</p>
<p>If no cookie processing is needed, a
<a class="reference internal" href="#aiohttp.DummyCookieJar" title="aiohttp.DummyCookieJar"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.DummyCookieJar</span></code></a> instance can be
provided.</p>
</p></li>
<li><p><strong>json_serialize</strong> (<em>callable</em>) – <p>Json <em>serializer</em> callable.</p>
<p>By default <a class="reference external" href="https://docs.python.org/3/library/json.html#json.dumps" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">json.dumps()</span></code></a> function.</p>
</p></li>
<li><p><strong>raise_for_status</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <p>Automatically call <a class="reference internal" href="#aiohttp.ClientResponse.raise_for_status" title="aiohttp.ClientResponse.raise_for_status"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientResponse.raise_for_status()</span></code></a> for
each response, <code class="docutils literal notranslate"><span class="pre">False</span></code> by default.</p>
<p>This parameter can be overridden when you making a request, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">client_session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">raise_for_status</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">raise_for_status</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">resp</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
</pre></div>
</div>
<p>Set the parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code> if you need <code class="docutils literal notranslate"><span class="pre">raise_for_status</span></code>
for most of cases but override <code class="docutils literal notranslate"><span class="pre">raise_for_status</span></code> for those
requests where you need to handle responses with status 400 or
higher.</p>
</p></li>
<li><p><strong>timeout</strong> – <dl class="simple">
<dt>a <a class="reference internal" href="#aiohttp.ClientTimeout" title="aiohttp.ClientTimeout"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientTimeout</span></code></a> settings structure, 5min</dt><dd><p>total timeout by default.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.3.</span></p>
</div>
</p></li>
<li><p><strong>read_timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – <p>Request operations timeout. <code class="docutils literal notranslate"><span class="pre">read_timeout</span></code> is
cumulative for all request operations (request, redirects, responses,
data consuming). By default, the read timeout is 5*60 seconds.
Use <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code> to disable timeout checks.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.3: </span>Use <code class="docutils literal notranslate"><span class="pre">timeout</span></code> parameter instead.</p>
</div>
</p></li>
<li><p><strong>conn_timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – <p>timeout for connection establishing
(optional). Values <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code> mean no timeout.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.3: </span>Use <code class="docutils literal notranslate"><span class="pre">timeout</span></code> parameter instead.</p>
</div>
</p></li>
<li><p><strong>connector_owner</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <p>Close connector instance on session closing.</p>
<p>Setting the parameter to <code class="docutils literal notranslate"><span class="pre">False</span></code> allows to share
connection pool between sessions without sharing session state:
cookies etc.</p>
</p></li>
<li><p><strong>auto_decompress</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <dl class="simple">
<dt>Automatically decompress response body,</dt><dd><p><code class="docutils literal notranslate"><span class="pre">True</span></code> by default</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</p></li>
<li><p><strong>trust_env</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <p>Get proxies information from <em>HTTP_PROXY</em> /
<em>HTTPS_PROXY</em> environment variables if the parameter is <code class="docutils literal notranslate"><span class="pre">True</span></code>
(<code class="docutils literal notranslate"><span class="pre">False</span></code> by default).</p>
<p>Get proxy credentials from <code class="docutils literal notranslate"><span class="pre">~/.netrc</span></code> file if present.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="docutils literal notranslate"><span class="pre">.netrc</span></code> documentation: <a class="reference external" href="https://www.gnu.org/software/inetutils/manual/html_node/The-_002enetrc-file.html">https://www.gnu.org/software/inetutils/manual/html_node/The-_002enetrc-file.html</a></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>Added support for <code class="docutils literal notranslate"><span class="pre">~/.netrc</span></code> file.</p>
</div>
</p></li>
<li><p><strong>requote_redirect_url</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <dl class="simple">
<dt>Apply <em>URL requoting</em> for redirection URLs if</dt><dd><p>automatic redirection is enabled (<code class="docutils literal notranslate"><span class="pre">True</span></code> by
default).</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.5.</span></p>
</div>
</p></li>
<li><p><strong>trace_configs</strong> – A list of <a class="reference internal" href="index.html#aiohttp.TraceConfig" title="aiohttp.TraceConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">TraceConfig</span></code></a> instances used for client
tracing.  <code class="docutils literal notranslate"><span class="pre">None</span></code> (default) is used for request tracing
disabling.  See <a class="reference internal" href="index.html#aiohttp-client-tracing-reference"><span class="std std-ref">Tracing Reference</span></a> for
more information.</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.ClientSession.closed">
<code class="sig-name descname">closed</code><a class="headerlink" href="#aiohttp.ClientSession.closed" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if the session has been closed, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
<p>A read-only property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientSession.connector">
<code class="sig-name descname">connector</code><a class="headerlink" href="#aiohttp.ClientSession.connector" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl>
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.connector.BaseConnector</span></code> derived instance used</dt><dd><p>for the session.</p>
<p>A read-only property.</p>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.ClientSession.cookie_jar">
<code class="sig-name descname">cookie_jar</code><a class="headerlink" href="#aiohttp.ClientSession.cookie_jar" title="Permalink to this definition">¶</a></dt>
<dd><p>The session cookies, <code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractCookieJar</span></code> instance.</p>
<p>Gives access to cookie jar’s content and modifiers.</p>
<p>A read-only property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientSession.requote_redirect_url">
<code class="sig-name descname">requote_redirect_url</code><a class="headerlink" href="#aiohttp.ClientSession.requote_redirect_url" title="Permalink to this definition">¶</a></dt>
<dd><p>aiohttp re quote’s redirect urls by default, but some servers
require exact url from location header. To disable <em>re-quote</em> system
set <a class="reference internal" href="#aiohttp.ClientSession.requote_redirect_url" title="aiohttp.ClientSession.requote_redirect_url"><code class="xref py py-attr docutils literal notranslate"><span class="pre">requote_redirect_url</span></code></a> attribute to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.1.</span></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This parameter affects all subsequent requests.</p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.5: </span>The attribute modification is deprecated.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientSession.loop">
<code class="sig-name descname">loop</code><a class="headerlink" href="#aiohttp.ClientSession.loop" title="Permalink to this definition">¶</a></dt>
<dd><p>A loop instance used for session creation.</p>
<p>A read-only property.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.5.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientSession.request">
<em class="property">coroutine async-with </em><code class="sig-name descname">request</code><span class="sig-paren">(</span><em class="sig-param">method</em>, <em class="sig-param">url</em>, <em class="sig-param">*</em>, <em class="sig-param">params=None</em>, <em class="sig-param">data=None</em>, <em class="sig-param">json=None</em>, <em class="sig-param">cookies=None</em>, <em class="sig-param">headers=None</em>, <em class="sig-param">skip_auto_headers=None</em>, <em class="sig-param">auth=None</em>, <em class="sig-param">allow_redirects=True</em>, <em class="sig-param">max_redirects=10</em>, <em class="sig-param">compress=None</em>, <em class="sig-param">chunked=None</em>, <em class="sig-param">expect100=False</em>, <em class="sig-param">raise_for_status=None</em>, <em class="sig-param">read_until_eof=True</em>, <em class="sig-param">proxy=None</em>, <em class="sig-param">proxy_auth=None</em>, <em class="sig-param">timeout=sentinel</em>, <em class="sig-param">ssl=None</em>, <em class="sig-param">verify_ssl=None</em>, <em class="sig-param">fingerprint=None</em>, <em class="sig-param">ssl_context=None</em>, <em class="sig-param">proxy_headers=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession.request" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs an asynchronous HTTP request. Returns a response object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – HTTP method</p></li>
<li><p><strong>url</strong> – Request URL, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a>.</p></li>
<li><p><strong>params</strong> – <p>Mapping, iterable of tuple of <em>key</em>/<em>value</em> pairs or
string to be sent as parameters in the query
string of the new request. Ignored for subsequent
redirected requests (optional)</p>
<p>Allowed values are:</p>
<ul>
<li><p><a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Mapping</span></code></a> e.g. <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>,
<code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.MultiDict</span></code> or
<code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.MultiDictProxy</span></code></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Iterable</span></code></a> e.g. <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> or
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> with preferably url-encoded content
(<strong>Warning:</strong> content will not be encoded by <em>aiohttp</em>)</p></li>
</ul>
</p></li>
<li><p><strong>data</strong> – The data to send in the body of the request. This can be a
<a class="reference internal" href="#aiohttp.FormData" title="aiohttp.FormData"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormData</span></code></a> object or anything that can be passed into
<a class="reference internal" href="#aiohttp.FormData" title="aiohttp.FormData"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormData</span></code></a>, e.g. a dictionary, bytes, or file-like object.
(optional)</p></li>
<li><p><strong>json</strong> – Any json compatible python object
(optional). <em>json</em> and <em>data</em> parameters could not
be used at the same time.</p></li>
<li><p><strong>cookies</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – <dl class="simple">
<dt>HTTP Cookies to send with</dt><dd><p>the request (optional)</p>
</dd>
</dl>
<p>Global session cookies and the explicitly set cookies will be merged
when sending the request.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.5.</span></p>
</div>
</p></li>
<li><p><strong>headers</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – HTTP Headers to send with
the request (optional)</p></li>
<li><p><strong>skip_auto_headers</strong> – <p>set of headers for which autogeneration
should be skipped.</p>
<p><em>aiohttp</em> autogenerates headers like <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> or
<code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> if these headers are not explicitly
passed. Using <code class="docutils literal notranslate"><span class="pre">skip_auto_headers</span></code> parameter allows to skip
that generation.</p>
<p>Iterable of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <code class="xref py py-class docutils literal notranslate"><span class="pre">istr</span></code>
(optional)</p>
</p></li>
<li><p><strong>auth</strong> (<a class="reference internal" href="index.html#aiohttp.BasicAuth" title="aiohttp.BasicAuth"><em>aiohttp.BasicAuth</em></a>) – an object that represents HTTP
Basic Authorization (optional)</p></li>
<li><p><strong>allow_redirects</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, do not follow redirects.
<code class="docutils literal notranslate"><span class="pre">True</span></code> by default (optional).</p></li>
<li><p><strong>max_redirects</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Maximum number of redirects to follow.
<code class="docutils literal notranslate"><span class="pre">10</span></code> by default.</p></li>
<li><p><strong>compress</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> if request has to be compressed
with deflate encoding. If <cite>compress</cite> can not be combined
with a <em>Content-Encoding</em> and <em>Content-Length</em> headers.
<code class="docutils literal notranslate"><span class="pre">None</span></code> by default (optional).</p></li>
<li><p><strong>chunked</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Enable chunked transfer encoding.
It is up to the developer
to decide how to chunk data streams. If chunking is enabled, aiohttp
encodes the provided chunks in the “Transfer-encoding: chunked” format.
If <em>chunked</em> is set, then the <em>Transfer-encoding</em> and <em>content-length</em>
headers are disallowed. <code class="docutils literal notranslate"><span class="pre">None</span></code> by default (optional).</p></li>
<li><p><strong>expect100</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Expect 100-continue response from server.
<code class="docutils literal notranslate"><span class="pre">False</span></code> by default (optional).</p></li>
<li><p><strong>raise_for_status</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <dl class="simple">
<dt>Automatically call <a class="reference internal" href="#aiohttp.ClientResponse.raise_for_status" title="aiohttp.ClientResponse.raise_for_status"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientResponse.raise_for_status()</span></code></a> for</dt><dd><p>response if set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
If set to <code class="docutils literal notranslate"><span class="pre">None</span></code> value from <code class="docutils literal notranslate"><span class="pre">ClientSession</span></code> will be used.
<code class="docutils literal notranslate"><span class="pre">None</span></code> by default (optional).</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.4.</span></p>
</div>
</p></li>
<li><p><strong>read_until_eof</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Read response until EOF if response
does not have Content-Length header.
<code class="docutils literal notranslate"><span class="pre">True</span></code> by default (optional).</p></li>
<li><p><strong>proxy</strong> – Proxy URL, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> (optional)</p></li>
<li><p><strong>proxy_auth</strong> (<a class="reference internal" href="index.html#aiohttp.BasicAuth" title="aiohttp.BasicAuth"><em>aiohttp.BasicAuth</em></a>) – an object that represents proxy HTTP
Basic Authorization (optional)</p></li>
<li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>override the session’s timeout.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.3: </span>The parameter is <a class="reference internal" href="#aiohttp.ClientTimeout" title="aiohttp.ClientTimeout"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientTimeout</span></code></a> instance,
<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> is still supported for sake of backward
compatibility.</p>
<p>If <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> is passed it is a <em>total</em> timeout.</p>
</div>
</p></li>
<li><p><strong>ssl</strong> – <dl>
<dt>SSL validation mode. <code class="docutils literal notranslate"><span class="pre">None</span></code> for default SSL check</dt><dd><p>(<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.create_default_context" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.create_default_context()</span></code></a> is used),
<code class="docutils literal notranslate"><span class="pre">False</span></code> for skip SSL certificate validation,
<a class="reference internal" href="#aiohttp.Fingerprint" title="aiohttp.Fingerprint"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.Fingerprint</span></code></a> for fingerprint
validation, <a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> for custom SSL
certificate validation.</p>
<p>Supersedes <em>verify_ssl</em>, <em>ssl_context</em> and
<em>fingerprint</em> parameters.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</p></li>
<li><p><strong>verify_ssl</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <p>Perform SSL certificate validation for
<em>HTTPS</em> requests (enabled by default). May be disabled to
skip validation for sites with invalid certificates.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.0: </span>Use <code class="docutils literal notranslate"><span class="pre">ssl=False</span></code></p>
</div>
</p></li>
<li><p><strong>fingerprint</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – <p>Pass the SHA256 digest of the expected
certificate in DER format to verify that the certificate the
server presents matches. Useful for <a class="reference external" href="https://en.wikipedia.org/wiki/Transport_Layer_Security#Certificate_pinning">certificate pinning</a>.</p>
<p>Warning: use of MD5 or SHA1 digests is insecure and removed.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.0: </span>Use <code class="docutils literal notranslate"><span class="pre">ssl=aiohttp.Fingerprint(digest)</span></code></p>
</div>
</p></li>
<li><p><strong>ssl_context</strong> (<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><em>ssl.SSLContext</em></a>) – <p>ssl context used for processing
<em>HTTPS</em> requests (optional).</p>
<p><em>ssl_context</em> may be used for configuring certification
authority channel, supported SSL options etc.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.0: </span>Use <code class="docutils literal notranslate"><span class="pre">ssl=ssl_context</span></code></p>
</div>
</p></li>
<li><p><strong>proxy_headers</strong> (<em>abc.Mapping</em>) – <p>HTTP headers to send to the proxy if the
parameter proxy has been provided.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</p></li>
<li><p><strong>trace_request_ctx</strong> – <p>Object used to give as a kw param for each new
<a class="reference internal" href="index.html#aiohttp.TraceConfig" title="aiohttp.TraceConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">TraceConfig</span></code></a> object instantiated,
used to give information to the
tracers that is only available at request time.</p>
<blockquote>
<div><div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</div></blockquote>
</p></li>
</ul>
</dd>
<dt class="field-even">Return ClientResponse</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">client</span> <span class="pre">response</span></code></a>
object.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientSession.get">
<em class="property">coroutine async-with </em><code class="sig-name descname">get</code><span class="sig-paren">(</span><em class="sig-param">url</em>, <em class="sig-param">*</em>, <em class="sig-param">allow_redirects=True</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request.</p>
<p>In order to modify inner
<a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request</span></code></a>
parameters, provide <cite>kwargs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> – Request URL, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a></p></li>
<li><p><strong>allow_redirects</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, do not follow redirects.
<code class="docutils literal notranslate"><span class="pre">True</span></code> by default (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Return ClientResponse</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">client</span> <span class="pre">response</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientSession.post">
<em class="property">coroutine async-with </em><code class="sig-name descname">post</code><span class="sig-paren">(</span><em class="sig-param">url</em>, <em class="sig-param">*</em>, <em class="sig-param">data=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession.post" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request.</p>
<p>In order to modify inner
<a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request</span></code></a>
parameters, provide <cite>kwargs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> – Request URL, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a></p></li>
<li><p><strong>data</strong> – Data to send in the body of the request; see
<a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request</span></code></a>
for details (optional)</p></li>
</ul>
</dd>
<dt class="field-even">Return ClientResponse</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">client</span> <span class="pre">response</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientSession.put">
<em class="property">coroutine async-with </em><code class="sig-name descname">put</code><span class="sig-paren">(</span><em class="sig-param">url</em>, <em class="sig-param">*</em>, <em class="sig-param">data=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession.put" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a <code class="docutils literal notranslate"><span class="pre">PUT</span></code> request.</p>
<p>In order to modify inner
<a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request</span></code></a>
parameters, provide <cite>kwargs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> – Request URL, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a></p></li>
<li><p><strong>data</strong> – Data to send in the body of the request; see
<a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request</span></code></a>
for details (optional)</p></li>
</ul>
</dd>
<dt class="field-even">Return ClientResponse</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">client</span> <span class="pre">response</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientSession.delete">
<em class="property">coroutine async-with </em><code class="sig-name descname">delete</code><span class="sig-paren">(</span><em class="sig-param">url</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> request.</p>
<p>In order to modify inner
<a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request</span></code></a>
parameters, provide <cite>kwargs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>url</strong> – Request URL, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a></p>
</dd>
<dt class="field-even">Return ClientResponse</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">client</span> <span class="pre">response</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientSession.head">
<em class="property">coroutine async-with </em><code class="sig-name descname">head</code><span class="sig-paren">(</span><em class="sig-param">url</em>, <em class="sig-param">*</em>, <em class="sig-param">allow_redirects=False</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession.head" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> request.</p>
<p>In order to modify inner
<a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request</span></code></a>
parameters, provide <cite>kwargs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> – Request URL, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a></p></li>
<li><p><strong>allow_redirects</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, do not follow redirects.
<code class="docutils literal notranslate"><span class="pre">False</span></code> by default (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Return ClientResponse</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">client</span> <span class="pre">response</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientSession.options">
<em class="property">coroutine async-with </em><code class="sig-name descname">options</code><span class="sig-paren">(</span><em class="sig-param">url</em>, <em class="sig-param">*</em>, <em class="sig-param">allow_redirects=True</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession.options" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> request.</p>
<p>In order to modify inner
<a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request</span></code></a>
parameters, provide <cite>kwargs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> – Request URL, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a></p></li>
<li><p><strong>allow_redirects</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, do not follow redirects.
<code class="docutils literal notranslate"><span class="pre">True</span></code> by default (optional).</p></li>
</ul>
</dd>
<dt class="field-even">Return ClientResponse</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">client</span> <span class="pre">response</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientSession.patch">
<em class="property">coroutine async-with </em><code class="sig-name descname">patch</code><span class="sig-paren">(</span><em class="sig-param">url</em>, <em class="sig-param">*</em>, <em class="sig-param">data=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession.patch" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> request.</p>
<p>In order to modify inner
<a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request</span></code></a>
parameters, provide <cite>kwargs</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> – Request URL, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a></p></li>
<li><p><strong>data</strong> – Data to send in the body of the request; see
<a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request</span></code></a>
for details (optional)</p></li>
</ul>
</dd>
<dt class="field-even">Return ClientResponse</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">client</span> <span class="pre">response</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientSession.ws_connect">
<em class="property">coroutine async-with </em><code class="sig-name descname">ws_connect</code><span class="sig-paren">(</span><em class="sig-param">url</em>, <em class="sig-param">*</em>, <em class="sig-param">method='GET'</em>, <em class="sig-param">protocols=()</em>, <em class="sig-param">timeout=10.0</em>, <em class="sig-param">receive_timeout=None</em>, <em class="sig-param">auth=None</em>, <em class="sig-param">autoclose=True</em>, <em class="sig-param">autoping=True</em>, <em class="sig-param">heartbeat=None</em>, <em class="sig-param">origin=None</em>, <em class="sig-param">headers=None</em>, <em class="sig-param">proxy=None</em>, <em class="sig-param">proxy_auth=None</em>, <em class="sig-param">ssl=None</em>, <em class="sig-param">verify_ssl=None</em>, <em class="sig-param">fingerprint=None</em>, <em class="sig-param">ssl_context=None</em>, <em class="sig-param">proxy_headers=None</em>, <em class="sig-param">compress=0</em>, <em class="sig-param">max_msg_size=4194304</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession.ws_connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a websocket connection. Returns a
<a class="reference internal" href="#aiohttp.ClientWebSocketResponse" title="aiohttp.ClientWebSocketResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientWebSocketResponse</span></code></a> object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> – Websocket server url, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a></p></li>
<li><p><strong>protocols</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><em>tuple</em></a>) – Websocket protocols</p></li>
<li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Timeout for websocket to close. <code class="docutils literal notranslate"><span class="pre">10</span></code> seconds
by default</p></li>
<li><p><strong>receive_timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Timeout for websocket to receive
complete message.  <code class="docutils literal notranslate"><span class="pre">None</span></code> (unlimited)
seconds by default</p></li>
<li><p><strong>auth</strong> (<a class="reference internal" href="index.html#aiohttp.BasicAuth" title="aiohttp.BasicAuth"><em>aiohttp.BasicAuth</em></a>) – an object that represents HTTP
Basic Authorization (optional)</p></li>
<li><p><strong>autoclose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Automatically close websocket connection on close
message from server. If <em>autoclose</em> is False
then close procedure has to be handled manually.
<code class="docutils literal notranslate"><span class="pre">True</span></code> by default</p></li>
<li><p><strong>autoping</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – automatically send <em>pong</em> on <em>ping</em>
message from server. <code class="docutils literal notranslate"><span class="pre">True</span></code> by default</p></li>
<li><p><strong>heartbeat</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Send <em>ping</em> message every <em>heartbeat</em>
seconds and wait <em>pong</em> response, if
<em>pong</em> response is not received then
close connection. The timer is reset on any data
reception.(optional)</p></li>
<li><p><strong>origin</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Origin header to send to server(optional)</p></li>
<li><p><strong>headers</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – HTTP Headers to send with
the request (optional)</p></li>
<li><p><strong>proxy</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Proxy URL, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> (optional)</p></li>
<li><p><strong>proxy_auth</strong> (<a class="reference internal" href="index.html#aiohttp.BasicAuth" title="aiohttp.BasicAuth"><em>aiohttp.BasicAuth</em></a>) – an object that represents proxy HTTP
Basic Authorization (optional)</p></li>
<li><p><strong>ssl</strong> – <dl>
<dt>SSL validation mode. <code class="docutils literal notranslate"><span class="pre">None</span></code> for default SSL check</dt><dd><p>(<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.create_default_context" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.create_default_context()</span></code></a> is used),
<code class="docutils literal notranslate"><span class="pre">False</span></code> for skip SSL certificate validation,
<a class="reference internal" href="#aiohttp.Fingerprint" title="aiohttp.Fingerprint"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.Fingerprint</span></code></a> for fingerprint
validation, <a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> for custom SSL
certificate validation.</p>
<p>Supersedes <em>verify_ssl</em>, <em>ssl_context</em> and
<em>fingerprint</em> parameters.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</p></li>
<li><p><strong>verify_ssl</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <p>Perform SSL certificate validation for
<em>HTTPS</em> requests (enabled by default). May be disabled to
skip validation for sites with invalid certificates.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.0: </span>Use <code class="docutils literal notranslate"><span class="pre">ssl=False</span></code></p>
</div>
</p></li>
<li><p><strong>fingerprint</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – <p>Pass the SHA256 digest of the expected
certificate in DER format to verify that the certificate the
server presents matches. Useful for <a class="reference external" href="https://en.wikipedia.org/wiki/Transport_Layer_Security#Certificate_pinning">certificate pinning</a>.</p>
<p>Note: use of MD5 or SHA1 digests is insecure and deprecated.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.0: </span>Use <code class="docutils literal notranslate"><span class="pre">ssl=aiohttp.Fingerprint(digest)</span></code></p>
</div>
</p></li>
<li><p><strong>ssl_context</strong> (<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><em>ssl.SSLContext</em></a>) – <p>ssl context used for processing
<em>HTTPS</em> requests (optional).</p>
<p><em>ssl_context</em> may be used for configuring certification
authority channel, supported SSL options etc.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.0: </span>Use <code class="docutils literal notranslate"><span class="pre">ssl=ssl_context</span></code></p>
</div>
</p></li>
<li><p><strong>proxy_headers</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – <p>HTTP headers to send to the proxy if the
parameter proxy has been provided.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</p></li>
<li><p><strong>compress</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <dl class="simple">
<dt>Enable Per-Message Compress Extension support.</dt><dd><p>0 for disable, 9 to 15 for window bit support.
Default value is 0.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</p></li>
<li><p><strong>max_msg_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <dl class="simple">
<dt>maximum size of read websocket message,</dt><dd><p>4 MB by default. To disable the size
limit use <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.3.</span></p>
</div>
</p></li>
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – <dl class="simple">
<dt>HTTP method to establish WebSocket connection,</dt><dd><p><code class="docutils literal notranslate"><span class="pre">'GET'</span></code> by default.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.5.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientSession.close">
<em class="property">coroutine </em><code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close underlying connector.</p>
<p>Release all acquired resources.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientSession.detach">
<code class="sig-name descname">detach</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientSession.detach" title="Permalink to this definition">¶</a></dt>
<dd><p>Detach connector from session without closing the former.</p>
<p>Session is switched to closed state anyway.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="basic-api">
<h5>Basic API<a class="headerlink" href="#basic-api" title="Permalink to this headline">¶</a></h5>
<p>While we encourage <a class="reference internal" href="#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> usage we also provide simple
coroutines for making HTTP requests.</p>
<p>Basic API is good for performing simple HTTP requests without
keepaliving, cookies and complex connection stuff like properly configured SSL
certification chaining.</p>
<dl class="function">
<dt id="aiohttp.request">
<em class="property">coroutine </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">request</code><span class="sig-paren">(</span><em class="sig-param">method</em>, <em class="sig-param">url</em>, <em class="sig-param">*</em>, <em class="sig-param">params=None</em>, <em class="sig-param">data=None</em>, <em class="sig-param">json=None</em>, <em class="sig-param">headers=None</em>, <em class="sig-param">cookies=None</em>, <em class="sig-param">auth=None</em>, <em class="sig-param">allow_redirects=True</em>, <em class="sig-param">max_redirects=10</em>, <em class="sig-param">encoding='utf-8'</em>, <em class="sig-param">version=HttpVersion(major=1</em>, <em class="sig-param">minor=1)</em>, <em class="sig-param">compress=None</em>, <em class="sig-param">chunked=None</em>, <em class="sig-param">expect100=False</em>, <em class="sig-param">raise_for_status=False</em>, <em class="sig-param">connector=None</em>, <em class="sig-param">loop=None</em>, <em class="sig-param">read_until_eof=True</em>, <em class="sig-param">timeout=sentinel</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.request" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Async-with</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>Asynchronous context manager for performing an asynchronous HTTP
request. Returns a <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientResponse</span></code></a> response object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – HTTP method</p></li>
<li><p><strong>url</strong> – Requested URL, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a></p></li>
<li><p><strong>params</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – Parameters to be sent in the query
string of the new request (optional)</p></li>
<li><p><strong>data</strong> – The data to send in the body of the request. This can be a
<a class="reference internal" href="#aiohttp.FormData" title="aiohttp.FormData"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormData</span></code></a> object or anything that can be passed into
<a class="reference internal" href="#aiohttp.FormData" title="aiohttp.FormData"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormData</span></code></a>, e.g. a dictionary, bytes, or file-like object.
(optional)</p></li>
<li><p><strong>json</strong> – Any json compatible python object (optional). <em>json</em> and <em>data</em>
parameters could not be used at the same time.</p></li>
<li><p><strong>headers</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – HTTP Headers to send with the request (optional)</p></li>
<li><p><strong>cookies</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – Cookies to send with the request (optional)</p></li>
<li><p><strong>auth</strong> (<a class="reference internal" href="index.html#aiohttp.BasicAuth" title="aiohttp.BasicAuth"><em>aiohttp.BasicAuth</em></a>) – an object that represents HTTP Basic
Authorization (optional)</p></li>
<li><p><strong>allow_redirects</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, do not follow redirects.
<code class="docutils literal notranslate"><span class="pre">True</span></code> by default (optional).</p></li>
<li><p><strong>version</strong> (<em>aiohttp.protocol.HttpVersion</em>) – Request HTTP version (optional)</p></li>
<li><p><strong>compress</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> if request has to be compressed
with deflate encoding.
<code class="docutils literal notranslate"><span class="pre">False</span></code> instructs aiohttp to not compress data.
<code class="docutils literal notranslate"><span class="pre">None</span></code> by default (optional).</p></li>
<li><p><strong>chunked</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Enables chunked transfer encoding.
<code class="docutils literal notranslate"><span class="pre">None</span></code> by default (optional).</p></li>
<li><p><strong>expect100</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Expect 100-continue response from server.
<code class="docutils literal notranslate"><span class="pre">False</span></code> by default (optional).</p></li>
<li><p><strong>raise_for_status</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <dl class="simple">
<dt>Automatically call</dt><dd><p><a class="reference internal" href="#aiohttp.ClientResponse.raise_for_status" title="aiohttp.ClientResponse.raise_for_status"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientResponse.raise_for_status()</span></code></a>
for response if set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.  If
set to <code class="docutils literal notranslate"><span class="pre">None</span></code> value from
<code class="docutils literal notranslate"><span class="pre">ClientSession</span></code> will be used.
<code class="docutils literal notranslate"><span class="pre">None</span></code> by default (optional).</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.4.</span></p>
</div>
</p></li>
<li><p><strong>connector</strong> (<em>aiohttp.connector.BaseConnector</em>) – BaseConnector sub-class
instance to support connection pooling.</p></li>
<li><p><strong>read_until_eof</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Read response until EOF if response
does not have Content-Length header.
<code class="docutils literal notranslate"><span class="pre">True</span></code> by default (optional).</p></li>
<li><p><strong>timeout</strong> – a <a class="reference internal" href="#aiohttp.ClientTimeout" title="aiohttp.ClientTimeout"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientTimeout</span></code></a> settings structure, 5min
total timeout by default.</p></li>
<li><p><strong>loop</strong> – <dl class="simple">
<dt><a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio-event-loop" title="(in Python v3.7)"><span class="xref std std-ref">event loop</span></a></dt><dd><p>used for processing HTTP requests.
If param is <code class="docutils literal notranslate"><span class="pre">None</span></code>, <a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.get_event_loop" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.get_event_loop()</span></code></a>
is used for getting default event loop.</p>
</dd>
</dl>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 2.0.</span></p>
</div>
</p></li>
</ul>
</dd>
<dt class="field-even">Return ClientResponse</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">client</span> <span class="pre">response</span></code></a> object.</p>
</dd>
</dl>
<p>Usage:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">aiohttp</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">fetch</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span>
            <span class="s1">&#39;http://python.org/&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="connectors">
<span id="aiohttp-client-reference-connectors"></span><h5>Connectors<a class="headerlink" href="#connectors" title="Permalink to this headline">¶</a></h5>
<p>Connectors are transports for aiohttp client API.</p>
<p>There are standard connectors:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#aiohttp.TCPConnector" title="aiohttp.TCPConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">TCPConnector</span></code></a> for regular <em>TCP sockets</em> (both <em>HTTP</em> and
<em>HTTPS</em> schemes supported).</p></li>
<li><p><a class="reference internal" href="#aiohttp.UnixConnector" title="aiohttp.UnixConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnixConnector</span></code></a> for connecting via UNIX socket (it’s used mostly for
testing purposes).</p></li>
</ol>
<p>All connector classes should be derived from <a class="reference internal" href="#aiohttp.BaseConnector" title="aiohttp.BaseConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseConnector</span></code></a>.</p>
<p>By default all <em>connectors</em> support <em>keep-alive connections</em> (behavior
is controlled by <em>force_close</em> constructor’s parameter).</p>
<div class="section" id="baseconnector">
<h6>BaseConnector<a class="headerlink" href="#baseconnector" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.BaseConnector">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">BaseConnector</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">keepalive_timeout=15</em>, <em class="sig-param">force_close=False</em>, <em class="sig-param">limit=100</em>, <em class="sig-param">limit_per_host=0</em>, <em class="sig-param">enable_cleanup_closed=False</em>, <em class="sig-param">loop=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BaseConnector" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for all connectors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>keepalive_timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – timeout for connection reusing
after releasing (optional). Values
<code class="docutils literal notranslate"><span class="pre">0</span></code>. For disabling <em>keep-alive</em>
feature use <code class="docutils literal notranslate"><span class="pre">force_close=True</span></code>
flag.</p></li>
<li><p><strong>limit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – total number simultaneous connections. If <em>limit</em> is
<code class="docutils literal notranslate"><span class="pre">None</span></code> the connector has no limit (default: 100).</p></li>
<li><p><strong>limit_per_host</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – limit simultaneous connections to the same
endpoint.  Endpoints are the same if they are
have equal <code class="docutils literal notranslate"><span class="pre">(host,</span> <span class="pre">port,</span> <span class="pre">is_ssl)</span></code> triple.
If <em>limit</em> is <code class="docutils literal notranslate"><span class="pre">0</span></code> the connector has no limit (default: 0).</p></li>
<li><p><strong>force_close</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – close underlying sockets after
connection releasing (optional).</p></li>
<li><p><strong>enable_cleanup_closed</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – some SSL servers do not properly complete
SSL shutdown process, in that case asyncio leaks ssl connections.
If this parameter is set to True, aiohttp additionally aborts underlining
transport after 2 seconds. It is off by default.</p></li>
<li><p><strong>loop</strong> – <p><a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio-event-loop" title="(in Python v3.7)"><span class="xref std std-ref">event loop</span></a>
used for handling connections.
If param is <code class="docutils literal notranslate"><span class="pre">None</span></code>, <a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.get_event_loop" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.get_event_loop()</span></code></a>
is used for getting default event loop.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 2.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.BaseConnector.closed">
<code class="sig-name descname">closed</code><a class="headerlink" href="#aiohttp.BaseConnector.closed" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property, <code class="docutils literal notranslate"><span class="pre">True</span></code> if connector is closed.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.BaseConnector.force_close">
<code class="sig-name descname">force_close</code><a class="headerlink" href="#aiohttp.BaseConnector.force_close" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property, <code class="docutils literal notranslate"><span class="pre">True</span></code> if connector should ultimately
close connections on releasing.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.BaseConnector.limit">
<code class="sig-name descname">limit</code><a class="headerlink" href="#aiohttp.BaseConnector.limit" title="Permalink to this definition">¶</a></dt>
<dd><p>The total number for simultaneous connections.
If limit is 0 the connector has no limit. The default limit size is 100.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.BaseConnector.limit_per_host">
<code class="sig-name descname">limit_per_host</code><a class="headerlink" href="#aiohttp.BaseConnector.limit_per_host" title="Permalink to this definition">¶</a></dt>
<dd><p>The limit for simultaneous connections to the same
endpoint.</p>
<p>Endpoints are the same if they are have equal <code class="docutils literal notranslate"><span class="pre">(host,</span> <span class="pre">port,</span>
<span class="pre">is_ssl)</span></code> triple.</p>
<p>If <em>limit_per_host</em> is <code class="docutils literal notranslate"><span class="pre">None</span></code> the connector has no limit per host.</p>
<p>Read-only property.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BaseConnector.close">
<em class="property">coroutine </em><code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BaseConnector.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close all opened connections.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BaseConnector.connect">
<em class="property">coroutine </em><code class="sig-name descname">connect</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BaseConnector.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a free connection from pool or create new one if connection
is absent in the pool.</p>
<p>The call may be paused if <a class="reference internal" href="#aiohttp.BaseConnector.limit" title="aiohttp.BaseConnector.limit"><code class="xref py py-attr docutils literal notranslate"><span class="pre">limit</span></code></a> is exhausted until used
connections returns to pool.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>request</strong> (<em>aiohttp.ClientRequest</em>) – request object
which is connection
initiator.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><a class="reference internal" href="#aiohttp.Connection" title="aiohttp.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BaseConnector._create_connection">
<em class="property">coroutine </em><code class="sig-name descname">_create_connection</code><span class="sig-paren">(</span><em class="sig-param">req</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BaseConnector._create_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstract method for actual connection establishing, should be
overridden in subclasses.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="tcpconnector">
<h6>TCPConnector<a class="headerlink" href="#tcpconnector" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.TCPConnector">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TCPConnector</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">ssl=None</em>, <em class="sig-param">verify_ssl=True</em>, <em class="sig-param">fingerprint=None</em>, <em class="sig-param">use_dns_cache=True</em>, <em class="sig-param">ttl_dns_cache=10</em>, <em class="sig-param">family=0</em>, <em class="sig-param">ssl_context=None</em>, <em class="sig-param">local_addr=None</em>, <em class="sig-param">resolver=None</em>, <em class="sig-param">keepalive_timeout=sentinel</em>, <em class="sig-param">force_close=False</em>, <em class="sig-param">limit=100</em>, <em class="sig-param">limit_per_host=0</em>, <em class="sig-param">enable_cleanup_closed=False</em>, <em class="sig-param">loop=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.TCPConnector" title="Permalink to this definition">¶</a></dt>
<dd><p>Connector for working with <em>HTTP</em> and <em>HTTPS</em> via <em>TCP</em> sockets.</p>
<p>The most common transport. When you don’t know what connector type
to use, use a <a class="reference internal" href="#aiohttp.TCPConnector" title="aiohttp.TCPConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">TCPConnector</span></code></a> instance.</p>
<p><a class="reference internal" href="#aiohttp.TCPConnector" title="aiohttp.TCPConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">TCPConnector</span></code></a> inherits from <a class="reference internal" href="#aiohttp.BaseConnector" title="aiohttp.BaseConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseConnector</span></code></a>.</p>
<p>Constructor accepts all parameters suitable for
<a class="reference internal" href="#aiohttp.BaseConnector" title="aiohttp.BaseConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseConnector</span></code></a> plus several TCP-specific ones:</p>
<blockquote>
<div><dl class="field-list">
<dt class="field-odd">param ssl</dt>
<dd class="field-odd"><dl>
<dt>SSL validation mode. <code class="docutils literal notranslate"><span class="pre">None</span></code> for default SSL check</dt><dd><p>(<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.create_default_context" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.create_default_context()</span></code></a> is used),
<code class="docutils literal notranslate"><span class="pre">False</span></code> for skip SSL certificate validation,
<a class="reference internal" href="#aiohttp.Fingerprint" title="aiohttp.Fingerprint"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.Fingerprint</span></code></a> for fingerprint
validation, <a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> for custom SSL
certificate validation.</p>
<p>Supersedes <em>verify_ssl</em>, <em>ssl_context</em> and
<em>fingerprint</em> parameters.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>verify_ssl</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <p>perform SSL certificate validation for
<em>HTTPS</em> requests (enabled by default). May be disabled to
skip validation for sites with invalid certificates.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 2.3: </span>Pass <em>verify_ssl</em> to <code class="docutils literal notranslate"><span class="pre">ClientSession.get()</span></code> etc.</p>
</div>
</p></li>
<li><p><strong>fingerprint</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – <p>pass the SHA256 digest of the expected
certificate in DER format to verify that the certificate the
server presents matches. Useful for <a class="reference external" href="https://en.wikipedia.org/wiki/Transport_Layer_Security#Certificate_pinning">certificate pinning</a>.</p>
<p>Note: use of MD5 or SHA1 digests is insecure and deprecated.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 2.3: </span>Pass <em>verify_ssl</em> to <code class="docutils literal notranslate"><span class="pre">ClientSession.get()</span></code> etc.</p>
</div>
</p></li>
<li><p><strong>use_dns_cache</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <p>use internal cache for DNS lookups, <code class="docutils literal notranslate"><span class="pre">True</span></code>
by default.</p>
<p>Enabling an option <em>may</em> speedup connection
establishing a bit but may introduce some
<em>side effects</em> also.</p>
</p></li>
<li><p><strong>ttl_dns_cache</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>expire after some seconds the DNS entries, <code class="docutils literal notranslate"><span class="pre">None</span></code>
means cached forever. By default 10 seconds.</p>
<p>By default DNS entries are cached forever, in some environments the IP
addresses related to a specific HOST can change after a specific time. Use
this option to keep the DNS cache updated refreshing each entry after N
seconds.</p>
</p></li>
<li><p><strong>limit</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – total number simultaneous connections. If <em>limit</em> is
<code class="docutils literal notranslate"><span class="pre">None</span></code> the connector has no limit (default: 100).</p></li>
<li><p><strong>limit_per_host</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – limit simultaneous connections to the same
endpoint.  Endpoints are the same if they are
have equal <code class="docutils literal notranslate"><span class="pre">(host,</span> <span class="pre">port,</span> <span class="pre">is_ssl)</span></code> triple.
If <em>limit</em> is <code class="docutils literal notranslate"><span class="pre">0</span></code> the connector has no limit (default: 0).</p></li>
<li><p><strong>resolver</strong> (<em>aiohttp.abc.AbstractResolver</em>) – <p>custom resolver
instance to use.  <code class="docutils literal notranslate"><span class="pre">aiohttp.DefaultResolver</span></code> by
default (asynchronous if <code class="docutils literal notranslate"><span class="pre">aiodns&gt;=1.1</span></code> is installed).</p>
<p>Custom resolvers allow to resolve hostnames differently than the
way the host is configured.</p>
<p>The resolver is <code class="docutils literal notranslate"><span class="pre">aiohttp.ThreadedResolver</span></code> by default,
asynchronous version is pretty robust but might fail in
very rare cases.</p>
</p></li>
<li><p><strong>family</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>TCP socket family, both IPv4 and IPv6 by default.
For <em>IPv4</em> only use <code class="xref py py-const docutils literal notranslate"><span class="pre">socket.AF_INET</span></code>,
for  <em>IPv6</em> only – <code class="xref py py-const docutils literal notranslate"><span class="pre">socket.AF_INET6</span></code>.</p>
<p><em>family</em> is <code class="docutils literal notranslate"><span class="pre">0</span></code> by default, that means both
IPv4 and IPv6 are accepted. To specify only
concrete version please pass
<code class="xref py py-const docutils literal notranslate"><span class="pre">socket.AF_INET</span></code> or
<code class="xref py py-const docutils literal notranslate"><span class="pre">socket.AF_INET6</span></code> explicitly.</p>
</p></li>
<li><p><strong>ssl_context</strong> (<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><em>ssl.SSLContext</em></a>) – <p>SSL context used for processing
<em>HTTPS</em> requests (optional).</p>
<p><em>ssl_context</em> may be used for configuring certification
authority channel, supported SSL options etc.</p>
</p></li>
<li><p><strong>local_addr</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><em>tuple</em></a>) – tuple of <code class="docutils literal notranslate"><span class="pre">(local_host,</span> <span class="pre">local_port)</span></code> used to bind
socket locally if specified.</p></li>
<li><p><strong>force_close</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – close underlying sockets after
connection releasing (optional).</p></li>
<li><p><strong>enable_cleanup_closed</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Some ssl servers do not properly complete
SSL shutdown process, in that case asyncio leaks SSL connections.
If this parameter is set to True, aiohttp additionally aborts underlining
transport after 2 seconds. It is off by default.</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.TCPConnector.family">
<code class="sig-name descname">family</code><a class="headerlink" href="#aiohttp.TCPConnector.family" title="Permalink to this definition">¶</a></dt>
<dd><p><em>TCP</em> socket family e.g. <code class="xref py py-const docutils literal notranslate"><span class="pre">socket.AF_INET</span></code> or
<code class="xref py py-const docutils literal notranslate"><span class="pre">socket.AF_INET6</span></code></p>
<p>Read-only property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TCPConnector.dns_cache">
<code class="sig-name descname">dns_cache</code><a class="headerlink" href="#aiohttp.TCPConnector.dns_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Use quick lookup in internal <em>DNS</em> cache for host names if <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TCPConnector.cached_hosts">
<code class="sig-name descname">cached_hosts</code><a class="headerlink" href="#aiohttp.TCPConnector.cached_hosts" title="Permalink to this definition">¶</a></dt>
<dd><p>The cache of resolved hosts if <a class="reference internal" href="#aiohttp.TCPConnector.dns_cache" title="aiohttp.TCPConnector.dns_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dns_cache</span></code></a> is enabled.</p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/types.html#types.MappingProxyType" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.MappingProxyType</span></code></a> property.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.TCPConnector.clear_dns_cache">
<code class="sig-name descname">clear_dns_cache</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">host=None</em>, <em class="sig-param">port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.TCPConnector.clear_dns_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear internal <em>DNS</em> cache.</p>
<p>Remove specific entry if both <em>host</em> and <em>port</em> are specified,
clear all cache otherwise.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="unixconnector">
<h6>UnixConnector<a class="headerlink" href="#unixconnector" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.UnixConnector">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">UnixConnector</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">conn_timeout=None</em>, <em class="sig-param">keepalive_timeout=30</em>, <em class="sig-param">limit=100</em>, <em class="sig-param">force_close=False</em>, <em class="sig-param">loop=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.UnixConnector" title="Permalink to this definition">¶</a></dt>
<dd><p>Unix socket connector.</p>
<p>Use <a class="reference internal" href="#aiohttp.UnixConnector" title="aiohttp.UnixConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnixConnector</span></code></a> for sending <em>HTTP/HTTPS</em> requests
through <em>UNIX Sockets</em> as underlying transport.</p>
<p>UNIX sockets are handy for writing tests and making very fast
connections between processes on the same host.</p>
<p><a class="reference internal" href="#aiohttp.UnixConnector" title="aiohttp.UnixConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnixConnector</span></code></a> is inherited from <a class="reference internal" href="#aiohttp.BaseConnector" title="aiohttp.BaseConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseConnector</span></code></a>.</p>
<blockquote>
<div><p>Usage:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">UnixConnector</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;/path/to/socket&#39;</span><span class="p">)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">ClientSession</span><span class="p">(</span><span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://python.org&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<p>Constructor accepts all parameters suitable for
<a class="reference internal" href="#aiohttp.BaseConnector" title="aiohttp.BaseConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseConnector</span></code></a> plus UNIX-specific one:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Unix socket path</p>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.UnixConnector.path">
<code class="sig-name descname">path</code><a class="headerlink" href="#aiohttp.UnixConnector.path" title="Permalink to this definition">¶</a></dt>
<dd><p>Path to <em>UNIX socket</em>, read-only <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> property.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="connection">
<h6>Connection<a class="headerlink" href="#connection" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.Connection">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">Connection</code><a class="headerlink" href="#aiohttp.Connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Encapsulates single connection in connector object.</p>
<p>End user should never create <a class="reference internal" href="#aiohttp.Connection" title="aiohttp.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> instances manually
but get it by <a class="reference internal" href="#aiohttp.BaseConnector.connect" title="aiohttp.BaseConnector.connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BaseConnector.connect()</span></code></a> coroutine.</p>
<dl class="attribute">
<dt id="aiohttp.Connection.closed">
<code class="sig-name descname">closed</code><a class="headerlink" href="#aiohttp.Connection.closed" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> read-only property, <code class="docutils literal notranslate"><span class="pre">True</span></code> if connection was
closed, released or detached.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.Connection.loop">
<code class="sig-name descname">loop</code><a class="headerlink" href="#aiohttp.Connection.loop" title="Permalink to this definition">¶</a></dt>
<dd><p>Event loop used for connection</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.5.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.Connection.transport">
<code class="sig-name descname">transport</code><a class="headerlink" href="#aiohttp.Connection.transport" title="Permalink to this definition">¶</a></dt>
<dd><p>Connection transport</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.Connection.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.Connection.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close connection with forcibly closing underlying socket.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.Connection.release">
<code class="sig-name descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.Connection.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release connection back to connector.</p>
<p>Underlying socket is not closed, the connection may be reused
later if timeout (30 seconds by default) for connection was not
expired.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="response-object">
<h5>Response object<a class="headerlink" href="#response-object" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.ClientResponse">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientResponse</code><a class="headerlink" href="#aiohttp.ClientResponse" title="Permalink to this definition">¶</a></dt>
<dd><p>Client response returned be <a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.request()</span></code></a> and family.</p>
<p>User never creates the instance of ClientResponse class but gets it
from API calls.</p>
<p><a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientResponse</span></code></a> supports async context manager protocol, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">resp</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
</pre></div>
</div>
<p>After exiting from <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span></code> block response object will be
<em>released</em> (see <a class="reference internal" href="#aiohttp.ClientResponse.release" title="aiohttp.ClientResponse.release"><code class="xref py py-meth docutils literal notranslate"><span class="pre">release()</span></code></a> coroutine).</p>
<dl class="attribute">
<dt id="aiohttp.ClientResponse.version">
<code class="sig-name descname">version</code><a class="headerlink" href="#aiohttp.ClientResponse.version" title="Permalink to this definition">¶</a></dt>
<dd><p>Response’s version, <code class="xref py py-class docutils literal notranslate"><span class="pre">HttpVersion</span></code> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.status">
<code class="sig-name descname">status</code><a class="headerlink" href="#aiohttp.ClientResponse.status" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP status code of response (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>), e.g. <code class="docutils literal notranslate"><span class="pre">200</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.reason">
<code class="sig-name descname">reason</code><a class="headerlink" href="#aiohttp.ClientResponse.reason" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP status reason of response (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>), e.g. <code class="docutils literal notranslate"><span class="pre">&quot;OK&quot;</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.method">
<code class="sig-name descname">method</code><a class="headerlink" href="#aiohttp.ClientResponse.method" title="Permalink to this definition">¶</a></dt>
<dd><p>Request’s method (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.url">
<code class="sig-name descname">url</code><a class="headerlink" href="#aiohttp.ClientResponse.url" title="Permalink to this definition">¶</a></dt>
<dd><p>URL of request (<a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a>).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.real_url">
<code class="sig-name descname">real_url</code><a class="headerlink" href="#aiohttp.ClientResponse.real_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Unmodified URL of request with URL fragment unstripped (<a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a>).</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.2.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.connection">
<code class="sig-name descname">connection</code><a class="headerlink" href="#aiohttp.ClientResponse.connection" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#aiohttp.Connection" title="aiohttp.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> used for handling response.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.content">
<code class="sig-name descname">content</code><a class="headerlink" href="#aiohttp.ClientResponse.content" title="Permalink to this definition">¶</a></dt>
<dd><p>Payload stream, which contains response’s BODY (<a class="reference internal" href="index.html#aiohttp.StreamReader" title="aiohttp.StreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamReader</span></code></a>).
It supports various reading methods depending on the expected format.
When chunked transfer encoding is used by the server, allows retrieving
the actual http chunks.</p>
<p>Reading from the stream may raise
<a class="reference internal" href="#aiohttp.ClientPayloadError" title="aiohttp.ClientPayloadError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">aiohttp.ClientPayloadError</span></code></a> if the response object is
closed before response receives all data or in case if any
transfer encoding related errors like misformed chunked
encoding of broken compression data.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.cookies">
<code class="sig-name descname">cookies</code><a class="headerlink" href="#aiohttp.ClientResponse.cookies" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP cookies of response (<em>Set-Cookie</em> HTTP header,
<a class="reference external" href="https://docs.python.org/3/library/http.cookies.html#http.cookies.SimpleCookie" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleCookie</span></code></a>).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.headers">
<code class="sig-name descname">headers</code><a class="headerlink" href="#aiohttp.ClientResponse.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>A case-insensitive multidict proxy with HTTP headers of
response, <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.CIMultiDictProxy" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIMultiDictProxy</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.raw_headers">
<code class="sig-name descname">raw_headers</code><a class="headerlink" href="#aiohttp.ClientResponse.raw_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Unmodified HTTP headers of response as unconverted bytes, a sequence of
<code class="docutils literal notranslate"><span class="pre">(key,</span> <span class="pre">value)</span></code> pairs.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.links">
<code class="sig-name descname">links</code><a class="headerlink" href="#aiohttp.ClientResponse.links" title="Permalink to this definition">¶</a></dt>
<dd><p>Link HTTP header parsed into a <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.MultiDictProxy" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDictProxy</span></code></a>.</p>
<p>For each link, key is link param <cite>rel</cite> when it exists, or link url as
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> otherwise, and value is <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.MultiDictProxy" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDictProxy</span></code></a>
of link params and url at key <cite>url</cite> as <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> instance.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.2.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.content_type">
<code class="sig-name descname">content_type</code><a class="headerlink" href="#aiohttp.ClientResponse.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property with <em>content</em> part of <em>Content-Type</em> header.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Returns value is <code class="docutils literal notranslate"><span class="pre">'application/octet-stream'</span></code> if no
Content-Type header present in HTTP headers according to
<span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2616.html"><strong>RFC 2616</strong></a>. To make sure Content-Type header is not present in
the server reply, use <a class="reference internal" href="#aiohttp.ClientResponse.headers" title="aiohttp.ClientResponse.headers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">headers</span></code></a> or <a class="reference internal" href="#aiohttp.ClientResponse.raw_headers" title="aiohttp.ClientResponse.raw_headers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">raw_headers</span></code></a>, e.g.
<code class="docutils literal notranslate"><span class="pre">'CONTENT-TYPE'</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">resp.headers</span></code>.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.charset">
<code class="sig-name descname">charset</code><a class="headerlink" href="#aiohttp.ClientResponse.charset" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property that specifies the <em>encoding</em> for the request’s BODY.</p>
<p>The value is parsed from the <em>Content-Type</em> HTTP header.</p>
<p>Returns <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> like <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no <em>Content-Type</em>
header present in HTTP headers or it has no charset information.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.content_disposition">
<code class="sig-name descname">content_disposition</code><a class="headerlink" href="#aiohttp.ClientResponse.content_disposition" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property that specified the <em>Content-Disposition</em> HTTP header.</p>
<p>Instance of <a class="reference internal" href="#aiohttp.ContentDisposition" title="aiohttp.ContentDisposition"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContentDisposition</span></code></a> or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no <em>Content-Disposition</em>
header present in HTTP headers.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.history">
<code class="sig-name descname">history</code><a class="headerlink" href="#aiohttp.ClientResponse.history" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> of <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientResponse</span></code></a>
objects of preceding requests (earliest request first) if there were
redirects, an empty sequence otherwise.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientResponse.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientResponse.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close response and underlying connection.</p>
<p>For <a class="reference internal" href="index.html#term-keep-alive"><span class="xref std std-term">keep-alive</span></a> support see <a class="reference internal" href="#aiohttp.ClientResponse.release" title="aiohttp.ClientResponse.release"><code class="xref py py-meth docutils literal notranslate"><span class="pre">release()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientResponse.read">
<em class="property">coroutine </em><code class="sig-name descname">read</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientResponse.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the whole response’s body as <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>.</p>
<p>Close underlying connection if data reading gets an error,
release connection otherwise.</p>
<p>Raise an <a class="reference internal" href="#aiohttp.ClientResponseError" title="aiohttp.ClientResponseError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">aiohttp.ClientResponseError</span></code></a> if the data can’t
be read.</p>
<dl class="field-list simple">
<dt class="field-odd">Return bytes</dt>
<dd class="field-odd"><p>read <em>BODY</em>.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#aiohttp.ClientResponse.close" title="aiohttp.ClientResponse.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></a>, <a class="reference internal" href="#aiohttp.ClientResponse.release" title="aiohttp.ClientResponse.release"><code class="xref py py-meth docutils literal notranslate"><span class="pre">release()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientResponse.release">
<em class="property">coroutine </em><code class="sig-name descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientResponse.release" title="Permalink to this definition">¶</a></dt>
<dd><p>It is not required to call <cite>release</cite> on the response
object. When the client fully receives the payload, the
underlying connection automatically returns back to pool. If the
payload is not fully read, the connection is closed</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientResponse.raise_for_status">
<code class="sig-name descname">raise_for_status</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientResponse.raise_for_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Raise an <a class="reference internal" href="#aiohttp.ClientResponseError" title="aiohttp.ClientResponseError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">aiohttp.ClientResponseError</span></code></a> if the response
status is 400 or higher.</p>
<p>Do nothing for success responses (less than 400).</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientResponse.text">
<em class="property">coroutine </em><code class="sig-name descname">text</code><span class="sig-paren">(</span><em class="sig-param">encoding=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientResponse.text" title="Permalink to this definition">¶</a></dt>
<dd><p>Read response’s body and return decoded <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> using
specified <em>encoding</em> parameter.</p>
<p>If <em>encoding</em> is <code class="docutils literal notranslate"><span class="pre">None</span></code> content encoding is autocalculated
using <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> HTTP header and <em>chardet</em> tool if the
header is not provided by server.</p>
<p><a class="reference internal" href="index.html#term-cchardet"><span class="xref std std-term">cchardet</span></a> is used with fallback to <a class="reference internal" href="index.html#term-chardet"><span class="xref std std-term">chardet</span></a> if
<em>cchardet</em> is not available.</p>
<p>Close underlying connection if data reading gets an error,
release connection otherwise.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – text encoding used for <em>BODY</em> decoding, or
<code class="docutils literal notranslate"><span class="pre">None</span></code> for encoding autodetection
(default).</p>
</dd>
<dt class="field-even">Return str</dt>
<dd class="field-even"><p>decoded <em>BODY</em></p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#LookupError" title="(in Python v3.7)"><strong>LookupError</strong></a> – if the encoding detected by chardet or cchardet is
unknown by Python (e.g. VISCII).</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If response has no <code class="docutils literal notranslate"><span class="pre">charset</span></code> info in <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> HTTP
header <a class="reference internal" href="index.html#term-cchardet"><span class="xref std std-term">cchardet</span></a> / <a class="reference internal" href="index.html#term-chardet"><span class="xref std std-term">chardet</span></a> is used for content
encoding autodetection.</p>
<p>It may hurt performance. If page encoding is known passing
explicit <em>encoding</em> parameter might help:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;ISO-8859-1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientResponse.json">
<em class="property">coroutine </em><code class="sig-name descname">json</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">encoding=None</em>, <em class="sig-param">loads=json.loads</em>, <em class="sig-param">content_type='application/json'</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientResponse.json" title="Permalink to this definition">¶</a></dt>
<dd><p>Read response’s body as <em>JSON</em>, return <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> using
specified <em>encoding</em> and <em>loader</em>. If data is not still available
a <code class="docutils literal notranslate"><span class="pre">read</span></code> call will be done,</p>
<p>If <em>encoding</em> is <code class="docutils literal notranslate"><span class="pre">None</span></code> content encoding is autocalculated
using <a class="reference internal" href="index.html#term-cchardet"><span class="xref std std-term">cchardet</span></a> or <a class="reference internal" href="index.html#term-chardet"><span class="xref std std-term">chardet</span></a> as fallback if
<em>cchardet</em> is not available.</p>
<p>if response’s <cite>content-type</cite> does not match <cite>content_type</cite> parameter
<a class="reference internal" href="#aiohttp.ContentTypeError" title="aiohttp.ContentTypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">aiohttp.ContentTypeError</span></code></a> get raised.
To disable content type check pass <code class="docutils literal notranslate"><span class="pre">None</span></code> value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – <p>text encoding used for <em>BODY</em> decoding, or
<code class="docutils literal notranslate"><span class="pre">None</span></code> for encoding autodetection
(default).</p>
<p>By the standard JSON encoding should be
<code class="docutils literal notranslate"><span class="pre">UTF-8</span></code> but practice beats purity: some
servers return non-UTF
responses. Autodetection works pretty fine
anyway.</p>
</p></li>
<li><p><strong>loads</strong> (<em>callable</em>) – <a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">callable()</span></code></a> used for loading <em>JSON</em>
data, <a class="reference external" href="https://docs.python.org/3/library/json.html#json.loads" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">json.loads()</span></code></a> by default.</p></li>
<li><p><strong>content_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – specify response’s content-type, if content type
does not match raise <a class="reference internal" href="#aiohttp.ClientResponseError" title="aiohttp.ClientResponseError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">aiohttp.ClientResponseError</span></code></a>.
To disable <cite>content-type</cite> check, pass <code class="docutils literal notranslate"><span class="pre">None</span></code> as value.
(default: <cite>application/json</cite>).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><em>BODY</em> as <em>JSON</em> data parsed by <em>loads</em> parameter or
<code class="docutils literal notranslate"><span class="pre">None</span></code> if <em>BODY</em> is empty or contains white-spaces only.</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponse.request_info">
<code class="sig-name descname">request_info</code><a class="headerlink" href="#aiohttp.ClientResponse.request_info" title="Permalink to this definition">¶</a></dt>
<dd><p>A namedtuple with request URL and headers from <code class="xref py py-class docutils literal notranslate"><span class="pre">ClientRequest</span></code>
object, <a class="reference internal" href="#aiohttp.RequestInfo" title="aiohttp.RequestInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.RequestInfo</span></code></a> instance.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientResponse.get_encoding">
<code class="sig-name descname">get_encoding</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientResponse.get_encoding" title="Permalink to this definition">¶</a></dt>
<dd><p>Automatically detect content encoding using <code class="docutils literal notranslate"><span class="pre">charset</span></code> info in
<code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> HTTP header. If this info is not exists or there
are no appropriate codecs for encoding then <a class="reference internal" href="index.html#term-cchardet"><span class="xref std std-term">cchardet</span></a> /
<a class="reference internal" href="index.html#term-chardet"><span class="xref std std-term">chardet</span></a> is used.</p>
<p>Beware that it is not always safe to use the result of this function to
decode a response. Some encodings detected by cchardet are not known by
Python (e.g. VISCII).</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="clientwebsocketresponse">
<h5>ClientWebSocketResponse<a class="headerlink" href="#clientwebsocketresponse" title="Permalink to this headline">¶</a></h5>
<p>To connect to a websocket server <code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp.ws_connect()</span></code> or
<a class="reference internal" href="#aiohttp.ClientSession.ws_connect" title="aiohttp.ClientSession.ws_connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.ClientSession.ws_connect()</span></code></a> coroutines should be used, do
not create an instance of class <a class="reference internal" href="#aiohttp.ClientWebSocketResponse" title="aiohttp.ClientWebSocketResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientWebSocketResponse</span></code></a>
manually.</p>
<dl class="class">
<dt id="aiohttp.ClientWebSocketResponse">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientWebSocketResponse</code><a class="headerlink" href="#aiohttp.ClientWebSocketResponse" title="Permalink to this definition">¶</a></dt>
<dd><p>Class for handling client-side websockets.</p>
<dl class="attribute">
<dt id="aiohttp.ClientWebSocketResponse.closed">
<code class="sig-name descname">closed</code><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.closed" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property, <code class="docutils literal notranslate"><span class="pre">True</span></code> if <a class="reference internal" href="#aiohttp.ClientWebSocketResponse.close" title="aiohttp.ClientWebSocketResponse.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></a> has been called or
<a class="reference internal" href="index.html#aiohttp.WSMsgType.CLOSE" title="aiohttp.WSMsgType.CLOSE"><code class="xref py py-const docutils literal notranslate"><span class="pre">CLOSE</span></code></a> message has been received from peer.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientWebSocketResponse.protocol">
<code class="sig-name descname">protocol</code><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.protocol" title="Permalink to this definition">¶</a></dt>
<dd><p>Websocket <em>subprotocol</em> chosen after <code class="xref py py-meth docutils literal notranslate"><span class="pre">start()</span></code> call.</p>
<p>May be <code class="docutils literal notranslate"><span class="pre">None</span></code> if server and client protocols are
not overlapping.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.get_extra_info">
<code class="sig-name descname">get_extra_info</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.get_extra_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads extra info from connection’s transport</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.exception">
<code class="sig-name descname">exception</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns exception if any occurs or returns None.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.ping">
<em class="property">coroutine </em><code class="sig-name descname">ping</code><span class="sig-paren">(</span><em class="sig-param">message=b''</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.ping" title="Permalink to this definition">¶</a></dt>
<dd><p>Send <a class="reference internal" href="index.html#aiohttp.WSMsgType.PING" title="aiohttp.WSMsgType.PING"><code class="xref py py-const docutils literal notranslate"><span class="pre">PING</span></code></a> to peer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>message</strong> – optional payload of <em>ping</em> message,
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> (converted to <em>UTF-8</em> encoded bytes)
or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>.</p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The method is converted into <a class="reference external" href="https://docs.python.org/3/glossary.html#term-coroutine" title="(in Python v3.7)"><span class="xref std std-term">coroutine</span></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.pong">
<em class="property">coroutine </em><code class="sig-name descname">pong</code><span class="sig-paren">(</span><em class="sig-param">message=b''</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.pong" title="Permalink to this definition">¶</a></dt>
<dd><p>Send <a class="reference internal" href="index.html#aiohttp.WSMsgType.PONG" title="aiohttp.WSMsgType.PONG"><code class="xref py py-const docutils literal notranslate"><span class="pre">PONG</span></code></a> to peer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>message</strong> – optional payload of <em>pong</em> message,
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> (converted to <em>UTF-8</em> encoded bytes)
or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>.</p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The method is converted into <a class="reference external" href="https://docs.python.org/3/glossary.html#term-coroutine" title="(in Python v3.7)"><span class="xref std std-term">coroutine</span></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.send_str">
<em class="property">coroutine </em><code class="sig-name descname">send_str</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">compress=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.send_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Send <em>data</em> to peer as <a class="reference internal" href="index.html#aiohttp.WSMsgType.TEXT" title="aiohttp.WSMsgType.TEXT"><code class="xref py py-const docutils literal notranslate"><span class="pre">TEXT</span></code></a> message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – data to send.</p></li>
<li><p><strong>compress</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – sets specific level of compression for
single message,
<code class="docutils literal notranslate"><span class="pre">None</span></code> for not overriding per-socket setting.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if data is not <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The method is converted into <a class="reference external" href="https://docs.python.org/3/glossary.html#term-coroutine" title="(in Python v3.7)"><span class="xref std std-term">coroutine</span></a>,
<em>compress</em> parameter added.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.send_bytes">
<em class="property">coroutine </em><code class="sig-name descname">send_bytes</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">compress=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.send_bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>Send <em>data</em> to peer as <a class="reference internal" href="index.html#aiohttp.WSMsgType.BINARY" title="aiohttp.WSMsgType.BINARY"><code class="xref py py-const docutils literal notranslate"><span class="pre">BINARY</span></code></a> message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – data to send.</p></li>
<li><p><strong>compress</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – sets specific level of compression for
single message,
<code class="docutils literal notranslate"><span class="pre">None</span></code> for not overriding per-socket setting.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if data is not <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>,
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#memoryview" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">memoryview</span></code></a>.</p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The method is converted into <a class="reference external" href="https://docs.python.org/3/glossary.html#term-coroutine" title="(in Python v3.7)"><span class="xref std std-term">coroutine</span></a>,
<em>compress</em> parameter added.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.send_json">
<em class="property">coroutine </em><code class="sig-name descname">send_json</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">compress=None</em>, <em class="sig-param">*</em>, <em class="sig-param">dumps=json.dumps</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.send_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Send <em>data</em> to peer as JSON string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – data to send.</p></li>
<li><p><strong>compress</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – sets specific level of compression for
single message,
<code class="docutils literal notranslate"><span class="pre">None</span></code> for not overriding per-socket setting.</p></li>
<li><p><strong>dumps</strong> (<em>callable</em>) – any <a class="reference internal" href="index.html#term-callable"><span class="xref std std-term">callable</span></a> that accepts an object and
returns a JSON string
(<a class="reference external" href="https://docs.python.org/3/library/json.html#json.dumps" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">json.dumps()</span></code></a> by default).</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><strong>RuntimeError</strong></a> – if connection is not started or closing</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if data is not serializable object</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if value returned by <code class="docutils literal notranslate"><span class="pre">dumps(data)</span></code> is not
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></p></li>
</ul>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The method is converted into <a class="reference external" href="https://docs.python.org/3/glossary.html#term-coroutine" title="(in Python v3.7)"><span class="xref std std-term">coroutine</span></a>,
<em>compress</em> parameter added.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.close">
<em class="property">coroutine </em><code class="sig-name descname">close</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">code=1000</em>, <em class="sig-param">message=b''</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.close" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that initiates closing handshake by sending
<a class="reference internal" href="index.html#aiohttp.WSMsgType.CLOSE" title="aiohttp.WSMsgType.CLOSE"><code class="xref py py-const docutils literal notranslate"><span class="pre">CLOSE</span></code></a> message. It waits for
close response from server. To add a timeout to <cite>close()</cite> call
just wrap the call with <cite>asyncio.wait()</cite> or <cite>asyncio.wait_for()</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>code</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – closing code</p></li>
<li><p><strong>message</strong> – optional payload of <em>pong</em> message,
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> (converted to <em>UTF-8</em> encoded bytes) or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.receive">
<em class="property">coroutine </em><code class="sig-name descname">receive</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.receive" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that waits upcoming <em>data</em>
message from peer and returns it.</p>
<p>The coroutine implicitly handles
<a class="reference internal" href="index.html#aiohttp.WSMsgType.PING" title="aiohttp.WSMsgType.PING"><code class="xref py py-const docutils literal notranslate"><span class="pre">PING</span></code></a>,
<a class="reference internal" href="index.html#aiohttp.WSMsgType.PONG" title="aiohttp.WSMsgType.PONG"><code class="xref py py-const docutils literal notranslate"><span class="pre">PONG</span></code></a> and
<a class="reference internal" href="index.html#aiohttp.WSMsgType.CLOSE" title="aiohttp.WSMsgType.CLOSE"><code class="xref py py-const docutils literal notranslate"><span class="pre">CLOSE</span></code></a> without returning the
message.</p>
<p>It process <em>ping-pong game</em> and performs <em>closing handshake</em> internally.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><a class="reference internal" href="index.html#aiohttp.WSMessage" title="aiohttp.WSMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">WSMessage</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.receive_str">
<em class="property">coroutine </em><code class="sig-name descname">receive_str</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.receive_str" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that calls <a class="reference internal" href="#aiohttp.ClientWebSocketResponse.receive" title="aiohttp.ClientWebSocketResponse.receive"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive()</span></code></a> but
also asserts the message type is
<a class="reference internal" href="index.html#aiohttp.WSMsgType.TEXT" title="aiohttp.WSMsgType.TEXT"><code class="xref py py-const docutils literal notranslate"><span class="pre">TEXT</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return str</dt>
<dd class="field-odd"><p>peer’s message content.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if message is <a class="reference internal" href="index.html#aiohttp.WSMsgType.BINARY" title="aiohttp.WSMsgType.BINARY"><code class="xref py py-const docutils literal notranslate"><span class="pre">BINARY</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.receive_bytes">
<em class="property">coroutine </em><code class="sig-name descname">receive_bytes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.receive_bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that calls <a class="reference internal" href="#aiohttp.ClientWebSocketResponse.receive" title="aiohttp.ClientWebSocketResponse.receive"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive()</span></code></a> but
also asserts the message type is
<a class="reference internal" href="index.html#aiohttp.WSMsgType.BINARY" title="aiohttp.WSMsgType.BINARY"><code class="xref py py-const docutils literal notranslate"><span class="pre">BINARY</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return bytes</dt>
<dd class="field-odd"><p>peer’s message content.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if message is <a class="reference internal" href="index.html#aiohttp.WSMsgType.TEXT" title="aiohttp.WSMsgType.TEXT"><code class="xref py py-const docutils literal notranslate"><span class="pre">TEXT</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.ClientWebSocketResponse.receive_json">
<em class="property">coroutine </em><code class="sig-name descname">receive_json</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">loads=json.loads</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientWebSocketResponse.receive_json" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that calls <a class="reference internal" href="#aiohttp.ClientWebSocketResponse.receive_str" title="aiohttp.ClientWebSocketResponse.receive_str"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive_str()</span></code></a> and loads
the JSON string to a Python dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>loads</strong> (<em>callable</em>) – any <a class="reference internal" href="index.html#term-callable"><span class="xref std std-term">callable</span></a> that accepts
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> and returns <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>
with parsed JSON (<a class="reference external" href="https://docs.python.org/3/library/json.html#json.loads" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">json.loads()</span></code></a> by
default).</p>
</dd>
<dt class="field-even">Return dict</dt>
<dd class="field-even"><p>loaded JSON content</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if message is <a class="reference internal" href="index.html#aiohttp.WSMsgType.BINARY" title="aiohttp.WSMsgType.BINARY"><code class="xref py py-const docutils literal notranslate"><span class="pre">BINARY</span></code></a>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if message is not valid JSON.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="utilities">
<h5>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h5>
<div class="section" id="clienttimeout">
<h6>ClientTimeout<a class="headerlink" href="#clienttimeout" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.ClientTimeout">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientTimeout</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">total=None</em>, <em class="sig-param">connect=None</em>, <em class="sig-param">sock_connect</em>, <em class="sig-param">sock_read=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ClientTimeout" title="Permalink to this definition">¶</a></dt>
<dd><p>A data class for client timeout settings.</p>
<p>See <a class="reference internal" href="index.html#aiohttp-client-timeouts"><span class="std std-ref">Timeouts</span></a> for usage examples.</p>
<dl class="attribute">
<dt id="aiohttp.ClientTimeout.total">
<code class="sig-name descname">total</code><a class="headerlink" href="#aiohttp.ClientTimeout.total" title="Permalink to this definition">¶</a></dt>
<dd><p>Total timeout for the whole request.</p>
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>, <code class="docutils literal notranslate"><span class="pre">None</span></code> by default.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientTimeout.connect">
<code class="sig-name descname">connect</code><a class="headerlink" href="#aiohttp.ClientTimeout.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Total timeout for acquiring a connection from pool.  The time
consists connection establishment for a new connection or
waiting for a free connection from a pool if pool connection
limits are exceeded.</p>
<p>For pure socket connection establishment time use
<a class="reference internal" href="#aiohttp.ClientTimeout.sock_connect" title="aiohttp.ClientTimeout.sock_connect"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sock_connect</span></code></a>.</p>
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>, <code class="docutils literal notranslate"><span class="pre">None</span></code> by default.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientTimeout.sock_connect">
<code class="sig-name descname">sock_connect</code><a class="headerlink" href="#aiohttp.ClientTimeout.sock_connect" title="Permalink to this definition">¶</a></dt>
<dd><p>A timeout for connecting to a peer for a new connection, not
given from a pool.  See also <a class="reference internal" href="#aiohttp.ClientTimeout.connect" title="aiohttp.ClientTimeout.connect"><code class="xref py py-attr docutils literal notranslate"><span class="pre">connect</span></code></a>.</p>
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>, <code class="docutils literal notranslate"><span class="pre">None</span></code> by default.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientTimeout.sock_read">
<code class="sig-name descname">sock_read</code><a class="headerlink" href="#aiohttp.ClientTimeout.sock_read" title="Permalink to this definition">¶</a></dt>
<dd><p>A timeout for reading a portion of data from a peer.</p>
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>, <code class="docutils literal notranslate"><span class="pre">None</span></code> by default.</p>
</dd></dl>

<div class="versionadded">
<p><span class="versionmodified added">New in version 3.3.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="requestinfo">
<h6>RequestInfo<a class="headerlink" href="#requestinfo" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.RequestInfo">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">RequestInfo</code><a class="headerlink" href="#aiohttp.RequestInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>A data class with request URL and headers from <code class="xref py py-class docutils literal notranslate"><span class="pre">ClientRequest</span></code>
object, available as <a class="reference internal" href="#aiohttp.ClientResponse.request_info" title="aiohttp.ClientResponse.request_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ClientResponse.request_info</span></code></a> attribute.</p>
<dl class="attribute">
<dt id="aiohttp.RequestInfo.url">
<code class="sig-name descname">url</code><a class="headerlink" href="#aiohttp.RequestInfo.url" title="Permalink to this definition">¶</a></dt>
<dd><p>Requested <em>url</em>, <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">yarl.URL</span></code></a> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.RequestInfo.method">
<code class="sig-name descname">method</code><a class="headerlink" href="#aiohttp.RequestInfo.method" title="Permalink to this definition">¶</a></dt>
<dd><p>Request HTTP method like <code class="docutils literal notranslate"><span class="pre">'GET'</span></code> or <code class="docutils literal notranslate"><span class="pre">'POST'</span></code>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.RequestInfo.headers">
<code class="sig-name descname">headers</code><a class="headerlink" href="#aiohttp.RequestInfo.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP headers for request, <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.CIMultiDict" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multidict.CIMultiDict</span></code></a> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.RequestInfo.real_url">
<code class="sig-name descname">real_url</code><a class="headerlink" href="#aiohttp.RequestInfo.real_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Requested <em>url</em> with URL fragment unstripped, <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">yarl.URL</span></code></a> instance.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.2.</span></p>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="basicauth">
<h6>BasicAuth<a class="headerlink" href="#basicauth" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.BasicAuth">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">BasicAuth</code><span class="sig-paren">(</span><em class="sig-param">login</em>, <em class="sig-param">password=''</em>, <em class="sig-param">encoding='latin1'</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BasicAuth" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP basic authentication helper.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>login</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – login</p></li>
<li><p><strong>password</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – password</p></li>
<li><p><strong>encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – encoding (<code class="docutils literal notranslate"><span class="pre">'latin1'</span></code> by default)</p></li>
</ul>
</dd>
</dl>
<p>Should be used for specifying authorization data in client API,
e.g. <em>auth</em> parameter for <a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.request()</span></code></a>.</p>
<dl class="method">
<dt id="aiohttp.BasicAuth.decode">
<em class="property">classmethod </em><code class="sig-name descname">decode</code><span class="sig-paren">(</span><em class="sig-param">auth_header</em>, <em class="sig-param">encoding='latin1'</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BasicAuth.decode" title="Permalink to this definition">¶</a></dt>
<dd><p>Decode HTTP basic authentication credentials.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>auth_header</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header to decode.</p></li>
<li><p><strong>encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – (optional) encoding (‘latin1’ by default)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>decoded authentication data, <a class="reference internal" href="#aiohttp.BasicAuth" title="aiohttp.BasicAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicAuth</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BasicAuth.from_url">
<em class="property">classmethod </em><code class="sig-name descname">from_url</code><span class="sig-paren">(</span><em class="sig-param">url</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BasicAuth.from_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructed credentials info from url’s <em>user</em> and <em>password</em>
parts.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>credentials data, <a class="reference internal" href="#aiohttp.BasicAuth" title="aiohttp.BasicAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicAuth</span></code></a> or <code class="docutils literal notranslate"><span class="pre">None</span></code> is
credentials are not provided.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BasicAuth.encode">
<code class="sig-name descname">encode</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BasicAuth.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Encode credentials into string suitable for <code class="docutils literal notranslate"><span class="pre">Authorization</span></code>
header etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>encoded authentication data, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="cookiejar">
<h6>CookieJar<a class="headerlink" href="#cookiejar" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.CookieJar">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">CookieJar</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">unsafe=False</em>, <em class="sig-param">loop=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.CookieJar" title="Permalink to this definition">¶</a></dt>
<dd><p>The cookie jar instance is available as <a class="reference internal" href="#aiohttp.ClientSession.cookie_jar" title="aiohttp.ClientSession.cookie_jar"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ClientSession.cookie_jar</span></code></a>.</p>
<p>The jar contains <a class="reference external" href="https://docs.python.org/3/library/http.cookies.html#http.cookies.Morsel" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Morsel</span></code></a> items for storing
internal cookie data.</p>
<p>API provides a count of saved cookies:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">cookie_jar</span><span class="p">)</span>
</pre></div>
</div>
<p>These cookies may be iterated over:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">cookie_jar</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cookie</span><span class="p">[</span><span class="s2">&quot;domain&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>The class implements <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Iterable</span></code></a>,
<a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sized" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Sized</span></code></a> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.AbstractCookieJar</span></code> interfaces.</p>
<p>Implements cookie storage adhering to RFC 6265.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>unsafe</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – (optional) Whether to accept cookies from IPs.</p></li>
<li><p><strong>loop</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <p>an <a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio-event-loop" title="(in Python v3.7)"><span class="xref std std-ref">event loop</span></a> instance.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.abc.AbstractCookieJar</span></code></p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 2.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="aiohttp.CookieJar.update_cookies">
<code class="sig-name descname">update_cookies</code><span class="sig-paren">(</span><em class="sig-param">cookies</em>, <em class="sig-param">response_url=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.CookieJar.update_cookies" title="Permalink to this definition">¶</a></dt>
<dd><p>Update cookies returned by server in <code class="docutils literal notranslate"><span class="pre">Set-Cookie</span></code> header.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cookies</strong> – a <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Mapping</span></code></a>
(e.g. <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/http.cookies.html#http.cookies.SimpleCookie" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleCookie</span></code></a>) or
<em>iterable</em> of <em>pairs</em> with cookies returned by server’s
response.</p></li>
<li><p><strong>response_url</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – URL of response, <code class="docutils literal notranslate"><span class="pre">None</span></code> for <em>shared
cookies</em>.  Regular cookies are coupled with server’s URL and
are sent only to this server, shared ones are sent in every
client request.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.CookieJar.filter_cookies">
<code class="sig-name descname">filter_cookies</code><span class="sig-paren">(</span><em class="sig-param">request_url</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.CookieJar.filter_cookies" title="Permalink to this definition">¶</a></dt>
<dd><p>Return jar’s cookies acceptable for URL and available in
<code class="docutils literal notranslate"><span class="pre">Cookie</span></code> header for sending client requests for given URL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>response_url</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – request’s URL for which cookies are asked.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/http.cookies.html#http.cookies.SimpleCookie" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">http.cookies.SimpleCookie</span></code></a> with filtered
cookies for given URL.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.CookieJar.save">
<code class="sig-name descname">save</code><span class="sig-paren">(</span><em class="sig-param">file_path</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.CookieJar.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a pickled representation of cookies into the file
at provided path.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_path</strong> – Path to file where cookies will be serialized,
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a> instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.CookieJar.load">
<code class="sig-name descname">load</code><span class="sig-paren">(</span><em class="sig-param">file_path</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.CookieJar.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a pickled representation of cookies from the file
at provided path.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_path</strong> – Path to file from where cookies will be
imported, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a> instance.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.DummyCookieJar">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">DummyCookieJar</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">loop=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.DummyCookieJar" title="Permalink to this definition">¶</a></dt>
<dd><p>Dummy cookie jar which does not store cookies but ignores them.</p>
<p>Could be useful e.g. for web crawlers to iterate over Internet
without blowing up with saved cookies information.</p>
<p>To install dummy cookie jar pass it into session instance:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">jar</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">DummyCookieJar</span><span class="p">()</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">cookie_jar</span><span class="o">=</span><span class="n">DummyCookieJar</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="aiohttp.Fingerprint">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">Fingerprint</code><span class="sig-paren">(</span><em class="sig-param">digest</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.Fingerprint" title="Permalink to this definition">¶</a></dt>
<dd><p>Fingerprint helper for checking SSL certificates by <em>SHA256</em> digest.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>digest</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – <em>SHA256</em> digest for certificate in DER-encoded
binary form (see
<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLSocket.getpeercert" title="(in Python v3.7)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ssl.SSLSocket.getpeercert()</span></code></a>).</p>
</dd>
</dl>
<p>To check fingerprint pass the object into <a class="reference internal" href="#aiohttp.ClientSession.get" title="aiohttp.ClientSession.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ClientSession.get()</span></code></a>
call, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hashlib</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_cert</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

<span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">Fingerprint</span><span class="p">(</span><span class="n">digest</span><span class="p">))</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="formdata">
<h6>FormData<a class="headerlink" href="#formdata" title="Permalink to this headline">¶</a></h6>
<p>A <a class="reference internal" href="#aiohttp.FormData" title="aiohttp.FormData"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormData</span></code></a> object contains the form data and also handles
encoding it into a body that is either <code class="docutils literal notranslate"><span class="pre">multipart/form-data</span></code> or
<code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code>. <code class="docutils literal notranslate"><span class="pre">multipart/form-data</span></code> is
used if at least one field is an <a class="reference external" href="https://docs.python.org/3/library/io.html#io.IOBase" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.IOBase</span></code></a> object or was
added with at least one optional argument to <a class="reference internal" href="#aiohttp.FormData.add_field" title="aiohttp.FormData.add_field"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_field</span></code></a>
(<code class="docutils literal notranslate"><span class="pre">content_type</span></code>, <code class="docutils literal notranslate"><span class="pre">filename</span></code>, or <code class="docutils literal notranslate"><span class="pre">content_transfer_encoding</span></code>).
Otherwise, <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code> is used.</p>
<p><a class="reference internal" href="#aiohttp.FormData" title="aiohttp.FormData"><code class="xref py py-class docutils literal notranslate"><span class="pre">FormData</span></code></a> instances are callable and return a <code class="xref py py-class docutils literal notranslate"><span class="pre">Payload</span></code>
on being called.</p>
<dl class="class">
<dt id="aiohttp.FormData">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">FormData</code><span class="sig-paren">(</span><em class="sig-param">fields</em>, <em class="sig-param">quote_fields=True</em>, <em class="sig-param">charset=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.FormData" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper class for multipart/form-data and application/x-www-form-urlencoded body generation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>fields</strong> – <p>A container for the key/value pairs of this form.</p>
<p>Possible types are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/io.html#io.IOBase" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.IOBase</span></code></a>, e.g. a file-like object</p></li>
<li><p><a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.MultiDict" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multidict.MultiDict</span></code></a> or <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.MultiDictProxy" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multidict.MultiDictProxy</span></code></a></p></li>
</ul>
<p>If it is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a>, it must be a valid argument
for <a class="reference internal" href="#aiohttp.FormData.add_fields" title="aiohttp.FormData.add_fields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_fields</span></code></a>.</p>
<p>For <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.MultiDict" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multidict.MultiDict</span></code></a>, and <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.MultiDictProxy" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multidict.MultiDictProxy</span></code></a>,
the keys and values must be valid <cite>name</cite> and <cite>value</cite> arguments to
<a class="reference internal" href="#aiohttp.FormData.add_field" title="aiohttp.FormData.add_field"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_field</span></code></a>, respectively.</p>
</p>
</dd>
</dl>
<dl class="method">
<dt id="aiohttp.FormData.add_field">
<code class="sig-name descname">add_field</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">value</em>, <em class="sig-param">content_type=None</em>, <em class="sig-param">filename=None</em>, <em class="sig-param">content_transfer_encoding=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.FormData.add_field" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a field to the form.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Name of the field</p></li>
<li><p><strong>value</strong> – <p>Value of the field</p>
<p>Possible types are:</p>
<ul>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">bytesarray</span></code>, or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#memoryview" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">memoryview</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/io.html#io.IOBase" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.IOBase</span></code></a>, e.g. a file-like object</p></li>
</ul>
</p></li>
<li><p><strong>content_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The field’s content-type header (optional)</p></li>
<li><p><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – <p>The field’s filename (optional)</p>
<p>If this is not set and <code class="docutils literal notranslate"><span class="pre">value</span></code> is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">bytesarray</span></code>,
or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#memoryview" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">memoryview</span></code></a> object, the <cite>name</cite> argument is used as the filename
unless <code class="docutils literal notranslate"><span class="pre">content_transfer_encoding</span></code> is specified.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">filename</span></code> is not set and <code class="docutils literal notranslate"><span class="pre">value</span></code> is an <a class="reference external" href="https://docs.python.org/3/library/io.html#io.IOBase" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.IOBase</span></code></a>
object, the filename is extracted from the object if possible.</p>
</p></li>
<li><p><strong>content_transfer_encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – The field’s content-transfer-encoding
header (optional)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.FormData.add_fields">
<code class="sig-name descname">add_fields</code><span class="sig-paren">(</span><em class="sig-param">fields</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.FormData.add_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Add one or more fields to the form.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>fields</strong> – <p>An iterable containing:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/io.html#io.IOBase" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.IOBase</span></code></a>, e.g. a file-like object</p></li>
<li><p><a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.MultiDict" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multidict.MultiDict</span></code></a> or <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.MultiDictProxy" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multidict.MultiDictProxy</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of length two, containing a name-value pair</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="client-exceptions">
<h5>Client exceptions<a class="headerlink" href="#client-exceptions" title="Permalink to this headline">¶</a></h5>
<p>Exception hierarchy has been significantly modified in version
2.0. aiohttp defines only exceptions that covers connection handling
and server response misbehaviors.  For developer specific mistakes,
aiohttp uses python standard exceptions like <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> or
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>.</p>
<p>Reading a response content may raise a <a class="reference internal" href="#aiohttp.ClientPayloadError" title="aiohttp.ClientPayloadError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientPayloadError</span></code></a>
exception. This exception indicates errors specific to the payload
encoding. Such as invalid compressed data, malformed chunked-encoded
chunks or not enough data that satisfy the content-length header.</p>
<p>All exceptions are available as members of <em>aiohttp</em> module.</p>
<dl class="exception">
<dt id="aiohttp.ClientError">
<em class="property">exception </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientError</code><a class="headerlink" href="#aiohttp.ClientError" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for all client specific exceptions.</p>
<p>Derived from <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#Exception" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">Exception</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.ClientPayloadError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientPayloadError</code><a class="headerlink" href="#aiohttp.ClientPayloadError" title="Permalink to this definition">¶</a></dt>
<dd><p>This exception can only be raised while reading the response
payload if one of these errors occurs:</p>
<ol class="arabic simple">
<li><p>invalid compression</p></li>
<li><p>malformed chunked encoding</p></li>
<li><p>not enough data that satisfy <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> HTTP header.</p></li>
</ol>
<p>Derived from <a class="reference internal" href="#aiohttp.ClientError" title="aiohttp.ClientError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientError</span></code></a></p>
</dd></dl>

<dl class="exception">
<dt id="aiohttp.InvalidURL">
<em class="property">exception </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">InvalidURL</code><a class="headerlink" href="#aiohttp.InvalidURL" title="Permalink to this definition">¶</a></dt>
<dd><p>URL used for fetching is malformed, e.g. it does not contain host
part.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ClientError" title="aiohttp.ClientError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientError</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a></p>
<dl class="attribute">
<dt id="aiohttp.InvalidURL.url">
<code class="sig-name descname">url</code><a class="headerlink" href="#aiohttp.InvalidURL.url" title="Permalink to this definition">¶</a></dt>
<dd><p>Invalid URL, <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">yarl.URL</span></code></a> instance.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.ContentDisposition">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ContentDisposition</code><a class="headerlink" href="#aiohttp.ContentDisposition" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent Content-Disposition header</p>
<dl class="attribute">
<dt id="aiohttp.ContentDisposition.value">
<code class="sig-name descname">value</code><a class="headerlink" href="#aiohttp.ContentDisposition.value" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> instance. Value of Content-Disposition header
itself, e.g. <code class="docutils literal notranslate"><span class="pre">attachment</span></code>.</p>
<dl class="attribute">
<dt id="aiohttp.ContentDisposition.filename">
<code class="sig-name descname">filename</code><a class="headerlink" href="#aiohttp.ContentDisposition.filename" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> instance. Content filename extracted from
parameters. May be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<dl class="attribute">
<dt id="aiohttp.ContentDisposition.parameters">
<code class="sig-name descname">parameters</code><a class="headerlink" href="#aiohttp.ContentDisposition.parameters" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Read-only mapping contains all parameters.</p>
</dd></dl>

<div class="section" id="response-errors">
<h6>Response errors<a class="headerlink" href="#response-errors" title="Permalink to this headline">¶</a></h6>
<dl class="exception">
<dt id="aiohttp.ClientResponseError">
<em class="property">exception </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientResponseError</code><a class="headerlink" href="#aiohttp.ClientResponseError" title="Permalink to this definition">¶</a></dt>
<dd><p>These exceptions could happen after we get response from server.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ClientError" title="aiohttp.ClientError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientError</span></code></a></p>
<dl class="attribute">
<dt id="aiohttp.ClientResponseError.request_info">
<code class="sig-name descname">request_info</code><a class="headerlink" href="#aiohttp.ClientResponseError.request_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Instance of <a class="reference internal" href="#aiohttp.RequestInfo" title="aiohttp.RequestInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestInfo</span></code></a> object, contains information
about request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponseError.status">
<code class="sig-name descname">status</code><a class="headerlink" href="#aiohttp.ClientResponseError.status" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP status code of response (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>), e.g. <code class="docutils literal notranslate"><span class="pre">400</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponseError.message">
<code class="sig-name descname">message</code><a class="headerlink" href="#aiohttp.ClientResponseError.message" title="Permalink to this definition">¶</a></dt>
<dd><p>Message of response (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>), e.g. <code class="docutils literal notranslate"><span class="pre">&quot;OK&quot;</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponseError.headers">
<code class="sig-name descname">headers</code><a class="headerlink" href="#aiohttp.ClientResponseError.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Headers in response, a list of pairs.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponseError.history">
<code class="sig-name descname">history</code><a class="headerlink" href="#aiohttp.ClientResponseError.history" title="Permalink to this definition">¶</a></dt>
<dd><p>History from failed response, if available, else empty tuple.</p>
<p>A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of <a class="reference internal" href="#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientResponse</span></code></a> objects used for
handle redirection responses.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.ClientResponseError.code">
<code class="sig-name descname">code</code><a class="headerlink" href="#aiohttp.ClientResponseError.code" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP status code of response (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>), e.g. <code class="docutils literal notranslate"><span class="pre">400</span></code>.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.1.</span></p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.WSServerHandshakeError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">WSServerHandshakeError</code><a class="headerlink" href="#aiohttp.WSServerHandshakeError" title="Permalink to this definition">¶</a></dt>
<dd><p>Web socket server response error.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ClientResponseError" title="aiohttp.ClientResponseError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientResponseError</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.ContentTypeError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ContentTypeError</code><a class="headerlink" href="#aiohttp.ContentTypeError" title="Permalink to this definition">¶</a></dt>
<dd><p>Invalid content type.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ClientResponseError" title="aiohttp.ClientResponseError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientResponseError</span></code></a></p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="class">
<dt id="aiohttp.TooManyRedirects">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TooManyRedirects</code><a class="headerlink" href="#aiohttp.TooManyRedirects" title="Permalink to this definition">¶</a></dt>
<dd><p>Client was redirected too many times.</p>
<p>Maximum number of redirects can be configured by using
parameter <code class="docutils literal notranslate"><span class="pre">max_redirects</span></code> in <a class="reference internal" href="#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request</span></code></a>.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ClientResponseError" title="aiohttp.ClientResponseError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientResponseError</span></code></a></p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.2.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="connection-errors">
<h6>Connection errors<a class="headerlink" href="#connection-errors" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.ClientConnectionError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientConnectionError</code><a class="headerlink" href="#aiohttp.ClientConnectionError" title="Permalink to this definition">¶</a></dt>
<dd><p>These exceptions related to low-level connection problems.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ClientError" title="aiohttp.ClientError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientError</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.ClientOSError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientOSError</code><a class="headerlink" href="#aiohttp.ClientOSError" title="Permalink to this definition">¶</a></dt>
<dd><p>Subset of connection errors that are initiated by an <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#OSError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OSError</span></code></a>
exception.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ClientConnectionError" title="aiohttp.ClientConnectionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientConnectionError</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#OSError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OSError</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.ClientConnectorError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientConnectorError</code><a class="headerlink" href="#aiohttp.ClientConnectorError" title="Permalink to this definition">¶</a></dt>
<dd><p>Connector related exceptions.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ClientOSError" title="aiohttp.ClientOSError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientOSError</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.ClientProxyConnectionError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientProxyConnectionError</code><a class="headerlink" href="#aiohttp.ClientProxyConnectionError" title="Permalink to this definition">¶</a></dt>
<dd><p>Derived from <a class="reference internal" href="#aiohttp.ClientConnectorError" title="aiohttp.ClientConnectorError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientConnectorError</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.ServerConnectionError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ServerConnectionError</code><a class="headerlink" href="#aiohttp.ServerConnectionError" title="Permalink to this definition">¶</a></dt>
<dd><p>Derived from <a class="reference internal" href="#aiohttp.ClientConnectionError" title="aiohttp.ClientConnectionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientConnectionError</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.ClientSSLError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientSSLError</code><a class="headerlink" href="#aiohttp.ClientSSLError" title="Permalink to this definition">¶</a></dt>
<dd><p>Derived from <a class="reference internal" href="#aiohttp.ClientConnectorError" title="aiohttp.ClientConnectorError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientConnectorError</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.ClientConnectorSSLError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientConnectorSSLError</code><a class="headerlink" href="#aiohttp.ClientConnectorSSLError" title="Permalink to this definition">¶</a></dt>
<dd><p>Response ssl error.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ClientSSLError" title="aiohttp.ClientSSLError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientSSLError</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ssl.SSLError</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.ClientConnectorCertificateError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ClientConnectorCertificateError</code><a class="headerlink" href="#aiohttp.ClientConnectorCertificateError" title="Permalink to this definition">¶</a></dt>
<dd><p>Response certificate error.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ClientSSLError" title="aiohttp.ClientSSLError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientSSLError</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.CertificateError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ssl.CertificateError</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.ServerDisconnectedError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ServerDisconnectedError</code><a class="headerlink" href="#aiohttp.ServerDisconnectedError" title="Permalink to this definition">¶</a></dt>
<dd><p>Server disconnected.</p>
<p>Derived from <code class="xref py py-exc docutils literal notranslate"><span class="pre">ServerDisconnectionError</span></code></p>
<dl class="attribute">
<dt id="aiohttp.ServerDisconnectedError.message">
<code class="sig-name descname">message</code><a class="headerlink" href="#aiohttp.ServerDisconnectedError.message" title="Permalink to this definition">¶</a></dt>
<dd><p>Partially parsed HTTP message (optional).</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.ServerTimeoutError">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ServerTimeoutError</code><a class="headerlink" href="#aiohttp.ServerTimeoutError" title="Permalink to this definition">¶</a></dt>
<dd><p>Server operation timeout: read timeout, etc.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ServerConnectionError" title="aiohttp.ServerConnectionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ServerConnectionError</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/asyncio-exceptions.html#asyncio.TimeoutError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">asyncio.TimeoutError</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.ServerFingerprintMismatch">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ServerFingerprintMismatch</code><a class="headerlink" href="#aiohttp.ServerFingerprintMismatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Server fingerprint mismatch.</p>
<p>Derived from <a class="reference internal" href="#aiohttp.ServerConnectionError" title="aiohttp.ServerConnectionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ServerConnectionError</span></code></a></p>
</dd></dl>

</div>
<div class="section" id="hierarchy-of-exceptions">
<h6>Hierarchy of exceptions<a class="headerlink" href="#hierarchy-of-exceptions" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p><a class="reference internal" href="#aiohttp.ClientError" title="aiohttp.ClientError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientError</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#aiohttp.ClientResponseError" title="aiohttp.ClientResponseError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientResponseError</span></code></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#aiohttp.ContentTypeError" title="aiohttp.ContentTypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ContentTypeError</span></code></a></p></li>
<li><p><a class="reference internal" href="#aiohttp.WSServerHandshakeError" title="aiohttp.WSServerHandshakeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">WSServerHandshakeError</span></code></a></p></li>
<li><p><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientHttpProxyError</span></code></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#aiohttp.ClientConnectionError" title="aiohttp.ClientConnectionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientConnectionError</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#aiohttp.ClientOSError" title="aiohttp.ClientOSError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientOSError</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#aiohttp.ClientConnectorError" title="aiohttp.ClientConnectorError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientConnectorError</span></code></a></p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#aiohttp.ClientSSLError" title="aiohttp.ClientSSLError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientSSLError</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#aiohttp.ClientConnectorCertificateError" title="aiohttp.ClientConnectorCertificateError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientConnectorCertificateError</span></code></a></p></li>
<li><p><a class="reference internal" href="#aiohttp.ClientConnectorSSLError" title="aiohttp.ClientConnectorSSLError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientConnectorSSLError</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#aiohttp.ClientProxyConnectionError" title="aiohttp.ClientProxyConnectionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientProxyConnectionError</span></code></a></p></li>
</ul>
</div></blockquote>
</li>
<li><p><a class="reference internal" href="#aiohttp.ServerConnectionError" title="aiohttp.ServerConnectionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ServerConnectionError</span></code></a></p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#aiohttp.ServerDisconnectedError" title="aiohttp.ServerDisconnectedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ServerDisconnectedError</span></code></a></p></li>
<li><p><a class="reference internal" href="#aiohttp.ServerTimeoutError" title="aiohttp.ServerTimeoutError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ServerTimeoutError</span></code></a></p></li>
</ul>
</div></blockquote>
</li>
<li><p><a class="reference internal" href="#aiohttp.ServerFingerprintMismatch" title="aiohttp.ServerFingerprintMismatch"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ServerFingerprintMismatch</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#aiohttp.ClientPayloadError" title="aiohttp.ClientPayloadError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ClientPayloadError</span></code></a></p></li>
<li><p><a class="reference internal" href="#aiohttp.InvalidURL" title="aiohttp.InvalidURL"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InvalidURL</span></code></a></p></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<span id="document-tracing_reference"></span><div class="section" id="tracing-reference">
<span id="aiohttp-client-tracing-reference"></span><h4>Tracing Reference<a class="headerlink" href="#tracing-reference" title="Permalink to this headline">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
<p>A reference for client tracing API.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-client-tracing"><span class="std std-ref">Client Tracing</span></a> for tracing usage instructions.</p>
</div>
<div class="section" id="request-life-cycle">
<h5>Request life cycle<a class="headerlink" href="#request-life-cycle" title="Permalink to this headline">¶</a></h5>
<p>A request goes through the following stages and corresponding fallbacks.</p>
<div class="section" id="overview">
<h6>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h6>
<div><img height="600" src="_images/blockdiag-01f8c7ea81260e2fd47484686b6499cdb2384cd1.png" width="832" /></div><table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>start</p></td>
<td><p>on_request_start</p></td>
</tr>
<tr class="row-odd"><td><p>redirect</p></td>
<td><p>on_request_redirect</p></td>
</tr>
<tr class="row-even"><td><p>acquire_connection</p></td>
<td><p>Connection acquiring</p></td>
</tr>
<tr class="row-odd"><td><p>headers_received</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>exception</p></td>
<td><p>on_request_exception</p></td>
</tr>
<tr class="row-odd"><td><p>end</p></td>
<td><p>on_request_end</p></td>
</tr>
<tr class="row-even"><td><p>headers_sent</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>chunk_sent</p></td>
<td><p>on_request_chunk_sent</p></td>
</tr>
<tr class="row-even"><td><p>chunk_received</p></td>
<td><p>on_response_chunk_received</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="connection-acquiring">
<h6>Connection acquiring<a class="headerlink" href="#connection-acquiring" title="Permalink to this headline">¶</a></h6>
<div><img height="680" src="_images/blockdiag-9e4ca86db1dec60a9e840bbdca40a83459c051cc.png" width="640" /></div><table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>begin</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>end</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>queued_start</p></td>
<td><p>on_connection_queued_start</p></td>
</tr>
<tr class="row-odd"><td><p>create_start</p></td>
<td><p>on_connection_create_start</p></td>
</tr>
<tr class="row-even"><td><p>reuseconn</p></td>
<td><p>on_connection_reuseconn</p></td>
</tr>
<tr class="row-odd"><td><p>queued_end</p></td>
<td><p>on_connection_queued_end</p></td>
</tr>
<tr class="row-even"><td><p>create_end</p></td>
<td><p>on_connection_create_end</p></td>
</tr>
<tr class="row-odd"><td><p>exception</p></td>
<td><p>Exception raised</p></td>
</tr>
<tr class="row-even"><td><p>resolve_dns</p></td>
<td><p>DNS resolving</p></td>
</tr>
<tr class="row-odd"><td><p>sock_connect</p></td>
<td><p>Connection establishment</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dns-resolving">
<h6>DNS resolving<a class="headerlink" href="#dns-resolving" title="Permalink to this headline">¶</a></h6>
<div><img height="440" src="_images/blockdiag-05bc7514e0a36c9153d89a94b45277a8b0854184.png" width="640" /></div><table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>begin</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>end</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>exception</p></td>
<td><p>Exception raised</p></td>
</tr>
<tr class="row-odd"><td><p>resolve_end</p></td>
<td><p>on_dns_resolvehost_end</p></td>
</tr>
<tr class="row-even"><td><p>resolve_start</p></td>
<td><p>on_dns_resolvehost_start</p></td>
</tr>
<tr class="row-odd"><td><p>cache_hit</p></td>
<td><p>on_dns_cache_hit</p></td>
</tr>
<tr class="row-even"><td><p>cache_miss</p></td>
<td><p>on_dns_cache_miss</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="traceconfig">
<h5>TraceConfig<a class="headerlink" href="#traceconfig" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceConfig">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceConfig</code><span class="sig-paren">(</span><em class="sig-param">trace_config_ctx_factory=SimpleNamespace</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.TraceConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Trace config is the configuration object used to trace requests
launched by a <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> object using different events
related to different parts of the request flow.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>trace_config_ctx_factory</strong> – factory used to create trace contexts,
default class used <a class="reference external" href="https://docs.python.org/3/library/types.html#types.SimpleNamespace" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.SimpleNamespace</span></code></a></p>
</dd>
</dl>
<dl class="method">
<dt id="aiohttp.TraceConfig.trace_config_ctx">
<code class="sig-name descname">trace_config_ctx</code><span class="sig-paren">(</span><em class="sig-param">trace_request_ctx=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.TraceConfig.trace_config_ctx" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>trace_request_ctx</strong> – Will be used to pass as a kw for the
<code class="docutils literal notranslate"><span class="pre">trace_config_ctx_factory</span></code>.</p>
</dd>
</dl>
<p>Build a new trace context from the config.</p>
</dd></dl>

<p>Every signal handler should have the following signature:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">on_signal</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">session</span></code> is <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientSession</span></code></a> instance, <code class="docutils literal notranslate"><span class="pre">context</span></code> is an
object returned by <a class="reference internal" href="#aiohttp.TraceConfig.trace_config_ctx" title="aiohttp.TraceConfig.trace_config_ctx"><code class="xref py py-meth docutils literal notranslate"><span class="pre">trace_config_ctx()</span></code></a> call and <code class="docutils literal notranslate"><span class="pre">params</span></code> is a
data class with signal parameters. The type of <code class="docutils literal notranslate"><span class="pre">params</span></code> depends on
subscribed signal and described below.</p>
<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_request_start">
<code class="sig-name descname">on_request_start</code><a class="headerlink" href="#aiohttp.TraceConfig.on_request_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed
when a request starts.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceRequestStartParams" title="aiohttp.TraceRequestStartParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceRequestStartParams</span></code></a> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_request_chunk_sent">
<code class="sig-name descname">on_request_chunk_sent</code><a class="headerlink" href="#aiohttp.TraceConfig.on_request_chunk_sent" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed
when a chunk of request body is sent.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceRequestChunkSentParams" title="aiohttp.TraceRequestChunkSentParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceRequestChunkSentParams</span></code></a> instance.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_response_chunk_received">
<code class="sig-name descname">on_response_chunk_received</code><a class="headerlink" href="#aiohttp.TraceConfig.on_response_chunk_received" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed
when a chunk of response body is received.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceResponseChunkReceivedParams</span></code> instance.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_request_redirect">
<code class="sig-name descname">on_request_redirect</code><a class="headerlink" href="#aiohttp.TraceConfig.on_request_redirect" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
redirect happens during a request flow.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceRequestRedirectParams" title="aiohttp.TraceRequestRedirectParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceRequestRedirectParams</span></code></a> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_request_end">
<code class="sig-name descname">on_request_end</code><a class="headerlink" href="#aiohttp.TraceConfig.on_request_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
request ends.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceRequestEndParams" title="aiohttp.TraceRequestEndParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceRequestEndParams</span></code></a> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_request_exception">
<code class="sig-name descname">on_request_exception</code><a class="headerlink" href="#aiohttp.TraceConfig.on_request_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
request finishes with an exception.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceRequestExceptionParams" title="aiohttp.TraceRequestExceptionParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceRequestExceptionParams</span></code></a> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_connection_queued_start">
<code class="sig-name descname">on_connection_queued_start</code><a class="headerlink" href="#aiohttp.TraceConfig.on_connection_queued_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
request has been queued waiting for an available connection.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceConnectionQueuedStartParams" title="aiohttp.TraceConnectionQueuedStartParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceConnectionQueuedStartParams</span></code></a>
instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_connection_queued_end">
<code class="sig-name descname">on_connection_queued_end</code><a class="headerlink" href="#aiohttp.TraceConfig.on_connection_queued_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
request that was queued already has an available connection.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceConnectionQueuedEndParams" title="aiohttp.TraceConnectionQueuedEndParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceConnectionQueuedEndParams</span></code></a>
instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_connection_create_start">
<code class="sig-name descname">on_connection_create_start</code><a class="headerlink" href="#aiohttp.TraceConfig.on_connection_create_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
request creates a new connection.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceConnectionCreateStartParams" title="aiohttp.TraceConnectionCreateStartParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceConnectionCreateStartParams</span></code></a>
instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_connection_create_end">
<code class="sig-name descname">on_connection_create_end</code><a class="headerlink" href="#aiohttp.TraceConfig.on_connection_create_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
request that created a new connection finishes its creation.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceConnectionCreateEndParams" title="aiohttp.TraceConnectionCreateEndParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceConnectionCreateEndParams</span></code></a>
instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_connection_reuseconn">
<code class="sig-name descname">on_connection_reuseconn</code><a class="headerlink" href="#aiohttp.TraceConfig.on_connection_reuseconn" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
request reuses a connection.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceConnectionReuseconnParams" title="aiohttp.TraceConnectionReuseconnParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceConnectionReuseconnParams</span></code></a>
instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_dns_resolvehost_start">
<code class="sig-name descname">on_dns_resolvehost_start</code><a class="headerlink" href="#aiohttp.TraceConfig.on_dns_resolvehost_start" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
request starts to resolve the domain related with the request.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceDnsResolveHostStartParams" title="aiohttp.TraceDnsResolveHostStartParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceDnsResolveHostStartParams</span></code></a>
instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_dns_resolvehost_end">
<code class="sig-name descname">on_dns_resolvehost_end</code><a class="headerlink" href="#aiohttp.TraceConfig.on_dns_resolvehost_end" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
request finishes to resolve the domain related with the request.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceDnsResolveHostEndParams" title="aiohttp.TraceDnsResolveHostEndParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceDnsResolveHostEndParams</span></code></a> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_dns_cache_hit">
<code class="sig-name descname">on_dns_cache_hit</code><a class="headerlink" href="#aiohttp.TraceConfig.on_dns_cache_hit" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
request was able to use a cached DNS resolution for the domain related
with the request.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceDnsCacheHitParams" title="aiohttp.TraceDnsCacheHitParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceDnsCacheHitParams</span></code></a> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceConfig.on_dns_cache_miss">
<code class="sig-name descname">on_dns_cache_miss</code><a class="headerlink" href="#aiohttp.TraceConfig.on_dns_cache_miss" title="Permalink to this definition">¶</a></dt>
<dd><p>Property that gives access to the signals that will be executed when a
request was not able to use a cached DNS resolution for the domain related
with the request.</p>
<p><code class="docutils literal notranslate"><span class="pre">params</span></code> is <a class="reference internal" href="#aiohttp.TraceDnsCacheMissParams" title="aiohttp.TraceDnsCacheMissParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TraceDnsCacheMissParams</span></code></a> instance.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="tracerequeststartparams">
<h5>TraceRequestStartParams<a class="headerlink" href="#tracerequeststartparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceRequestStartParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceRequestStartParams</code><a class="headerlink" href="#aiohttp.TraceRequestStartParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_request_start" title="aiohttp.TraceConfig.on_request_start"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_request_start</span></code></a> for details.</p>
<dl class="attribute">
<dt id="aiohttp.TraceRequestStartParams.method">
<code class="sig-name descname">method</code><a class="headerlink" href="#aiohttp.TraceRequestStartParams.method" title="Permalink to this definition">¶</a></dt>
<dd><p>Method that will be used  to make the request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceRequestStartParams.url">
<code class="sig-name descname">url</code><a class="headerlink" href="#aiohttp.TraceRequestStartParams.url" title="Permalink to this definition">¶</a></dt>
<dd><p>URL that will be used  for the request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceRequestStartParams.headers">
<code class="sig-name descname">headers</code><a class="headerlink" href="#aiohttp.TraceRequestStartParams.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Headers that will be used for the request, can be mutated.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="tracerequestchunksentparams">
<h5>TraceRequestChunkSentParams<a class="headerlink" href="#tracerequestchunksentparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceRequestChunkSentParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceRequestChunkSentParams</code><a class="headerlink" href="#aiohttp.TraceRequestChunkSentParams" title="Permalink to this definition">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
<p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_request_chunk_sent" title="aiohttp.TraceConfig.on_request_chunk_sent"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_request_chunk_sent</span></code></a> for details.</p>
<dl class="attribute">
<dt id="aiohttp.TraceRequestChunkSentParams.chunk">
<code class="sig-name descname">chunk</code><a class="headerlink" href="#aiohttp.TraceRequestChunkSentParams.chunk" title="Permalink to this definition">¶</a></dt>
<dd><p>Bytes of chunk sent</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="traceresponsechunksentparams">
<h5>TraceResponseChunkSentParams<a class="headerlink" href="#traceresponsechunksentparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceResponseChunkSentParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceResponseChunkSentParams</code><a class="headerlink" href="#aiohttp.TraceResponseChunkSentParams" title="Permalink to this definition">¶</a></dt>
<dd><div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
<p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_response_chunk_received" title="aiohttp.TraceConfig.on_response_chunk_received"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_response_chunk_received</span></code></a> for details.</p>
<dl class="attribute">
<dt id="aiohttp.TraceResponseChunkSentParams.chunk">
<code class="sig-name descname">chunk</code><a class="headerlink" href="#aiohttp.TraceResponseChunkSentParams.chunk" title="Permalink to this definition">¶</a></dt>
<dd><p>Bytes of chunk received</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="tracerequestendparams">
<h5>TraceRequestEndParams<a class="headerlink" href="#tracerequestendparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceRequestEndParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceRequestEndParams</code><a class="headerlink" href="#aiohttp.TraceRequestEndParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_request_end" title="aiohttp.TraceConfig.on_request_end"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_request_end</span></code></a> for details.</p>
<dl class="attribute">
<dt id="aiohttp.TraceRequestEndParams.method">
<code class="sig-name descname">method</code><a class="headerlink" href="#aiohttp.TraceRequestEndParams.method" title="Permalink to this definition">¶</a></dt>
<dd><p>Method used to make the request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceRequestEndParams.url">
<code class="sig-name descname">url</code><a class="headerlink" href="#aiohttp.TraceRequestEndParams.url" title="Permalink to this definition">¶</a></dt>
<dd><p>URL used for the request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceRequestEndParams.headers">
<code class="sig-name descname">headers</code><a class="headerlink" href="#aiohttp.TraceRequestEndParams.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Headers used for the request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceRequestEndParams.response">
<code class="sig-name descname">response</code><a class="headerlink" href="#aiohttp.TraceRequestEndParams.response" title="Permalink to this definition">¶</a></dt>
<dd><p>Response <a class="reference internal" href="index.html#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientResponse</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="tracerequestexceptionparams">
<h5>TraceRequestExceptionParams<a class="headerlink" href="#tracerequestexceptionparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceRequestExceptionParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceRequestExceptionParams</code><a class="headerlink" href="#aiohttp.TraceRequestExceptionParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_request_exception" title="aiohttp.TraceConfig.on_request_exception"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_request_exception</span></code></a> for details.</p>
<dl class="attribute">
<dt id="aiohttp.TraceRequestExceptionParams.method">
<code class="sig-name descname">method</code><a class="headerlink" href="#aiohttp.TraceRequestExceptionParams.method" title="Permalink to this definition">¶</a></dt>
<dd><p>Method used to make the request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceRequestExceptionParams.url">
<code class="sig-name descname">url</code><a class="headerlink" href="#aiohttp.TraceRequestExceptionParams.url" title="Permalink to this definition">¶</a></dt>
<dd><p>URL used for the request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceRequestExceptionParams.headers">
<code class="sig-name descname">headers</code><a class="headerlink" href="#aiohttp.TraceRequestExceptionParams.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Headers used for the request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceRequestExceptionParams.exception">
<code class="sig-name descname">exception</code><a class="headerlink" href="#aiohttp.TraceRequestExceptionParams.exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception raised during the request.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="tracerequestredirectparams">
<h5>TraceRequestRedirectParams<a class="headerlink" href="#tracerequestredirectparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceRequestRedirectParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceRequestRedirectParams</code><a class="headerlink" href="#aiohttp.TraceRequestRedirectParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_request_redirect" title="aiohttp.TraceConfig.on_request_redirect"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_request_redirect</span></code></a> for details.</p>
<dl class="attribute">
<dt id="aiohttp.TraceRequestRedirectParams.method">
<code class="sig-name descname">method</code><a class="headerlink" href="#aiohttp.TraceRequestRedirectParams.method" title="Permalink to this definition">¶</a></dt>
<dd><p>Method used to get this redirect request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceRequestRedirectParams.url">
<code class="sig-name descname">url</code><a class="headerlink" href="#aiohttp.TraceRequestRedirectParams.url" title="Permalink to this definition">¶</a></dt>
<dd><p>URL used for this redirect request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceRequestRedirectParams.headers">
<code class="sig-name descname">headers</code><a class="headerlink" href="#aiohttp.TraceRequestRedirectParams.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Headers used for this redirect.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.TraceRequestRedirectParams.response">
<code class="sig-name descname">response</code><a class="headerlink" href="#aiohttp.TraceRequestRedirectParams.response" title="Permalink to this definition">¶</a></dt>
<dd><p>Response <a class="reference internal" href="index.html#aiohttp.ClientResponse" title="aiohttp.ClientResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientResponse</span></code></a> got from the redirect.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="traceconnectionqueuedstartparams">
<h5>TraceConnectionQueuedStartParams<a class="headerlink" href="#traceconnectionqueuedstartparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceConnectionQueuedStartParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceConnectionQueuedStartParams</code><a class="headerlink" href="#aiohttp.TraceConnectionQueuedStartParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_connection_queued_start" title="aiohttp.TraceConfig.on_connection_queued_start"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_connection_queued_start</span></code></a> for details.</p>
<p>There are no attributes right now.</p>
</dd></dl>

</div>
<div class="section" id="traceconnectionqueuedendparams">
<h5>TraceConnectionQueuedEndParams<a class="headerlink" href="#traceconnectionqueuedendparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceConnectionQueuedEndParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceConnectionQueuedEndParams</code><a class="headerlink" href="#aiohttp.TraceConnectionQueuedEndParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_connection_queued_end" title="aiohttp.TraceConfig.on_connection_queued_end"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_connection_queued_end</span></code></a> for details.</p>
<p>There are no attributes right now.</p>
</dd></dl>

</div>
<div class="section" id="traceconnectioncreatestartparams">
<h5>TraceConnectionCreateStartParams<a class="headerlink" href="#traceconnectioncreatestartparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceConnectionCreateStartParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceConnectionCreateStartParams</code><a class="headerlink" href="#aiohttp.TraceConnectionCreateStartParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_connection_create_start" title="aiohttp.TraceConfig.on_connection_create_start"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_connection_create_start</span></code></a> for details.</p>
<p>There are no attributes right now.</p>
</dd></dl>

</div>
<div class="section" id="traceconnectioncreateendparams">
<h5>TraceConnectionCreateEndParams<a class="headerlink" href="#traceconnectioncreateendparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceConnectionCreateEndParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceConnectionCreateEndParams</code><a class="headerlink" href="#aiohttp.TraceConnectionCreateEndParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_connection_create_end" title="aiohttp.TraceConfig.on_connection_create_end"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_connection_create_end</span></code></a> for details.</p>
<p>There are no attributes right now.</p>
</dd></dl>

</div>
<div class="section" id="traceconnectionreuseconnparams">
<h5>TraceConnectionReuseconnParams<a class="headerlink" href="#traceconnectionreuseconnparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceConnectionReuseconnParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceConnectionReuseconnParams</code><a class="headerlink" href="#aiohttp.TraceConnectionReuseconnParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_connection_reuseconn" title="aiohttp.TraceConfig.on_connection_reuseconn"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_connection_reuseconn</span></code></a> for details.</p>
<p>There are no attributes right now.</p>
</dd></dl>

</div>
<div class="section" id="tracednsresolvehoststartparams">
<h5>TraceDnsResolveHostStartParams<a class="headerlink" href="#tracednsresolvehoststartparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceDnsResolveHostStartParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceDnsResolveHostStartParams</code><a class="headerlink" href="#aiohttp.TraceDnsResolveHostStartParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_dns_resolvehost_start" title="aiohttp.TraceConfig.on_dns_resolvehost_start"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_dns_resolvehost_start</span></code></a> for details.</p>
<dl class="attribute">
<dt id="aiohttp.TraceDnsResolveHostStartParams.Host">
<code class="sig-name descname">Host</code><a class="headerlink" href="#aiohttp.TraceDnsResolveHostStartParams.Host" title="Permalink to this definition">¶</a></dt>
<dd><p>Host that will be resolved.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="tracednsresolvehostendparams">
<h5>TraceDnsResolveHostEndParams<a class="headerlink" href="#tracednsresolvehostendparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceDnsResolveHostEndParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceDnsResolveHostEndParams</code><a class="headerlink" href="#aiohttp.TraceDnsResolveHostEndParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_dns_resolvehost_end" title="aiohttp.TraceConfig.on_dns_resolvehost_end"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_dns_resolvehost_end</span></code></a> for details.</p>
<dl class="attribute">
<dt id="aiohttp.TraceDnsResolveHostEndParams.Host">
<code class="sig-name descname">Host</code><a class="headerlink" href="#aiohttp.TraceDnsResolveHostEndParams.Host" title="Permalink to this definition">¶</a></dt>
<dd><p>Host that has been resolved.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="tracednscachehitparams">
<h5>TraceDnsCacheHitParams<a class="headerlink" href="#tracednscachehitparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceDnsCacheHitParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceDnsCacheHitParams</code><a class="headerlink" href="#aiohttp.TraceDnsCacheHitParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_dns_cache_hit" title="aiohttp.TraceConfig.on_dns_cache_hit"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_dns_cache_hit</span></code></a> for details.</p>
<dl class="attribute">
<dt id="aiohttp.TraceDnsCacheHitParams.Host">
<code class="sig-name descname">Host</code><a class="headerlink" href="#aiohttp.TraceDnsCacheHitParams.Host" title="Permalink to this definition">¶</a></dt>
<dd><p>Host found in the cache.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="tracednscachemissparams">
<h5>TraceDnsCacheMissParams<a class="headerlink" href="#tracednscachemissparams" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.TraceDnsCacheMissParams">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">TraceDnsCacheMissParams</code><a class="headerlink" href="#aiohttp.TraceDnsCacheMissParams" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#aiohttp.TraceConfig.on_dns_cache_miss" title="aiohttp.TraceConfig.on_dns_cache_miss"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TraceConfig.on_dns_cache_miss</span></code></a> for details.</p>
<dl class="attribute">
<dt id="aiohttp.TraceDnsCacheMissParams.Host">
<code class="sig-name descname">Host</code><a class="headerlink" href="#aiohttp.TraceDnsCacheMissParams.Host" title="Permalink to this definition">¶</a></dt>
<dd><p>Host didn’t find the cache.</p>
</dd></dl>

</dd></dl>

</div>
</div>
</div>
</div>
<span id="document-web"></span><div class="section" id="module-aiohttp.web">
<span id="server"></span><span id="aiohttp-web"></span><h3>Server<a class="headerlink" href="#module-aiohttp.web" title="Permalink to this headline">¶</a></h3>
<p>The page contains all information about aiohttp Server API:</p>
<div class="toctree-wrapper compound" id="id1">
<span id="document-web_quickstart"></span><div class="section" id="web-server-quickstart">
<span id="aiohttp-web-quickstart"></span><h4>Web Server Quickstart<a class="headerlink" href="#web-server-quickstart" title="Permalink to this headline">¶</a></h4>
<div class="section" id="run-a-simple-web-server">
<h5>Run a Simple Web Server<a class="headerlink" href="#run-a-simple-web-server" title="Permalink to this headline">¶</a></h5>
<p>In order to implement a web server, first create a
<a class="reference internal" href="#aiohttp-web-handler"><span class="std std-ref">request handler</span></a>.</p>
<p>A request handler must be a <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that
accepts a <a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a> instance as its only parameter and returns a
<a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> instance:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, create an <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> instance and register the
request handler on a particular <em>HTTP method</em> and <em>path</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">hello</span><span class="p">)])</span>
</pre></div>
</div>
<p>After that, run the application by <a class="reference internal" href="index.html#aiohttp.web.run_app" title="aiohttp.web.run_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_app()</span></code></a> call:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>That’s it. Now, head over to <code class="docutils literal notranslate"><span class="pre">http://localhost:8080/</span></code> to see the results.</p>
<p>Alternatively if you prefer <em>route decorators</em> create a <em>route table</em>
and register a <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">routes</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">RouteTableDef</span><span class="p">()</span>

<span class="nd">@routes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">(</span><span class="n">routes</span><span class="p">)</span>
<span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>Both ways essentially do the same work, the difference is only in your
taste: do you prefer <em>Django style</em> with famous <code class="docutils literal notranslate"><span class="pre">urls.py</span></code> or <em>Flask</em>
with shiny route decorators.</p>
<p><em>aiohttp</em> server documentation uses both ways in code snippets to
emphasize their equality, switching from one style to another is very
trivial.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-graceful-shutdown"><span class="std std-ref">Graceful shutdown</span></a> section explains what <a class="reference internal" href="index.html#aiohttp.web.run_app" title="aiohttp.web.run_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_app()</span></code></a>
does and how to implement complex server initialization/finalization
from scratch.</p>
<p><a class="reference internal" href="index.html#aiohttp-web-app-runners"><span class="std std-ref">Application runners</span></a> for more handling more complex cases
like <em>asynchronous</em> web application serving and multiple hosts
support.</p>
</div>
</div>
<div class="section" id="command-line-interface-cli">
<span id="aiohttp-web-cli"></span><h5>Command Line Interface (CLI)<a class="headerlink" href="#command-line-interface-cli" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> implements a basic CLI for quickly serving an
<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> in <em>development</em> over TCP/IP:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ python -m aiohttp.web -H localhost -P <span class="m">8080</span> package.module:init_func
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">package.module:init_func</span></code> should be an importable <a class="reference internal" href="index.html#term-callable"><span class="xref std std-term">callable</span></a> that
accepts a list of any non-parsed command-line arguments and returns an
<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> instance after setting it up:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">init_func</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">index_handler</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>
</pre></div>
</div>
</div>
<div class="section" id="handler">
<span id="aiohttp-web-handler"></span><h5>Handler<a class="headerlink" href="#handler" title="Permalink to this headline">¶</a></h5>
<p>A request handler must be a <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that accepts a
<a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a> instance as its only argument and returns a
<a class="reference internal" href="index.html#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamResponse</span></code></a> derived (e.g. <a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a>) instance:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">()</span>
</pre></div>
</div>
<p>Handlers are setup to handle requests by registering them with the
<a class="reference internal" href="index.html#aiohttp.web.Application.add_routes" title="aiohttp.web.Application.add_routes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Application.add_routes()</span></code></a> on a particular route (<em>HTTP method</em> and
<em>path</em> pair) using helpers like <a class="reference internal" href="index.html#aiohttp.web.get" title="aiohttp.web.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">get()</span></code></a> and
<a class="reference internal" href="index.html#aiohttp.web.post" title="aiohttp.web.post"><code class="xref py py-func docutils literal notranslate"><span class="pre">post()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">),</span>
                <span class="n">web</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/post&#39;</span><span class="p">,</span> <span class="n">post_handler</span><span class="p">),</span>
                <span class="n">web</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;/put&#39;</span><span class="p">,</span> <span class="n">put_handler</span><span class="p">)])</span>
</pre></div>
</div>
<p>Or use <em>route decorators</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">routes</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">RouteTableDef</span><span class="p">()</span>

<span class="nd">@routes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>

<span class="nd">@routes</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/post&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">post_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>

<span class="nd">@routes</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;/put&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">put_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">(</span><span class="n">routes</span><span class="p">)</span>
</pre></div>
</div>
<p>Wildcard <em>HTTP method</em> is also supported by <a class="reference internal" href="index.html#aiohttp.web.route" title="aiohttp.web.route"><code class="xref py py-func docutils literal notranslate"><span class="pre">route()</span></code></a> or
<a class="reference internal" href="index.html#aiohttp.web.RouteTableDef.route" title="aiohttp.web.RouteTableDef.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RouteTableDef.route()</span></code></a>, allowing a handler to serve incoming
requests on a <em>path</em> having <strong>any</strong> <em>HTTP method</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;/path&#39;</span><span class="p">,</span> <span class="n">all_handler</span><span class="p">)])</span>
</pre></div>
</div>
<p>The <em>HTTP method</em> can be queried later in the request handler using the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Request.method</span></code> property.</p>
<p>By default endpoints added with <code class="docutils literal notranslate"><span class="pre">GET</span></code> method will accept
<code class="docutils literal notranslate"><span class="pre">HEAD</span></code> requests and return the same response headers as they would
for a <code class="docutils literal notranslate"><span class="pre">GET</span></code> request. You can also deny <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> requests on a route:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">allow_head</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">handler</span></code> won’t be called on <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> request and the server
will respond with <code class="docutils literal notranslate"><span class="pre">405:</span> <span class="pre">Method</span> <span class="pre">Not</span> <span class="pre">Allowed</span></code>.</p>
</div>
<div class="section" id="resources-and-routes">
<span id="aiohttp-web-resource-and-route"></span><h5>Resources and Routes<a class="headerlink" href="#resources-and-routes" title="Permalink to this headline">¶</a></h5>
<p>Internally routes are served by <a class="reference internal" href="index.html#aiohttp.web.Application.router" title="aiohttp.web.Application.router"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.router</span></code></a>
(<a class="reference internal" href="index.html#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlDispatcher</span></code></a> instance).</p>
<p>The <em>router</em> is a list of <em>resources</em>.</p>
<p>Resource is an entry in <em>route table</em> which corresponds to requested URL.</p>
<p>Resource in turn has at least one <em>route</em>.</p>
<p>Route corresponds to handling <em>HTTP method</em> by calling <em>web handler</em>.</p>
<p>Thus when you add a <em>route</em> the <em>resouce</em> object is created under the hood.</p>
<p>The library implementation <strong>merges</strong> all subsequent route additions
for the same path adding the only resource for all HTTP methods.</p>
<p>Consider two examples:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/path1&#39;</span><span class="p">,</span> <span class="n">get_1</span><span class="p">),</span>
                <span class="n">web</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/path1&#39;</span><span class="p">,</span> <span class="n">post_1</span><span class="p">),</span>
                <span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/path2&#39;</span><span class="p">,</span> <span class="n">get_2</span><span class="p">),</span>
                <span class="n">web</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/path2&#39;</span><span class="p">,</span> <span class="n">post_2</span><span class="p">)]</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/path1&#39;</span><span class="p">,</span> <span class="n">get_1</span><span class="p">),</span>
                <span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/path2&#39;</span><span class="p">,</span> <span class="n">get_2</span><span class="p">),</span>
                <span class="n">web</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/path2&#39;</span><span class="p">,</span> <span class="n">post_2</span><span class="p">),</span>
                <span class="n">web</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/path1&#39;</span><span class="p">,</span> <span class="n">post_1</span><span class="p">)]</span>
</pre></div>
</div>
<p>First one is <em>optimized</em>. You have got the idea.</p>
<div class="section" id="variable-resources">
<span id="aiohttp-web-variable-handler"></span><h6>Variable Resources<a class="headerlink" href="#variable-resources" title="Permalink to this headline">¶</a></h6>
<p>Resource may have <em>variable path</em> also. For instance, a resource with
the path <code class="docutils literal notranslate"><span class="pre">'/a/{name}/c'</span></code> would match all incoming requests with
paths such as <code class="docutils literal notranslate"><span class="pre">'/a/b/c'</span></code>, <code class="docutils literal notranslate"><span class="pre">'/a/1/c'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'/a/etc/c'</span></code>.</p>
<p>A variable <em>part</em> is specified in the form <code class="docutils literal notranslate"><span class="pre">{identifier}</span></code>, where the
<code class="docutils literal notranslate"><span class="pre">identifier</span></code> can be used later in a
<a class="reference internal" href="#aiohttp-web-handler"><span class="std std-ref">request handler</span></a> to access the matched value for
that <em>part</em>. This is done by looking up the <code class="docutils literal notranslate"><span class="pre">identifier</span></code> in the
<a class="reference internal" href="index.html#aiohttp.web.Request.match_info" title="aiohttp.web.Request.match_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Request.match_info</span></code></a> mapping:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@routes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{name}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">variable_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>By default, each <em>part</em> matches the regular expression <code class="docutils literal notranslate"><span class="pre">[^{}/]+</span></code>.</p>
<p>You can also specify a custom regex in the form <code class="docutils literal notranslate"><span class="pre">{identifier:regex}</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/{name:\d+}&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="reverse-url-constructing-using-named-resources">
<span id="aiohttp-web-named-routes"></span><h6>Reverse URL Constructing using Named Resources<a class="headerlink" href="#reverse-url-constructing-using-named-resources" title="Permalink to this headline">¶</a></h6>
<p>Routes can also be given a <em>name</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@routes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/root&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Which can then be used to access and build a <em>URL</em> for that resource later (e.g.
in a <a class="reference internal" href="#aiohttp-web-handler"><span class="std std-ref">request handler</span></a>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">url_for</span><span class="p">()</span><span class="o">.</span><span class="n">with_query</span><span class="p">({</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">url</span> <span class="o">==</span> <span class="n">URL</span><span class="p">(</span><span class="s1">&#39;/root?a=b&amp;c=d&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A more interesting example is building <em>URLs</em> for <a class="reference internal" href="#aiohttp-web-variable-handler"><span class="std std-ref">variable
resources</span></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/</span><span class="si">{user}</span><span class="s1">/info&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;user-info&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case you can also pass in the <em>parts</em> of the route:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="p">[</span><span class="s1">&#39;user-info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">url_for</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;john_doe&#39;</span><span class="p">)</span>
<span class="n">url_with_qs</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">with_query</span><span class="p">(</span><span class="s2">&quot;a=b&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">url_with_qs</span> <span class="o">==</span> <span class="s1">&#39;/john_doe/info?a=b&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="organizing-handlers-in-classes">
<h6>Organizing Handlers in Classes<a class="headerlink" href="#organizing-handlers-in-classes" title="Permalink to this headline">¶</a></h6>
<p>As discussed above, <a class="reference internal" href="#aiohttp-web-handler"><span class="std std-ref">handlers</span></a> can be first-class
coroutines:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">hello</span><span class="p">)</span>
</pre></div>
</div>
<p>But sometimes it’s convenient to group logically similar handlers into a Python
<em>class</em>.</p>
<p>Since <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> does not dictate any implementation details,
application developers can organize handlers in classes if they so wish:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Handler</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_intro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_greeting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Anonymous&quot;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Hello, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">txt</span><span class="p">)</span>

<span class="n">handler</span> <span class="o">=</span> <span class="n">Handler</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/intro&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="o">.</span><span class="n">handle_intro</span><span class="p">),</span>
                <span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/greet/</span><span class="si">{name}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="o">.</span><span class="n">handle_greeting</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="class-based-views">
<span id="aiohttp-web-class-based-views"></span><h6>Class Based Views<a class="headerlink" href="#class-based-views" title="Permalink to this headline">¶</a></h6>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> has support for <em>class based views</em>.</p>
<p>You can derive from <a class="reference internal" href="index.html#aiohttp.web.View" title="aiohttp.web.View"><code class="xref py py-class docutils literal notranslate"><span class="pre">View</span></code></a> and define methods for handling http
requests:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">View</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">get_resp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">post_resp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
<p>Handlers should be coroutines accepting <em>self</em> only and returning
response object as regular <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a>. Request object can be
retrieved by <a class="reference internal" href="index.html#aiohttp.web.View.request" title="aiohttp.web.View.request"><code class="xref py py-attr docutils literal notranslate"><span class="pre">View.request</span></code></a> property.</p>
<p>After implementing the view (<code class="docutils literal notranslate"><span class="pre">MyView</span></code> from example above) should be
registered in application’s router:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">web</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;/path/to&#39;</span><span class="p">,</span> <span class="n">MyView</span><span class="p">)</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@routes</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s1">&#39;/path/to&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">View</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Example will process GET and POST requests for <em>/path/to</em> but raise
<em>405 Method not allowed</em> exception for unimplemented HTTP methods.</p>
</div>
<div class="section" id="resource-views">
<h6>Resource Views<a class="headerlink" href="#resource-views" title="Permalink to this headline">¶</a></h6>
<p><em>All</em> registered resources in a router can be viewed using the
<a class="reference internal" href="index.html#aiohttp.web.UrlDispatcher.resources" title="aiohttp.web.UrlDispatcher.resources"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.resources()</span></code></a> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">resources</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
</pre></div>
</div>
<p>A <em>subset</em> of the resources that were registered with a <em>name</em> can be
viewed using the <a class="reference internal" href="index.html#aiohttp.web.UrlDispatcher.named_resources" title="aiohttp.web.UrlDispatcher.named_resources"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.named_resources()</span></code></a> method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">named_resources</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="alternative-ways-for-registering-routes">
<span id="aiohttp-web-alternative-routes-definition"></span><h5>Alternative ways for registering routes<a class="headerlink" href="#alternative-ways-for-registering-routes" title="Permalink to this headline">¶</a></h5>
<p>Code examples shown above use <em>imperative</em> style for adding new
routes: they call <code class="docutils literal notranslate"><span class="pre">app.router.add_get(...)</span></code> etc.</p>
<p>There are two alternatives: route tables and route decorators.</p>
<p>Route tables look like Django way:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handle_get</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_post</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/get&#39;</span><span class="p">,</span> <span class="n">handle_get</span><span class="p">),</span>
                       <span class="n">web</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/post&#39;</span><span class="p">,</span> <span class="n">handle_post</span><span class="p">),</span>
</pre></div>
</div>
<p>The snippet calls <code class="xref py py-meth docutils literal notranslate"><span class="pre">add_routes()</span></code> to
register a list of <em>route definitions</em> (<a class="reference internal" href="index.html#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.RouteDef</span></code></a>
instances) created by <a class="reference internal" href="index.html#aiohttp.web.get" title="aiohttp.web.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp.web.get()</span></code></a> or
<a class="reference internal" href="index.html#aiohttp.web.post" title="aiohttp.web.post"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp.web.post()</span></code></a> functions.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-route-def"><span class="std std-ref">RouteDef and StaticDef</span></a> reference.</p>
</div>
<p>Route decorators are closer to Flask approach:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">routes</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">RouteTableDef</span><span class="p">()</span>

<span class="nd">@routes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/get&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_get</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>


<span class="nd">@routes</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/post&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_post</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_routes</span><span class="p">(</span><span class="n">routes</span><span class="p">)</span>
</pre></div>
</div>
<p>It is also possible to use decorators with class-based views:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">routes</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">RouteTableDef</span><span class="p">()</span>

<span class="nd">@routes</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s2">&quot;/view&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">View</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_routes</span><span class="p">(</span><span class="n">routes</span><span class="p">)</span>
</pre></div>
</div>
<p>The example creates a <a class="reference internal" href="index.html#aiohttp.web.RouteTableDef" title="aiohttp.web.RouteTableDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.RouteTableDef</span></code></a> container first.</p>
<p>The container is a list-like object with additional decorators
<a class="reference internal" href="index.html#aiohttp.web.RouteTableDef.get" title="aiohttp.web.RouteTableDef.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.web.RouteTableDef.get()</span></code></a>,
<a class="reference internal" href="index.html#aiohttp.web.RouteTableDef.post" title="aiohttp.web.RouteTableDef.post"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.web.RouteTableDef.post()</span></code></a> etc. for registering new
routes.</p>
<p>After filling the container
<code class="xref py py-meth docutils literal notranslate"><span class="pre">add_routes()</span></code> is used for adding
registered <em>route definitions</em> into application’s router.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-route-table-def"><span class="std std-ref">RouteTableDef</span></a> reference.</p>
</div>
<p>All tree ways (imperative calls, route tables and decorators) are
equivalent, you could use what do you prefer or even mix them on your
own.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</div>
<div class="section" id="json-response">
<h5>JSON Response<a class="headerlink" href="#json-response" title="Permalink to this headline">¶</a></h5>
<p>It is a common case to return JSON data in response, <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a>
provides a shortcut for returning JSON – <a class="reference internal" href="index.html#aiohttp.web.json_response" title="aiohttp.web.json_response"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp.web.json_response()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;some&#39;</span><span class="p">:</span> <span class="s1">&#39;data&#39;</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">json_response</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>The shortcut method returns <a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Response</span></code></a> instance
so you can for example set cookies before returning it from handler.</p>
</div>
<div class="section" id="user-sessions">
<h5>User Sessions<a class="headerlink" href="#user-sessions" title="Permalink to this headline">¶</a></h5>
<p>Often you need a container for storing user data across requests. The concept
is usually called a <em>session</em>.</p>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> has no built-in concept of a <em>session</em>, however, there is a
third-party library, <a class="reference external" href="https://aiohttp-session.readthedocs.io/en/stable/reference.html#module-aiohttp_session" title="(in aiohttp_session v2.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp_session</span></code></a>, that adds <em>session</em> support:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">cryptography</span> <span class="k">import</span> <span class="n">fernet</span>
<span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>
<span class="kn">from</span> <span class="nn">aiohttp_session</span> <span class="k">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">get_session</span><span class="p">,</span> <span class="n">session_middleware</span>
<span class="kn">from</span> <span class="nn">aiohttp_session.cookie_storage</span> <span class="k">import</span> <span class="n">EncryptedCookieStorage</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_session</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">last_visit</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;last_visit&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;last_visit&#39;</span> <span class="ow">in</span> <span class="n">session</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Last visited: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">last_visit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">make_app</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="c1"># secret_key must be 32 url-safe base64-encoded bytes</span>
    <span class="n">fernet_key</span> <span class="o">=</span> <span class="n">fernet</span><span class="o">.</span><span class="n">Fernet</span><span class="o">.</span><span class="n">generate_key</span><span class="p">()</span>
    <span class="n">secret_key</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64decode</span><span class="p">(</span><span class="n">fernet_key</span><span class="p">)</span>
    <span class="n">setup</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">EncryptedCookieStorage</span><span class="p">(</span><span class="n">secret_key</span><span class="p">))</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">app</span>

<span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">make_app</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="http-forms">
<span id="aiohttp-web-forms"></span><h5>HTTP Forms<a class="headerlink" href="#http-forms" title="Permalink to this headline">¶</a></h5>
<p>HTTP Forms are supported out of the box.</p>
<p>If form’s method is <code class="docutils literal notranslate"><span class="pre">&quot;GET&quot;</span></code> (<code class="docutils literal notranslate"><span class="pre">&lt;form</span> <span class="pre">method=&quot;get&quot;&gt;</span></code>) use
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Request.query</span></code> for getting form data.</p>
<p>To access form data with <code class="docutils literal notranslate"><span class="pre">&quot;POST&quot;</span></code> method use
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Request.post()</span></code> or <code class="xref py py-meth docutils literal notranslate"><span class="pre">Request.multipart()</span></code>.</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">Request.post()</span></code> accepts both
<code class="docutils literal notranslate"><span class="pre">'application/x-www-form-urlencoded'</span></code> and <code class="docutils literal notranslate"><span class="pre">'multipart/form-data'</span></code>
form’s data encoding (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;form</span> <span class="pre">enctype=&quot;multipart/form-data&quot;&gt;</span></code>).
It stores files data in temporary directory. If <cite>client_max_size</cite> is
specified <cite>post</cite> raises <cite>ValueError</cite> exception.
For efficiency use <code class="xref py py-meth docutils literal notranslate"><span class="pre">Request.multipart()</span></code>, It is especially effective
for uploading large files (<a class="reference internal" href="#aiohttp-web-file-upload"><span class="std std-ref">File Uploads</span></a>).</p>
<p>Values submitted by the following form:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/login&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">accept-charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span>
      <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;login&quot;</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;login&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;login&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">autofocus</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">&gt;</span>Password<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;login&quot;</span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>could be accessed as:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">do_login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">post</span><span class="p">()</span>
    <span class="n">login</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="file-uploads">
<span id="aiohttp-web-file-upload"></span><h5>File Uploads<a class="headerlink" href="#file-uploads" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> has built-in support for handling files uploaded from the
browser.</p>
<p>First, make sure that the HTML <code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code> element has its <em>enctype</em> attribute
set to <code class="docutils literal notranslate"><span class="pre">enctype=&quot;multipart/form-data&quot;</span></code>. As an example, here is a form that
accepts an MP3 file:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/store/mp3&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">accept-charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span>
      <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;mp3&quot;</span><span class="p">&gt;</span>Mp3<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;mp3&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;mp3&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Then, in the <a class="reference internal" href="#aiohttp-web-handler"><span class="std std-ref">request handler</span></a> you can access the
file input field as a <a class="reference internal" href="index.html#aiohttp.web.FileField" title="aiohttp.web.FileField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileField</span></code></a> instance. <a class="reference internal" href="index.html#aiohttp.web.FileField" title="aiohttp.web.FileField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileField</span></code></a> is simply
a container for the file as well as some of its metadata:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">store_mp3_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="c1"># WARNING: don&#39;t do that if you plan to receive large files!</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">post</span><span class="p">()</span>

    <span class="n">mp3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mp3&#39;</span><span class="p">]</span>

    <span class="c1"># .filename contains the name of the file in string format.</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">mp3</span><span class="o">.</span><span class="n">filename</span>

    <span class="c1"># .file contains the actual file data that needs to be stored somewhere.</span>
    <span class="n">mp3_file</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mp3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">file</span>

    <span class="n">content</span> <span class="o">=</span> <span class="n">mp3_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="n">MultiDict</span><span class="p">(</span>
                            <span class="p">{</span><span class="s1">&#39;CONTENT-DISPOSITION&#39;</span><span class="p">:</span> <span class="n">mp3_file</span><span class="p">}))</span>
</pre></div>
</div>
<p>You might have noticed a big warning in the example above. The general issue is
that <code class="xref py py-meth docutils literal notranslate"><span class="pre">Request.post()</span></code> reads the whole payload in memory,
resulting in possible
<abbr title="Out Of Memory">OOM</abbr> errors. To avoid this, for multipart uploads, you
should use <code class="xref py py-meth docutils literal notranslate"><span class="pre">Request.multipart()</span></code> which returns a <a class="reference internal" href="index.html#aiohttp-multipart"><span class="std std-ref">multipart reader</span></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">store_mp3_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="n">reader</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">multipart</span><span class="p">()</span>

    <span class="c1"># /!\ Don&#39;t forget to validate your inputs /!\</span>

    <span class="c1"># reader.next() will `yield` the fields of your form</span>

    <span class="n">field</span> <span class="o">=</span> <span class="k">await</span> <span class="n">reader</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="k">await</span> <span class="n">field</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">field</span> <span class="o">=</span> <span class="k">await</span> <span class="n">reader</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp3&#39;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">filename</span>
    <span class="c1"># You cannot rely on Content-Length if transfer is chunked.</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/spool/yarrr-media/mp3/&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="k">await</span> <span class="n">field</span><span class="o">.</span><span class="n">read_chunk</span><span class="p">()</span>  <span class="c1"># 8192 bytes by default.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> sized of </span><span class="si">{}</span><span class="s1"> successfully stored&#39;</span>
                             <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="websockets">
<span id="aiohttp-web-websockets"></span><h5>WebSockets<a class="headerlink" href="#websockets" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> supports <em>WebSockets</em> out-of-the-box.</p>
<p>To setup a <em>WebSocket</em>, create a <a class="reference internal" href="index.html#aiohttp.web.WebSocketResponse" title="aiohttp.web.WebSocketResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">WebSocketResponse</span></code></a> in a
<a class="reference internal" href="#aiohttp-web-handler"><span class="std std-ref">request handler</span></a> and then use it to communicate
with the peer:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">websocket_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="n">ws</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">WebSocketResponse</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">WSMsgType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;close&#39;</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">send_str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="s1">&#39;/answer&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">WSMsgType</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ws connection closed with exception </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                  <span class="n">ws</span><span class="o">.</span><span class="n">exception</span><span class="p">())</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;websocket connection closed&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ws</span>
</pre></div>
</div>
<p>The handler should be registered as HTTP GET processor:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/ws&#39;</span><span class="p">,</span> <span class="n">websocket_handler</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="section" id="redirects">
<span id="aiohttp-web-redirects"></span><h5>Redirects<a class="headerlink" href="#redirects" title="Permalink to this headline">¶</a></h5>
<p>To redirect user to another endpoint - raise <code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPFound</span></code> with
an absolute URL, relative URL or view name (the argument from router):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPFound</span><span class="p">(</span><span class="s1">&#39;/redirect&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The following example shows redirect to view named ‘login’ in routes:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">url_for</span><span class="p">()</span>
    <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>

<span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/handler&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
<span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">login_handler</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example with login validation:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@aiohttp_jinja2</span><span class="o">.</span><span class="n">template</span><span class="p">(</span><span class="s1">&#39;login.html&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">post</span><span class="p">()</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">validate_login</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># login form is valid</span>
            <span class="n">location</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">url_for</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{}</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_post</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="exceptions">
<span id="aiohttp-web-exceptions"></span><h5>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> defines a set of exceptions for every <em>HTTP status code</em>.</p>
<p>Each exception is a subclass of <a class="reference internal" href="index.html#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPException</span></code></a> and relates to a single
HTTP status code:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">HTTPFound</span><span class="p">(</span><span class="s1">&#39;/redirect&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Returning <a class="reference internal" href="index.html#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPException</span></code></a> or its subclasses is deprecated and will
be removed in subsequent aiohttp versions.</p>
</div>
<p>Each exception class has a status code according to <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2068.html"><strong>RFC 2068</strong></a>:
codes with 100-300 are not really errors; 400s are client errors,
and 500s are server errors.</p>
<p>HTTP Exception hierarchy chart:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="ne">Exception</span>
  <span class="n">HTTPException</span>
    <span class="n">HTTPSuccessful</span>
      <span class="o">*</span> <span class="mi">200</span> <span class="o">-</span> <span class="n">HTTPOk</span>
      <span class="o">*</span> <span class="mi">201</span> <span class="o">-</span> <span class="n">HTTPCreated</span>
      <span class="o">*</span> <span class="mi">202</span> <span class="o">-</span> <span class="n">HTTPAccepted</span>
      <span class="o">*</span> <span class="mi">203</span> <span class="o">-</span> <span class="n">HTTPNonAuthoritativeInformation</span>
      <span class="o">*</span> <span class="mi">204</span> <span class="o">-</span> <span class="n">HTTPNoContent</span>
      <span class="o">*</span> <span class="mi">205</span> <span class="o">-</span> <span class="n">HTTPResetContent</span>
      <span class="o">*</span> <span class="mi">206</span> <span class="o">-</span> <span class="n">HTTPPartialContent</span>
    <span class="n">HTTPRedirection</span>
      <span class="o">*</span> <span class="mi">300</span> <span class="o">-</span> <span class="n">HTTPMultipleChoices</span>
      <span class="o">*</span> <span class="mi">301</span> <span class="o">-</span> <span class="n">HTTPMovedPermanently</span>
      <span class="o">*</span> <span class="mi">302</span> <span class="o">-</span> <span class="n">HTTPFound</span>
      <span class="o">*</span> <span class="mi">303</span> <span class="o">-</span> <span class="n">HTTPSeeOther</span>
      <span class="o">*</span> <span class="mi">304</span> <span class="o">-</span> <span class="n">HTTPNotModified</span>
      <span class="o">*</span> <span class="mi">305</span> <span class="o">-</span> <span class="n">HTTPUseProxy</span>
      <span class="o">*</span> <span class="mi">307</span> <span class="o">-</span> <span class="n">HTTPTemporaryRedirect</span>
      <span class="o">*</span> <span class="mi">308</span> <span class="o">-</span> <span class="n">HTTPPermanentRedirect</span>
    <span class="n">HTTPError</span>
      <span class="n">HTTPClientError</span>
        <span class="o">*</span> <span class="mi">400</span> <span class="o">-</span> <span class="n">HTTPBadRequest</span>
        <span class="o">*</span> <span class="mi">401</span> <span class="o">-</span> <span class="n">HTTPUnauthorized</span>
        <span class="o">*</span> <span class="mi">402</span> <span class="o">-</span> <span class="n">HTTPPaymentRequired</span>
        <span class="o">*</span> <span class="mi">403</span> <span class="o">-</span> <span class="n">HTTPForbidden</span>
        <span class="o">*</span> <span class="mi">404</span> <span class="o">-</span> <span class="n">HTTPNotFound</span>
        <span class="o">*</span> <span class="mi">405</span> <span class="o">-</span> <span class="n">HTTPMethodNotAllowed</span>
        <span class="o">*</span> <span class="mi">406</span> <span class="o">-</span> <span class="n">HTTPNotAcceptable</span>
        <span class="o">*</span> <span class="mi">407</span> <span class="o">-</span> <span class="n">HTTPProxyAuthenticationRequired</span>
        <span class="o">*</span> <span class="mi">408</span> <span class="o">-</span> <span class="n">HTTPRequestTimeout</span>
        <span class="o">*</span> <span class="mi">409</span> <span class="o">-</span> <span class="n">HTTPConflict</span>
        <span class="o">*</span> <span class="mi">410</span> <span class="o">-</span> <span class="n">HTTPGone</span>
        <span class="o">*</span> <span class="mi">411</span> <span class="o">-</span> <span class="n">HTTPLengthRequired</span>
        <span class="o">*</span> <span class="mi">412</span> <span class="o">-</span> <span class="n">HTTPPreconditionFailed</span>
        <span class="o">*</span> <span class="mi">413</span> <span class="o">-</span> <span class="n">HTTPRequestEntityTooLarge</span>
        <span class="o">*</span> <span class="mi">414</span> <span class="o">-</span> <span class="n">HTTPRequestURITooLong</span>
        <span class="o">*</span> <span class="mi">415</span> <span class="o">-</span> <span class="n">HTTPUnsupportedMediaType</span>
        <span class="o">*</span> <span class="mi">416</span> <span class="o">-</span> <span class="n">HTTPRequestRangeNotSatisfiable</span>
        <span class="o">*</span> <span class="mi">417</span> <span class="o">-</span> <span class="n">HTTPExpectationFailed</span>
        <span class="o">*</span> <span class="mi">421</span> <span class="o">-</span> <span class="n">HTTPMisdirectedRequest</span>
        <span class="o">*</span> <span class="mi">422</span> <span class="o">-</span> <span class="n">HTTPUnprocessableEntity</span>
        <span class="o">*</span> <span class="mi">424</span> <span class="o">-</span> <span class="n">HTTPFailedDependency</span>
        <span class="o">*</span> <span class="mi">426</span> <span class="o">-</span> <span class="n">HTTPUpgradeRequired</span>
        <span class="o">*</span> <span class="mi">428</span> <span class="o">-</span> <span class="n">HTTPPreconditionRequired</span>
        <span class="o">*</span> <span class="mi">429</span> <span class="o">-</span> <span class="n">HTTPTooManyRequests</span>
        <span class="o">*</span> <span class="mi">431</span> <span class="o">-</span> <span class="n">HTTPRequestHeaderFieldsTooLarge</span>
        <span class="o">*</span> <span class="mi">451</span> <span class="o">-</span> <span class="n">HTTPUnavailableForLegalReasons</span>
      <span class="n">HTTPServerError</span>
        <span class="o">*</span> <span class="mi">500</span> <span class="o">-</span> <span class="n">HTTPInternalServerError</span>
        <span class="o">*</span> <span class="mi">501</span> <span class="o">-</span> <span class="n">HTTPNotImplemented</span>
        <span class="o">*</span> <span class="mi">502</span> <span class="o">-</span> <span class="n">HTTPBadGateway</span>
        <span class="o">*</span> <span class="mi">503</span> <span class="o">-</span> <span class="n">HTTPServiceUnavailable</span>
        <span class="o">*</span> <span class="mi">504</span> <span class="o">-</span> <span class="n">HTTPGatewayTimeout</span>
        <span class="o">*</span> <span class="mi">505</span> <span class="o">-</span> <span class="n">HTTPVersionNotSupported</span>
        <span class="o">*</span> <span class="mi">506</span> <span class="o">-</span> <span class="n">HTTPVariantAlsoNegotiates</span>
        <span class="o">*</span> <span class="mi">507</span> <span class="o">-</span> <span class="n">HTTPInsufficientStorage</span>
        <span class="o">*</span> <span class="mi">510</span> <span class="o">-</span> <span class="n">HTTPNotExtended</span>
        <span class="o">*</span> <span class="mi">511</span> <span class="o">-</span> <span class="n">HTTPNetworkAuthenticationRequired</span>
</pre></div>
</div>
<p>All HTTP exceptions have the same constructor signature:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">HTTPNotFound</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">body</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>If not directly specified, <em>headers</em> will be added to the <em>default
response headers</em>.</p>
<p>Classes <code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPMultipleChoices</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPMovedPermanently</span></code>,
<code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPFound</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPSeeOther</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPUseProxy</span></code>,
<code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPTemporaryRedirect</span></code> have the following constructor signature:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">HTTPFound</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">body</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>where <em>location</em> is value for <em>Location HTTP header</em>.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPMethodNotAllowed</span></code> is constructed by providing the incoming
unsupported method and list of allowed methods:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">HTTPMethodNotAllowed</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">allowed_methods</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                     <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">body</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-web_advanced"></span><div class="section" id="web-server-advanced">
<span id="aiohttp-web-advanced"></span><h4>Web Server Advanced<a class="headerlink" href="#web-server-advanced" title="Permalink to this headline">¶</a></h4>
<div class="section" id="unicode-support">
<h5>Unicode support<a class="headerlink" href="#unicode-support" title="Permalink to this headline">¶</a></h5>
<p><em>aiohttp</em> does <a class="reference internal" href="index.html#term-requoting"><span class="xref std std-term">requoting</span></a> of incoming request path.</p>
<p>Unicode (non-ASCII) symbols are processed transparently on both <em>route
adding</em> and <em>resolving</em> (internally everything is converted to
<a class="reference internal" href="index.html#term-percent-encoding"><span class="xref std std-term">percent-encoding</span></a> form by <a class="reference internal" href="index.html#term-yarl"><span class="xref std std-term">yarl</span></a> library).</p>
<p>But in case of custom regular expressions for
<a class="reference internal" href="index.html#aiohttp-web-variable-handler"><span class="std std-ref">Variable Resources</span></a> please take care that URL is
<em>percent encoded</em>: if you pass Unicode patterns they don’t match to
<em>requoted</em> path.</p>
</div>
<div class="section" id="web-handler-cancellation">
<h5>Web Handler Cancellation<a class="headerlink" href="#web-handler-cancellation" title="Permalink to this headline">¶</a></h5>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a> execution could be canceled on every <code class="docutils literal notranslate"><span class="pre">await</span></code>
if client drops connection without reading entire response’s BODY.</p>
<p>The behavior is very different from classic WSGI frameworks like
Flask and Django.</p>
</div>
<p>Sometimes it is a desirable behavior: on processing <code class="docutils literal notranslate"><span class="pre">GET</span></code> request the
code might fetch data from database or other web resource, the
fetching is potentially slow.</p>
<p>Canceling this fetch is very good: the peer dropped connection
already, there is no reason to waste time and resources (memory etc) by
getting data from DB without any chance to send it back to peer.</p>
<p>But sometimes the cancellation is bad: on <code class="docutils literal notranslate"><span class="pre">POST</span></code> request very often
is needed to save data to DB regardless to peer closing.</p>
<p>Cancellation prevention could be implemented in several ways:</p>
<ul class="simple">
<li><p>Applying <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#asyncio.shield" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.shield()</span></code></a> to coroutine that saves data into DB.</p></li>
<li><p>Spawning a new task for DB saving</p></li>
<li><p>Using <a class="reference external" href="http://aiojobs.readthedocs.io/en/latest/">aiojobs</a> or other third party library.</p></li>
</ul>
<p><a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#asyncio.shield" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.shield()</span></code></a> works pretty good. The only disadvantage is you
need to split web handler into exactly two async functions: one
for handler itself and other for protected code.</p>
<p>For example the following snippet is not safe:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">shield</span><span class="p">(</span><span class="n">write_to_redis</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">shield</span><span class="p">(</span><span class="n">write_to_postgres</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;OK&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Cancellation might be occurred just after saving data in REDIS,
<code class="docutils literal notranslate"><span class="pre">write_to_postgres</span></code> will be not called.</p>
<p>Spawning a new task is much worse: there is no place to <code class="docutils literal notranslate"><span class="pre">await</span></code>
spawned tasks:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">request</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">write_to_redis</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;OK&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case errors from <code class="docutils literal notranslate"><span class="pre">write_to_redis</span></code> are not awaited, it leads
to many asyncio log messages <em>Future exception was never retrieved</em>
and <em>Task was destroyed but it is pending!</em>.</p>
<p>Moreover on <a class="reference internal" href="#aiohttp-web-graceful-shutdown"><span class="std std-ref">Graceful shutdown</span></a> phase <em>aiohttp</em> don’t
wait for these tasks, you have a great chance to loose very important
data.</p>
<p>On other hand <a class="reference external" href="http://aiojobs.readthedocs.io/en/latest/">aiojobs</a> provides an API for spawning new jobs and
awaiting their results etc. It stores all scheduled activity in
internal data structures and could terminate them gracefully:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiojobs.aiohttp</span> <span class="k">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">spawn</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">coro</span><span class="p">(</span><span class="n">timeout</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>  <span class="c1"># do something in background</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">spawn</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">coro</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">setup</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
<p>All not finished jobs will be terminated on
<a class="reference internal" href="index.html#aiohttp.web.Application.on_cleanup" title="aiohttp.web.Application.on_cleanup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_cleanup</span></code></a> signal.</p>
<p>To prevent cancellation of the whole <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a> use
<code class="docutils literal notranslate"><span class="pre">&#64;atomic</span></code> decorator:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiojobs.aiohttp</span> <span class="k">import</span> <span class="n">atomic</span>

<span class="nd">@atomic</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">write_to_db</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">setup</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
<p>It prevents all <code class="docutils literal notranslate"><span class="pre">handler</span></code> async function from cancellation,
<code class="docutils literal notranslate"><span class="pre">write_to_db</span></code> will be never interrupted.</p>
</div>
<div class="section" id="passing-a-coroutine-into-run-app-and-gunicorn">
<h5>Passing a coroutine into run_app and Gunicorn<a class="headerlink" href="#passing-a-coroutine-into-run-app-and-gunicorn" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#aiohttp.web.run_app" title="aiohttp.web.run_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_app()</span></code></a> accepts either application instance or a coroutine for
making an application. The coroutine based approach allows to perform
async IO before making an app:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">app_factory</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">pre_init</span><span class="p">()</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>

<span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">app_factory</span><span class="p">())</span>
</pre></div>
</div>
<p>Gunicorn worker supports a factory as well. For Gunicorn the factory
should accept zero parameters:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">my_web_app</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>
</pre></div>
</div>
<p>Start gunicorn:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ gunicorn my_app_module:my_web_app --bind localhost:8080 --worker-class aiohttp.GunicornWebWorker
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
</div>
<div class="section" id="custom-routing-criteria">
<h5>Custom Routing Criteria<a class="headerlink" href="#custom-routing-criteria" title="Permalink to this headline">¶</a></h5>
<p>Sometimes you need to register <a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">handlers</span></a> on
more complex criteria than simply a <em>HTTP method</em> and <em>path</em> pair.</p>
<p>Although <a class="reference internal" href="index.html#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlDispatcher</span></code></a> does not support any extra criteria, routing
based on custom conditions can be accomplished by implementing a second layer
of routing in your application.</p>
<p>The following example shows custom routing based on the <em>HTTP Accept</em> header:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AcceptChooser</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_accepts</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">do_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">accept</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">getall</span><span class="p">(</span><span class="s1">&#39;ACCEPT&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">acceptor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accepts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">acceptor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="k">await</span> <span class="n">acceptor</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">HTTPNotAcceptable</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reg_acceptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accept</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_accepts</span><span class="p">[</span><span class="n">accept</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_json</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># do json handling</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_xml</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># do xml handling</span>

<span class="n">chooser</span> <span class="o">=</span> <span class="n">AcceptChooser</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">chooser</span><span class="o">.</span><span class="n">do_route</span><span class="p">)])</span>

<span class="n">chooser</span><span class="o">.</span><span class="n">reg_acceptor</span><span class="p">(</span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span> <span class="n">handle_json</span><span class="p">)</span>
<span class="n">chooser</span><span class="o">.</span><span class="n">reg_acceptor</span><span class="p">(</span><span class="s1">&#39;application/xml&#39;</span><span class="p">,</span> <span class="n">handle_xml</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="static-file-handling">
<span id="aiohttp-web-static-file-handling"></span><h5>Static file handling<a class="headerlink" href="#static-file-handling" title="Permalink to this headline">¶</a></h5>
<p>The best way to handle static files (images, JavaScripts, CSS files
etc.) is using <a class="reference external" href="https://en.wikipedia.org/wiki/Reverse_proxy">Reverse Proxy</a> like <a class="reference external" href="https://nginx.org/">nginx</a> or <a class="reference external" href="https://en.wikipedia.org/wiki/Content_delivery_network">CDN</a> services.</p>
<p>But for development it’s very convenient to handle static files by
aiohttp server itself.</p>
<p>To do it just register a new static route by
<a class="reference internal" href="index.html#aiohttp.web.RouteTableDef.static" title="aiohttp.web.RouteTableDef.static"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RouteTableDef.static()</span></code></a> or <a class="reference internal" href="index.html#aiohttp.web.static" title="aiohttp.web.static"><code class="xref py py-func docutils literal notranslate"><span class="pre">static()</span></code></a> calls:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s1">&#39;/prefix&#39;</span><span class="p">,</span> <span class="n">path_to_static_folder</span><span class="p">)])</span>

<span class="n">routes</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s1">&#39;/prefix&#39;</span><span class="p">,</span> <span class="n">path_to_static_folder</span><span class="p">)</span>
</pre></div>
</div>
<p>When a directory is accessed within a static route then the server responses
to client with <code class="docutils literal notranslate"><span class="pre">HTTP/403</span> <span class="pre">Forbidden</span></code> by default. Displaying folder index
instead could be enabled with <code class="docutils literal notranslate"><span class="pre">show_index</span></code> parameter set to <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">web</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s1">&#39;/prefix&#39;</span><span class="p">,</span> <span class="n">path_to_static_folder</span><span class="p">,</span> <span class="n">show_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>When a symlink from the static directory is accessed, the server responses to
client with <code class="docutils literal notranslate"><span class="pre">HTTP/404</span> <span class="pre">Not</span> <span class="pre">Found</span></code> by default. To allow the server to follow
symlinks, parameter <code class="docutils literal notranslate"><span class="pre">follow_symlinks</span></code> should be set to <code class="docutils literal notranslate"><span class="pre">True</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">web</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s1">&#39;/prefix&#39;</span><span class="p">,</span> <span class="n">path_to_static_folder</span><span class="p">,</span> <span class="n">follow_symlinks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>When you want to enable cache busting,
parameter <code class="docutils literal notranslate"><span class="pre">append_version</span></code> can be set to <code class="docutils literal notranslate"><span class="pre">True</span></code></p>
<p>Cache busting is the process of appending some form of file version hash
to the filename of resources like JavaScript and CSS files.
The performance advantage of doing this is that we can tell the browser
to cache these files indefinitely without worrying about the client not getting
the latest version when the file changes:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">web</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="s1">&#39;/prefix&#39;</span><span class="p">,</span> <span class="n">path_to_static_folder</span><span class="p">,</span> <span class="n">append_version</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="template-rendering">
<h5>Template Rendering<a class="headerlink" href="#template-rendering" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> does not support template rendering out-of-the-box.</p>
<p>However, there is a third-party library, <a class="reference external" href="https://aiohttp-jinja2.readthedocs.io/en/stable/index.html#module-aiohttp_jinja2" title="(in aiohttp_jinja2 v1.1)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp_jinja2</span></code></a>, which is
supported by the <em>aiohttp</em> authors.</p>
<p>Using it is rather simple. First, setup a <em>jinja2 environment</em> with a call
to <a class="reference external" href="https://aiohttp-jinja2.readthedocs.io/en/stable/index.html#aiohttp_jinja2.setup" title="(in aiohttp_jinja2 v1.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp_jinja2.setup()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">aiohttp_jinja2</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">app</span><span class="p">,</span>
    <span class="n">loader</span><span class="o">=</span><span class="n">jinja2</span><span class="o">.</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="s1">&#39;/path/to/templates/folder&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>After that you may use the template engine in your
<a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">handlers</span></a>. The most convenient way is to simply
wrap your handlers with the  <a class="reference external" href="https://aiohttp-jinja2.readthedocs.io/en/stable/index.html#aiohttp_jinja2.template" title="(in aiohttp_jinja2 v1.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp_jinja2.template()</span></code></a> decorator:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@aiohttp_jinja2</span><span class="o">.</span><span class="n">template</span><span class="p">(</span><span class="s1">&#39;tmpl.jinja2&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Andrew&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">:</span> <span class="s1">&#39;Svetlov&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>If you prefer the <a class="reference external" href="http://www.makotemplates.org/">Mako</a> template engine, please take a look at the
<a class="reference external" href="https://github.com/aio-libs/aiohttp_mako">aiohttp_mako</a> library.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a class="reference external" href="https://aiohttp-jinja2.readthedocs.io/en/stable/index.html#aiohttp_jinja2.template" title="(in aiohttp_jinja2 v1.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp_jinja2.template()</span></code></a> should be applied <strong>before</strong>
<a class="reference internal" href="index.html#aiohttp.web.RouteTableDef.get" title="aiohttp.web.RouteTableDef.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RouteTableDef.get()</span></code></a> decorator and family, e.g. it must be
the <em>first</em> (most <em>down</em> decorator in the chain):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@routes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/path&#39;</span><span class="p">)</span>
<span class="nd">@aiohttp_jinja2</span><span class="o">.</span><span class="n">template</span><span class="p">(</span><span class="s1">&#39;tmpl.jinja2&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Andrew&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">:</span> <span class="s1">&#39;Svetlov&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reading-from-the-same-task-in-websockets">
<span id="aiohttp-web-websocket-read-same-task"></span><h5>Reading from the same task in WebSockets<a class="headerlink" href="#reading-from-the-same-task-in-websockets" title="Permalink to this headline">¶</a></h5>
<p>Reading from the <em>WebSocket</em> (<code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">ws.receive()</span></code>) <strong>must only</strong> be
done inside the request handler <em>task</em>; however, writing
(<code class="docutils literal notranslate"><span class="pre">ws.send_str(...)</span></code>) to the <em>WebSocket</em>, closing (<code class="docutils literal notranslate"><span class="pre">await</span>
<span class="pre">ws.close()</span></code>) and canceling the handler task may be delegated to other
tasks. See also <a class="reference internal" href="index.html#aiohttp-faq-terminating-websockets"><span class="std std-ref">FAQ section</span></a>.</p>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> creates an implicit <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#asyncio.Task" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.Task</span></code></a> for
handling every incoming request.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> itself only supports <em>WebSockets</em> without
downgrading to <em>LONG-POLLING</em>, etc., our team supports <a class="reference external" href="https://github.com/aio-libs/sockjs">SockJS</a>, an
aiohttp-based library for implementing SockJS-compatible server
code.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Parallel reads from websocket are forbidden, there is no
possibility to call <a class="reference internal" href="index.html#aiohttp.web.WebSocketResponse.receive" title="aiohttp.web.WebSocketResponse.receive"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WebSocketResponse.receive()</span></code></a>
from two tasks.</p>
<p>See <a class="reference internal" href="index.html#aiohttp-faq-parallel-event-sources"><span class="std std-ref">FAQ section</span></a> for
instructions how to solve the problem.</p>
</div>
</div>
<div class="section" id="data-sharing-aka-no-singletons-please">
<span id="aiohttp-web-data-sharing"></span><h5>Data Sharing aka No Singletons Please<a class="headerlink" href="#data-sharing-aka-no-singletons-please" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> discourages the use of <em>global variables</em>, aka <em>singletons</em>.
Every variable should have its own context that is <em>not global</em>.</p>
<p>So, <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> and <a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a>
support a <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.MutableMapping" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.MutableMapping</span></code></a> interface (i.e. they are
dict-like objects), allowing them to be used as data stores.</p>
<div class="section" id="application-s-config">
<span id="aiohttp-web-data-sharing-app-config"></span><h6>Application’s config<a class="headerlink" href="#application-s-config" title="Permalink to this headline">¶</a></h6>
<p>For storing <em>global-like</em> variables, feel free to save them in an
<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> instance:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;my_private_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</pre></div>
</div>
<p>and get it back in the <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;my_private_key&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>In case of <a class="reference internal" href="#aiohttp-web-nested-applications"><span class="std std-ref">nested applications</span></a> the desired lookup strategy could
be the following:</p>
<ol class="arabic simple">
<li><p>Search the key in the current nested application.</p></li>
<li><p>If the key is not found continue searching in the parent application(s).</p></li>
</ol>
<p>For this please use <a class="reference internal" href="index.html#aiohttp.web.Request.config_dict" title="aiohttp.web.Request.config_dict"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Request.config_dict</span></code></a> read-only property:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">config_dict</span><span class="p">[</span><span class="s1">&#39;my_private_key&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="request-s-storage">
<h6>Request’s storage<a class="headerlink" href="#request-s-storage" title="Permalink to this headline">¶</a></h6>
<p>Variables that are only needed for the lifetime of a <a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a>, can be
stored in a <a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="n">request</span><span class="p">[</span><span class="s1">&#39;my_private_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>This is mostly useful for <a class="reference internal" href="#aiohttp-web-middlewares"><span class="std std-ref">Middlewares</span></a> and
<a class="reference internal" href="#aiohttp-web-signals"><span class="std std-ref">Signals</span></a> handlers to store data for further processing by the
next handlers in the chain.</p>
</div>
<div class="section" id="response-s-storage">
<h6>Response’s storage<a class="headerlink" href="#response-s-storage" title="Permalink to this headline">¶</a></h6>
<p><a class="reference internal" href="index.html#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamResponse</span></code></a> and <a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> objects
also support <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.MutableMapping" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.MutableMapping</span></code></a> interface. This is useful
when you want to share data with signals and middlewares once all the work in
the handler is done:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="p">[</span> <span class="n">do</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">work</span> <span class="p">]</span>
  <span class="n">response</span><span class="p">[</span><span class="s1">&#39;my_metric&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">123</span>
  <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
</div>
<div class="section" id="naming-hint">
<h6>Naming hint<a class="headerlink" href="#naming-hint" title="Permalink to this headline">¶</a></h6>
<p>To avoid clashing with other <em>aiohttp</em> users and third-party libraries, please
choose a unique key name for storing data.</p>
<p>If your code is published on PyPI, then the project name is most likely unique
and safe to use as the key.
Otherwise, something based on your company name/url would be satisfactory (i.e.
<code class="docutils literal notranslate"><span class="pre">org.company.app</span></code>).</p>
</div>
</div>
<div class="section" id="contextvars-support">
<span id="aiohttp-web-contextvars"></span><h5>ContextVars support<a class="headerlink" href="#contextvars-support" title="Permalink to this headline">¶</a></h5>
<p>Starting from Python 3.7 asyncio has <a class="reference external" href="https://docs.python.org/3/library/contextvars.html#module-contextvars" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Context</span> <span class="pre">Variables</span></code></a> as a
context-local storage (a generalization of thread-local concept that works with asyncio
tasks also).</p>
<p><em>aiohttp</em> server supports it in the following way:</p>
<ul>
<li><p>A server inherits the current task’s context used when creating it.
<a class="reference internal" href="index.html#aiohttp.web.run_app" title="aiohttp.web.run_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp.web.run_app()</span></code></a> runs a task for handling all underlying jobs running
the app, but alternatively <a class="reference internal" href="#aiohttp-web-app-runners"><span class="std std-ref">Application runners</span></a> can be used.</p></li>
<li><p>Application initialization / finalization events (<a class="reference internal" href="index.html#aiohttp.web.Application.cleanup_ctx" title="aiohttp.web.Application.cleanup_ctx"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.cleanup_ctx</span></code></a>,
<a class="reference internal" href="index.html#aiohttp.web.Application.on_startup" title="aiohttp.web.Application.on_startup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_startup</span></code></a> and <a class="reference internal" href="index.html#aiohttp.web.Application.on_shutdown" title="aiohttp.web.Application.on_shutdown"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_shutdown</span></code></a>,
<a class="reference internal" href="index.html#aiohttp.web.Application.on_cleanup" title="aiohttp.web.Application.on_cleanup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_cleanup</span></code></a>) are executed inside the same context.</p>
<p>E.g. all context modifications made on application startup a visible on teardown.</p>
</li>
<li><p>On every request handling <em>aiohttp</em> creates a context copy. <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a> has
all variables installed on initialization stage. But the context modification made by
a handler or middleware is invisible to another HTTP request handling call.</p></li>
</ul>
<p>An example of context vars usage:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contextvars</span> <span class="k">import</span> <span class="n">ContextVar</span>

<span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="n">VAR</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s1">&#39;VAR&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">coro</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">VAR</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">VAR</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">VAR</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;handler&#39;</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">var</span><span class="p">,</span>
                                        <span class="n">ret</span><span class="p">]))</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">on_startup</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_startup&#39;</span><span class="p">,</span> <span class="n">VAR</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
    <span class="n">VAR</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;on_startup&#39;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">on_cleanup</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_cleanup&#39;</span><span class="p">,</span> <span class="n">VAR</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
    <span class="n">VAR</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;on_cleanup&#39;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="n">VAR</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
    <span class="n">VAR</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">)</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">on_startup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">on_startup</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">on_cleanup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">on_cleanup</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>


<span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">init</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">,</span> <span class="n">VAR</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.5.</span></p>
</div>
</div>
<div class="section" id="middlewares">
<span id="aiohttp-web-middlewares"></span><h5>Middlewares<a class="headerlink" href="#middlewares" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> provides a powerful mechanism for customizing
<a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">request handlers</span></a> via <em>middlewares</em>.</p>
<p>A <em>middleware</em> is a coroutine that can modify either the request or
response. For example, here’s a simple <em>middleware</em> which appends
<code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">wink'</span></code> to the response:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp.web</span> <span class="k">import</span> <span class="n">middleware</span>

<span class="nd">@middleware</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">middleware</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; wink&#39;</span>
    <span class="k">return</span> <span class="n">resp</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The example won’t work with streamed responses or websockets</p>
</div>
<p>Every <em>middleware</em> should accept two parameters, a <a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a> instance and a <em>handler</em>, and return the response or raise
an exception. If the exception is not an instance of
<a class="reference internal" href="index.html#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPException</span></code></a> it is converted to <code class="docutils literal notranslate"><span class="pre">500</span></code>
<code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPInternalServerError</span></code> after processing the
middlewares chain.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Second argument should be named <em>handler</em> exactly.</p>
</div>
<p>When creating an <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a>, these <em>middlewares</em> are passed to
the keyword-only <code class="docutils literal notranslate"><span class="pre">middlewares</span></code> parameter:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="n">middlewares</span><span class="o">=</span><span class="p">[</span><span class="n">middleware_1</span><span class="p">,</span>
                                   <span class="n">middleware_2</span><span class="p">])</span>
</pre></div>
</div>
<p>Internally, a single <a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">request handler</span></a> is constructed
by applying the middleware chain to the original handler in reverse order,
and is called by the <code class="xref py py-class docutils literal notranslate"><span class="pre">RequestHandler</span></code> as a regular <em>handler</em>.</p>
<p>Since <em>middlewares</em> are themselves coroutines, they may perform extra
<code class="docutils literal notranslate"><span class="pre">await</span></code> calls when creating a new handler, e.g. call database etc.</p>
<p><em>Middlewares</em> usually call the handler, but they may choose to ignore it,
e.g. displaying <em>403 Forbidden page</em> or raising <code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPForbidden</span></code> exception
if the user does not have permissions to access the underlying resource.
They may also render errors raised by the handler, perform some pre- or
post-processing like handling <em>CORS</em> and so on.</p>
<p>The following code demonstrates middlewares execution order:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Handler function called&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>

<span class="nd">@web</span><span class="o">.</span><span class="n">middleware</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">middleware1</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Middleware 1 called&#39;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Middleware 1 finished&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="nd">@web</span><span class="o">.</span><span class="n">middleware</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">middleware2</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Middleware 2 called&#39;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Middleware 2 finished&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="n">middlewares</span><span class="o">=</span><span class="p">[</span><span class="n">middleware1</span><span class="p">,</span> <span class="n">middleware2</span><span class="p">])</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
<span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>Produced output:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">Middleware</span> <span class="mi">1</span> <span class="n">called</span>
<span class="n">Middleware</span> <span class="mi">2</span> <span class="n">called</span>
<span class="n">Handler</span> <span class="n">function</span> <span class="n">called</span>
<span class="n">Middleware</span> <span class="mi">2</span> <span class="n">finished</span>
<span class="n">Middleware</span> <span class="mi">1</span> <span class="n">finished</span>
</pre></div>
</div>
<div class="section" id="example">
<h6>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h6>
<p>A common use of middlewares is to implement custom error pages.  The following
example will render 404 errors using a JSON response, as might be appropriate
a JSON REST service:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="nd">@web</span><span class="o">.</span><span class="n">middleware</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">error_middleware</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">message</span>
    <span class="k">except</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPException</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ex</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">reason</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">json_response</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">})</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="n">middlewares</span><span class="o">=</span><span class="p">[</span><span class="n">error_middleware</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="middleware-factory">
<h6>Middleware Factory<a class="headerlink" href="#middleware-factory" title="Permalink to this headline">¶</a></h6>
<p>A <em>middleware factory</em> is a function that creates a middleware with passed arguments. For example, here’s a trivial <em>middleware factory</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">middleware_factory</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="nd">@middleware</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">sample_middleware</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">resp</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="n">text</span>
        <span class="k">return</span> <span class="n">resp</span>
    <span class="k">return</span> <span class="n">sample_middleware</span>
</pre></div>
</div>
<p>Remember that contrary to regular middlewares you need the result of a middleware factory not the function itself. So when passing a middleware factory to an app you actually need to call it:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="n">middlewares</span><span class="o">=</span><span class="p">[</span><span class="n">middleware_factory</span><span class="p">(</span><span class="s1">&#39; wink&#39;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="signals">
<span id="aiohttp-web-signals"></span><h5>Signals<a class="headerlink" href="#signals" title="Permalink to this headline">¶</a></h5>
<p>Although <a class="reference internal" href="#aiohttp-web-middlewares"><span class="std std-ref">middlewares</span></a> can customize
<a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">request handlers</span></a> before or after a <a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a>
has been prepared, they can’t customize a <a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> <strong>while</strong> it’s
being prepared. For this <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> provides <em>signals</em>.</p>
<p>For example, a middleware can only change HTTP headers for <em>unprepared</em>
responses (see <a class="reference internal" href="index.html#aiohttp.web.StreamResponse.prepare" title="aiohttp.web.StreamResponse.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StreamResponse.prepare()</span></code></a>), but sometimes we
need a hook for changing HTTP headers for streamed responses and WebSockets.
This can be accomplished by subscribing to the
<a class="reference internal" href="index.html#aiohttp.web.Application.on_response_prepare" title="aiohttp.web.Application.on_response_prepare"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_response_prepare</span></code></a> signal:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">on_prepare</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;My-Header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>

<span class="n">app</span><span class="o">.</span><span class="n">on_response_prepare</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">on_prepare</span><span class="p">)</span>
</pre></div>
</div>
<p>Additionally, the <a class="reference internal" href="index.html#aiohttp.web.Application.on_startup" title="aiohttp.web.Application.on_startup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_startup</span></code></a> and
<a class="reference internal" href="index.html#aiohttp.web.Application.on_cleanup" title="aiohttp.web.Application.on_cleanup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_cleanup</span></code></a> signals can be subscribed to for
application component setup and tear down accordingly.</p>
<p>The following example will properly initialize and dispose an aiopg connection
engine:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiopg.sa</span> <span class="k">import</span> <span class="n">create_engine</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">create_aiopg</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">app</span><span class="p">[</span><span class="s1">&#39;pg_engine&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_engine</span><span class="p">(</span>
        <span class="n">user</span><span class="o">=</span><span class="s1">&#39;postgre&#39;</span><span class="p">,</span>
        <span class="n">database</span><span class="o">=</span><span class="s1">&#39;postgre&#39;</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">5432</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">dispose_aiopg</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">app</span><span class="p">[</span><span class="s1">&#39;pg_engine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">app</span><span class="p">[</span><span class="s1">&#39;pg_engine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">wait_closed</span><span class="p">()</span>

<span class="n">app</span><span class="o">.</span><span class="n">on_startup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">create_aiopg</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">on_cleanup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dispose_aiopg</span><span class="p">)</span>
</pre></div>
</div>
<p>Signal handlers should not return a value but may modify incoming mutable
parameters.</p>
<p>Signal handlers will be run sequentially, in order they were
added. All handlers must be asynchronous since <em>aiohttp</em> 3.0.</p>
</div>
<div class="section" id="cleanup-context">
<span id="aiohttp-web-cleanup-ctx"></span><h5>Cleanup Context<a class="headerlink" href="#cleanup-context" title="Permalink to this headline">¶</a></h5>
<p>Bare <a class="reference internal" href="index.html#aiohttp.web.Application.on_startup" title="aiohttp.web.Application.on_startup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_startup</span></code></a> / <a class="reference internal" href="index.html#aiohttp.web.Application.on_cleanup" title="aiohttp.web.Application.on_cleanup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_cleanup</span></code></a>
pair still has a pitfall: signals handlers are independent on each other.</p>
<p>E.g. we have <code class="docutils literal notranslate"><span class="pre">[create_pg,</span> <span class="pre">create_redis]</span></code> in <em>startup</em> signal and
<code class="docutils literal notranslate"><span class="pre">[dispose_pg,</span> <span class="pre">dispose_redis]</span></code> in <em>cleanup</em>.</p>
<p>If, for example, <code class="docutils literal notranslate"><span class="pre">create_pg(app)</span></code> call fails <code class="docutils literal notranslate"><span class="pre">create_redis(app)</span></code>
is not called. But on application cleanup both <code class="docutils literal notranslate"><span class="pre">dispose_pg(app)</span></code> and
<code class="docutils literal notranslate"><span class="pre">dispose_redis(app)</span></code> are still called: <em>cleanup signal</em> has no
knowledge about startup/cleanup pairs and their execution state.</p>
<p>The solution is <a class="reference internal" href="index.html#aiohttp.web.Application.cleanup_ctx" title="aiohttp.web.Application.cleanup_ctx"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.cleanup_ctx</span></code></a> usage:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">pg_engine</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">app</span><span class="p">[</span><span class="s1">&#39;pg_engine&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_engine</span><span class="p">(</span>
        <span class="n">user</span><span class="o">=</span><span class="s1">&#39;postgre&#39;</span><span class="p">,</span>
        <span class="n">database</span><span class="o">=</span><span class="s1">&#39;postgre&#39;</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">5432</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">app</span><span class="p">[</span><span class="s1">&#39;pg_engine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">app</span><span class="p">[</span><span class="s1">&#39;pg_engine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">wait_closed</span><span class="p">()</span>

<span class="n">app</span><span class="o">.</span><span class="n">cleanup_ctx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pg_engine</span><span class="p">)</span>
</pre></div>
</div>
<p>The attribute is a list of <em>asynchronous generators</em>, a code <em>before</em>
<code class="docutils literal notranslate"><span class="pre">yield</span></code> is an initialization stage (called on <em>startup</em>), a code
<em>after</em> <code class="docutils literal notranslate"><span class="pre">yield</span></code> is executed on <em>cleanup</em>. The generator must have only
one <code class="docutils literal notranslate"><span class="pre">yield</span></code>.</p>
<p><em>aiohttp</em> guarantees that <em>cleanup code</em> is called if and only if
<em>startup code</em> was successfully finished.</p>
<p>Asynchronous generators are supported by Python 3.6+, on Python 3.5
please use <a class="reference external" href="https://pypi.org/project/async_generator/">async_generator</a>
library.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
</div>
<div class="section" id="nested-applications">
<span id="aiohttp-web-nested-applications"></span><h5>Nested applications<a class="headerlink" href="#nested-applications" title="Permalink to this headline">¶</a></h5>
<p>Sub applications are designed for solving the problem of the big
monolithic code base.
Let’s assume we have a project with own business logic and tools like
administration panel and debug toolbar.</p>
<p>Administration panel is a separate application by its own nature but all
toolbar URLs are served by prefix like <code class="docutils literal notranslate"><span class="pre">/admin</span></code>.</p>
<p>Thus we’ll create a totally separate application named <code class="docutils literal notranslate"><span class="pre">admin</span></code> and
connect it to main app with prefix by
<a class="reference internal" href="index.html#aiohttp.web.Application.add_subapp" title="aiohttp.web.Application.add_subapp"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Application.add_subapp()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">admin</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="c1"># setup admin routes, signals and middlewares</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_subapp</span><span class="p">(</span><span class="s1">&#39;/admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="p">)</span>
</pre></div>
</div>
<p>Middlewares and signals from <code class="docutils literal notranslate"><span class="pre">app</span></code> and <code class="docutils literal notranslate"><span class="pre">admin</span></code> are chained.</p>
<p>It means that if URL is <code class="docutils literal notranslate"><span class="pre">'/admin/something'</span></code> middlewares from
<code class="docutils literal notranslate"><span class="pre">app</span></code> are applied first and <code class="docutils literal notranslate"><span class="pre">admin.middlewares</span></code> are the next in
the call chain.</p>
<p>The same is going for
<a class="reference internal" href="index.html#aiohttp.web.Application.on_response_prepare" title="aiohttp.web.Application.on_response_prepare"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_response_prepare</span></code></a> signal – the
signal is delivered to both top level <code class="docutils literal notranslate"><span class="pre">app</span></code> and <code class="docutils literal notranslate"><span class="pre">admin</span></code> if
processing URL is routed to <code class="docutils literal notranslate"><span class="pre">admin</span></code> sub-application.</p>
<p>Common signals like <a class="reference internal" href="index.html#aiohttp.web.Application.on_startup" title="aiohttp.web.Application.on_startup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_startup</span></code></a>,
<a class="reference internal" href="index.html#aiohttp.web.Application.on_shutdown" title="aiohttp.web.Application.on_shutdown"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_shutdown</span></code></a> and
<a class="reference internal" href="index.html#aiohttp.web.Application.on_cleanup" title="aiohttp.web.Application.on_cleanup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_cleanup</span></code></a> are delivered to all
registered sub-applications. The passed parameter is sub-application
instance, not top-level application.</p>
<p>Third level sub-applications can be nested into second level ones –
there are no limitation for nesting level.</p>
<p>Url reversing for sub-applications should generate urls with proper prefix.</p>
<p>But for getting URL sub-application’s router should be used:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">admin</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/resource&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)])</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_subapp</span><span class="p">(</span><span class="s1">&#39;/admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="n">admin</span><span class="o">.</span><span class="n">router</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">url_for</span><span class="p">()</span>
</pre></div>
</div>
<p>The generated <code class="docutils literal notranslate"><span class="pre">url</span></code> from example will have a value
<code class="docutils literal notranslate"><span class="pre">URL('/admin/resource')</span></code>.</p>
<p>If main application should do URL reversing for sub-application it could
use the following explicit technique:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">admin</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/resource&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)])</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_subapp</span><span class="p">(</span><span class="s1">&#39;/admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="p">)</span>
<span class="n">app</span><span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">admin</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>  <span class="c1"># main application&#39;s handler</span>
    <span class="n">admin</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;admin&#39;</span><span class="p">]</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">admin</span><span class="o">.</span><span class="n">router</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">url_for</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="expect-header">
<span id="aiohttp-web-expect-header"></span><h5><em>Expect</em> Header<a class="headerlink" href="#expect-header" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> supports <em>Expect</em> header. By default it sends
<code class="docutils literal notranslate"><span class="pre">HTTP/1.1</span> <span class="pre">100</span> <span class="pre">Continue</span></code> line to client, or raises
<code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPExpectationFailed</span></code> if header value is not equal to
“100-continue”. It is possible to specify custom <em>Expect</em> header
handler on per route basis. This handler gets called if <em>Expect</em>
header exist in request after receiving all headers and before
processing application’s <a class="reference internal" href="#aiohttp-web-middlewares"><span class="std std-ref">Middlewares</span></a> and
route handler. Handler can return <em>None</em>, in that case the request
processing continues as usual. If handler returns an instance of class
<a class="reference internal" href="index.html#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamResponse</span></code></a>, <em>request handler</em> uses it as response. Also
handler can raise a subclass of <a class="reference internal" href="index.html#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPException</span></code></a>. In this case all
further processing will not happen and client will receive appropriate
http response.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A server that does not understand or is unable to comply with any of the
expectation values in the Expect field of a request MUST respond with
appropriate error status. The server MUST respond with a 417
(Expectation Failed) status if any of the expectations cannot be met or,
if there are other problems with the request, some other 4xx status.</p>
<p><a class="reference external" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.20">http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.20</a></p>
</div>
<p>If all checks pass, the custom handler <em>must</em> write a <em>HTTP/1.1 100 Continue</em>
status code before returning.</p>
<p>The following example shows how to setup a custom handler for the <em>Expect</em>
header:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">check_auth</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">HttpVersion11</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;EXPECT&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;100-continue&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPExpectationFailed</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Unknown Expect: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">expect</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AUTHORIZATION&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPForbidden</span><span class="p">()</span>

    <span class="n">request</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;HTTP/1.1 100 Continue</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">hello</span><span class="p">,</span> <span class="n">expect_handler</span><span class="o">=</span><span class="n">check_auth</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-resource-implementation">
<span id="aiohttp-web-custom-resource"></span><h5>Custom resource implementation<a class="headerlink" href="#custom-resource-implementation" title="Permalink to this headline">¶</a></h5>
<p>To register custom resource use <code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.register_resource()</span></code>.
Resource instance must implement <cite>AbstractResource</cite> interface.</p>
</div>
<div class="section" id="application-runners">
<span id="aiohttp-web-app-runners"></span><h5>Application runners<a class="headerlink" href="#application-runners" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#aiohttp.web.run_app" title="aiohttp.web.run_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_app()</span></code></a> provides a simple <em>blocking</em> API for running an
<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a>.</p>
<p>For starting the application <em>asynchronously</em> or serving on multiple
HOST/PORT <a class="reference internal" href="index.html#aiohttp.web.AppRunner" title="aiohttp.web.AppRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppRunner</span></code></a> exists.</p>
<p>The simple startup code for serving HTTP site on <code class="docutils literal notranslate"><span class="pre">'localhost'</span></code>, port
<code class="docutils literal notranslate"><span class="pre">8080</span></code> looks like:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runner</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">AppRunner</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="k">await</span> <span class="n">runner</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
<span class="n">site</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">TCPSite</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>
<span class="k">await</span> <span class="n">site</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>To stop serving call <a class="reference internal" href="index.html#aiohttp.web.AppRunner.cleanup" title="aiohttp.web.AppRunner.cleanup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AppRunner.cleanup()</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">runner</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</div>
<div class="section" id="graceful-shutdown">
<span id="aiohttp-web-graceful-shutdown"></span><h5>Graceful shutdown<a class="headerlink" href="#graceful-shutdown" title="Permalink to this headline">¶</a></h5>
<p>Stopping <em>aiohttp web server</em> by just closing all connections is not
always satisfactory.</p>
<p>The problem is: if application supports <a class="reference internal" href="index.html#term-websocket"><span class="xref std std-term">websocket</span></a>s or <em>data
streaming</em> it most likely has open connections at server
shutdown time.</p>
<p>The <em>library</em> has no knowledge how to close them gracefully but
developer can help by registering <a class="reference internal" href="index.html#aiohttp.web.Application.on_shutdown" title="aiohttp.web.Application.on_shutdown"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_shutdown</span></code></a>
signal handler and call the signal on <em>web server</em> closing.</p>
<p>Developer should keep a list of opened connections
(<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> is a good candidate).</p>
<p>The following <a class="reference internal" href="index.html#term-websocket"><span class="xref std std-term">websocket</span></a> snippet shows an example for websocket
handler:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>
<span class="kn">import</span> <span class="nn">weakref</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="p">[</span><span class="s1">&#39;websockets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakSet</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">websocket_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">WebSocketResponse</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;websockets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">:</span>
            <span class="o">...</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;websockets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ws</span>
</pre></div>
</div>
<p>Signal handler may look like:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">WSCloseCode</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">on_shutdown</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;websockets&#39;</span><span class="p">]):</span>
        <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">WSCloseCode</span><span class="o">.</span><span class="n">GOING_AWAY</span><span class="p">,</span>
                       <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Server shutdown&#39;</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">on_shutdown</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">on_shutdown</span><span class="p">)</span>
</pre></div>
</div>
<p>Both <a class="reference internal" href="index.html#aiohttp.web.run_app" title="aiohttp.web.run_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">run_app()</span></code></a> and <a class="reference internal" href="index.html#aiohttp.web.AppRunner.cleanup" title="aiohttp.web.AppRunner.cleanup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AppRunner.cleanup()</span></code></a> call shutdown
signal handlers.</p>
</div>
<div class="section" id="background-tasks">
<span id="aiohttp-web-background-tasks"></span><h5>Background tasks<a class="headerlink" href="#background-tasks" title="Permalink to this headline">¶</a></h5>
<p>Sometimes there’s a need to perform some asynchronous operations just
after application start-up.</p>
<p>Even more, in some sophisticated systems there could be a need to run some
background tasks in the event loop along with the application’s request
handler. Such as listening to message queue or other network message/event
sources (e.g. ZeroMQ, Redis Pub/Sub, AMQP, etc.) to react to received messages
within the application.</p>
<p>For example the background task could listen to ZeroMQ on
<code class="xref py py-data docutils literal notranslate"><span class="pre">zmq.SUB</span></code> socket, process and forward retrieved messages to
clients connected via WebSocket that are stored somewhere in the
application (e.g. in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">application['websockets']</span></code> list).</p>
<p>To run such short and long running background tasks aiohttp provides an
ability to register <a class="reference internal" href="index.html#aiohttp.web.Application.on_startup" title="aiohttp.web.Application.on_startup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_startup</span></code></a> signal handler(s) that
will run along with the application’s request handler.</p>
<p>For example there’s a need to run one quick task and two long running
tasks that will live till the application is alive. The appropriate
background tasks could be registered as an <a class="reference internal" href="index.html#aiohttp.web.Application.on_startup" title="aiohttp.web.Application.on_startup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_startup</span></code></a>
signal handlers as shown in the example below:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">listen_to_redis</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aioredis</span><span class="o">.</span><span class="n">create_redis</span><span class="p">((</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">))</span>
        <span class="n">ch</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">sub</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s1">&#39;news&#39;</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">ch</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">):</span>
            <span class="c1"># Forward message to all connected websockets:</span>
            <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="n">app</span><span class="p">[</span><span class="s1">&#39;websockets&#39;</span><span class="p">]:</span>
                <span class="n">ws</span><span class="o">.</span><span class="n">send_str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ch</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">sub</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">ch</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">sub</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">start_background_tasks</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">app</span><span class="p">[</span><span class="s1">&#39;redis_listener&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">listen_to_redis</span><span class="p">(</span><span class="n">app</span><span class="p">))</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">cleanup_background_tasks</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">app</span><span class="p">[</span><span class="s1">&#39;redis_listener&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">app</span><span class="p">[</span><span class="s1">&#39;redis_listener&#39;</span><span class="p">]</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">on_startup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_background_tasks</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">on_cleanup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cleanup_background_tasks</span><span class="p">)</span>
<span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>The task <code class="xref py py-func docutils literal notranslate"><span class="pre">listen_to_redis()</span></code> will run forever.
To shut it down correctly <a class="reference internal" href="index.html#aiohttp.web.Application.on_cleanup" title="aiohttp.web.Application.on_cleanup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_cleanup</span></code></a> signal handler
may be used to send a cancellation to it.</p>
</div>
<div class="section" id="handling-error-pages">
<h5>Handling error pages<a class="headerlink" href="#handling-error-pages" title="Permalink to this headline">¶</a></h5>
<p>Pages like <em>404 Not Found</em> and <em>500 Internal Error</em> could be handled
by custom middleware, see <a class="reference external" href="https://aiohttp-demos.readthedocs.io/en/latest/tutorial.html#aiohttp-demos-polls-middlewares" title="(in aiohttp-demos v0.2)"><span class="xref std std-ref">polls demo</span></a>
for example.</p>
</div>
<div class="section" id="deploying-behind-a-proxy">
<span id="aiohttp-web-forwarded-support"></span><h5>Deploying behind a Proxy<a class="headerlink" href="#deploying-behind-a-proxy" title="Permalink to this headline">¶</a></h5>
<p>As discussed in <a class="reference internal" href="index.html#aiohttp-deployment"><span class="std std-ref">Server Deployment</span></a> the preferable way is
deploying <em>aiohttp</em> web server behind a <em>Reverse Proxy Server</em> like
<a class="reference internal" href="index.html#term-nginx"><span class="xref std std-term">nginx</span></a> for production usage.</p>
<p>In this way properties like <a class="reference internal" href="index.html#aiohttp.web.BaseRequest.scheme" title="aiohttp.web.BaseRequest.scheme"><code class="xref py py-attr docutils literal notranslate"><span class="pre">BaseRequest.scheme</span></code></a>
<a class="reference internal" href="index.html#aiohttp.web.BaseRequest.host" title="aiohttp.web.BaseRequest.host"><code class="xref py py-attr docutils literal notranslate"><span class="pre">BaseRequest.host</span></code></a> and <a class="reference internal" href="index.html#aiohttp.web.BaseRequest.remote" title="aiohttp.web.BaseRequest.remote"><code class="xref py py-attr docutils literal notranslate"><span class="pre">BaseRequest.remote</span></code></a> are
incorrect.</p>
<p>Real values should be given from proxy server, usually either
<code class="docutils literal notranslate"><span class="pre">Forwarded</span></code> or old-fashion <code class="docutils literal notranslate"><span class="pre">X-Forwarded-For</span></code>,
<code class="docutils literal notranslate"><span class="pre">X-Forwarded-Host</span></code>, <code class="docutils literal notranslate"><span class="pre">X-Forwarded-Proto</span></code> HTTP headers are used.</p>
<p><em>aiohttp</em> does not take <em>forwarded</em> headers into account by default
because it produces <em>security issue</em>: HTTP client might add these
headers too, pushing non-trusted data values.</p>
<p>That’s why <em>aiohttp server</em> should setup <em>forwarded</em> headers in custom
middleware in tight conjunction with <em>reverse proxy configuration</em>.</p>
<p>For changing <a class="reference internal" href="index.html#aiohttp.web.BaseRequest.scheme" title="aiohttp.web.BaseRequest.scheme"><code class="xref py py-attr docutils literal notranslate"><span class="pre">BaseRequest.scheme</span></code></a> <a class="reference internal" href="index.html#aiohttp.web.BaseRequest.host" title="aiohttp.web.BaseRequest.host"><code class="xref py py-attr docutils literal notranslate"><span class="pre">BaseRequest.host</span></code></a> and
<a class="reference internal" href="index.html#aiohttp.web.BaseRequest.remote" title="aiohttp.web.BaseRequest.remote"><code class="xref py py-attr docutils literal notranslate"><span class="pre">BaseRequest.remote</span></code></a> the middleware might use
<a class="reference internal" href="index.html#aiohttp.web.BaseRequest.clone" title="aiohttp.web.BaseRequest.clone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BaseRequest.clone()</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://github.com/aio-libs/aiohttp-remotes">https://github.com/aio-libs/aiohttp-remotes</a> provides secure helpers
for modifying <em>scheme</em>, <em>host</em> and <em>remote</em> attributes according
to <code class="docutils literal notranslate"><span class="pre">Forwarded</span></code> and <code class="docutils literal notranslate"><span class="pre">X-Forwarded-*</span></code> HTTP headers.</p>
</div>
</div>
<div class="section" id="swagger-support">
<h5>Swagger support<a class="headerlink" href="#swagger-support" title="Permalink to this headline">¶</a></h5>
<p><a class="reference external" href="https://github.com/cr0hn/aiohttp-swagger">aiohttp-swagger</a> is a
library that allow to add Swagger documentation and embed the
Swagger-UI into your <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> project.</p>
</div>
<div class="section" id="cors-support">
<h5>CORS support<a class="headerlink" href="#cors-support" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> itself does not support <a class="reference external" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">Cross-Origin Resource
Sharing</a>, but
there is an aiohttp plugin for it:
<a class="reference external" href="https://github.com/aio-libs/aiohttp_cors">aiohttp_cors</a>.</p>
</div>
<div class="section" id="debug-toolbar">
<h5>Debug Toolbar<a class="headerlink" href="#debug-toolbar" title="Permalink to this headline">¶</a></h5>
<p><a class="reference external" href="https://github.com/aio-libs/aiohttp_debugtoolbar">aiohttp-debugtoolbar</a> is a very useful library that provides a
debugging toolbar while you’re developing an <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a>
application.</p>
<p>Install it with <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ pip install aiohttp_debugtoolbar
</pre></div>
</div>
<p>Just call <code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp_debugtoolbar.setup()</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">aiohttp_debugtoolbar</span>
<span class="kn">from</span> <span class="nn">aiohttp_debugtoolbar</span> <span class="k">import</span> <span class="n">toolbar_middleware_factory</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">aiohttp_debugtoolbar</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>The toolbar is ready to use. Enjoy!!!</p>
</div>
<div class="section" id="dev-tools">
<h5>Dev Tools<a class="headerlink" href="#dev-tools" title="Permalink to this headline">¶</a></h5>
<p><a class="reference external" href="https://github.com/aio-libs/aiohttp-devtools">aiohttp-devtools</a> provides a couple of tools to simplify development of
<a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> applications.</p>
<p>Install with <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>  $ pip install aiohttp-devtools

 * <span class="sb">``</span>runserver<span class="sb">``</span> provides a development server with auto-reload,
live-reload, static file serving and aiohttp_debugtoolbar_
integration.
 * <span class="sb">``</span>start<span class="sb">``</span> is a <span class="sb">`</span>cookiecutter <span class="nb">command</span> which does the donkey work
of creating new :mod:<span class="sb">`</span>aiohttp.web<span class="sb">`</span> Applications.
</pre></div>
</div>
<p>Documentation and a complete tutorial of creating and running an app
locally are available at <a class="reference external" href="https://github.com/aio-libs/aiohttp-devtools">aiohttp-devtools</a>.</p>
</div>
</div>
<span id="document-web_lowlevel"></span><div class="section" id="low-level-server">
<span id="aiohttp-web-lowlevel"></span><h4>Low Level Server<a class="headerlink" href="#low-level-server" title="Permalink to this headline">¶</a></h4>
<p>This topic describes <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> based <em>low level</em> API.</p>
<div class="section" id="abstract">
<h5>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h5>
<p>Sometimes user don’t need high-level concepts introduced in
<a class="reference internal" href="index.html#aiohttp-web"><span class="std std-ref">Server</span></a>: applications, routers, middlewares and signals.</p>
<p>All what is needed is supporting asynchronous callable which accepts a
request and returns a response object.</p>
<p>This is done by introducing <a class="reference internal" href="index.html#aiohttp.web.Server" title="aiohttp.web.Server"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Server</span></code></a> class which
serves a <em>protocol factory</em> role for
<code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.AbstractEventLoop.create_server()</span></code> and bridges data
stream to <em>web handler</em> and sends result back.</p>
<p>Low level <em>web handler</em> should accept the single <a class="reference internal" href="index.html#aiohttp.web.BaseRequest" title="aiohttp.web.BaseRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseRequest</span></code></a>
parameter and performs one of the following actions:</p>
<blockquote>
<div><ol class="arabic">
<li><p>Return a <a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> with the whole HTTP body stored in memory.</p></li>
<li><p>Create a <a class="reference internal" href="index.html#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamResponse</span></code></a>, send headers by
<a class="reference internal" href="index.html#aiohttp.web.StreamResponse.prepare" title="aiohttp.web.StreamResponse.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StreamResponse.prepare()</span></code></a> call, send data chunks by
<a class="reference internal" href="index.html#aiohttp.web.StreamResponse.write" title="aiohttp.web.StreamResponse.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StreamResponse.write()</span></code></a> and return finished response.</p></li>
<li><p>Raise <a class="reference internal" href="index.html#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPException</span></code></a> derived exception (see
<a class="reference internal" href="index.html#aiohttp-web-exceptions"><span class="std std-ref">Exceptions</span></a> section).</p>
<p>All other exceptions not derived from <a class="reference internal" href="index.html#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPException</span></code></a>
leads to <em>500 Internal Server Error</em> response.</p>
</li>
<li><p>Initiate and process Web-Socket connection by
<a class="reference internal" href="index.html#aiohttp.web.WebSocketResponse" title="aiohttp.web.WebSocketResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">WebSocketResponse</span></code></a> using (see <a class="reference internal" href="index.html#aiohttp-web-websockets"><span class="std std-ref">WebSockets</span></a>).</p></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="run-a-basic-low-level-server">
<h5>Run a Basic Low-Level Server<a class="headerlink" href="#run-a-basic-low-level-server" title="Permalink to this headline">¶</a></h5>
<p>The following code demonstrates very trivial usage example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;OK&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Server</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="n">runner</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">ServerRunner</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">runner</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
    <span class="n">site</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">TCPSite</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">site</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;======= Serving on http://127.0.0.1:8080/ ======&quot;</span><span class="p">)</span>

    <span class="c1"># pause here for very long time by serving HTTP requests and</span>
    <span class="c1"># waiting for keyboard interruption</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span>


<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>In the snippet we have <code class="docutils literal notranslate"><span class="pre">handler</span></code> which returns a regular
<a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> with <code class="docutils literal notranslate"><span class="pre">&quot;OK&quot;</span></code> in BODY.</p>
<p>This <em>handler</em> is processed by <code class="docutils literal notranslate"><span class="pre">server</span></code> (<a class="reference internal" href="index.html#aiohttp.web.Server" title="aiohttp.web.Server"><code class="xref py py-class docutils literal notranslate"><span class="pre">Server</span></code></a> which acts
as <em>protocol factory</em>).  Network communication is created by
<a class="reference internal" href="index.html#aiohttp-web-app-runners-reference"><span class="std std-ref">runners API</span></a> to serve
<code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8080/</span></code>.</p>
<p>The handler should process every request for every <em>path</em>, e.g.
<code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code>, Web-Socket.</p>
<p>The example is very basic: it always return <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">OK</span></code> response, real
life code is much more complex usually.</p>
</div>
</div>
<span id="document-web_reference"></span><div class="section" id="server-reference">
<span id="aiohttp-web-reference"></span><h4>Server Reference<a class="headerlink" href="#server-reference" title="Permalink to this headline">¶</a></h4>
<div class="section" id="request-and-base-request">
<span id="aiohttp-web-request"></span><h5>Request and Base Request<a class="headerlink" href="#request-and-base-request" title="Permalink to this headline">¶</a></h5>
<p>The Request object contains all the information about an incoming HTTP request.</p>
<p><a class="reference internal" href="#aiohttp.web.BaseRequest" title="aiohttp.web.BaseRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseRequest</span></code></a> is used for <a class="reference internal" href="index.html#aiohttp-web-lowlevel"><span class="std std-ref">Low-Level
Servers</span></a> (which have no applications, routers,
signals and middlewares). <a class="reference internal" href="#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a> has an <a class="reference internal" href="#aiohttp.web.Request.app" title="aiohttp.web.Request.app"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Request.app</span></code></a>
and <a class="reference internal" href="#aiohttp.web.Request.match_info" title="aiohttp.web.Request.match_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Request.match_info</span></code></a> attributes.</p>
<p>A <a class="reference internal" href="#aiohttp.web.BaseRequest" title="aiohttp.web.BaseRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseRequest</span></code></a> / <a class="reference internal" href="#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a> are <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> like objects,
allowing them to be used for <a class="reference internal" href="index.html#aiohttp-web-data-sharing"><span class="std std-ref">sharing
data</span></a> among <a class="reference internal" href="index.html#aiohttp-web-middlewares"><span class="std std-ref">Middlewares</span></a>
and <a class="reference internal" href="index.html#aiohttp-web-signals"><span class="std std-ref">Signals</span></a> handlers.</p>
<dl class="class">
<dt id="aiohttp.web.BaseRequest">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">BaseRequest</code><a class="headerlink" href="#aiohttp.web.BaseRequest" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="aiohttp.web.BaseRequest.version">
<code class="sig-name descname">version</code><a class="headerlink" href="#aiohttp.web.BaseRequest.version" title="Permalink to this definition">¶</a></dt>
<dd><p><em>HTTP version</em> of request, Read-only property.</p>
<p>Returns <code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.protocol.HttpVersion</span></code> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.method">
<code class="sig-name descname">method</code><a class="headerlink" href="#aiohttp.web.BaseRequest.method" title="Permalink to this definition">¶</a></dt>
<dd><p><em>HTTP method</em>, read-only property.</p>
<p>The value is upper-cased <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> like <code class="docutils literal notranslate"><span class="pre">&quot;GET&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;POST&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;PUT&quot;</span></code> etc.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.url">
<code class="sig-name descname">url</code><a class="headerlink" href="#aiohttp.web.BaseRequest.url" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> instance with absolute URL to resource
(<em>scheme</em>, <em>host</em> and <em>port</em> are included).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In case of malformed request (e.g. without <code class="docutils literal notranslate"><span class="pre">&quot;HOST&quot;</span></code> HTTP
header) the absolute url may be unavailable.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.rel_url">
<code class="sig-name descname">rel_url</code><a class="headerlink" href="#aiohttp.web.BaseRequest.rel_url" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> instance with relative URL to resource
(contains <em>path</em>, <em>query</em> and <em>fragment</em> parts only, <em>scheme</em>,
<em>host</em> and <em>port</em> are excluded).</p>
<p>The property is equal to <code class="docutils literal notranslate"><span class="pre">.url.relative()</span></code> but is always present.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>A note from <a class="reference internal" href="#aiohttp.web.BaseRequest.url" title="aiohttp.web.BaseRequest.url"><code class="xref py py-attr docutils literal notranslate"><span class="pre">url</span></code></a>.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.scheme">
<code class="sig-name descname">scheme</code><a class="headerlink" href="#aiohttp.web.BaseRequest.scheme" title="Permalink to this definition">¶</a></dt>
<dd><p>A string representing the scheme of the request.</p>
<p>The scheme is <code class="docutils literal notranslate"><span class="pre">'https'</span></code> if transport for request handling is
<em>SSL</em>, <code class="docutils literal notranslate"><span class="pre">'http'</span></code> otherwise.</p>
<p>The value could be overridden by <a class="reference internal" href="#aiohttp.web.BaseRequest.clone" title="aiohttp.web.BaseRequest.clone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clone()</span></code></a>.</p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> property.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.3: </span><em>Forwarded</em> and <em>X-Forwarded-Proto</em> are not used anymore.</p>
<p>Call <code class="docutils literal notranslate"><span class="pre">.clone(scheme=new_scheme)</span></code> for setting up the value
explicitly.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-forwarded-support"><span class="std std-ref">Deploying behind a Proxy</span></a></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.secure">
<code class="sig-name descname">secure</code><a class="headerlink" href="#aiohttp.web.BaseRequest.secure" title="Permalink to this definition">¶</a></dt>
<dd><p>Shorthand for <code class="docutils literal notranslate"><span class="pre">request.url.scheme</span> <span class="pre">==</span> <span class="pre">'https'</span></code></p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> property.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#aiohttp.web.BaseRequest.scheme" title="aiohttp.web.BaseRequest.scheme"><code class="xref py py-attr docutils literal notranslate"><span class="pre">scheme</span></code></a></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.forwarded">
<code class="sig-name descname">forwarded</code><a class="headerlink" href="#aiohttp.web.BaseRequest.forwarded" title="Permalink to this definition">¶</a></dt>
<dd><p>A tuple containing all parsed Forwarded header(s).</p>
<p>Makes an effort to parse Forwarded headers as specified by <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc7239.html"><strong>RFC 7239</strong></a>:</p>
<ul class="simple">
<li><p>It adds one (immutable) dictionary per Forwarded <code class="docutils literal notranslate"><span class="pre">field-value</span></code>, i.e.
per proxy. The element corresponds to the data in the Forwarded
<code class="docutils literal notranslate"><span class="pre">field-value</span></code> added by the first proxy encountered by the client.
Each subsequent item corresponds to those added by later proxies.</p></li>
<li><p>It checks that every value has valid syntax in general as specified
in <span class="target" id="index-1"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc7239.html#section-4"><strong>RFC 7239#section-4</strong></a>: either a <code class="docutils literal notranslate"><span class="pre">token</span></code> or a <code class="docutils literal notranslate"><span class="pre">quoted-string</span></code>.</p></li>
<li><p>It un-escapes <code class="docutils literal notranslate"><span class="pre">quoted-pairs</span></code>.</p></li>
<li><p>It does NOT validate ‘by’ and ‘for’ contents as specified in
<span class="target" id="index-2"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc7239.html#section-6"><strong>RFC 7239#section-6</strong></a>.</p></li>
<li><p>It does NOT validate <code class="docutils literal notranslate"><span class="pre">host</span></code> contents (Host ABNF).</p></li>
<li><p>It does NOT validate <code class="docutils literal notranslate"><span class="pre">proto</span></code> contents for valid URI scheme names.</p></li>
</ul>
<p>Returns a tuple containing one or more <code class="docutils literal notranslate"><span class="pre">MappingProxy</span></code> objects</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#aiohttp.web.BaseRequest.scheme" title="aiohttp.web.BaseRequest.scheme"><code class="xref py py-attr docutils literal notranslate"><span class="pre">scheme</span></code></a></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#aiohttp.web.BaseRequest.host" title="aiohttp.web.BaseRequest.host"><code class="xref py py-attr docutils literal notranslate"><span class="pre">host</span></code></a></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.host">
<code class="sig-name descname">host</code><a class="headerlink" href="#aiohttp.web.BaseRequest.host" title="Permalink to this definition">¶</a></dt>
<dd><p>Host name of the request, resolved in this order:</p>
<ul class="simple">
<li><p>Overridden value by <a class="reference internal" href="#aiohttp.web.BaseRequest.clone" title="aiohttp.web.BaseRequest.clone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clone()</span></code></a> call.</p></li>
<li><p><em>Host</em> HTTP header</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">socket.gtfqdn()</span></code></p></li>
</ul>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> property.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 2.3: </span><em>Forwarded</em> and <em>X-Forwarded-Host</em> are not used anymore.</p>
<p>Call <code class="docutils literal notranslate"><span class="pre">.clone(host=new_host)</span></code> for setting up the value
explicitly.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-forwarded-support"><span class="std std-ref">Deploying behind a Proxy</span></a></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.remote">
<code class="sig-name descname">remote</code><a class="headerlink" href="#aiohttp.web.BaseRequest.remote" title="Permalink to this definition">¶</a></dt>
<dd><p>Originating IP address of a client initiated HTTP request.</p>
<p>The IP is resolved through the following headers, in this order:</p>
<ul class="simple">
<li><p>Overridden value by <a class="reference internal" href="#aiohttp.web.BaseRequest.clone" title="aiohttp.web.BaseRequest.clone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clone()</span></code></a> call.</p></li>
<li><p>Peer name of opened socket.</p></li>
</ul>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> property.</p>
<p>Call <code class="docutils literal notranslate"><span class="pre">.clone(remote=new_remote)</span></code> for setting up the value
explicitly.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-forwarded-support"><span class="std std-ref">Deploying behind a Proxy</span></a></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.path_qs">
<code class="sig-name descname">path_qs</code><a class="headerlink" href="#aiohttp.web.BaseRequest.path_qs" title="Permalink to this definition">¶</a></dt>
<dd><p>The URL including PATH_INFO and the query string. e.g.,
<code class="docutils literal notranslate"><span class="pre">/app/blog?id=10</span></code></p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.path">
<code class="sig-name descname">path</code><a class="headerlink" href="#aiohttp.web.BaseRequest.path" title="Permalink to this definition">¶</a></dt>
<dd><p>The URL including <em>PATH INFO</em> without the host or scheme. e.g.,
<code class="docutils literal notranslate"><span class="pre">/app/blog</span></code>. The path is URL-decoded. For raw path info see
<a class="reference internal" href="#aiohttp.web.BaseRequest.raw_path" title="aiohttp.web.BaseRequest.raw_path"><code class="xref py py-attr docutils literal notranslate"><span class="pre">raw_path</span></code></a>.</p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.raw_path">
<code class="sig-name descname">raw_path</code><a class="headerlink" href="#aiohttp.web.BaseRequest.raw_path" title="Permalink to this definition">¶</a></dt>
<dd><p>The URL including raw <em>PATH INFO</em> without the host or scheme.
Warning, the path may be URL-encoded and may contain invalid URL
characters, e.g.
<code class="docutils literal notranslate"><span class="pre">/my%2Fpath%7Cwith%21some%25strange%24characters</span></code>.</p>
<p>For URL-decoded version please take a look on <a class="reference internal" href="#aiohttp.web.BaseRequest.path" title="aiohttp.web.BaseRequest.path"><code class="xref py py-attr docutils literal notranslate"><span class="pre">path</span></code></a>.</p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.query">
<code class="sig-name descname">query</code><a class="headerlink" href="#aiohttp.web.BaseRequest.query" title="Permalink to this definition">¶</a></dt>
<dd><p>A multidict with all the variables in the query string.</p>
<p>Read-only <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.MultiDictProxy" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDictProxy</span></code></a> lazy property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.query_string">
<code class="sig-name descname">query_string</code><a class="headerlink" href="#aiohttp.web.BaseRequest.query_string" title="Permalink to this definition">¶</a></dt>
<dd><p>The query string in the URL, e.g., <code class="docutils literal notranslate"><span class="pre">id=10</span></code></p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.headers">
<code class="sig-name descname">headers</code><a class="headerlink" href="#aiohttp.web.BaseRequest.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>A case-insensitive multidict proxy with all headers.</p>
<p>Read-only <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.CIMultiDictProxy" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIMultiDictProxy</span></code></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.raw_headers">
<code class="sig-name descname">raw_headers</code><a class="headerlink" href="#aiohttp.web.BaseRequest.raw_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP headers of response as unconverted bytes, a sequence of
<code class="docutils literal notranslate"><span class="pre">(key,</span> <span class="pre">value)</span></code> pairs.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.keep_alive">
<code class="sig-name descname">keep_alive</code><a class="headerlink" href="#aiohttp.web.BaseRequest.keep_alive" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if keep-alive connection enabled by HTTP client and
protocol version supports it, otherwise <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.transport">
<code class="sig-name descname">transport</code><a class="headerlink" href="#aiohttp.web.BaseRequest.transport" title="Permalink to this definition">¶</a></dt>
<dd><p>An <a class="reference external" href="https://docs.python.org/3/library/asyncio-protocol.html#asyncio-transport" title="(in Python v3.7)"><span class="xref std std-ref">transport</span></a> used to process request,
Read-only property.</p>
<p>The property can be used, for example, for getting IP address of
client’s peer:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">peername</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_extra_info</span><span class="p">(</span><span class="s1">&#39;peername&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">peername</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">peername</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.loop">
<code class="sig-name descname">loop</code><a class="headerlink" href="#aiohttp.web.BaseRequest.loop" title="Permalink to this definition">¶</a></dt>
<dd><p>An event loop instance used by HTTP request handling.</p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.AbstractEventLoop" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.AbstractEventLoop</span></code></a> property.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.5.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.cookies">
<code class="sig-name descname">cookies</code><a class="headerlink" href="#aiohttp.web.BaseRequest.cookies" title="Permalink to this definition">¶</a></dt>
<dd><p>A multidict of all request’s cookies.</p>
<p>Read-only <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.MultiDictProxy" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDictProxy</span></code></a> lazy property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.content">
<code class="sig-name descname">content</code><a class="headerlink" href="#aiohttp.web.BaseRequest.content" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="index.html#aiohttp.StreamReader" title="aiohttp.StreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamReader</span></code></a> instance,
input stream for reading request’s <em>BODY</em>.</p>
<p>Read-only property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.body_exists">
<code class="sig-name descname">body_exists</code><a class="headerlink" href="#aiohttp.web.BaseRequest.body_exists" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if request has <em>HTTP BODY</em>, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> property.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.can_read_body">
<code class="sig-name descname">can_read_body</code><a class="headerlink" href="#aiohttp.web.BaseRequest.can_read_body" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if request’s <em>HTTP BODY</em> can be read, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> property.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.has_body">
<code class="sig-name descname">has_body</code><a class="headerlink" href="#aiohttp.web.BaseRequest.has_body" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if request’s <em>HTTP BODY</em> can be read, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
<p>Read-only <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> property.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 2.3: </span>Use <a class="reference internal" href="#aiohttp.web.BaseRequest.can_read_body" title="aiohttp.web.BaseRequest.can_read_body"><code class="xref py py-meth docutils literal notranslate"><span class="pre">can_read_body()</span></code></a> instead.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.content_type">
<code class="sig-name descname">content_type</code><a class="headerlink" href="#aiohttp.web.BaseRequest.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property with <em>content</em> part of <em>Content-Type</em> header.</p>
<p>Returns <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> like <code class="docutils literal notranslate"><span class="pre">'text/html'</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Returns value is <code class="docutils literal notranslate"><span class="pre">'application/octet-stream'</span></code> if no
Content-Type header present in HTTP headers according to
<span class="target" id="index-3"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2616.html"><strong>RFC 2616</strong></a></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.charset">
<code class="sig-name descname">charset</code><a class="headerlink" href="#aiohttp.web.BaseRequest.charset" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property that specifies the <em>encoding</em> for the request’s BODY.</p>
<p>The value is parsed from the <em>Content-Type</em> HTTP header.</p>
<p>Returns <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> like <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code> if
<em>Content-Type</em> has no charset information.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.content_length">
<code class="sig-name descname">content_length</code><a class="headerlink" href="#aiohttp.web.BaseRequest.content_length" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property that returns length of the request’s BODY.</p>
<p>The value is parsed from the <em>Content-Length</em> HTTP header.</p>
<p>Returns <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> or <code class="docutils literal notranslate"><span class="pre">None</span></code> if <em>Content-Length</em> is absent.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.http_range">
<code class="sig-name descname">http_range</code><a class="headerlink" href="#aiohttp.web.BaseRequest.http_range" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property that returns information about <em>Range</em> HTTP header.</p>
<p>Returns a <a class="reference external" href="https://docs.python.org/3/library/functions.html#slice" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">slice</span></code></a> where <code class="docutils literal notranslate"><span class="pre">.start</span></code> is <em>left inclusive
bound</em>, <code class="docutils literal notranslate"><span class="pre">.stop</span></code> is <em>right exclusive bound</em> and <code class="docutils literal notranslate"><span class="pre">.step</span></code> is
<code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>The property might be used in two manners:</p>
<ol class="arabic">
<li><p>Attribute-access style (example assumes that both left and
right borders are set, the real logic for case of open bounds
is more complex):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">rng</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">http_range</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">stop</span><span class="o">-</span><span class="n">rng</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Slice-style:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">buffer</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">http_range</span><span class="p">]</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.if_modified_since">
<code class="sig-name descname">if_modified_since</code><a class="headerlink" href="#aiohttp.web.BaseRequest.if_modified_since" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property that returns the date specified in the
<em>If-Modified-Since</em> header.</p>
<p>Returns <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a> or <code class="docutils literal notranslate"><span class="pre">None</span></code> if
<em>If-Modified-Since</em> header is absent or is not a valid
HTTP date.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.if_unmodified_since">
<code class="sig-name descname">if_unmodified_since</code><a class="headerlink" href="#aiohttp.web.BaseRequest.if_unmodified_since" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property that returns the date specified in the
<em>If-Unmodified-Since</em> header.</p>
<p>Returns <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a> or <code class="docutils literal notranslate"><span class="pre">None</span></code> if
<em>If-Unmodified-Since</em> header is absent or is not a valid
HTTP date.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRequest.if_range">
<code class="sig-name descname">if_range</code><a class="headerlink" href="#aiohttp.web.BaseRequest.if_range" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property that returns the date specified in the
<em>If-Range</em> header.</p>
<p>Returns <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a> or <code class="docutils literal notranslate"><span class="pre">None</span></code> if
<em>If-Range</em> header is absent or is not a valid
HTTP date.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.BaseRequest.clone">
<code class="sig-name descname">clone</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">method=...</em>, <em class="sig-param">rel_url=...</em>, <em class="sig-param">headers=...</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.BaseRequest.clone" title="Permalink to this definition">¶</a></dt>
<dd><p>Clone itself with replacement some attributes.</p>
<p>Creates and returns a new instance of Request object. If no parameters
are given, an exact copy is returned. If a parameter is not passed, it
will reuse the one from the current request object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – http method</p></li>
<li><p><strong>rel_url</strong> – url to use, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a></p></li>
<li><p><strong>headers</strong> – <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.CIMultiDict" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIMultiDict</span></code></a> or compatible
headers container.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a cloned <a class="reference internal" href="#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a> instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.BaseRequest.read">
<em class="property">coroutine </em><code class="sig-name descname">read</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.BaseRequest.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read request body, returns <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> object with body content.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method <strong>does</strong> store read data internally, subsequent
<code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code> call will return the same value.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.BaseRequest.text">
<em class="property">coroutine </em><code class="sig-name descname">text</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.BaseRequest.text" title="Permalink to this definition">¶</a></dt>
<dd><p>Read request body, decode it using <a class="reference internal" href="#aiohttp.web.BaseRequest.charset" title="aiohttp.web.BaseRequest.charset"><code class="xref py py-attr docutils literal notranslate"><span class="pre">charset</span></code></a> encoding or
<code class="docutils literal notranslate"><span class="pre">UTF-8</span></code> if no encoding was specified in <em>MIME-type</em>.</p>
<p>Returns <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> with body content.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method <strong>does</strong> store read data internally, subsequent
<code class="xref py py-meth docutils literal notranslate"><span class="pre">text()</span></code> call will return the same value.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.BaseRequest.json">
<em class="property">coroutine </em><code class="sig-name descname">json</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">loads=json.loads</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.BaseRequest.json" title="Permalink to this definition">¶</a></dt>
<dd><p>Read request body decoded as <em>json</em>.</p>
<p>The method is just a boilerplate <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a>
implemented as:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">loads</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>loads</strong> (<em>callable</em>) – any <a class="reference internal" href="index.html#term-callable"><span class="xref std std-term">callable</span></a> that accepts
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> and returns <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>
with parsed JSON (<a class="reference external" href="https://docs.python.org/3/library/json.html#json.loads" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">json.loads()</span></code></a> by
default).</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method <strong>does</strong> store read data internally, subsequent
<code class="xref py py-meth docutils literal notranslate"><span class="pre">json()</span></code> call will return the same value.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.BaseRequest.multipart">
<em class="property">coroutine </em><code class="sig-name descname">multipart</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.BaseRequest.multipart" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.multipart.MultipartReader</span></code> which processes
incoming <em>multipart</em> request.</p>
<p>The method is just a boilerplate <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a>
implemented as:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">multipart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">multipart</span><span class="o">.</span><span class="n">MultipartReader</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">reader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_payload</span><span class="p">)</span>
</pre></div>
</div>
<p>This method is a coroutine for consistency with the else reader methods.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The method <strong>does not</strong> store read data internally. That means once
you exhausts multipart reader, you cannot get the request payload one
more time.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-multipart"><span class="std std-ref">Working with Multipart</span></a></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.4: </span>Dropped <em>reader</em> parameter.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.BaseRequest.post">
<em class="property">coroutine </em><code class="sig-name descname">post</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.BaseRequest.post" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that reads POST parameters from
request body.</p>
<p>Returns <a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.MultiDictProxy" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDictProxy</span></code></a> instance filled
with parsed data.</p>
<p>If <a class="reference internal" href="#aiohttp.web.BaseRequest.method" title="aiohttp.web.BaseRequest.method"><code class="xref py py-attr docutils literal notranslate"><span class="pre">method</span></code></a> is not <em>POST</em>, <em>PUT</em>, <em>PATCH</em>, <em>TRACE</em> or <em>DELETE</em> or
<a class="reference internal" href="#aiohttp.web.BaseRequest.content_type" title="aiohttp.web.BaseRequest.content_type"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content_type</span></code></a> is not empty or
<em>application/x-www-form-urlencoded</em> or <em>multipart/form-data</em>
returns empty multidict.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method <strong>does</strong> store read data internally, subsequent
<code class="xref py py-meth docutils literal notranslate"><span class="pre">post()</span></code> call will return the same value.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.BaseRequest.release">
<em class="property">coroutine </em><code class="sig-name descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.BaseRequest.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release request.</p>
<p>Eat unread part of HTTP BODY if present.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>User code may never call <code class="xref py py-meth docutils literal notranslate"><span class="pre">release()</span></code>, all
required work will be processed by <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a>
internal machinery.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.Request">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">Request</code><a class="headerlink" href="#aiohttp.web.Request" title="Permalink to this definition">¶</a></dt>
<dd><p>A request used for receiving request’s information by <em>web handler</em>.</p>
<p>Every <a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">handler</span></a> accepts a request
instance as the first positional parameter.</p>
<p>The class in derived from <a class="reference internal" href="#aiohttp.web.BaseRequest" title="aiohttp.web.BaseRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseRequest</span></code></a>, shares all parent’s
attributes and methods but has a couple of additional properties:</p>
<dl class="attribute">
<dt id="aiohttp.web.Request.match_info">
<code class="sig-name descname">match_info</code><a class="headerlink" href="#aiohttp.web.Request.match_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property with <code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMatchInfo</span></code>
instance for result of route resolving.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Exact type of property depends on used router.  If
<code class="docutils literal notranslate"><span class="pre">app.router</span></code> is <a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlDispatcher</span></code></a> the property contains
<a class="reference internal" href="#aiohttp.web.UrlMappingMatchInfo" title="aiohttp.web.UrlMappingMatchInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlMappingMatchInfo</span></code></a> instance.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.app">
<code class="sig-name descname">app</code><a class="headerlink" href="#aiohttp.web.Request.app" title="Permalink to this definition">¶</a></dt>
<dd><p>An <a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> instance used to call <a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">request handler</span></a>, Read-only property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.config_dict">
<code class="sig-name descname">config_dict</code><a class="headerlink" href="#aiohttp.web.Request.config_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="index.html#aiohttp.ChainMapProxy" title="aiohttp.ChainMapProxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.ChainMapProxy</span></code></a> instance for mapping all properties
from the current application returned by <a class="reference internal" href="#aiohttp.web.Request.app" title="aiohttp.web.Request.app"><code class="xref py py-attr docutils literal notranslate"><span class="pre">app</span></code></a> property
and all its parents.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-data-sharing-app-config"><span class="std std-ref">Application’s config</span></a></p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.2.</span></p>
</div>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You should never create the <a class="reference internal" href="#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a> instance manually
– <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> does it for you. But
<a class="reference internal" href="#aiohttp.web.BaseRequest.clone" title="aiohttp.web.BaseRequest.clone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clone()</span></code></a> may be used for cloning <em>modified</em>
request copy with changed <em>path</em>, <em>method</em> etc.</p>
</div>
</dd></dl>

</div>
<div class="section" id="response-classes">
<span id="aiohttp-web-response"></span><h5>Response classes<a class="headerlink" href="#response-classes" title="Permalink to this headline">¶</a></h5>
<p>For now, <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> has three classes for the <em>HTTP response</em>:
<a class="reference internal" href="#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamResponse</span></code></a>, <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> and <code class="xref py py-class docutils literal notranslate"><span class="pre">FileResponse</span></code>.</p>
<p>Usually you need to use the second one. <a class="reference internal" href="#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamResponse</span></code></a> is
intended for streaming data, while <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> contains <em>HTTP
BODY</em> as an attribute and sends own content as single piece with the
correct <em>Content-Length HTTP header</em>.</p>
<p>For sake of design decisions <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> is derived from
<a class="reference internal" href="#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamResponse</span></code></a> parent class.</p>
<p>The response supports <em>keep-alive</em> handling out-of-the-box if
<em>request</em> supports it.</p>
<p>You can disable <em>keep-alive</em> by <a class="reference internal" href="#aiohttp.web.StreamResponse.force_close" title="aiohttp.web.StreamResponse.force_close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">force_close()</span></code></a> though.</p>
<p>The common case for sending an answer from
<a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">web-handler</span></a> is returning a
<a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> instance:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;All right!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Response classes are <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a> like objects,
allowing them to be used for <a class="reference internal" href="index.html#aiohttp-web-data-sharing"><span class="std std-ref">sharing
data</span></a> among <a class="reference internal" href="index.html#aiohttp-web-middlewares"><span class="std std-ref">Middlewares</span></a>
and <a class="reference internal" href="index.html#aiohttp-web-signals"><span class="std std-ref">Signals</span></a> handlers:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0: </span>Dict-like interface support.</p>
</div>
<div class="section" id="streamresponse">
<h6>StreamResponse<a class="headerlink" href="#streamresponse" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.web.StreamResponse">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">StreamResponse</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">status=200</em>, <em class="sig-param">reason=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.StreamResponse" title="Permalink to this definition">¶</a></dt>
<dd><p>The base class for the <em>HTTP response</em> handling.</p>
<p>Contains methods for setting <em>HTTP response headers</em>, <em>cookies</em>,
<em>response status code</em>, writing <em>HTTP response BODY</em> and so on.</p>
<p>The most important thing you should know about <em>response</em> — it
is <em>Finite State Machine</em>.</p>
<p>That means you can do any manipulations with <em>headers</em>, <em>cookies</em>
and <em>status code</em> only before <a class="reference internal" href="#aiohttp.web.StreamResponse.prepare" title="aiohttp.web.StreamResponse.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare()</span></code></a> coroutine is called.</p>
<p>Once you call <a class="reference internal" href="#aiohttp.web.StreamResponse.prepare" title="aiohttp.web.StreamResponse.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare()</span></code></a> any change of
the <em>HTTP header</em> part will raise <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> exception.</p>
<p>Any <a class="reference internal" href="#aiohttp.web.StreamResponse.write" title="aiohttp.web.StreamResponse.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write()</span></code></a> call after <a class="reference internal" href="#aiohttp.web.StreamResponse.write_eof" title="aiohttp.web.StreamResponse.write_eof"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write_eof()</span></code></a> is also forbidden.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>status</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – HTTP status code, <code class="docutils literal notranslate"><span class="pre">200</span></code> by default.</p></li>
<li><p><strong>reason</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – HTTP reason. If param is <code class="docutils literal notranslate"><span class="pre">None</span></code> reason will be
calculated basing on <em>status</em>
parameter. Otherwise pass <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> with
arbitrary <em>status</em> explanation..</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.prepared">
<code class="sig-name descname">prepared</code><a class="headerlink" href="#aiohttp.web.StreamResponse.prepared" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> property, <code class="docutils literal notranslate"><span class="pre">True</span></code> if <a class="reference internal" href="#aiohttp.web.StreamResponse.prepare" title="aiohttp.web.StreamResponse.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare()</span></code></a> has
been called, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.task">
<code class="sig-name descname">task</code><a class="headerlink" href="#aiohttp.web.StreamResponse.task" title="Permalink to this definition">¶</a></dt>
<dd><p>A task that serves HTTP request handling.</p>
<p>May be useful for graceful shutdown of long-running requests
(streaming, long polling or web-socket).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.status">
<code class="sig-name descname">status</code><a class="headerlink" href="#aiohttp.web.StreamResponse.status" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property for <em>HTTP response status code</em>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">200</span></code> (OK) by default.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.reason">
<code class="sig-name descname">reason</code><a class="headerlink" href="#aiohttp.web.StreamResponse.reason" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property for <em>HTTP response reason</em>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.set_status">
<code class="sig-name descname">set_status</code><span class="sig-paren">(</span><em class="sig-param">status</em>, <em class="sig-param">reason=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.StreamResponse.set_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Set <a class="reference internal" href="#aiohttp.web.StreamResponse.status" title="aiohttp.web.StreamResponse.status"><code class="xref py py-attr docutils literal notranslate"><span class="pre">status</span></code></a> and <a class="reference internal" href="#aiohttp.web.StreamResponse.reason" title="aiohttp.web.StreamResponse.reason"><code class="xref py py-attr docutils literal notranslate"><span class="pre">reason</span></code></a>.</p>
<p><em>reason</em> value is auto calculated if not specified (<code class="docutils literal notranslate"><span class="pre">None</span></code>).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.keep_alive">
<code class="sig-name descname">keep_alive</code><a class="headerlink" href="#aiohttp.web.StreamResponse.keep_alive" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property, copy of <code class="xref py py-attr docutils literal notranslate"><span class="pre">Request.keep_alive</span></code> by default.</p>
<p>Can be switched to <code class="docutils literal notranslate"><span class="pre">False</span></code> by <a class="reference internal" href="#aiohttp.web.StreamResponse.force_close" title="aiohttp.web.StreamResponse.force_close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">force_close()</span></code></a> call.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.force_close">
<code class="sig-name descname">force_close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.StreamResponse.force_close" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable <a class="reference internal" href="#aiohttp.web.StreamResponse.keep_alive" title="aiohttp.web.StreamResponse.keep_alive"><code class="xref py py-attr docutils literal notranslate"><span class="pre">keep_alive</span></code></a> for connection. There are no ways to
enable it back.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.compression">
<code class="sig-name descname">compression</code><a class="headerlink" href="#aiohttp.web.StreamResponse.compression" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> property, <code class="docutils literal notranslate"><span class="pre">True</span></code> if compression is enabled.</p>
<p><code class="docutils literal notranslate"><span class="pre">False</span></code> by default.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#aiohttp.web.StreamResponse.enable_compression" title="aiohttp.web.StreamResponse.enable_compression"><code class="xref py py-meth docutils literal notranslate"><span class="pre">enable_compression()</span></code></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.enable_compression">
<code class="sig-name descname">enable_compression</code><span class="sig-paren">(</span><em class="sig-param">force=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.StreamResponse.enable_compression" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable compression.</p>
<p>When <em>force</em> is unset compression encoding is selected based on
the request’s <em>Accept-Encoding</em> header.</p>
<p><em>Accept-Encoding</em> is not checked if <em>force</em> is set to a
<a class="reference internal" href="#aiohttp.web.ContentCoding" title="aiohttp.web.ContentCoding"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContentCoding</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#aiohttp.web.StreamResponse.compression" title="aiohttp.web.StreamResponse.compression"><code class="xref py py-attr docutils literal notranslate"><span class="pre">compression</span></code></a></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.chunked">
<code class="sig-name descname">chunked</code><a class="headerlink" href="#aiohttp.web.StreamResponse.chunked" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property, indicates if chunked encoding is on.</p>
<p>Can be enabled by <a class="reference internal" href="#aiohttp.web.StreamResponse.enable_chunked_encoding" title="aiohttp.web.StreamResponse.enable_chunked_encoding"><code class="xref py py-meth docutils literal notranslate"><span class="pre">enable_chunked_encoding()</span></code></a> call.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#aiohttp.web.StreamResponse.enable_chunked_encoding" title="aiohttp.web.StreamResponse.enable_chunked_encoding"><code class="xref py py-attr docutils literal notranslate"><span class="pre">enable_chunked_encoding</span></code></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.enable_chunked_encoding">
<code class="sig-name descname">enable_chunked_encoding</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.StreamResponse.enable_chunked_encoding" title="Permalink to this definition">¶</a></dt>
<dd><p>Enables <a class="reference internal" href="#aiohttp.web.StreamResponse.chunked" title="aiohttp.web.StreamResponse.chunked"><code class="xref py py-attr docutils literal notranslate"><span class="pre">chunked</span></code></a> encoding for response. There are no ways to
disable it back. With enabled <a class="reference internal" href="#aiohttp.web.StreamResponse.chunked" title="aiohttp.web.StreamResponse.chunked"><code class="xref py py-attr docutils literal notranslate"><span class="pre">chunked</span></code></a> encoding each <a class="reference internal" href="#aiohttp.web.StreamResponse.write" title="aiohttp.web.StreamResponse.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write()</span></code></a>
operation encoded in separate chunk.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>chunked encoding can be enabled for <code class="docutils literal notranslate"><span class="pre">HTTP/1.1</span></code> only.</p>
<p>Setting up both <a class="reference internal" href="#aiohttp.web.StreamResponse.content_length" title="aiohttp.web.StreamResponse.content_length"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content_length</span></code></a> and chunked
encoding is mutually exclusive.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#aiohttp.web.StreamResponse.chunked" title="aiohttp.web.StreamResponse.chunked"><code class="xref py py-attr docutils literal notranslate"><span class="pre">chunked</span></code></a></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.headers">
<code class="sig-name descname">headers</code><a class="headerlink" href="#aiohttp.web.StreamResponse.headers" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.CIMultiDict" title="(in multidict v4.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CIMultiDict</span></code></a> instance
for <em>outgoing</em> <em>HTTP headers</em>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.cookies">
<code class="sig-name descname">cookies</code><a class="headerlink" href="#aiohttp.web.StreamResponse.cookies" title="Permalink to this definition">¶</a></dt>
<dd><p>An instance of <a class="reference external" href="https://docs.python.org/3/library/http.cookies.html#http.cookies.SimpleCookie" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">http.cookies.SimpleCookie</span></code></a> for <em>outgoing</em> cookies.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Direct setting up <em>Set-Cookie</em> header may be overwritten by
explicit calls to cookie manipulation.</p>
<p>We are encourage using of <a class="reference internal" href="#aiohttp.web.StreamResponse.cookies" title="aiohttp.web.StreamResponse.cookies"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cookies</span></code></a> and
<a class="reference internal" href="#aiohttp.web.StreamResponse.set_cookie" title="aiohttp.web.StreamResponse.set_cookie"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_cookie()</span></code></a>, <a class="reference internal" href="#aiohttp.web.StreamResponse.del_cookie" title="aiohttp.web.StreamResponse.del_cookie"><code class="xref py py-meth docutils literal notranslate"><span class="pre">del_cookie()</span></code></a> for cookie
manipulations.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.set_cookie">
<code class="sig-name descname">set_cookie</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">value</em>, <em class="sig-param">*</em>, <em class="sig-param">path='/'</em>, <em class="sig-param">expires=None</em>, <em class="sig-param">domain=None</em>, <em class="sig-param">max_age=None</em>, <em class="sig-param">secure=None</em>, <em class="sig-param">httponly=None</em>, <em class="sig-param">version=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.StreamResponse.set_cookie" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenient way for setting <a class="reference internal" href="#aiohttp.web.StreamResponse.cookies" title="aiohttp.web.StreamResponse.cookies"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cookies</span></code></a>, allows to specify
some additional properties like <em>max_age</em> in a single call.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – cookie name</p></li>
<li><p><strong>value</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – cookie value (will be converted to
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> if value has another type).</p></li>
<li><p><strong>expires</strong> – expiration date (optional)</p></li>
<li><p><strong>domain</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – cookie domain (optional)</p></li>
<li><p><strong>max_age</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – defines the lifetime of the cookie, in
seconds.  The delta-seconds value is a
decimal non- negative integer.  After
delta-seconds seconds elapse, the client
should discard the cookie.  A value of zero
means the cookie should be discarded
immediately.  (optional)</p></li>
<li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – specifies the subset of URLs to
which this cookie applies. (optional, <code class="docutils literal notranslate"><span class="pre">'/'</span></code> by default)</p></li>
<li><p><strong>secure</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – attribute (with no value) directs
the user agent to use only (unspecified)
secure means to contact the origin server
whenever it sends back this cookie.
The user agent (possibly under the user’s
control) may determine what level of
security it considers appropriate for
“secure” cookies.  The <em>secure</em> should be
considered security advice from the server
to the user agent, indicating that it is in
the session’s interest to protect the cookie
contents. (optional)</p></li>
<li><p><strong>httponly</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <code class="docutils literal notranslate"><span class="pre">True</span></code> if the cookie HTTP only (optional)</p></li>
<li><p><strong>version</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – a decimal integer, identifies to which
version of the state management
specification the cookie
conforms. (Optional, <em>version=1</em> by default)</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In HTTP version 1.1, <code class="docutils literal notranslate"><span class="pre">expires</span></code> was deprecated and replaced with
the easier-to-use <code class="docutils literal notranslate"><span class="pre">max-age</span></code>, but Internet Explorer (IE6, IE7,
and IE8) <strong>does not</strong> support <code class="docutils literal notranslate"><span class="pre">max-age</span></code>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.del_cookie">
<code class="sig-name descname">del_cookie</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">*</em>, <em class="sig-param">path='/'</em>, <em class="sig-param">domain=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.StreamResponse.del_cookie" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes cookie.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – cookie name</p></li>
<li><p><strong>domain</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – optional cookie domain</p></li>
<li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – optional cookie path, <code class="docutils literal notranslate"><span class="pre">'/'</span></code> by default</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.content_length">
<code class="sig-name descname">content_length</code><a class="headerlink" href="#aiohttp.web.StreamResponse.content_length" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Content-Length</em> for outgoing response.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.content_type">
<code class="sig-name descname">content_type</code><a class="headerlink" href="#aiohttp.web.StreamResponse.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Content</em> part of <em>Content-Type</em> for outgoing response.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.charset">
<code class="sig-name descname">charset</code><a class="headerlink" href="#aiohttp.web.StreamResponse.charset" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Charset</em> aka <em>encoding</em> part of <em>Content-Type</em> for outgoing response.</p>
<p>The value converted to lower-case on attribute assigning.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.last_modified">
<code class="sig-name descname">last_modified</code><a class="headerlink" href="#aiohttp.web.StreamResponse.last_modified" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Last-Modified</em> header for outgoing response.</p>
<p>This property accepts raw <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> values,
<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a> objects, Unix timestamps specified
as an <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> or a <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> object, and the
value <code class="docutils literal notranslate"><span class="pre">None</span></code> to unset the header.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.prepare">
<em class="property">coroutine </em><code class="sig-name descname">prepare</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.StreamResponse.prepare" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>request</strong> (<a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><em>aiohttp.web.Request</em></a>) – HTTP request object, that the
response answers.</p>
</dd>
</dl>
<p>Send <em>HTTP header</em>. You should not change any header data after
calling this method.</p>
<p>The coroutine calls <a class="reference internal" href="#aiohttp.web.Application.on_response_prepare" title="aiohttp.web.Application.on_response_prepare"><code class="xref py py-attr docutils literal notranslate"><span class="pre">on_response_prepare</span></code></a>
signal handlers.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.write">
<em class="property">coroutine </em><code class="sig-name descname">write</code><span class="sig-paren">(</span><em class="sig-param">data</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.StreamResponse.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Send byte-ish data as the part of <em>response BODY</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#aiohttp.web.StreamResponse.prepare" title="aiohttp.web.StreamResponse.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare()</span></code></a> must be invoked before the call.</p>
<p>Raises <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a> if data is not <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>,
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#memoryview" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">memoryview</span></code></a> instance.</p>
<p>Raises <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> if <a class="reference internal" href="#aiohttp.web.StreamResponse.prepare" title="aiohttp.web.StreamResponse.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare()</span></code></a> has not been called.</p>
<p>Raises <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> if <a class="reference internal" href="#aiohttp.web.StreamResponse.write_eof" title="aiohttp.web.StreamResponse.write_eof"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write_eof()</span></code></a> has been called.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.write_eof">
<em class="property">coroutine </em><code class="sig-name descname">write_eof</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.StreamResponse.write_eof" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> <em>may</em> be called as a mark of the
<em>HTTP response</em> processing finish.</p>
<p><em>Internal machinery</em> will call this method at the end of
the request processing if needed.</p>
<p>After <a class="reference internal" href="#aiohttp.web.StreamResponse.write_eof" title="aiohttp.web.StreamResponse.write_eof"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write_eof()</span></code></a> call any manipulations with the <em>response</em>
object are forbidden.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="response">
<h6>Response<a class="headerlink" href="#response" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.web.Response">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">Response</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">body=None</em>, <em class="sig-param">status=200</em>, <em class="sig-param">reason=None</em>, <em class="sig-param">text=None</em>, <em class="sig-param">headers=None</em>, <em class="sig-param">content_type=None</em>, <em class="sig-param">charset=None</em>, <em class="sig-param">zlib_executor_size=sentinel</em>, <em class="sig-param">zlib_executor=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.Response" title="Permalink to this definition">¶</a></dt>
<dd><p>The most usable response class, inherited from <a class="reference internal" href="#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamResponse</span></code></a>.</p>
<p>Accepts <em>body</em> argument for setting the <em>HTTP response BODY</em>.</p>
<p>The actual <a class="reference internal" href="#aiohttp.web.Response.body" title="aiohttp.web.Response.body"><code class="xref py py-attr docutils literal notranslate"><span class="pre">body</span></code></a> sending happens in overridden
<a class="reference internal" href="#aiohttp.web.StreamResponse.write_eof" title="aiohttp.web.StreamResponse.write_eof"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write_eof()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>body</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – response’s BODY</p></li>
<li><p><strong>status</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – HTTP status code, 200 OK by default.</p></li>
<li><p><strong>headers</strong> (<a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping" title="(in Python v3.7)"><em>collections.abc.Mapping</em></a>) – HTTP headers that should be added to
response’s ones.</p></li>
<li><p><strong>text</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – response’s BODY</p></li>
<li><p><strong>content_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – response’s content type. <code class="docutils literal notranslate"><span class="pre">'text/plain'</span></code>
if <em>text</em> is passed also,
<code class="docutils literal notranslate"><span class="pre">'application/octet-stream'</span></code> otherwise.</p></li>
<li><p><strong>charset</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – response’s charset. <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code> if <em>text</em> is
passed also, <code class="docutils literal notranslate"><span class="pre">None</span></code> otherwise.</p></li>
<li><p><strong>zlib_executor_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <dl class="simple">
<dt>length in bytes which will trigger zlib compression</dt><dd><p>of body to happen in an executor</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.5.</span></p>
</div>
</p></li>
<li><p><strong>zlib_executor</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>executor to use for zlib compression</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.5.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.web.Response.body">
<code class="sig-name descname">body</code><a class="headerlink" href="#aiohttp.web.Response.body" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-write attribute for storing response’s content aka BODY,
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>.</p>
<p>Setting <a class="reference internal" href="#aiohttp.web.Response.body" title="aiohttp.web.Response.body"><code class="xref py py-attr docutils literal notranslate"><span class="pre">body</span></code></a> also recalculates
<a class="reference internal" href="#aiohttp.web.StreamResponse.content_length" title="aiohttp.web.StreamResponse.content_length"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content_length</span></code></a> value.</p>
<p>Assigning <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> to <a class="reference internal" href="#aiohttp.web.Response.body" title="aiohttp.web.Response.body"><code class="xref py py-attr docutils literal notranslate"><span class="pre">body</span></code></a> will make the <a class="reference internal" href="#aiohttp.web.Response.body" title="aiohttp.web.Response.body"><code class="xref py py-attr docutils literal notranslate"><span class="pre">body</span></code></a>
type of <code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.payload.StringPayload</span></code>, which tries to encode
the given data based on <em>Content-Type</em> HTTP header, while defaulting
to <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code>.</p>
<p>Resetting <a class="reference internal" href="#aiohttp.web.Response.body" title="aiohttp.web.Response.body"><code class="xref py py-attr docutils literal notranslate"><span class="pre">body</span></code></a> (assigning <code class="docutils literal notranslate"><span class="pre">None</span></code>) sets
<a class="reference internal" href="#aiohttp.web.StreamResponse.content_length" title="aiohttp.web.StreamResponse.content_length"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content_length</span></code></a> to <code class="docutils literal notranslate"><span class="pre">None</span></code> too, dropping
<em>Content-Length</em> HTTP header.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Response.text">
<code class="sig-name descname">text</code><a class="headerlink" href="#aiohttp.web.Response.text" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-write attribute for storing response’s content, represented as
string, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
<p>Setting <a class="reference internal" href="#aiohttp.web.Response.text" title="aiohttp.web.Response.text"><code class="xref py py-attr docutils literal notranslate"><span class="pre">text</span></code></a> also recalculates
<a class="reference internal" href="#aiohttp.web.StreamResponse.content_length" title="aiohttp.web.StreamResponse.content_length"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content_length</span></code></a> value and
<code class="xref py py-attr docutils literal notranslate"><span class="pre">body</span></code> value</p>
<p>Resetting <a class="reference internal" href="#aiohttp.web.Response.text" title="aiohttp.web.Response.text"><code class="xref py py-attr docutils literal notranslate"><span class="pre">text</span></code></a> (assigning <code class="docutils literal notranslate"><span class="pre">None</span></code>) sets
<a class="reference internal" href="#aiohttp.web.StreamResponse.content_length" title="aiohttp.web.StreamResponse.content_length"><code class="xref py py-attr docutils literal notranslate"><span class="pre">content_length</span></code></a> to <code class="docutils literal notranslate"><span class="pre">None</span></code> too, dropping
<em>Content-Length</em> HTTP header.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="websocketresponse">
<h6>WebSocketResponse<a class="headerlink" href="#websocketresponse" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.web.WebSocketResponse">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">WebSocketResponse</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">timeout=10.0</em>, <em class="sig-param">receive_timeout=None</em>, <em class="sig-param">autoclose=True</em>, <em class="sig-param">autoping=True</em>, <em class="sig-param">heartbeat=None</em>, <em class="sig-param">protocols=()</em>, <em class="sig-param">compress=True</em>, <em class="sig-param">max_msg_size=4194304</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse" title="Permalink to this definition">¶</a></dt>
<dd><p>Class for handling server-side websockets, inherited from
<a class="reference internal" href="#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamResponse</span></code></a>.</p>
<p>After starting (by <a class="reference internal" href="#aiohttp.web.WebSocketResponse.prepare" title="aiohttp.web.WebSocketResponse.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare()</span></code></a> call) the response you
cannot use <a class="reference internal" href="#aiohttp.web.StreamResponse.write" title="aiohttp.web.StreamResponse.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write()</span></code></a> method but should to
communicate with websocket client by <a class="reference internal" href="#aiohttp.web.WebSocketResponse.send_str" title="aiohttp.web.WebSocketResponse.send_str"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_str()</span></code></a>,
<a class="reference internal" href="#aiohttp.web.WebSocketResponse.receive" title="aiohttp.web.WebSocketResponse.receive"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive()</span></code></a> and others.</p>
<p>To enable back-pressure from slow websocket clients treat methods
<a class="reference internal" href="#aiohttp.web.WebSocketResponse.ping" title="aiohttp.web.WebSocketResponse.ping"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ping()</span></code></a>, <a class="reference internal" href="#aiohttp.web.WebSocketResponse.pong" title="aiohttp.web.WebSocketResponse.pong"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pong()</span></code></a>, <a class="reference internal" href="#aiohttp.web.WebSocketResponse.send_str" title="aiohttp.web.WebSocketResponse.send_str"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_str()</span></code></a>,
<a class="reference internal" href="#aiohttp.web.WebSocketResponse.send_bytes" title="aiohttp.web.WebSocketResponse.send_bytes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_bytes()</span></code></a>, <a class="reference internal" href="#aiohttp.web.WebSocketResponse.send_json" title="aiohttp.web.WebSocketResponse.send_json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_json()</span></code></a> as coroutines.  By
default write buffer size is set to 64k.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>autoping</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Automatically send
<a class="reference internal" href="index.html#aiohttp.WSMsgType.PONG" title="aiohttp.WSMsgType.PONG"><code class="xref py py-const docutils literal notranslate"><span class="pre">PONG</span></code></a> on
<a class="reference internal" href="index.html#aiohttp.WSMsgType.PING" title="aiohttp.WSMsgType.PING"><code class="xref py py-const docutils literal notranslate"><span class="pre">PING</span></code></a>
message from client, and handle
<a class="reference internal" href="index.html#aiohttp.WSMsgType.PONG" title="aiohttp.WSMsgType.PONG"><code class="xref py py-const docutils literal notranslate"><span class="pre">PONG</span></code></a>
responses from client.
Note that server does not send
<a class="reference internal" href="index.html#aiohttp.WSMsgType.PING" title="aiohttp.WSMsgType.PING"><code class="xref py py-const docutils literal notranslate"><span class="pre">PING</span></code></a>
requests, you need to do this explicitly
using <a class="reference internal" href="#aiohttp.web.WebSocketResponse.ping" title="aiohttp.web.WebSocketResponse.ping"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ping()</span></code></a> method.</p></li>
<li><p><strong>heartbeat</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Send <cite>ping</cite> message every <cite>heartbeat</cite>
seconds and wait <cite>pong</cite> response, close
connection if <cite>pong</cite> response is not
received. The timer is reset on any data reception.</p></li>
<li><p><strong>receive_timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Timeout value for <cite>receive</cite>
operations.  Default value is None
(no timeout for receive operation)</p></li>
<li><p><strong>compress</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Enable per-message deflate extension support.
False for disabled, default value is True.</p></li>
<li><p><strong>max_msg_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <dl class="simple">
<dt>maximum size of read websocket message, 4</dt><dd><p>MB by default. To disable the size limit use <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.3.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<p>The class supports <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">for</span></code> statement for iterating over
incoming messages:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">WebSocketResponse</span><span class="p">()</span>
<span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.prepare">
<em class="property">coroutine </em><code class="sig-name descname">prepare</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.prepare" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts websocket. After the call you can use websocket methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>request</strong> (<a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><em>aiohttp.web.Request</em></a>) – HTTP request object, that the
response answers.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="index.html#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><strong>HTTPException</strong></a> – if websocket handshake has failed.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.can_prepare">
<code class="sig-name descname">can_prepare</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.can_prepare" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs checks for <em>request</em> data to figure out if websocket
can be started on the request.</p>
<p>If <a class="reference internal" href="#aiohttp.web.WebSocketResponse.can_prepare" title="aiohttp.web.WebSocketResponse.can_prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">can_prepare()</span></code></a> call is success then <a class="reference internal" href="#aiohttp.web.WebSocketResponse.prepare" title="aiohttp.web.WebSocketResponse.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prepare()</span></code></a> will
success too.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>request</strong> (<a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><em>aiohttp.web.Request</em></a>) – HTTP request object, that the
response answers.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p><a class="reference internal" href="#aiohttp.web.WebSocketReady" title="aiohttp.web.WebSocketReady"><code class="xref py py-class docutils literal notranslate"><span class="pre">WebSocketReady</span></code></a> instance.</p>
<p><a class="reference internal" href="#aiohttp.web.WebSocketReady.ok" title="aiohttp.web.WebSocketReady.ok"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WebSocketReady.ok</span></code></a> is
<code class="docutils literal notranslate"><span class="pre">True</span></code> on success, <a class="reference internal" href="#aiohttp.web.WebSocketReady.protocol" title="aiohttp.web.WebSocketReady.protocol"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WebSocketReady.protocol</span></code></a> is
websocket subprotocol which is passed by client and
accepted by server (one of <em>protocols</em> sequence from
<a class="reference internal" href="#aiohttp.web.WebSocketResponse" title="aiohttp.web.WebSocketResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">WebSocketResponse</span></code></a> ctor).
<a class="reference internal" href="#aiohttp.web.WebSocketReady.protocol" title="aiohttp.web.WebSocketReady.protocol"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WebSocketReady.protocol</span></code></a> may be <code class="docutils literal notranslate"><span class="pre">None</span></code> if
client and server subprotocols are not overlapping.</p>
</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method never raises exception.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.WebSocketResponse.closed">
<code class="sig-name descname">closed</code><a class="headerlink" href="#aiohttp.web.WebSocketResponse.closed" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property, <code class="docutils literal notranslate"><span class="pre">True</span></code> if connection has been closed or in process
of closing.
<a class="reference internal" href="index.html#aiohttp.WSMsgType.CLOSE" title="aiohttp.WSMsgType.CLOSE"><code class="xref py py-const docutils literal notranslate"><span class="pre">CLOSE</span></code></a> message has been received from peer.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.WebSocketResponse.close_code">
<code class="sig-name descname">close_code</code><a class="headerlink" href="#aiohttp.web.WebSocketResponse.close_code" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property, close code from peer. It is set to <code class="docutils literal notranslate"><span class="pre">None</span></code> on
opened connection.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.WebSocketResponse.ws_protocol">
<code class="sig-name descname">ws_protocol</code><a class="headerlink" href="#aiohttp.web.WebSocketResponse.ws_protocol" title="Permalink to this definition">¶</a></dt>
<dd><p>Websocket <em>subprotocol</em> chosen after <code class="xref py py-meth docutils literal notranslate"><span class="pre">start()</span></code> call.</p>
<p>May be <code class="docutils literal notranslate"><span class="pre">None</span></code> if server and client protocols are
not overlapping.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.exception">
<code class="sig-name descname">exception</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns last occurred exception or None.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.ping">
<em class="property">coroutine </em><code class="sig-name descname">ping</code><span class="sig-paren">(</span><em class="sig-param">message=b''</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.ping" title="Permalink to this definition">¶</a></dt>
<dd><p>Send <a class="reference internal" href="index.html#aiohttp.WSMsgType.PING" title="aiohttp.WSMsgType.PING"><code class="xref py py-const docutils literal notranslate"><span class="pre">PING</span></code></a> to peer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>message</strong> – optional payload of <em>ping</em> message,
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> (converted to <em>UTF-8</em> encoded bytes)
or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><strong>RuntimeError</strong></a> – if connections is not started or closing.</p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The method is converted into <a class="reference external" href="https://docs.python.org/3/glossary.html#term-coroutine" title="(in Python v3.7)"><span class="xref std std-term">coroutine</span></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.pong">
<em class="property">coroutine </em><code class="sig-name descname">pong</code><span class="sig-paren">(</span><em class="sig-param">message=b''</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.pong" title="Permalink to this definition">¶</a></dt>
<dd><p>Send <em>unsolicited</em> <a class="reference internal" href="index.html#aiohttp.WSMsgType.PONG" title="aiohttp.WSMsgType.PONG"><code class="xref py py-const docutils literal notranslate"><span class="pre">PONG</span></code></a> to peer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>message</strong> – optional payload of <em>pong</em> message,
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> (converted to <em>UTF-8</em> encoded bytes)
or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><strong>RuntimeError</strong></a> – if connections is not started or closing.</p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The method is converted into <a class="reference external" href="https://docs.python.org/3/glossary.html#term-coroutine" title="(in Python v3.7)"><span class="xref std std-term">coroutine</span></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.send_str">
<em class="property">coroutine </em><code class="sig-name descname">send_str</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">compress=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.send_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Send <em>data</em> to peer as <a class="reference internal" href="index.html#aiohttp.WSMsgType.TEXT" title="aiohttp.WSMsgType.TEXT"><code class="xref py py-const docutils literal notranslate"><span class="pre">TEXT</span></code></a> message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – data to send.</p></li>
<li><p><strong>compress</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – sets specific level of compression for
single message,
<code class="docutils literal notranslate"><span class="pre">None</span></code> for not overriding per-socket setting.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><strong>RuntimeError</strong></a> – if connection is not started or closing</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if data is not <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></p></li>
</ul>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The method is converted into <a class="reference external" href="https://docs.python.org/3/glossary.html#term-coroutine" title="(in Python v3.7)"><span class="xref std std-term">coroutine</span></a>,
<em>compress</em> parameter added.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.send_bytes">
<em class="property">coroutine </em><code class="sig-name descname">send_bytes</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">compress=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.send_bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>Send <em>data</em> to peer as <a class="reference internal" href="index.html#aiohttp.WSMsgType.BINARY" title="aiohttp.WSMsgType.BINARY"><code class="xref py py-const docutils literal notranslate"><span class="pre">BINARY</span></code></a> message.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – data to send.</p></li>
<li><p><strong>compress</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – sets specific level of compression for
single message,
<code class="docutils literal notranslate"><span class="pre">None</span></code> for not overriding per-socket setting.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><strong>RuntimeError</strong></a> – if connection is not started or closing</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if data is not <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>,
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#memoryview" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">memoryview</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The method is converted into <a class="reference external" href="https://docs.python.org/3/glossary.html#term-coroutine" title="(in Python v3.7)"><span class="xref std std-term">coroutine</span></a>,
<em>compress</em> parameter added.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.send_json">
<em class="property">coroutine </em><code class="sig-name descname">send_json</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">compress=None</em>, <em class="sig-param">*</em>, <em class="sig-param">dumps=json.dumps</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.send_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Send <em>data</em> to peer as JSON string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – data to send.</p></li>
<li><p><strong>compress</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – sets specific level of compression for
single message,
<code class="docutils literal notranslate"><span class="pre">None</span></code> for not overriding per-socket setting.</p></li>
<li><p><strong>dumps</strong> (<em>callable</em>) – any <a class="reference internal" href="index.html#term-callable"><span class="xref std std-term">callable</span></a> that accepts an object and
returns a JSON string
(<a class="reference external" href="https://docs.python.org/3/library/json.html#json.dumps" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">json.dumps()</span></code></a> by default).</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><strong>RuntimeError</strong></a> – if connection is not started or closing</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if data is not serializable object</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if value returned by <code class="docutils literal notranslate"><span class="pre">dumps</span></code> param is not <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></p></li>
</ul>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The method is converted into <a class="reference external" href="https://docs.python.org/3/glossary.html#term-coroutine" title="(in Python v3.7)"><span class="xref std std-term">coroutine</span></a>,
<em>compress</em> parameter added.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.close">
<em class="property">coroutine </em><code class="sig-name descname">close</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">code=1000</em>, <em class="sig-param">message=b''</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.close" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that initiates closing
handshake by sending <a class="reference internal" href="index.html#aiohttp.WSMsgType.CLOSE" title="aiohttp.WSMsgType.CLOSE"><code class="xref py py-const docutils literal notranslate"><span class="pre">CLOSE</span></code></a> message.</p>
<p>It is safe to call <cite>close()</cite> from different task.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>code</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – closing code</p></li>
<li><p><strong>message</strong> – optional payload of <em>pong</em> message,
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> (converted to <em>UTF-8</em> encoded bytes)
or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><strong>RuntimeError</strong></a> – if connection is not started</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.receive">
<em class="property">coroutine </em><code class="sig-name descname">receive</code><span class="sig-paren">(</span><em class="sig-param">timeout=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.receive" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that waits upcoming <em>data</em>
message from peer and returns it.</p>
<p>The coroutine implicitly handles
<a class="reference internal" href="index.html#aiohttp.WSMsgType.PING" title="aiohttp.WSMsgType.PING"><code class="xref py py-const docutils literal notranslate"><span class="pre">PING</span></code></a>,
<a class="reference internal" href="index.html#aiohttp.WSMsgType.PONG" title="aiohttp.WSMsgType.PONG"><code class="xref py py-const docutils literal notranslate"><span class="pre">PONG</span></code></a> and
<a class="reference internal" href="index.html#aiohttp.WSMsgType.CLOSE" title="aiohttp.WSMsgType.CLOSE"><code class="xref py py-const docutils literal notranslate"><span class="pre">CLOSE</span></code></a> without returning the
message.</p>
<p>It process <em>ping-pong game</em> and performs <em>closing handshake</em> internally.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Can only be called by the request handling task.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>timeout</strong> – <p>timeout for <cite>receive</cite> operation.</p>
<p>timeout value overrides response`s receive_timeout attribute.</p>
</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><a class="reference internal" href="index.html#aiohttp.WSMessage" title="aiohttp.WSMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">WSMessage</span></code></a></p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><strong>RuntimeError</strong></a> – if connection is not started</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.receive_str">
<em class="property">coroutine </em><code class="sig-name descname">receive_str</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">timeout=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.receive_str" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that calls <a class="reference internal" href="#aiohttp.web.WebSocketResponse.receive" title="aiohttp.web.WebSocketResponse.receive"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive()</span></code></a> but
also asserts the message type is <a class="reference internal" href="index.html#aiohttp.WSMsgType.TEXT" title="aiohttp.WSMsgType.TEXT"><code class="xref py py-const docutils literal notranslate"><span class="pre">TEXT</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Can only be called by the request handling task.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>timeout</strong> – <p>timeout for <cite>receive</cite> operation.</p>
<p>timeout value overrides response`s receive_timeout attribute.</p>
</p>
</dd>
<dt class="field-even">Return str</dt>
<dd class="field-even"><p>peer’s message content.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if message is <a class="reference internal" href="index.html#aiohttp.WSMsgType.BINARY" title="aiohttp.WSMsgType.BINARY"><code class="xref py py-const docutils literal notranslate"><span class="pre">BINARY</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.receive_bytes">
<em class="property">coroutine </em><code class="sig-name descname">receive_bytes</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">timeout=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.receive_bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that calls <a class="reference internal" href="#aiohttp.web.WebSocketResponse.receive" title="aiohttp.web.WebSocketResponse.receive"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive()</span></code></a> but
also asserts the message type is
<a class="reference internal" href="index.html#aiohttp.WSMsgType.BINARY" title="aiohttp.WSMsgType.BINARY"><code class="xref py py-const docutils literal notranslate"><span class="pre">BINARY</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Can only be called by the request handling task.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>timeout</strong> – <p>timeout for <cite>receive</cite> operation.</p>
<p>timeout value overrides response`s receive_timeout attribute.</p>
</p>
</dd>
<dt class="field-even">Return bytes</dt>
<dd class="field-even"><p>peer’s message content.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if message is <a class="reference internal" href="index.html#aiohttp.WSMsgType.TEXT" title="aiohttp.WSMsgType.TEXT"><code class="xref py py-const docutils literal notranslate"><span class="pre">TEXT</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.WebSocketResponse.receive_json">
<em class="property">coroutine </em><code class="sig-name descname">receive_json</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">loads=json.loads</em>, <em class="sig-param">timeout=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.WebSocketResponse.receive_json" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that calls <a class="reference internal" href="#aiohttp.web.WebSocketResponse.receive_str" title="aiohttp.web.WebSocketResponse.receive_str"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive_str()</span></code></a> and loads the
JSON string to a Python dict.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Can only be called by the request handling task.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loads</strong> (<em>callable</em>) – any <a class="reference internal" href="index.html#term-callable"><span class="xref std std-term">callable</span></a> that accepts
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> and returns <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>
with parsed JSON (<a class="reference external" href="https://docs.python.org/3/library/json.html#json.loads" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">json.loads()</span></code></a> by
default).</p></li>
<li><p><strong>timeout</strong> – <p>timeout for <cite>receive</cite> operation.</p>
<p>timeout value overrides response`s receive_timeout attribute.</p>
</p></li>
</ul>
</dd>
<dt class="field-even">Return dict</dt>
<dd class="field-even"><p>loaded JSON content</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if message is <a class="reference internal" href="index.html#aiohttp.WSMsgType.BINARY" title="aiohttp.WSMsgType.BINARY"><code class="xref py py-const docutils literal notranslate"><span class="pre">BINARY</span></code></a>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if message is not valid JSON.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-websockets"><span class="std std-ref">WebSockets handling</span></a></p>
</div>
</div>
<div class="section" id="websocketready">
<h6>WebSocketReady<a class="headerlink" href="#websocketready" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.web.WebSocketReady">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">WebSocketReady</code><a class="headerlink" href="#aiohttp.web.WebSocketReady" title="Permalink to this definition">¶</a></dt>
<dd><p>A named tuple for returning result from
<a class="reference internal" href="#aiohttp.web.WebSocketResponse.can_prepare" title="aiohttp.web.WebSocketResponse.can_prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WebSocketResponse.can_prepare()</span></code></a>.</p>
<p>Has <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> check implemented, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">can_prepare</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="n">cannot_start_websocket</span><span class="p">()</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="aiohttp.web.WebSocketReady.ok">
<code class="sig-name descname">ok</code><a class="headerlink" href="#aiohttp.web.WebSocketReady.ok" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if websocket connection can be established, <code class="docutils literal notranslate"><span class="pre">False</span></code>
otherwise.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.WebSocketReady.protocol">
<code class="sig-name descname">protocol</code><a class="headerlink" href="#aiohttp.web.WebSocketReady.protocol" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> represented selected websocket sub-protocol.</p>
</dd></dl>

<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#aiohttp.web.WebSocketResponse.can_prepare" title="aiohttp.web.WebSocketResponse.can_prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">WebSocketResponse.can_prepare()</span></code></a></p>
</div>
</dd></dl>

</div>
<div class="section" id="json-response">
<h6>json_response<a class="headerlink" href="#json-response" title="Permalink to this headline">¶</a></h6>
<dl class="function">
<dt id="aiohttp.web.json_response">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">json_response</code><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param">data</em>, <span class="optional">]</span><em class="sig-param">*</em>, <em class="sig-param">text=None</em>, <em class="sig-param">body=None</em>, <em class="sig-param">status=200</em>, <em class="sig-param">reason=None</em>, <em class="sig-param">headers=None</em>, <em class="sig-param">content_type='application/json'</em>, <em class="sig-param">dumps=json.dumps</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.json_response" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Return <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> with predefined <code class="docutils literal notranslate"><span class="pre">'application/json'</span></code>
content type and <em>data</em> encoded by <code class="docutils literal notranslate"><span class="pre">dumps</span></code> parameter
(<a class="reference external" href="https://docs.python.org/3/library/json.html#json.dumps" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">json.dumps()</span></code></a> by default).</p>
</div>
<div class="section" id="http-exceptions">
<h6>HTTP Exceptions<a class="headerlink" href="#http-exceptions" title="Permalink to this headline">¶</a></h6>
<p>Errors can also be returned by raising a HTTP exception instance from within
the handler.</p>
<dl class="class">
<dt id="aiohttp.web.HTTPException">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">HTTPException</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">headers=None</em>, <em class="sig-param">reason=None</em>, <em class="sig-param">text=None</em>, <em class="sig-param">content_type=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.HTTPException" title="Permalink to this definition">¶</a></dt>
<dd><p>Low-level HTTP failure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>headers</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a><em> or </em><a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.CIMultiDict" title="(in multidict v4.5)"><em>multidict.CIMultiDict</em></a>) – headers for the response</p></li>
<li><p><strong>reason</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – reason included in the response</p></li>
<li><p><strong>text</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – response’s body</p></li>
<li><p><strong>content_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – response’s content type.  This is passed through
to the <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> initializer.</p></li>
</ul>
</dd>
</dl>
<p>Sub-classes of <code class="docutils literal notranslate"><span class="pre">HTTPException</span></code> exist for the standard HTTP response codes
as described in <a class="reference internal" href="index.html#aiohttp-web-exceptions"><span class="std std-ref">Exceptions</span></a> and the expected usage is to
simply raise the appropriate exception type to respond with a specific HTTP
response code.</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">HTTPException</span></code> is a sub-class of <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a>, it contains the
methods and properties that allow you to directly manipulate details of the
response.</p>
<dl class="attribute">
<dt id="aiohttp.web.HTTPException.status_code">
<code class="sig-name descname">status_code</code><a class="headerlink" href="#aiohttp.web.HTTPException.status_code" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP status code for this exception class.  This attribute is usually
defined at the class level.  <code class="docutils literal notranslate"><span class="pre">self.status_code</span></code> is passed to the
<a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> initializer.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="application-and-router">
<span id="aiohttp-web-app-and-router"></span><h5>Application and Router<a class="headerlink" href="#application-and-router" title="Permalink to this headline">¶</a></h5>
<div class="section" id="application">
<h6>Application<a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h6>
<p>Application is a synonym for web-server.</p>
<p>To get fully working example, you have to make <em>application</em>, register
supported urls in <em>router</em> and pass it to <a class="reference internal" href="#aiohttp.web.run_app" title="aiohttp.web.run_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp.web.run_app()</span></code></a>
or <a class="reference internal" href="#aiohttp.web.AppRunner" title="aiohttp.web.AppRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.AppRunner</span></code></a>.</p>
<p><em>Application</em> contains a <em>router</em> instance and a list of callbacks that
will be called during application finishing.</p>
<p><a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a>-like object, so you can use it for
<a class="reference internal" href="index.html#aiohttp-web-data-sharing"><span class="std std-ref">sharing data</span></a> globally by storing arbitrary
properties for later access from a <a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">handler</span></a> via the
<a class="reference internal" href="#aiohttp.web.Request.app" title="aiohttp.web.Request.app"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Request.app</span></code></a> property:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aiopg</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span><span class="o">**</span><span class="n">db_config</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">with</span> <span class="p">(</span><span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE * FROM table&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Although <a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a>-like object, it can’t be
duplicated like one using <code class="xref py py-meth docutils literal notranslate"><span class="pre">Application.copy()</span></code>.</p>
<dl class="class">
<dt id="aiohttp.web.Application">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">Application</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">logger=&lt;default&gt;</em>, <em class="sig-param">router=None</em>, <em class="sig-param">middlewares=()</em>, <em class="sig-param">handler_args=None</em>, <em class="sig-param">client_max_size=1024**2</em>, <em class="sig-param">loop=None</em>, <em class="sig-param">debug=...</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.Application" title="Permalink to this definition">¶</a></dt>
<dd><p>The class inherits <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logger</strong> – <p><a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Logger</span></code></a> instance for storing application logs.</p>
<p>By default the value is <code class="docutils literal notranslate"><span class="pre">logging.getLogger(&quot;aiohttp.web&quot;)</span></code></p>
</p></li>
<li><p><strong>router</strong> – <dl class="simple">
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.abc.AbstractRouter</span></code> instance, the system</dt><dd><p>creates <a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlDispatcher</span></code></a> by default if
<em>router</em> is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd>
</dl>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.3: </span>The custom routers support is deprecated, the parameter will
be removed in 4.0.</p>
</div>
</p></li>
<li><p><strong>middlewares</strong> – <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of middleware factories, see
<a class="reference internal" href="index.html#aiohttp-web-middlewares"><span class="std std-ref">Middlewares</span></a> for details.</p></li>
<li><p><strong>handler_args</strong> – dict-like object that overrides keyword arguments of
<a class="reference internal" href="#aiohttp.web.Application.make_handler" title="aiohttp.web.Application.make_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Application.make_handler()</span></code></a></p></li>
<li><p><strong>client_max_size</strong> – client’s maximum size in a request, in
bytes.  If a POST request exceeds this
value, it raises an
<cite>HTTPRequestEntityTooLarge</cite> exception.</p></li>
<li><p><strong>loop</strong> – <p>event loop</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 2.0: </span>The parameter is deprecated. Loop is get set during freeze
stage.</p>
</div>
</p></li>
<li><p><strong>debug</strong> – <p>Switches debug mode.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.5: </span>Use asyncio <a class="reference external" href="https://docs.python.org/3/library/asyncio-dev.html#asyncio-debug-mode" title="(in Python v3.7)"><span>Debug Mode</span></a> instead.</p>
</div>
</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.web.Application.router">
<code class="sig-name descname">router</code><a class="headerlink" href="#aiohttp.web.Application.router" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property that returns <em>router instance</em>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Application.logger">
<code class="sig-name descname">logger</code><a class="headerlink" href="#aiohttp.web.Application.logger" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Logger</span></code></a> instance for storing application logs.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Application.loop">
<code class="sig-name descname">loop</code><a class="headerlink" href="#aiohttp.web.Application.loop" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio-event-loop" title="(in Python v3.7)"><span class="xref std std-ref">event loop</span></a> used for processing HTTP requests.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.5.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Application.debug">
<code class="sig-name descname">debug</code><a class="headerlink" href="#aiohttp.web.Application.debug" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean value indicating whether the debug mode is turned on or off.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.5: </span>Use asyncio <a class="reference external" href="https://docs.python.org/3/library/asyncio-dev.html#asyncio-debug-mode" title="(in Python v3.7)"><span>Debug Mode</span></a> instead.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Application.on_response_prepare">
<code class="sig-name descname">on_response_prepare</code><a class="headerlink" href="#aiohttp.web.Application.on_response_prepare" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="index.html#aiohttp.Signal" title="aiohttp.Signal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code></a> that is fired at the beginning
of <a class="reference internal" href="#aiohttp.web.StreamResponse.prepare" title="aiohttp.web.StreamResponse.prepare"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StreamResponse.prepare()</span></code></a> with parameters <em>request</em> and
<em>response</em>. It can be used, for example, to add custom headers to each
response before sending.</p>
<p>Signal handlers should have the following signature:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">on_prepare</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Application.on_startup">
<code class="sig-name descname">on_startup</code><a class="headerlink" href="#aiohttp.web.Application.on_startup" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="index.html#aiohttp.Signal" title="aiohttp.Signal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code></a> that is fired on application start-up.</p>
<p>Subscribers may use the signal to run background tasks in the event
loop along with the application’s request handler just after the
application start-up.</p>
<p>Signal handlers should have the following signature:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">on_startup</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-signals"><span class="std std-ref">Signals</span></a>.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Application.on_shutdown">
<code class="sig-name descname">on_shutdown</code><a class="headerlink" href="#aiohttp.web.Application.on_shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="index.html#aiohttp.Signal" title="aiohttp.Signal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code></a> that is fired on application shutdown.</p>
<p>Subscribers may use the signal for gracefully closing long running
connections, e.g. websockets and data streaming.</p>
<p>Signal handlers should have the following signature:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">on_shutdown</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>It’s up to end user to figure out which <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a>s
are still alive and how to finish them properly.</p>
<p>We suggest keeping a list of long running handlers in
<a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> dictionary.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-graceful-shutdown"><span class="std std-ref">Graceful shutdown</span></a> and <a class="reference internal" href="#aiohttp.web.Application.on_cleanup" title="aiohttp.web.Application.on_cleanup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">on_cleanup</span></code></a>.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Application.on_cleanup">
<code class="sig-name descname">on_cleanup</code><a class="headerlink" href="#aiohttp.web.Application.on_cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="index.html#aiohttp.Signal" title="aiohttp.Signal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Signal</span></code></a> that is fired on application cleanup.</p>
<p>Subscribers may use the signal for gracefully closing
connections to database server etc.</p>
<p>Signal handlers should have the following signature:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">on_cleanup</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-signals"><span class="std std-ref">Signals</span></a> and <a class="reference internal" href="#aiohttp.web.Application.on_shutdown" title="aiohttp.web.Application.on_shutdown"><code class="xref py py-attr docutils literal notranslate"><span class="pre">on_shutdown</span></code></a>.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Application.cleanup_ctx">
<code class="sig-name descname">cleanup_ctx</code><a class="headerlink" href="#aiohttp.web.Application.cleanup_ctx" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of <em>context generators</em> for <em>startup</em>/<em>cleanup</em> handling.</p>
<p>Signal handlers should have the following signature:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">context</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="c1"># do startup stuff</span>
    <span class="k">yield</span>
    <span class="c1"># do cleanup</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-cleanup-ctx"><span class="std std-ref">Cleanup Context</span></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Application.add_subapp">
<code class="sig-name descname">add_subapp</code><span class="sig-paren">(</span><em class="sig-param">prefix</em>, <em class="sig-param">subapp</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.Application.add_subapp" title="Permalink to this definition">¶</a></dt>
<dd><p>Register nested sub-application under given path <em>prefix</em>.</p>
<p>In resolving process if request’s path starts with <em>prefix</em> then
further resolving is passed to <em>subapp</em>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prefix</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – path’s prefix for the resource.</p></li>
<li><p><strong>subapp</strong> (<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><em>Application</em></a>) – nested application attached under <em>prefix</em>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a <a class="reference internal" href="#aiohttp.web.PrefixedSubAppResource" title="aiohttp.web.PrefixedSubAppResource"><code class="xref py py-class docutils literal notranslate"><span class="pre">PrefixedSubAppResource</span></code></a> instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Application.add_domain">
<code class="sig-name descname">add_domain</code><span class="sig-paren">(</span><em class="sig-param">domain</em>, <em class="sig-param">subapp</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.Application.add_domain" title="Permalink to this definition">¶</a></dt>
<dd><p>Register nested sub-application that serves
the domain name or domain name mask.</p>
<p>In resolving process if request.headers[‘host’]
matches the pattern <em>domain</em> then
further resolving is passed to <em>subapp</em>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>domain</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – domain or mask of domain for the resource.</p></li>
<li><p><strong>subapp</strong> (<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><em>Application</em></a>) – nested application.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">MatchedSubAppResource</span></code> instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Application.add_routes">
<code class="sig-name descname">add_routes</code><span class="sig-paren">(</span><em class="sig-param">routes_table</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.Application.add_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Register route definitions from <em>routes_table</em>.</p>
<p>The table is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> items or
<a class="reference internal" href="#aiohttp.web.RouteTableDef" title="aiohttp.web.RouteTableDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteTableDef</span></code></a>.</p>
<p>The method is a shortcut for
<code class="docutils literal notranslate"><span class="pre">app.router.add_routes(routes_table)</span></code>, see also
<a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_routes" title="aiohttp.web.UrlDispatcher.add_routes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_routes()</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Application.make_handler">
<code class="sig-name descname">make_handler</code><span class="sig-paren">(</span><em class="sig-param">loop=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.Application.make_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates HTTP protocol factory for handling requests.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loop</strong> – <p><a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio-event-loop" title="(in Python v3.7)"><span class="xref std std-ref">event loop</span></a> used
for processing HTTP requests.</p>
<p>If param is <code class="docutils literal notranslate"><span class="pre">None</span></code> <a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.get_event_loop" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.get_event_loop()</span></code></a>
used for getting default event loop.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 2.0.</span></p>
</div>
</p></li>
<li><p><strong>tcp_keepalive</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Enable TCP Keep-Alive. Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><strong>keepalive_timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Number of seconds before closing Keep-Alive
connection. Default: <code class="docutils literal notranslate"><span class="pre">75</span></code> seconds (NGINX’s default value).</p></li>
<li><p><strong>logger</strong> – Custom logger object. Default:
<code class="xref py py-data docutils literal notranslate"><span class="pre">aiohttp.log.server_logger</span></code>.</p></li>
<li><p><strong>access_log</strong> – Custom logging object. Default:
<code class="xref py py-data docutils literal notranslate"><span class="pre">aiohttp.log.access_logger</span></code>.</p></li>
<li><p><strong>access_log_class</strong> – Class for <cite>access_logger</cite>. Default:
<code class="xref py py-data docutils literal notranslate"><span class="pre">aiohttp.helpers.AccessLogger</span></code>.
Must to be a subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.abc.AbstractAccessLogger</span></code>.</p></li>
<li><p><strong>access_log_format</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Access log format string. Default:
<code class="xref py py-attr docutils literal notranslate"><span class="pre">helpers.AccessLogger.LOG_FORMAT</span></code>.</p></li>
<li><p><strong>max_line_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Optional maximum header line size. Default:
<code class="docutils literal notranslate"><span class="pre">8190</span></code>.</p></li>
<li><p><strong>max_headers</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Optional maximum header size. Default: <code class="docutils literal notranslate"><span class="pre">32768</span></code>.</p></li>
<li><p><strong>max_field_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – Optional maximum header field size. Default:
<code class="docutils literal notranslate"><span class="pre">8190</span></code>.</p></li>
<li><p><strong>lingering_time</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Maximum time during which the server
reads and ignores additional data coming from the client when
lingering close is on.  Use <code class="docutils literal notranslate"><span class="pre">0</span></code> to disable lingering on
server channel closing.</p></li>
</ul>
</dd>
</dl>
<p>You should pass result of the method as <em>protocol_factory</em> to
<code class="xref py py-meth docutils literal notranslate"><span class="pre">create_server()</span></code>, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>

<span class="c1"># setup route table</span>
<span class="c1"># app.router.add_route(...)</span>

<span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">create_server</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">make_handler</span><span class="p">(),</span>
                         <span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>
</pre></div>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.2: </span>The method is deprecated and will be removed in future
aiohttp versions.  Please use <a class="reference internal" href="index.html#aiohttp-web-app-runners"><span class="std std-ref">Application runners</span></a> instead.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Application.startup">
<em class="property">coroutine </em><code class="sig-name descname">startup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.Application.startup" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that will be called along with the
application’s request handler.</p>
<p>The purpose of the method is calling <a class="reference internal" href="#aiohttp.web.Application.on_startup" title="aiohttp.web.Application.on_startup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">on_startup</span></code></a> signal
handlers.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Application.shutdown">
<em class="property">coroutine </em><code class="sig-name descname">shutdown</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.Application.shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that should be called on
server stopping but before <a class="reference internal" href="#aiohttp.web.Application.cleanup" title="aiohttp.web.Application.cleanup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cleanup()</span></code></a>.</p>
<p>The purpose of the method is calling <a class="reference internal" href="#aiohttp.web.Application.on_shutdown" title="aiohttp.web.Application.on_shutdown"><code class="xref py py-attr docutils literal notranslate"><span class="pre">on_shutdown</span></code></a> signal
handlers.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Application.cleanup">
<em class="property">coroutine </em><code class="sig-name descname">cleanup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.Application.cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that should be called on
server stopping but after <a class="reference internal" href="#aiohttp.web.Application.shutdown" title="aiohttp.web.Application.shutdown"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shutdown()</span></code></a>.</p>
<p>The purpose of the method is calling <a class="reference internal" href="#aiohttp.web.Application.on_cleanup" title="aiohttp.web.Application.on_cleanup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">on_cleanup</span></code></a> signal
handlers.</p>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Application object has <a class="reference internal" href="#aiohttp.web.Application.router" title="aiohttp.web.Application.router"><code class="xref py py-attr docutils literal notranslate"><span class="pre">router</span></code></a> attribute but has no
<code class="docutils literal notranslate"><span class="pre">add_route()</span></code> method. The reason is: we want to support
different router implementations (even maybe not url-matching
based but traversal ones).</p>
<p>For sake of that fact we have very trivial ABC for
<code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractRouter</span></code>: it should have only
<code class="xref py py-meth docutils literal notranslate"><span class="pre">AbstractRouter.resolve()</span></code> coroutine.</p>
<p>No methods for adding routes or route reversing (getting URL by
route name). All those are router implementation details (but,
sure, you need to deal with that methods after choosing the
router for your application).</p>
</div>
</dd></dl>

</div>
<div class="section" id="server">
<h6>Server<a class="headerlink" href="#server" title="Permalink to this headline">¶</a></h6>
<p>A protocol factory compatible with
<code class="xref py py-meth docutils literal notranslate"><span class="pre">create_server()</span></code>.</p>
<dl class="class">
<dt id="aiohttp.web.Server">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">Server</code><a class="headerlink" href="#aiohttp.web.Server" title="Permalink to this definition">¶</a></dt>
<dd><p>The class is responsible for creating HTTP protocol
objects that can handle HTTP connections.</p>
<dl class="attribute">
<dt id="aiohttp.web.Server.connections">
<code class="sig-name descname">connections</code><a class="headerlink" href="#aiohttp.web.Server.connections" title="Permalink to this definition">¶</a></dt>
<dd><p>List of all currently opened connections.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Server.requests_count">
<code class="sig-name descname">requests_count</code><a class="headerlink" href="#aiohttp.web.Server.requests_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Amount of processed requests.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Server.shutdown">
<em class="property">coroutine </em><code class="sig-name descname">shutdown</code><span class="sig-paren">(</span><em class="sig-param">timeout</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.Server.shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that should be called to close all opened
connections.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="router">
<h6>Router<a class="headerlink" href="#router" title="Permalink to this headline">¶</a></h6>
<p>For dispatching URLs to <a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">handlers</span></a>
<a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> uses <em>routers</em>.</p>
<p>Router is any object that implements <code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractRouter</span></code> interface.</p>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> provides an implementation called <a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlDispatcher</span></code></a>.</p>
<p><a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> uses <a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlDispatcher</span></code></a> as <code class="xref py py-meth docutils literal notranslate"><span class="pre">router()</span></code> by default.</p>
<dl class="class">
<dt id="aiohttp.web.UrlDispatcher">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">UrlDispatcher</code><a class="headerlink" href="#aiohttp.web.UrlDispatcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Straightforward url-matching router, implements
<a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Mapping</span></code></a> for access to <em>named routes</em>.</p>
<p>Before running <a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> you should fill <em>route
table</em> first by calling <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_route()</span></code></a> and <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_static" title="aiohttp.web.UrlDispatcher.add_static"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_static()</span></code></a>.</p>
<p><a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">Handler</span></a> lookup is performed by iterating on
added <em>routes</em> in FIFO order. The first matching <em>route</em> will be used
to call corresponding <em>handler</em>.</p>
<p>If on route creation you specify <em>name</em> parameter the result is
<em>named route</em>.</p>
<p><em>Named route</em> can be retrieved by <code class="docutils literal notranslate"><span class="pre">app.router[name]</span></code> call, checked for
existence by <code class="docutils literal notranslate"><span class="pre">name</span> <span class="pre">in</span> <span class="pre">app.router</span></code> etc.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#aiohttp-web-route"><span class="std std-ref">Route classes</span></a></p>
</div>
<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_resource">
<code class="sig-name descname">add_resource</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_resource" title="Permalink to this definition">¶</a></dt>
<dd><p>Append a <a class="reference internal" href="index.html#term-resource"><span class="xref std std-term">resource</span></a> to the end of route table.</p>
<p><em>path</em> may be either <em>constant</em> string like <code class="docutils literal notranslate"><span class="pre">'/a/b/c'</span></code> or
<em>variable rule</em> like <code class="docutils literal notranslate"><span class="pre">'/a/{var}'</span></code> (see
<a class="reference internal" href="index.html#aiohttp-web-variable-handler"><span class="std std-ref">handling variable paths</span></a>)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – resource path spec.</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – optional resource name.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>created resource instance (<a class="reference internal" href="#aiohttp.web.PlainResource" title="aiohttp.web.PlainResource"><code class="xref py py-class docutils literal notranslate"><span class="pre">PlainResource</span></code></a> or
<a class="reference internal" href="#aiohttp.web.DynamicResource" title="aiohttp.web.DynamicResource"><code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicResource</span></code></a>).</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_route">
<code class="sig-name descname">add_route</code><span class="sig-paren">(</span><em class="sig-param">method</em>, <em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_route" title="Permalink to this definition">¶</a></dt>
<dd><p>Append <a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">handler</span></a> to the end of route table.</p>
<dl class="simple">
<dt><em>path</em> may be either <em>constant</em> string like <code class="docutils literal notranslate"><span class="pre">'/a/b/c'</span></code> or</dt><dd><p><em>variable rule</em> like <code class="docutils literal notranslate"><span class="pre">'/a/{var}'</span></code> (see
<a class="reference internal" href="index.html#aiohttp-web-variable-handler"><span class="std std-ref">handling variable paths</span></a>)</p>
</dd>
</dl>
<p>Pay attention please: <em>handler</em> is converted to coroutine internally when
it is a regular function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – <p>HTTP method for route. Should be one of
<code class="docutils literal notranslate"><span class="pre">'GET'</span></code>, <code class="docutils literal notranslate"><span class="pre">'POST'</span></code>, <code class="docutils literal notranslate"><span class="pre">'PUT'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'DELETE'</span></code>, <code class="docutils literal notranslate"><span class="pre">'PATCH'</span></code>, <code class="docutils literal notranslate"><span class="pre">'HEAD'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'OPTIONS'</span></code> or <code class="docutils literal notranslate"><span class="pre">'*'</span></code> for any method.</p>
<p>The parameter is case-insensitive, e.g. you
can push <code class="docutils literal notranslate"><span class="pre">'get'</span></code> as well as <code class="docutils literal notranslate"><span class="pre">'GET'</span></code>.</p>
</p></li>
<li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – route path. Should be started with slash (<code class="docutils literal notranslate"><span class="pre">'/'</span></code>).</p></li>
<li><p><strong>handler</strong> (<em>callable</em>) – route handler.</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – optional route name.</p></li>
<li><p><strong>expect_handler</strong> (<em>coroutine</em>) – optional <em>expect</em> header handler.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>new <code class="xref py py-class docutils literal notranslate"><span class="pre">PlainRoute</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">DynamicRoute</span></code> instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_routes">
<code class="sig-name descname">add_routes</code><span class="sig-paren">(</span><em class="sig-param">routes_table</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_routes" title="Permalink to this definition">¶</a></dt>
<dd><p>Register route definitions from <em>routes_table</em>.</p>
<p>The table is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> items or
<a class="reference internal" href="#aiohttp.web.RouteTableDef" title="aiohttp.web.RouteTableDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteTableDef</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_get">
<code class="sig-name descname">add_get</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">allow_head=True</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Shortcut for adding a GET handler. Calls the <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_route()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">method</span></code> equals to <code class="docutils literal notranslate"><span class="pre">'GET'</span></code>.</p>
<p>If <em>allow_head</em> is <code class="docutils literal notranslate"><span class="pre">True</span></code> (default) the route for method HEAD
is added with the same handler as for GET.</p>
<p>If <em>name</em> is provided the name for HEAD route is suffixed with
<code class="docutils literal notranslate"><span class="pre">'-head'</span></code>. For example <code class="docutils literal notranslate"><span class="pre">router.add_get(path,</span> <span class="pre">handler,</span>
<span class="pre">name='route')</span></code> call adds two routes: first for GET with name
<code class="docutils literal notranslate"><span class="pre">'route'</span></code> and second for HEAD with name <code class="docutils literal notranslate"><span class="pre">'route-head'</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_post">
<code class="sig-name descname">add_post</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_post" title="Permalink to this definition">¶</a></dt>
<dd><p>Shortcut for adding a POST handler. Calls the <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_route()</span></code></a> with </p>
<p><code class="docutils literal notranslate"><span class="pre">method</span></code> equals to <code class="docutils literal notranslate"><span class="pre">'POST'</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_head">
<code class="sig-name descname">add_head</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_head" title="Permalink to this definition">¶</a></dt>
<dd><p>Shortcut for adding a HEAD handler. Calls the <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_route()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">method</span></code> equals to <code class="docutils literal notranslate"><span class="pre">'HEAD'</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_put">
<code class="sig-name descname">add_put</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_put" title="Permalink to this definition">¶</a></dt>
<dd><p>Shortcut for adding a PUT handler. Calls the <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_route()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">method</span></code> equals to <code class="docutils literal notranslate"><span class="pre">'PUT'</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_patch">
<code class="sig-name descname">add_patch</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_patch" title="Permalink to this definition">¶</a></dt>
<dd><p>Shortcut for adding a PATCH handler. Calls the <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_route()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">method</span></code> equals to <code class="docutils literal notranslate"><span class="pre">'PATCH'</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_delete">
<code class="sig-name descname">add_delete</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Shortcut for adding a DELETE handler. Calls the <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_route()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">method</span></code> equals to <code class="docutils literal notranslate"><span class="pre">'DELETE'</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_view">
<code class="sig-name descname">add_view</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_view" title="Permalink to this definition">¶</a></dt>
<dd><p>Shortcut for adding a class-based view handler. Calls the <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_route()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">method</span></code> equals to <code class="docutils literal notranslate"><span class="pre">'*'</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_static">
<code class="sig-name descname">add_static</code><span class="sig-paren">(</span><em class="sig-param">prefix</em>, <em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em>, <em class="sig-param">chunk_size=256*1024</em>, <em class="sig-param">response_factory=StreamResponse</em>, <em class="sig-param">show_index=False</em>, <em class="sig-param">follow_symlinks=False</em>, <em class="sig-param">append_version=False</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_static" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a router and a handler for returning static files.</p>
<p>Useful for serving static content like images, javascript and css files.</p>
<p>On platforms that support it, the handler will transfer files more
efficiently using the <code class="docutils literal notranslate"><span class="pre">sendfile</span></code> system call.</p>
<p>In some situations it might be necessary to avoid using the <code class="docutils literal notranslate"><span class="pre">sendfile</span></code>
system call even if the platform supports it. This can be accomplished by
by setting environment variable <code class="docutils literal notranslate"><span class="pre">AIOHTTP_NOSENDFILE=1</span></code>.</p>
<p>If a gzip version of the static content exists at file path + <code class="docutils literal notranslate"><span class="pre">.gz</span></code>, it
will be used for the response.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Use <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_static" title="aiohttp.web.UrlDispatcher.add_static"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_static()</span></code></a> for development only. In production,
static content should be processed by web servers like <em>nginx</em>
or <em>apache</em>.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prefix</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – URL path prefix for handled static files</p></li>
<li><p><strong>path</strong> – path to the folder in file system that contains
handled static files, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a>.</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – optional route name.</p></li>
<li><p><strong>expect_handler</strong> (<em>coroutine</em>) – optional <em>expect</em> header handler.</p></li>
<li><p><strong>chunk_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>size of single chunk for file
downloading, 256Kb by default.</p>
<p>Increasing <em>chunk_size</em> parameter to,
say, 1Mb may increase file downloading
speed but consumes more memory.</p>
</p></li>
<li><p><strong>show_index</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – flag for allowing to show indexes of a directory,
by default it’s not allowed and HTTP/403 will
be returned on directory access.</p></li>
<li><p><strong>follow_symlinks</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – flag for allowing to follow symlinks from
a directory, by default it’s not allowed and
HTTP/404 will be returned on access.</p></li>
<li><p><strong>append_version</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – flag for adding file version (hash)
to the url query string, this value will
be used as default when you call to
<code class="xref py py-meth docutils literal notranslate"><span class="pre">StaticRoute.url()</span></code> and
<code class="xref py py-meth docutils literal notranslate"><span class="pre">StaticRoute.url_for()</span></code> methods.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>new <code class="xref py py-class docutils literal notranslate"><span class="pre">StaticRoute</span></code> instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.resolve">
<em class="property">coroutine </em><code class="sig-name descname">resolve</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.resolve" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.7)"><span class="xref std std-ref">coroutine</span></a> that returns
<code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMatchInfo</span></code> for <em>request</em>.</p>
<p>The method never raises exception, but returns
<code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMatchInfo</span></code> instance with:</p>
<ol class="arabic">
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">http_exception</span></code> assigned to
<a class="reference internal" href="#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPException</span></code></a> instance.</p></li>
<li><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">handler</span></code> which raises
<code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPNotFound</span></code> or <code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPMethodNotAllowed</span></code> on handler’s
execution if there is no registered route for <em>request</em>.</p>
<p><em>Middlewares</em> can process that exceptions to render
pretty-looking error page for example.</p>
</li>
</ol>
<p>Used by internal machinery, end user unlikely need to call the method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method uses <code class="xref py py-attr docutils literal notranslate"><span class="pre">Request.raw_path</span></code> for pattern
matching against registered routes.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.resources">
<code class="sig-name descname">resources</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.resources" title="Permalink to this definition">¶</a></dt>
<dd><p>The method returns a <em>view</em> for <em>all</em> registered resources.</p>
<p>The view is an object that allows to:</p>
<ol class="arabic">
<li><p>Get size of the router table:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">resources</span><span class="p">())</span>
</pre></div>
</div>
</li>
<li><p>Iterate over registered resources:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">resources</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Make a check if the resources is registered in the router table:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">route</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">resources</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.routes">
<code class="sig-name descname">routes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.routes" title="Permalink to this definition">¶</a></dt>
<dd><p>The method returns a <em>view</em> for <em>all</em> registered routes.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.named_resources">
<code class="sig-name descname">named_resources</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UrlDispatcher.named_resources" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a>-like <a class="reference external" href="https://docs.python.org/3/library/types.html#types.MappingProxyType" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.MappingProxyType</span></code></a> <em>view</em> over
<em>all</em> named <strong>resources</strong>.</p>
<p>The view maps every named resource’s <strong>name</strong> to the
<code class="xref py py-class docutils literal notranslate"><span class="pre">BaseResource</span></code> instance. It supports the usual
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dict</span></code></a>-like operations, except for any mutable operations
(i.e. it’s <strong>read-only</strong>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">named_resources</span><span class="p">())</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">named_resources</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span>

<span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">named_resources</span><span class="p">()</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">named_resources</span><span class="p">()[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="resource">
<span id="aiohttp-web-resource"></span><h6>Resource<a class="headerlink" href="#resource" title="Permalink to this headline">¶</a></h6>
<p>Default router <a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlDispatcher</span></code></a> operates with <a class="reference internal" href="index.html#term-resource"><span class="xref std std-term">resource</span></a>s.</p>
<p>Resource is an item in <em>routing table</em> which has a <em>path</em>, an optional
unique <em>name</em> and at least one <a class="reference internal" href="index.html#term-route"><span class="xref std std-term">route</span></a>.</p>
<p><a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a> lookup is performed in the following way:</p>
<ol class="arabic simple">
<li><p>Router iterates over <em>resources</em> one-by-one.</p></li>
<li><p>If <em>resource</em> matches to requested URL the resource iterates over
own <em>routes</em>.</p></li>
<li><p>If route matches to requested HTTP method (or <code class="docutils literal notranslate"><span class="pre">'*'</span></code> wildcard) the
route’s handler is used as found <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a>. The lookup is
finished.</p></li>
<li><p>Otherwise router tries next resource from the <em>routing table</em>.</p></li>
<li><p>If the end of <em>routing table</em> is reached and no <em>resource</em> /
<em>route</em> pair found the <em>router</em> returns special <code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMatchInfo</span></code>
instance with <code class="xref py py-attr docutils literal notranslate"><span class="pre">AbstractMatchInfo.http_exception</span></code> is not <code class="docutils literal notranslate"><span class="pre">None</span></code>
but <a class="reference internal" href="#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPException</span></code></a> with  either <em>HTTP 404 Not Found</em> or
<em>HTTP 405 Method Not Allowed</em> status code.
Registered <code class="xref py py-attr docutils literal notranslate"><span class="pre">AbstractMatchInfo.handler</span></code> raises this exception on call.</p></li>
</ol>
<p>User should never instantiate resource classes but give it by
<a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_resource" title="aiohttp.web.UrlDispatcher.add_resource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_resource()</span></code></a> call.</p>
<p>After that he may add a <a class="reference internal" href="index.html#term-route"><span class="xref std std-term">route</span></a> by calling <a class="reference internal" href="#aiohttp.web.Resource.add_route" title="aiohttp.web.Resource.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Resource.add_route()</span></code></a>.</p>
<p><a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_route()</span></code></a> is just shortcut for:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">router</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
<p>Resource with a <em>name</em> is called <em>named resource</em>.
The main purpose of <em>named resource</em> is constructing URL by route name for
passing it into <em>template engine</em> for example:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="p">[</span><span class="s1">&#39;resource_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">url_for</span><span class="p">()</span><span class="o">.</span><span class="n">with_query</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
<p>Resource classes hierarchy:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">AbstractResource</span>
  <span class="n">Resource</span>
    <span class="n">PlainResource</span>
    <span class="n">DynamicResource</span>
    <span class="n">StaticResource</span>
</pre></div>
</div>
<dl class="class">
<dt id="aiohttp.web.AbstractResource">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">AbstractResource</code><a class="headerlink" href="#aiohttp.web.AbstractResource" title="Permalink to this definition">¶</a></dt>
<dd><p>A base class for all resources.</p>
<p>Inherited from <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sized" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Sized</span></code></a> and
<a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Iterable</span></code></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">len(resource)</span></code> returns amount of <a class="reference internal" href="index.html#term-route"><span class="xref std std-term">route</span></a>s belongs to the resource,
<code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">route</span> <span class="pre">in</span> <span class="pre">resource</span></code> allows to iterate over these routes.</p>
<dl class="attribute">
<dt id="aiohttp.web.AbstractResource.name">
<code class="sig-name descname">name</code><a class="headerlink" href="#aiohttp.web.AbstractResource.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only <em>name</em> of resource or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.AbstractResource.canonical">
<code class="sig-name descname">canonical</code><a class="headerlink" href="#aiohttp.web.AbstractResource.canonical" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only <em>canonical path</em> associate with the resource. For example
<code class="docutils literal notranslate"><span class="pre">/path/to</span></code> or <code class="docutils literal notranslate"><span class="pre">/path/{to}</span></code></p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.AbstractResource.resolve">
<em class="property">coroutine </em><code class="sig-name descname">resolve</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.AbstractResource.resolve" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolve resource by finding appropriate <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a> for
<code class="docutils literal notranslate"><span class="pre">(method,</span> <span class="pre">path)</span></code> combination.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p>(<em>match_info</em>, <em>allowed_methods</em>) pair.</p>
<p><em>allowed_methods</em> is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> or HTTP methods accepted by
resource.</p>
<p><em>match_info</em> is either <a class="reference internal" href="#aiohttp.web.UrlMappingMatchInfo" title="aiohttp.web.UrlMappingMatchInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlMappingMatchInfo</span></code></a> if
request is resolved or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no <a class="reference internal" href="index.html#term-route"><span class="xref std std-term">route</span></a> is
found.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.AbstractResource.get_info">
<code class="sig-name descname">get_info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.AbstractResource.get_info" title="Permalink to this definition">¶</a></dt>
<dd><p>A resource description, e.g. <code class="docutils literal notranslate"><span class="pre">{'path':</span> <span class="pre">'/path/to'}</span></code> or
<code class="docutils literal notranslate"><span class="pre">{'formatter':</span> <span class="pre">'/path/{to}',</span> <span class="pre">'pattern':</span>
<span class="pre">re.compile(r'^/path/(?P&lt;to&gt;[a-zA-Z][_a-zA-Z0-9]+)$</span></code></p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.AbstractResource.url_for">
<code class="sig-name descname">url_for</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.AbstractResource.url_for" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct an URL for route with additional params.</p>
<p><em>args</em> and <strong>kwargs</strong> depend on a parameters list accepted by
inherited resource class.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> – resulting URL instance.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.Resource">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">Resource</code><a class="headerlink" href="#aiohttp.web.Resource" title="Permalink to this definition">¶</a></dt>
<dd><p>A base class for new-style resources, inherits <a class="reference internal" href="#aiohttp.web.AbstractResource" title="aiohttp.web.AbstractResource"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractResource</span></code></a>.</p>
<dl class="method">
<dt id="aiohttp.web.Resource.add_route">
<code class="sig-name descname">add_route</code><span class="sig-paren">(</span><em class="sig-param">method</em>, <em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.Resource.add_route" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a> to resource.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – <p>HTTP method for route. Should be one of
<code class="docutils literal notranslate"><span class="pre">'GET'</span></code>, <code class="docutils literal notranslate"><span class="pre">'POST'</span></code>, <code class="docutils literal notranslate"><span class="pre">'PUT'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'DELETE'</span></code>, <code class="docutils literal notranslate"><span class="pre">'PATCH'</span></code>, <code class="docutils literal notranslate"><span class="pre">'HEAD'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'OPTIONS'</span></code> or <code class="docutils literal notranslate"><span class="pre">'*'</span></code> for any method.</p>
<p>The parameter is case-insensitive, e.g. you
can push <code class="docutils literal notranslate"><span class="pre">'get'</span></code> as well as <code class="docutils literal notranslate"><span class="pre">'GET'</span></code>.</p>
<p>The method should be unique for resource.</p>
</p></li>
<li><p><strong>handler</strong> (<em>callable</em>) – route handler.</p></li>
<li><p><strong>expect_handler</strong> (<em>coroutine</em>) – optional <em>expect</em> header handler.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>new <a class="reference internal" href="#aiohttp.web.ResourceRoute" title="aiohttp.web.ResourceRoute"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceRoute</span></code></a> instance.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.PlainResource">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">PlainResource</code><a class="headerlink" href="#aiohttp.web.PlainResource" title="Permalink to this definition">¶</a></dt>
<dd><p>A resource, inherited from <a class="reference internal" href="#aiohttp.web.Resource" title="aiohttp.web.Resource"><code class="xref py py-class docutils literal notranslate"><span class="pre">Resource</span></code></a>.</p>
<p>The class corresponds to resources with plain-text matching,
<code class="docutils literal notranslate"><span class="pre">'/path/to'</span></code> for example.</p>
<dl class="attribute">
<dt id="aiohttp.web.PlainResource.canonical">
<code class="sig-name descname">canonical</code><a class="headerlink" href="#aiohttp.web.PlainResource.canonical" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only <em>canonical path</em> associate with the resource. Returns the path
used to create the PlainResource. For example <code class="docutils literal notranslate"><span class="pre">/path/to</span></code></p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.PlainResource.url_for">
<code class="sig-name descname">url_for</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.PlainResource.url_for" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> for the resource.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.DynamicResource">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">DynamicResource</code><a class="headerlink" href="#aiohttp.web.DynamicResource" title="Permalink to this definition">¶</a></dt>
<dd><p>A resource, inherited from <a class="reference internal" href="#aiohttp.web.Resource" title="aiohttp.web.Resource"><code class="xref py py-class docutils literal notranslate"><span class="pre">Resource</span></code></a>.</p>
<p>The class corresponds to resources with
<a class="reference internal" href="index.html#aiohttp-web-variable-handler"><span class="std std-ref">variable</span></a> matching,
e.g. <code class="docutils literal notranslate"><span class="pre">'/path/{to}/{param}'</span></code> etc.</p>
<dl class="attribute">
<dt id="aiohttp.web.DynamicResource.canonical">
<code class="sig-name descname">canonical</code><a class="headerlink" href="#aiohttp.web.DynamicResource.canonical" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only <em>canonical path</em> associate with the resource. Returns the
formatter obtained from the path used to create the DynamicResource.
For example, from a path <code class="docutils literal notranslate"><span class="pre">/get/{num:^\d+}</span></code>, it returns <code class="docutils literal notranslate"><span class="pre">/get/{num}</span></code></p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.DynamicResource.url_for">
<code class="sig-name descname">url_for</code><span class="sig-paren">(</span><em class="sig-param">**params</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.DynamicResource.url_for" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> for the resource.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>params</strong> – <p>– a variable substitutions for dynamic resource.</p>
<p>E.g. for <code class="docutils literal notranslate"><span class="pre">'/path/{to}/{param}'</span></code> pattern the method should
be called as <code class="docutils literal notranslate"><span class="pre">resource.url_for(to='val1',</span> <span class="pre">param='val2')</span></code></p>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.StaticResource">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">StaticResource</code><a class="headerlink" href="#aiohttp.web.StaticResource" title="Permalink to this definition">¶</a></dt>
<dd><p>A resource, inherited from <a class="reference internal" href="#aiohttp.web.Resource" title="aiohttp.web.Resource"><code class="xref py py-class docutils literal notranslate"><span class="pre">Resource</span></code></a>.</p>
<p>The class corresponds to resources for <a class="reference internal" href="index.html#aiohttp-web-static-file-handling"><span class="std std-ref">static file serving</span></a>.</p>
<dl class="attribute">
<dt id="aiohttp.web.StaticResource.canonical">
<code class="sig-name descname">canonical</code><a class="headerlink" href="#aiohttp.web.StaticResource.canonical" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only <em>canonical path</em> associate with the resource. Returns the prefix
used to create the StaticResource. For example <code class="docutils literal notranslate"><span class="pre">/prefix</span></code></p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StaticResource.url_for">
<code class="sig-name descname">url_for</code><span class="sig-paren">(</span><em class="sig-param">filename</em>, <em class="sig-param">append_version=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.StaticResource.url_for" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> for file path under resource prefix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – <p>– a file name substitution for static file handler.</p>
<p>Accepts both <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a>.</p>
<p>E.g. an URL for <code class="docutils literal notranslate"><span class="pre">'/prefix/dir/file.txt'</span></code> should
be generated as <code class="docutils literal notranslate"><span class="pre">resource.url_for(filename='dir/file.txt')</span></code></p>
</p></li>
<li><p><strong>append_version</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – <dl class="simple">
<dt>– a flag for adding file version</dt><dd><p>(hash) to the url query string for
cache boosting</p>
</dd>
</dl>
<p>By default has value from a constructor (<code class="docutils literal notranslate"><span class="pre">False</span></code> by default)
When set to <code class="docutils literal notranslate"><span class="pre">True</span></code> - <code class="docutils literal notranslate"><span class="pre">v=FILE_HASH</span></code> query string param will be added
When set to <code class="docutils literal notranslate"><span class="pre">False</span></code> has no impact</p>
<p>if file not found has no impact</p>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.PrefixedSubAppResource">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">PrefixedSubAppResource</code><a class="headerlink" href="#aiohttp.web.PrefixedSubAppResource" title="Permalink to this definition">¶</a></dt>
<dd><p>A resource for serving nested applications. The class instance is
returned by <a class="reference internal" href="#aiohttp.web.Application.add_subapp" title="aiohttp.web.Application.add_subapp"><code class="xref py py-class docutils literal notranslate"><span class="pre">add_subapp</span></code></a> call.</p>
<dl class="attribute">
<dt id="aiohttp.web.PrefixedSubAppResource.canonical">
<code class="sig-name descname">canonical</code><a class="headerlink" href="#aiohttp.web.PrefixedSubAppResource.canonical" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only <em>canonical path</em> associate with the resource. Returns the
prefix used to create the PrefixedSubAppResource.
For example <code class="docutils literal notranslate"><span class="pre">/prefix</span></code></p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.PrefixedSubAppResource.url_for">
<code class="sig-name descname">url_for</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.PrefixedSubAppResource.url_for" title="Permalink to this definition">¶</a></dt>
<dd><p>The call is not allowed, it raises <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="route">
<span id="aiohttp-web-route"></span><h6>Route<a class="headerlink" href="#route" title="Permalink to this headline">¶</a></h6>
<p>Route has <em>HTTP method</em> (wildcard <code class="docutils literal notranslate"><span class="pre">'*'</span></code> is an option),
<a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a> and optional <em>expect handler</em>.</p>
<p>Every route belong to some resource.</p>
<p>Route classes hierarchy:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">AbstractRoute</span>
  <span class="n">ResourceRoute</span>
  <span class="n">SystemRoute</span>
</pre></div>
</div>
<p><a class="reference internal" href="#aiohttp.web.ResourceRoute" title="aiohttp.web.ResourceRoute"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceRoute</span></code></a> is the route used for resources,
<a class="reference internal" href="#aiohttp.web.SystemRoute" title="aiohttp.web.SystemRoute"><code class="xref py py-class docutils literal notranslate"><span class="pre">SystemRoute</span></code></a> serves URL resolving errors like <em>404 Not Found</em>
and <em>405 Method Not Allowed</em>.</p>
<dl class="class">
<dt id="aiohttp.web.AbstractRoute">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">AbstractRoute</code><a class="headerlink" href="#aiohttp.web.AbstractRoute" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for routes served by <a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlDispatcher</span></code></a>.</p>
<dl class="attribute">
<dt id="aiohttp.web.AbstractRoute.method">
<code class="sig-name descname">method</code><a class="headerlink" href="#aiohttp.web.AbstractRoute.method" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP method handled by the route, e.g. <em>GET</em>, <em>POST</em> etc.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.AbstractRoute.handler">
<code class="sig-name descname">handler</code><a class="headerlink" href="#aiohttp.web.AbstractRoute.handler" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="index.html#aiohttp-web-handler"><span class="std std-ref">handler</span></a> that processes the route.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.AbstractRoute.name">
<code class="sig-name descname">name</code><a class="headerlink" href="#aiohttp.web.AbstractRoute.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of the route, always equals to name of resource which owns the route.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.AbstractRoute.resource">
<code class="sig-name descname">resource</code><a class="headerlink" href="#aiohttp.web.AbstractRoute.resource" title="Permalink to this definition">¶</a></dt>
<dd><p>Resource instance which holds the route, <code class="docutils literal notranslate"><span class="pre">None</span></code> for
<a class="reference internal" href="#aiohttp.web.SystemRoute" title="aiohttp.web.SystemRoute"><code class="xref py py-class docutils literal notranslate"><span class="pre">SystemRoute</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.AbstractRoute.url_for">
<code class="sig-name descname">url_for</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.AbstractRoute.url_for" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstract method for constructing url handled by the route.</p>
<p>Actually it’s a shortcut for <code class="docutils literal notranslate"><span class="pre">route.resource.url_for(...)</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.AbstractRoute.handle_expect_header">
<em class="property">coroutine </em><code class="sig-name descname">handle_expect_header</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.AbstractRoute.handle_expect_header" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">100-continue</span></code> handler.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.ResourceRoute">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">ResourceRoute</code><a class="headerlink" href="#aiohttp.web.ResourceRoute" title="Permalink to this definition">¶</a></dt>
<dd><p>The route class for handling different HTTP methods for <a class="reference internal" href="#aiohttp.web.Resource" title="aiohttp.web.Resource"><code class="xref py py-class docutils literal notranslate"><span class="pre">Resource</span></code></a>.</p>
</dd></dl>

<dl class="class">
<dt id="aiohttp.web.SystemRoute">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">SystemRoute</code><a class="headerlink" href="#aiohttp.web.SystemRoute" title="Permalink to this definition">¶</a></dt>
<dd><p>The route class for handling URL resolution errors like like <em>404 Not Found</em>
and <em>405 Method Not Allowed</em>.</p>
<dl class="attribute">
<dt id="aiohttp.web.SystemRoute.status">
<code class="sig-name descname">status</code><a class="headerlink" href="#aiohttp.web.SystemRoute.status" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP status code</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.SystemRoute.reason">
<code class="sig-name descname">reason</code><a class="headerlink" href="#aiohttp.web.SystemRoute.reason" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP status reason</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="routedef-and-staticdef">
<span id="aiohttp-web-route-def"></span><h6>RouteDef and StaticDef<a class="headerlink" href="#routedef-and-staticdef" title="Permalink to this headline">¶</a></h6>
<p>Route definition, a description for not registered yet route.</p>
<p>Could be used for filing route table by providing a list of route
definitions (Django style).</p>
<p>The definition is created by functions like <a class="reference internal" href="#aiohttp.web.get" title="aiohttp.web.get"><code class="xref py py-func docutils literal notranslate"><span class="pre">get()</span></code></a> or
<a class="reference internal" href="#aiohttp.web.post" title="aiohttp.web.post"><code class="xref py py-func docutils literal notranslate"><span class="pre">post()</span></code></a>, list of definitions could be added to router by
<a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_routes" title="aiohttp.web.UrlDispatcher.add_routes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_routes()</span></code></a> call:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_get</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_post</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/get&#39;</span><span class="p">,</span> <span class="n">handle_get</span><span class="p">),</span>
                       <span class="n">web</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/post&#39;</span><span class="p">,</span> <span class="n">handle_post</span><span class="p">),</span>
</pre></div>
</div>
<dl class="class">
<dt id="aiohttp.web.AbstractRouteDef">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">AbstractRouteDef</code><a class="headerlink" href="#aiohttp.web.AbstractRouteDef" title="Permalink to this definition">¶</a></dt>
<dd><p>A base class for route definitions.</p>
<p>Inherited from <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.ABC" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
<dl class="method">
<dt id="aiohttp.web.AbstractRouteDef.register">
<code class="sig-name descname">register</code><span class="sig-paren">(</span><em class="sig-param">router</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.AbstractRouteDef.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register itself into <a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlDispatcher</span></code></a>.</p>
<p>Abstract method, should be overridden by subclasses.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.RouteDef">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">RouteDef</code><a class="headerlink" href="#aiohttp.web.RouteDef" title="Permalink to this definition">¶</a></dt>
<dd><p>A definition of not registered yet route.</p>
<p>Implements <a class="reference internal" href="#aiohttp.web.AbstractRouteDef" title="aiohttp.web.AbstractRouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractRouteDef</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.1: </span>The class implements <a class="reference internal" href="#aiohttp.web.AbstractRouteDef" title="aiohttp.web.AbstractRouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractRouteDef</span></code></a> interface.</p>
</div>
<dl class="attribute">
<dt id="aiohttp.web.RouteDef.method">
<code class="sig-name descname">method</code><a class="headerlink" href="#aiohttp.web.RouteDef.method" title="Permalink to this definition">¶</a></dt>
<dd><p>HTTP method (<code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code> etc.)  (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.RouteDef.path">
<code class="sig-name descname">path</code><a class="headerlink" href="#aiohttp.web.RouteDef.path" title="Permalink to this definition">¶</a></dt>
<dd><p>Path to resource, e.g. <code class="docutils literal notranslate"><span class="pre">/path/to</span></code>. Could contain <code class="docutils literal notranslate"><span class="pre">{}</span></code>
brackets for <a class="reference internal" href="index.html#aiohttp-web-variable-handler"><span class="std std-ref">variable resources</span></a> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.RouteDef.handler">
<code class="sig-name descname">handler</code><a class="headerlink" href="#aiohttp.web.RouteDef.handler" title="Permalink to this definition">¶</a></dt>
<dd><p>An async function to handle HTTP request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.RouteDef.kwargs">
<code class="sig-name descname">kwargs</code><a class="headerlink" href="#aiohttp.web.RouteDef.kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of additional arguments.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.StaticDef">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">StaticDef</code><a class="headerlink" href="#aiohttp.web.StaticDef" title="Permalink to this definition">¶</a></dt>
<dd><p>A definition of static file resource.</p>
<p>Implements <a class="reference internal" href="#aiohttp.web.AbstractRouteDef" title="aiohttp.web.AbstractRouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractRouteDef</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
<dl class="attribute">
<dt id="aiohttp.web.StaticDef.prefix">
<code class="sig-name descname">prefix</code><a class="headerlink" href="#aiohttp.web.StaticDef.prefix" title="Permalink to this definition">¶</a></dt>
<dd><p>A prefix used for static file handling, e.g. <code class="docutils literal notranslate"><span class="pre">/static</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StaticDef.path">
<code class="sig-name descname">path</code><a class="headerlink" href="#aiohttp.web.StaticDef.path" title="Permalink to this definition">¶</a></dt>
<dd><p>File system directory to serve, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or
<a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a>
(e.g. <code class="docutils literal notranslate"><span class="pre">'/home/web-service/path/to/static'</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StaticDef.kwargs">
<code class="sig-name descname">kwargs</code><a class="headerlink" href="#aiohttp.web.StaticDef.kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of additional arguments, see
<a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_static" title="aiohttp.web.UrlDispatcher.add_static"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_static()</span></code></a> for a list of supported
options.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="aiohttp.web.get">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">get</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">allow_head=True</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> for processing <code class="docutils literal notranslate"><span class="pre">GET</span></code> requests. See
<a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_get" title="aiohttp.web.UrlDispatcher.add_get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_get()</span></code></a> for information about parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="aiohttp.web.post">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">post</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.post" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> for processing <code class="docutils literal notranslate"><span class="pre">POST</span></code> requests. See
<a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_post" title="aiohttp.web.UrlDispatcher.add_post"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_post()</span></code></a> for information about parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="aiohttp.web.head">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">head</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.head" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> for processing <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> requests. See
<a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_head" title="aiohttp.web.UrlDispatcher.add_head"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_head()</span></code></a> for information about parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="aiohttp.web.put">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">put</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.put" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> for processing <code class="docutils literal notranslate"><span class="pre">PUT</span></code> requests. See
<a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_put" title="aiohttp.web.UrlDispatcher.add_put"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_put()</span></code></a> for information about parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="aiohttp.web.patch">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">patch</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.patch" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> for processing <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> requests. See
<a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_patch" title="aiohttp.web.UrlDispatcher.add_patch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_patch()</span></code></a> for information about parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="aiohttp.web.delete">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">delete</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> for processing <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> requests. See
<a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_delete" title="aiohttp.web.UrlDispatcher.add_delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_delete()</span></code></a> for information about parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="aiohttp.web.view">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">view</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.view" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> for processing <code class="docutils literal notranslate"><span class="pre">ANY</span></code> requests. See
<a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_view" title="aiohttp.web.UrlDispatcher.add_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_view()</span></code></a> for information about parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="aiohttp.web.static">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">static</code><span class="sig-paren">(</span><em class="sig-param">prefix</em>, <em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em>, <em class="sig-param">chunk_size=256*1024</em>, <em class="sig-param">show_index=False</em>, <em class="sig-param">follow_symlinks=False</em>, <em class="sig-param">append_version=False</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.static" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <a class="reference internal" href="#aiohttp.web.StaticDef" title="aiohttp.web.StaticDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaticDef</span></code></a> for processing static files.</p>
<p>See <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_static" title="aiohttp.web.UrlDispatcher.add_static"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_static()</span></code></a> for information
about supported parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="aiohttp.web.route">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">route</code><span class="sig-paren">(</span><em class="sig-param">method</em>, <em class="sig-param">path</em>, <em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.route" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> for processing requests that decided by
<code class="docutils literal notranslate"><span class="pre">method</span></code>. See <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_route()</span></code></a> for information
about parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="routetabledef">
<span id="aiohttp-web-route-table-def"></span><h6>RouteTableDef<a class="headerlink" href="#routetabledef" title="Permalink to this headline">¶</a></h6>
<p>A routes table definition used for describing routes by decorators
(Flask style):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="n">routes</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">RouteTableDef</span><span class="p">()</span>

<span class="nd">@routes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/get&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_get</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>


<span class="nd">@routes</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/post&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_post</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_routes</span><span class="p">(</span><span class="n">routes</span><span class="p">)</span>


<span class="nd">@routes</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s2">&quot;/view&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">web</span><span class="o">.</span><span class="n">View</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<dl class="class">
<dt id="aiohttp.web.RouteTableDef">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">RouteTableDef</code><a class="headerlink" href="#aiohttp.web.RouteTableDef" title="Permalink to this definition">¶</a></dt>
<dd><p>A sequence of <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> instances (implements
<code class="xref py py-class docutils literal notranslate"><span class="pre">abc.collections.Sequence</span></code> protocol).</p>
<p>In addition to all standard <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> methods the class
provides also methods like <code class="docutils literal notranslate"><span class="pre">get()</span></code> and <code class="docutils literal notranslate"><span class="pre">post()</span></code> for adding new
route definition.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<dl class="method">
<dt id="aiohttp.web.RouteTableDef.get">
<code class="sig-prename descclassname">&#64;</code><code class="sig-name descname">get</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">allow_head=True</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.RouteTableDef.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> item for registering <code class="docutils literal notranslate"><span class="pre">GET</span></code> web-handler.</p>
<p>See <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_get" title="aiohttp.web.UrlDispatcher.add_get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_get()</span></code></a> for information about parameters.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.RouteTableDef.post">
<code class="sig-prename descclassname">&#64;</code><code class="sig-name descname">post</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.RouteTableDef.post" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> item for registering <code class="docutils literal notranslate"><span class="pre">POST</span></code> web-handler.</p>
<p>See <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_post" title="aiohttp.web.UrlDispatcher.add_post"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_post()</span></code></a> for information about parameters.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.RouteTableDef.head">
<code class="sig-prename descclassname">&#64;</code><code class="sig-name descname">head</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.RouteTableDef.head" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> item for registering <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> web-handler.</p>
<p>See <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_head" title="aiohttp.web.UrlDispatcher.add_head"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_head()</span></code></a> for information about parameters.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.RouteTableDef.put">
<code class="sig-prename descclassname">&#64;</code><code class="sig-name descname">put</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.RouteTableDef.put" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> item for registering <code class="docutils literal notranslate"><span class="pre">PUT</span></code> web-handler.</p>
<p>See <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_put" title="aiohttp.web.UrlDispatcher.add_put"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_put()</span></code></a> for information about parameters.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.RouteTableDef.patch">
<code class="sig-prename descclassname">&#64;</code><code class="sig-name descname">patch</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.RouteTableDef.patch" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> item for registering <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> web-handler.</p>
<p>See <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_patch" title="aiohttp.web.UrlDispatcher.add_patch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_patch()</span></code></a> for information about parameters.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.RouteTableDef.delete">
<code class="sig-prename descclassname">&#64;</code><code class="sig-name descname">delete</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.RouteTableDef.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> item for registering <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> web-handler.</p>
<p>See <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_delete" title="aiohttp.web.UrlDispatcher.add_delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_delete()</span></code></a> for information about parameters.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.RouteTableDef.view">
<code class="sig-prename descclassname">&#64;</code><code class="sig-name descname">view</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.RouteTableDef.view" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> item for registering <code class="docutils literal notranslate"><span class="pre">ANY</span></code> methods
against a class-based view.</p>
<p>See <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_view" title="aiohttp.web.UrlDispatcher.add_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_view()</span></code></a> for information about parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.RouteTableDef.static">
<code class="sig-name descname">static</code><span class="sig-paren">(</span><em class="sig-param">prefix</em>, <em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em>, <em class="sig-param">chunk_size=256*1024</em>, <em class="sig-param">show_index=False</em>, <em class="sig-param">follow_symlinks=False</em>, <em class="sig-param">append_version=False</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.RouteTableDef.static" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new <a class="reference internal" href="#aiohttp.web.StaticDef" title="aiohttp.web.StaticDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaticDef</span></code></a> item for registering static files processor.</p>
<p>See <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_static" title="aiohttp.web.UrlDispatcher.add_static"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_static()</span></code></a> for information about
supported parameters.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.RouteTableDef.route">
<code class="sig-prename descclassname">&#64;</code><code class="sig-name descname">route</code><span class="sig-paren">(</span><em class="sig-param">method</em>, <em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">name=None</em>, <em class="sig-param">expect_handler=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.RouteTableDef.route" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new <a class="reference internal" href="#aiohttp.web.RouteDef" title="aiohttp.web.RouteDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteDef</span></code></a> item for registering a web-handler
for arbitrary HTTP method.</p>
<p>See <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UrlDispatcher.add_route()</span></code></a> for information about parameters.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="matchinfo">
<h6>MatchInfo<a class="headerlink" href="#matchinfo" title="Permalink to this headline">¶</a></h6>
<p>After route matching web application calls found handler if any.</p>
<p>Matching result can be accessible from handler as
<a class="reference internal" href="#aiohttp.web.Request.match_info" title="aiohttp.web.Request.match_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Request.match_info</span></code></a> attribute.</p>
<p>In general the result may be any object derived from
<code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMatchInfo</span></code> (<a class="reference internal" href="#aiohttp.web.UrlMappingMatchInfo" title="aiohttp.web.UrlMappingMatchInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlMappingMatchInfo</span></code></a> for default
<a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">UrlDispatcher</span></code></a> router).</p>
<dl class="class">
<dt id="aiohttp.web.UrlMappingMatchInfo">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">UrlMappingMatchInfo</code><a class="headerlink" href="#aiohttp.web.UrlMappingMatchInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Inherited from <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> and <code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMatchInfo</span></code>. Dict
items are filled by matching info and is <a class="reference internal" href="index.html#term-resource"><span class="xref std std-term">resource</span></a>-specific.</p>
<dl class="attribute">
<dt id="aiohttp.web.UrlMappingMatchInfo.expect_handler">
<code class="sig-name descname">expect_handler</code><a class="headerlink" href="#aiohttp.web.UrlMappingMatchInfo.expect_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>A coroutine for handling <code class="docutils literal notranslate"><span class="pre">100-continue</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.UrlMappingMatchInfo.handler">
<code class="sig-name descname">handler</code><a class="headerlink" href="#aiohttp.web.UrlMappingMatchInfo.handler" title="Permalink to this definition">¶</a></dt>
<dd><p>A coroutine for handling request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.UrlMappingMatchInfo.route">
<code class="sig-name descname">route</code><a class="headerlink" href="#aiohttp.web.UrlMappingMatchInfo.route" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Route</span></code> instance for url matching.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="view">
<h6>View<a class="headerlink" href="#view" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.web.View">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">View</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.View" title="Permalink to this definition">¶</a></dt>
<dd><p>Inherited from <code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractView</span></code>.</p>
<p>Base class for class based views. Implementations should derive from
<a class="reference internal" href="#aiohttp.web.View" title="aiohttp.web.View"><code class="xref py py-class docutils literal notranslate"><span class="pre">View</span></code></a> and override methods for handling HTTP verbs like
<code class="docutils literal notranslate"><span class="pre">get()</span></code> or <code class="docutils literal notranslate"><span class="pre">post()</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">post_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;/view&#39;</span><span class="p">,</span> <span class="n">MyView</span><span class="p">)</span>
</pre></div>
</div>
<p>The view raises <em>405 Method Not allowed</em>
(<code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPMethodNotAllowed</span></code>) if requested web verb is not
supported.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>request</strong> – instance of <a class="reference internal" href="#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a> that has initiated a view
processing.</p>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.web.View.request">
<code class="sig-name descname">request</code><a class="headerlink" href="#aiohttp.web.View.request" title="Permalink to this definition">¶</a></dt>
<dd><p>Request sent to view’s constructor, read-only property.</p>
</dd></dl>

<p>Overridable coroutine methods: <code class="docutils literal notranslate"><span class="pre">connect()</span></code>, <code class="docutils literal notranslate"><span class="pre">delete()</span></code>,
<code class="docutils literal notranslate"><span class="pre">get()</span></code>, <code class="docutils literal notranslate"><span class="pre">head()</span></code>, <code class="docutils literal notranslate"><span class="pre">options()</span></code>, <code class="docutils literal notranslate"><span class="pre">patch()</span></code>, <code class="docutils literal notranslate"><span class="pre">post()</span></code>,
<code class="docutils literal notranslate"><span class="pre">put()</span></code>, <code class="docutils literal notranslate"><span class="pre">trace()</span></code>.</p>
</dd></dl>

<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-class-based-views"><span class="std std-ref">Class Based Views</span></a></p>
</div>
</div>
</div>
<div class="section" id="running-applications">
<span id="aiohttp-web-app-runners-reference"></span><h5>Running Applications<a class="headerlink" href="#running-applications" title="Permalink to this headline">¶</a></h5>
<p>To start web application there is <code class="docutils literal notranslate"><span class="pre">AppRunner</span></code> and site classes.</p>
<p>Runner is a storage for running application, sites are for running
application on specific TCP or Unix socket, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">runner</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">AppRunner</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="k">await</span> <span class="n">runner</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
<span class="n">site</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">TCPSite</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>
<span class="k">await</span> <span class="n">site</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="c1"># wait for finish signal</span>
<span class="k">await</span> <span class="n">runner</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0: </span><a class="reference internal" href="#aiohttp.web.AppRunner" title="aiohttp.web.AppRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppRunner</span></code></a> / <a class="reference internal" href="#aiohttp.web.ServerRunner" title="aiohttp.web.ServerRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">ServerRunner</span></code></a> and <a class="reference internal" href="#aiohttp.web.TCPSite" title="aiohttp.web.TCPSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">TCPSite</span></code></a> /
<a class="reference internal" href="#aiohttp.web.UnixSite" title="aiohttp.web.UnixSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnixSite</span></code></a> / <a class="reference internal" href="#aiohttp.web.SockSite" title="aiohttp.web.SockSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">SockSite</span></code></a> are added in aiohttp 3.0</p>
</div>
<dl class="class">
<dt id="aiohttp.web.BaseRunner">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">BaseRunner</code><a class="headerlink" href="#aiohttp.web.BaseRunner" title="Permalink to this definition">¶</a></dt>
<dd><p>A base class for runners. Use <a class="reference internal" href="#aiohttp.web.AppRunner" title="aiohttp.web.AppRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">AppRunner</span></code></a> for serving
<a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a>, <a class="reference internal" href="#aiohttp.web.ServerRunner" title="aiohttp.web.ServerRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">ServerRunner</span></code></a> for low-level
<a class="reference internal" href="#aiohttp.web.Server" title="aiohttp.web.Server"><code class="xref py py-class docutils literal notranslate"><span class="pre">Server</span></code></a>.</p>
<dl class="attribute">
<dt id="aiohttp.web.BaseRunner.server">
<code class="sig-name descname">server</code><a class="headerlink" href="#aiohttp.web.BaseRunner.server" title="Permalink to this definition">¶</a></dt>
<dd><p>Low-level web <a class="reference internal" href="#aiohttp.web.Server" title="aiohttp.web.Server"><code class="xref py py-class docutils literal notranslate"><span class="pre">Server</span></code></a> for handling HTTP requests,
read-only attribute.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRunner.addresses">
<code class="sig-name descname">addresses</code><a class="headerlink" href="#aiohttp.web.BaseRunner.addresses" title="Permalink to this definition">¶</a></dt>
<dd><p>A  <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of served sockets addresses.</p>
<p>See <code class="xref py py-meth docutils literal notranslate"><span class="pre">socket.getsockname()</span></code> for items type.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.3.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.BaseRunner.sites">
<code class="sig-name descname">sites</code><a class="headerlink" href="#aiohttp.web.BaseRunner.sites" title="Permalink to this definition">¶</a></dt>
<dd><p>A read-only <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> of served sites (<a class="reference internal" href="#aiohttp.web.TCPSite" title="aiohttp.web.TCPSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">TCPSite</span></code></a> /
<a class="reference internal" href="#aiohttp.web.UnixSite" title="aiohttp.web.UnixSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnixSite</span></code></a> / <a class="reference internal" href="#aiohttp.web.NamedPipeSite" title="aiohttp.web.NamedPipeSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">NamedPipeSite</span></code></a> / <a class="reference internal" href="#aiohttp.web.SockSite" title="aiohttp.web.SockSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">SockSite</span></code></a> instances).</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.BaseRunner.setup">
<em class="property">coroutine </em><code class="sig-name descname">setup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.BaseRunner.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the server. Should be called before adding sites.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.BaseRunner.cleanup">
<em class="property">coroutine </em><code class="sig-name descname">cleanup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.BaseRunner.cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop handling all registered sites and cleanup used resources.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.AppRunner">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">AppRunner</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">*</em>, <em class="sig-param">handle_signals=False</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.AppRunner" title="Permalink to this definition">¶</a></dt>
<dd><p>A runner for <a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a>. Used with conjunction with sites
to serve on specific port.</p>
<p>Inherited from <a class="reference internal" href="#aiohttp.web.BaseRunner" title="aiohttp.web.BaseRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseRunner</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>app</strong> (<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><em>Application</em></a>) – web application instance to serve.</p></li>
<li><p><strong>handle_signals</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – add signal handlers for
<code class="xref py py-data docutils literal notranslate"><span class="pre">signal.SIGINT</span></code> and
<code class="xref py py-data docutils literal notranslate"><span class="pre">signal.SIGTERM</span></code> (<code class="docutils literal notranslate"><span class="pre">False</span></code> by
default).</p></li>
<li><p><strong>kwargs</strong> – named parameters to pass into
web protocol.</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.web.AppRunner.app">
<code class="sig-name descname">app</code><a class="headerlink" href="#aiohttp.web.AppRunner.app" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only attribute for accessing to <a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> served
instance.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.AppRunner.setup">
<em class="property">coroutine </em><code class="sig-name descname">setup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.AppRunner.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize application. Should be called before adding sites.</p>
<p>The method calls <a class="reference internal" href="#aiohttp.web.Application.on_startup" title="aiohttp.web.Application.on_startup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_startup</span></code></a> registered signals.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.AppRunner.cleanup">
<em class="property">coroutine </em><code class="sig-name descname">cleanup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.AppRunner.cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop handling all registered sites and cleanup used resources.</p>
<p><a class="reference internal" href="#aiohttp.web.Application.on_shutdown" title="aiohttp.web.Application.on_shutdown"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_shutdown</span></code></a> and
<a class="reference internal" href="#aiohttp.web.Application.on_cleanup" title="aiohttp.web.Application.on_cleanup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Application.on_cleanup</span></code></a> signals are called internally.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.ServerRunner">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">ServerRunner</code><span class="sig-paren">(</span><em class="sig-param">web_server</em>, <em class="sig-param">*</em>, <em class="sig-param">handle_signals=False</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.ServerRunner" title="Permalink to this definition">¶</a></dt>
<dd><p>A runner for low-level <a class="reference internal" href="#aiohttp.web.Server" title="aiohttp.web.Server"><code class="xref py py-class docutils literal notranslate"><span class="pre">Server</span></code></a>. Used with conjunction with sites
to serve on specific port.</p>
<p>Inherited from <a class="reference internal" href="#aiohttp.web.BaseRunner" title="aiohttp.web.BaseRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseRunner</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>web_server</strong> (<a class="reference internal" href="index.html#aiohttp.web.Server" title="aiohttp.web.Server"><em>Server</em></a>) – low-level web server instance to serve.</p></li>
<li><p><strong>handle_signals</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – add signal handlers for
<code class="xref py py-data docutils literal notranslate"><span class="pre">signal.SIGINT</span></code> and
<code class="xref py py-data docutils literal notranslate"><span class="pre">signal.SIGTERM</span></code> (<code class="docutils literal notranslate"><span class="pre">False</span></code> by
default).</p></li>
<li><p><strong>kwargs</strong> – named parameters to pass into
web protocol.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-lowlevel"><span class="std std-ref">Low Level Server</span></a> demonstrates low-level server usage</p>
</div>
</dd></dl>

<dl class="class">
<dt id="aiohttp.web.BaseSite">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">BaseSite</code><a class="headerlink" href="#aiohttp.web.BaseSite" title="Permalink to this definition">¶</a></dt>
<dd><p>An abstract class for handled sites.</p>
<dl class="attribute">
<dt id="aiohttp.web.BaseSite.name">
<code class="sig-name descname">name</code><a class="headerlink" href="#aiohttp.web.BaseSite.name" title="Permalink to this definition">¶</a></dt>
<dd><p>An identifier for site, read-only <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> property. Could
be a handled URL or UNIX socket path.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.BaseSite.start">
<em class="property">coroutine </em><code class="sig-name descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.BaseSite.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start handling a site.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.BaseSite.stop">
<em class="property">coroutine </em><code class="sig-name descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.BaseSite.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop handling a site.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.web.TCPSite">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">TCPSite</code><span class="sig-paren">(</span><em class="sig-param">runner</em>, <em class="sig-param">host=None</em>, <em class="sig-param">port=None</em>, <em class="sig-param">*</em>, <em class="sig-param">shutdown_timeout=60.0</em>, <em class="sig-param">ssl_context=None</em>, <em class="sig-param">backlog=128</em>, <em class="sig-param">reuse_address=None</em>, <em class="sig-param">reuse_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.TCPSite" title="Permalink to this definition">¶</a></dt>
<dd><p>Serve a runner on TCP socket.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>runner</strong> – a runner to serve.</p></li>
<li><p><strong>host</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – HOST to listen on, <code class="docutils literal notranslate"><span class="pre">'0.0.0.0'</span></code> if <code class="docutils literal notranslate"><span class="pre">None</span></code> (default).</p></li>
<li><p><strong>port</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – PORT to listed on, <code class="docutils literal notranslate"><span class="pre">8080</span></code> if <code class="docutils literal notranslate"><span class="pre">None</span></code> (default).</p></li>
<li><p><strong>shutdown_timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – a timeout for closing opened
connections on <a class="reference internal" href="#aiohttp.web.BaseSite.stop" title="aiohttp.web.BaseSite.stop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BaseSite.stop()</span></code></a>
call.</p></li>
<li><p><strong>ssl_context</strong> – a <a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> instance for serving
SSL/TLS secure server, <code class="docutils literal notranslate"><span class="pre">None</span></code> for plain HTTP
server (default).</p></li>
<li><p><strong>backlog</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>a number of unaccepted connections that the
system will allow before refusing new
connections, see <code class="xref py py-meth docutils literal notranslate"><span class="pre">socket.listen()</span></code> for details.</p>
<p><code class="docutils literal notranslate"><span class="pre">128</span></code> by default.</p>
</p></li>
<li><p><strong>reuse_address</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – tells the kernel to reuse a local socket in
TIME_WAIT state, without waiting for its
natural timeout to expire. If not specified
will automatically be set to True on UNIX.</p></li>
<li><p><strong>reuse_port</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – tells the kernel to allow this endpoint to be
bound to the same port as other existing
endpoints are bound to, so long as they all set
this flag when being created. This option is not
supported on Windows.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="aiohttp.web.UnixSite">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">UnixSite</code><span class="sig-paren">(</span><em class="sig-param">runner</em>, <em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">shutdown_timeout=60.0</em>, <em class="sig-param">ssl_context=None</em>, <em class="sig-param">backlog=128</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.UnixSite" title="Permalink to this definition">¶</a></dt>
<dd><p>Serve a runner on UNIX socket.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>runner</strong> – a runner to serve.</p></li>
<li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – PATH to UNIX socket to listen.</p></li>
<li><p><strong>shutdown_timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – a timeout for closing opened
connections on <a class="reference internal" href="#aiohttp.web.BaseSite.stop" title="aiohttp.web.BaseSite.stop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BaseSite.stop()</span></code></a>
call.</p></li>
<li><p><strong>ssl_context</strong> – a <a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> instance for serving
SSL/TLS secure server, <code class="docutils literal notranslate"><span class="pre">None</span></code> for plain HTTP
server (default).</p></li>
<li><p><strong>backlog</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>a number of unaccepted connections that the
system will allow before refusing new
connections, see <code class="xref py py-meth docutils literal notranslate"><span class="pre">socket.listen()</span></code> for details.</p>
<p><code class="docutils literal notranslate"><span class="pre">128</span></code> by default.</p>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="aiohttp.web.NamedPipeSite">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">NamedPipeSite</code><span class="sig-paren">(</span><em class="sig-param">runner</em>, <em class="sig-param">path</em>, <em class="sig-param">*</em>, <em class="sig-param">shutdown_timeout=60.0</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.NamedPipeSite" title="Permalink to this definition">¶</a></dt>
<dd><p>Serve a runner on Named Pipe in Windows.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>runner</strong> – a runner to serve.</p></li>
<li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – PATH of named pipe to listen.</p></li>
<li><p><strong>shutdown_timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – a timeout for closing opened
connections on <a class="reference internal" href="#aiohttp.web.BaseSite.stop" title="aiohttp.web.BaseSite.stop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BaseSite.stop()</span></code></a>
call.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="aiohttp.web.SockSite">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">SockSite</code><span class="sig-paren">(</span><em class="sig-param">runner</em>, <em class="sig-param">sock</em>, <em class="sig-param">*</em>, <em class="sig-param">shutdown_timeout=60.0</em>, <em class="sig-param">ssl_context=None</em>, <em class="sig-param">backlog=128</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.SockSite" title="Permalink to this definition">¶</a></dt>
<dd><p>Serve a runner on UNIX socket.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>runner</strong> – a runner to serve.</p></li>
<li><p><strong>sock</strong> – <code class="xref py py-class docutils literal notranslate"><span class="pre">socket.socket</span></code> to listen.</p></li>
<li><p><strong>shutdown_timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – a timeout for closing opened
connections on <a class="reference internal" href="#aiohttp.web.BaseSite.stop" title="aiohttp.web.BaseSite.stop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BaseSite.stop()</span></code></a>
call.</p></li>
<li><p><strong>ssl_context</strong> – a <a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> instance for serving
SSL/TLS secure server, <code class="docutils literal notranslate"><span class="pre">None</span></code> for plain HTTP
server (default).</p></li>
<li><p><strong>backlog</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>a number of unaccepted connections that the
system will allow before refusing new
connections, see <code class="xref py py-meth docutils literal notranslate"><span class="pre">socket.listen()</span></code> for details.</p>
<p><code class="docutils literal notranslate"><span class="pre">128</span></code> by default.</p>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="utilities">
<h5>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.web.FileField">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">FileField</code><a class="headerlink" href="#aiohttp.web.FileField" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">namedtuple</span></code> instance that is returned as
multidict value by <code class="xref py py-meth docutils literal notranslate"><span class="pre">Request.POST()</span></code> if field is uploaded file.</p>
<dl class="attribute">
<dt id="aiohttp.web.FileField.name">
<code class="sig-name descname">name</code><a class="headerlink" href="#aiohttp.web.FileField.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Field name</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.FileField.filename">
<code class="sig-name descname">filename</code><a class="headerlink" href="#aiohttp.web.FileField.filename" title="Permalink to this definition">¶</a></dt>
<dd><p>File name as specified by uploading (client) side.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.FileField.file">
<code class="sig-name descname">file</code><a class="headerlink" href="#aiohttp.web.FileField.file" title="Permalink to this definition">¶</a></dt>
<dd><p>An <a class="reference external" href="https://docs.python.org/3/library/io.html#io.IOBase" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.IOBase</span></code></a> instance with content of uploaded file.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.FileField.content_type">
<code class="sig-name descname">content_type</code><a class="headerlink" href="#aiohttp.web.FileField.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p><em>MIME type</em> of uploaded file, <code class="docutils literal notranslate"><span class="pre">'text/plain'</span></code> by default.</p>
</dd></dl>

<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-web-file-upload"><span class="std std-ref">File Uploads</span></a></p>
</div>
</dd></dl>

<dl class="function">
<dt id="aiohttp.web.run_app">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">run_app</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">*</em>, <em class="sig-param">host=None</em>, <em class="sig-param">port=None</em>, <em class="sig-param">path=None</em>, <em class="sig-param">sock=None</em>, <em class="sig-param">shutdown_timeout=60.0</em>, <em class="sig-param">ssl_context=None</em>, <em class="sig-param">print=print</em>, <em class="sig-param">backlog=128</em>, <em class="sig-param">access_log_class=aiohttp.helpers.AccessLogger</em>, <em class="sig-param">access_log_format=aiohttp.helpers.AccessLogger.LOG_FORMAT</em>, <em class="sig-param">access_log=aiohttp.log.access_logger</em>, <em class="sig-param">handle_signals=True</em>, <em class="sig-param">reuse_address=None</em>, <em class="sig-param">reuse_port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.run_app" title="Permalink to this definition">¶</a></dt>
<dd><p>A utility function for running an application, serving it until
keyboard interrupt and performing a
<a class="reference internal" href="index.html#aiohttp-web-graceful-shutdown"><span class="std std-ref">Graceful shutdown</span></a>.</p>
<p>Suitable as handy tool for scaffolding aiohttp based projects.
Perhaps production config will use more sophisticated runner but it
good enough at least at very beginning stage.</p>
<p>The server will listen on any host or Unix domain socket path you supply.
If no hosts or paths are supplied, or only a port is supplied, a TCP server
listening on 0.0.0.0 (all hosts) will be launched.</p>
<p>Distributing HTTP traffic to multiple hosts or paths on the same
application process provides no performance benefit as the requests are
handled on the same event loop. See <a class="reference internal" href="index.html#document-deployment"><span class="doc">Server Deployment</span></a> for ways of
distributing work for increased performance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>app</strong> – <a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a> instance to run or a <em>coroutine</em>
that returns an application.</p></li>
<li><p><strong>host</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – TCP/IP host or a sequence of hosts for HTTP server.
Default is <code class="docutils literal notranslate"><span class="pre">'0.0.0.0'</span></code> if <em>port</em> has been specified
or if <em>path</em> is not supplied.</p></li>
<li><p><strong>port</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – TCP/IP port for HTTP server. Default is <code class="docutils literal notranslate"><span class="pre">8080</span></code> for plain
text HTTP and <code class="docutils literal notranslate"><span class="pre">8443</span></code> for HTTP via SSL (when
<em>ssl_context</em> parameter is specified).</p></li>
<li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – file system path for HTTP server Unix domain socket.
A sequence of file system paths can be used to bind
multiple domain sockets. Listening on Unix domain
sockets is not supported by all operating systems.</p></li>
<li><p><strong>sock</strong> (<em>socket</em>) – a preexisting socket object to accept connections on.
A sequence of socket objects can be passed.</p></li>
<li><p><strong>shutdown_timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>a delay to wait for graceful server
shutdown before disconnecting all
open client sockets hard way.</p>
<p>A system with properly
<a class="reference internal" href="index.html#aiohttp-web-graceful-shutdown"><span class="std std-ref">Graceful shutdown</span></a>
implemented never waits for this
timeout but closes a server in a few
milliseconds.</p>
</p></li>
<li><p><strong>ssl_context</strong> – <a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLContext</span></code></a> for HTTPS server,
<code class="docutils literal notranslate"><span class="pre">None</span></code> for HTTP connection.</p></li>
<li><p><strong>print</strong> – a callable compatible with <a class="reference external" href="https://docs.python.org/3/library/functions.html#print" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">print()</span></code></a>. May be used
to override STDOUT output or suppress it. Passing <cite>None</cite>
disables output.</p></li>
<li><p><strong>backlog</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – the number of unaccepted connections that the
system will allow before refusing new
connections (<code class="docutils literal notranslate"><span class="pre">128</span></code> by default).</p></li>
<li><p><strong>access_log_class</strong> – class for <cite>access_logger</cite>. Default:
<code class="xref py py-data docutils literal notranslate"><span class="pre">aiohttp.helpers.AccessLogger</span></code>.
Must to be a subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.abc.AbstractAccessLogger</span></code>.</p></li>
<li><p><strong>access_log</strong> – <a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Logger</span></code></a> instance used for saving
access logs. Use <code class="docutils literal notranslate"><span class="pre">None</span></code> for disabling logs for
sake of speedup.</p></li>
<li><p><strong>access_log_format</strong> – access log format, see
<a class="reference internal" href="index.html#aiohttp-logging-access-log-format-spec"><span class="std std-ref">Format specification</span></a>
for details.</p></li>
<li><p><strong>handle_signals</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – override signal TERM handling to gracefully
exit the application.</p></li>
<li><p><strong>reuse_address</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – tells the kernel to reuse a local socket in
TIME_WAIT state, without waiting for its
natural timeout to expire. If not specified
will automatically be set to True on UNIX.</p></li>
<li><p><strong>reuse_port</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – tells the kernel to allow this endpoint to be
bound to the same port as other existing
endpoints are bound to, so long as they all set
this flag when being created. This option is not
supported on Windows.</p></li>
</ul>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0: </span>Support <em>access_log_class</em> parameter.</p>
<p>Support <em>reuse_address</em>, <em>reuse_port</em> parameter.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.1: </span>Accept a coroutine as <em>app</em> parameter.</p>
</div>
</dd></dl>

</div>
<div class="section" id="constants">
<h5>Constants<a class="headerlink" href="#constants" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.web.ContentCoding">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">ContentCoding</code><a class="headerlink" href="#aiohttp.web.ContentCoding" title="Permalink to this definition">¶</a></dt>
<dd><p>An <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></a> class of available Content Codings.</p>
<dl class="attribute">
<dt id="aiohttp.web.ContentCoding.deflate">
<code class="sig-name descname">deflate</code><a class="headerlink" href="#aiohttp.web.ContentCoding.deflate" title="Permalink to this definition">¶</a></dt>
<dd><p><em>DEFLATE compression</em></p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.ContentCoding.gzip">
<code class="sig-name descname">gzip</code><a class="headerlink" href="#aiohttp.web.ContentCoding.gzip" title="Permalink to this definition">¶</a></dt>
<dd><p><em>GZIP compression</em></p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.ContentCoding.identity">
<code class="sig-name descname">identity</code><a class="headerlink" href="#aiohttp.web.ContentCoding.identity" title="Permalink to this definition">¶</a></dt>
<dd><p><em>no compression</em></p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="middlewares">
<h5>Middlewares<a class="headerlink" href="#middlewares" title="Permalink to this headline">¶</a></h5>
<div class="section" id="normalize-path-middleware">
<h6>Normalize path middleware<a class="headerlink" href="#normalize-path-middleware" title="Permalink to this headline">¶</a></h6>
<dl class="function">
<dt id="aiohttp.web.normalize_path_middleware">
<code class="sig-prename descclassname">aiohttp.web.</code><code class="sig-name descname">normalize_path_middleware</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">append_slash=True</em>, <em class="sig-param">remove_slash=False</em>, <em class="sig-param">merge_slashes=True</em>, <em class="sig-param">redirect_class=HTTPPermanentRedirect</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.web.normalize_path_middleware" title="Permalink to this definition">¶</a></dt>
<dd><p>Middleware factory which produces a middleware that normalizes
the path of a request. By normalizing it means:</p>
<blockquote>
<div><ul class="simple">
<li><p>Add or remove a trailing slash to the path.</p></li>
<li><p>Double slashes are replaced by one.</p></li>
</ul>
</div></blockquote>
<p>The middleware returns as soon as it finds a path that resolves
correctly. The order if both merge and append/remove are enabled is:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><em>merge_slashes</em></p></li>
<li><p><em>append_slash</em> or <em>remove_slash</em></p></li>
<li><p>both <em>merge_slashes</em> and <em>append_slash</em> or <em>remove_slash</em></p></li>
</ol>
</div></blockquote>
<p>If the path resolves with at least one of those conditions, it will
redirect to the new path.</p>
<p>Only one of <em>append_slash</em> and <em>remove_slash</em> can be enabled. If both are
<code class="docutils literal notranslate"><span class="pre">True</span></code> the factory will raise an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code></p>
<p>If <em>append_slash</em> is <code class="docutils literal notranslate"><span class="pre">True</span></code> the middleware will append a slash when
needed. If a resource is defined with trailing slash and the request
comes without it, it will append it automatically.</p>
<p>If <em>remove_slash</em> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, <em>append_slash</em> must be <code class="docutils literal notranslate"><span class="pre">False</span></code>. When enabled
the middleware will remove trailing slashes and redirect if the resource is
defined.</p>
<p>If <em>merge_slashes</em> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, merge multiple consecutive slashes in the
path into one.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.4: </span>Support for <em>remove_slash</em></p>
</div>
</dd></dl>

</div>
</div>
</div>
<span id="document-logging"></span><div class="section" id="logging">
<span id="aiohttp-logging"></span><h4>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h4>
<p><em>aiohttp</em> uses standard <a class="reference external" href="https://docs.python.org/3/library/logging.html#module-logging" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> for tracking the
library activity.</p>
<p>We have the following loggers enumerated by names:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'aiohttp.access'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'aiohttp.client'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'aiohttp.internal'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'aiohttp.server'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'aiohttp.web'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'aiohttp.websocket'</span></code></p></li>
</ul>
<p>You may subscribe to these loggers for getting logging messages.  The
page does not provide instructions for logging subscribing while the
most friendly method is <a class="reference external" href="https://docs.python.org/3/library/logging.config.html#logging.config.dictConfig" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">logging.config.dictConfig()</span></code></a> for
configuring whole loggers in your application.</p>
<p>Logging does not work out of the box. It requires at least minimal <code class="docutils literal notranslate"><span class="pre">'logging'</span></code>
configuration.
Example of minimal working logger setup:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 4.0.0.</span></p>
</div>
<div class="section" id="access-logs">
<h5>Access logs<a class="headerlink" href="#access-logs" title="Permalink to this headline">¶</a></h5>
<p>Access logs are enabled by default. If the <cite>debug</cite> flag is set, and the default
logger <code class="docutils literal notranslate"><span class="pre">'aiohttp.access'</span></code> is used, access logs will be output to
<a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.stderr" title="(in Python v3.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">stderr</span></code></a> if no handlers are attached.
Furthermore, if the default logger has no log level set, the log level will be
set to <code class="xref py py-obj docutils literal notranslate"><span class="pre">logging.DEBUG</span></code>.</p>
<p>This logging may be controlled by <a class="reference internal" href="index.html#aiohttp.web.AppRunner" title="aiohttp.web.AppRunner"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.web.AppRunner()</span></code></a> and
<a class="reference internal" href="index.html#aiohttp.web.run_app" title="aiohttp.web.run_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp.web.run_app()</span></code></a>.</p>
<p>To override the default logger, pass an instance of <a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Logger</span></code></a> to
override the default logger.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">web.run_app(app,</span> <span class="pre">access_log=None)</span></code> to disable access logs.</p>
</div>
<p>In addition, <em>access_log_format</em> may be used to specify the log format.</p>
<div class="section" id="format-specification">
<span id="aiohttp-logging-access-log-format-spec"></span><h6>Format specification<a class="headerlink" href="#format-specification" title="Permalink to this headline">¶</a></h6>
<p>The library provides custom micro-language to specifying info about
request and response:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%%</span></code></p></td>
<td><p>The percent sign</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%a</span></code></p></td>
<td><p>Remote IP-address
(IP-address of proxy if using reverse proxy)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%t</span></code></p></td>
<td><p>Time when the request was started to process</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%P</span></code></p></td>
<td><p>The process ID of the child that serviced the request</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%r</span></code></p></td>
<td><p>First line of request</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%s</span></code></p></td>
<td><p>Response status code</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%b</span></code></p></td>
<td><p>Size of response in bytes, including HTTP headers</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%T</span></code></p></td>
<td><p>The time taken to serve the request, in seconds</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%Tf</span></code></p></td>
<td><p>The time taken to serve the request, in seconds
with fraction in %.06f format</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%D</span></code></p></td>
<td><p>The time taken to serve the request, in microseconds</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">%{FOO}i</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">request.headers['FOO']</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">%{FOO}o</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">response.headers['FOO']</span></code></p></td>
</tr>
</tbody>
</table>
<p>The default access log format is:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1"> %t &quot;</span><span class="si">%r</span><span class="s1">&quot; </span><span class="si">%s</span><span class="s1"> %b &quot;%</span><span class="si">{Referer}</span><span class="s1">i&quot; &quot;%{User-Agent}i&quot;&#39;</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.0.</span></p>
</div>
<p><em>access_log_class</em> introduced.</p>
<p>Example of a drop-in replacement for the default access logger:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp.abc</span> <span class="k">import</span> <span class="n">AbstractAccessLogger</span>

<span class="k">class</span> <span class="nc">AccessLogger</span><span class="p">(</span><span class="n">AbstractAccessLogger</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{request.remote}</span><span class="s1"> &#39;</span>
                         <span class="n">f</span><span class="s1">&#39;&quot;</span><span class="si">{request.method}</span><span class="s1"> </span><span class="si">{request.path}</span><span class="s1"> &#39;</span>
                         <span class="n">f</span><span class="s1">&#39;done in </span><span class="si">{time}</span><span class="s1">s: </span><span class="si">{response.status}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="gunicorn-access-logs">
<span id="gunicorn-accesslog"></span><h6>Gunicorn access logs<a class="headerlink" href="#gunicorn-access-logs" title="Permalink to this headline">¶</a></h6>
<p>When <a class="reference external" href="http://docs.gunicorn.org/en/latest/index.html">Gunicorn</a> is used for
<a class="reference internal" href="index.html#aiohttp-deployment-gunicorn"><span class="std std-ref">deployment</span></a>, its default access log format
will be automatically replaced with the default aiohttp’s access log format.</p>
<p>If Gunicorn’s option <a class="reference external" href="http://docs.gunicorn.org/en/stable/settings.html#access-log-format">access_logformat</a> is
specified explicitly, it should use aiohttp’s format specification.</p>
<p>Gunicorn’s access log works only if <a class="reference external" href="http://docs.gunicorn.org/en/stable/settings.html#accesslog">accesslog</a> is specified explicitly in your
config or as a command line option.
This configuration can be either a path or <code class="docutils literal notranslate"><span class="pre">'-'</span></code>. If the application uses
a custom logging setup intercepting the <code class="docutils literal notranslate"><span class="pre">'gunicorn.access'</span></code> logger,
<a class="reference external" href="http://docs.gunicorn.org/en/stable/settings.html#accesslog">accesslog</a> should be set to <code class="docutils literal notranslate"><span class="pre">'-'</span></code> to prevent Gunicorn to create an empty
access log file upon every startup.</p>
</div>
</div>
<div class="section" id="error-logs">
<h5>Error logs<a class="headerlink" href="#error-logs" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> uses a logger named <code class="docutils literal notranslate"><span class="pre">'aiohttp.server'</span></code> to store errors
given on web requests handling.</p>
<p>This log is enabled by default.</p>
<p>To use a different logger name, pass <em>logger</em> (<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Logger" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Logger</span></code></a>
instance) to the <a class="reference internal" href="index.html#aiohttp.web.AppRunner" title="aiohttp.web.AppRunner"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.web.AppRunner()</span></code></a> constructor.</p>
</div>
</div>
<span id="document-testing"></span><div class="section" id="testing">
<span id="aiohttp-testing"></span><h4>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h4>
<div class="section" id="testing-aiohttp-web-servers">
<h5>Testing aiohttp web servers<a class="headerlink" href="#testing-aiohttp-web-servers" title="Permalink to this headline">¶</a></h5>
<p>aiohttp provides plugin for <em>pytest</em> making writing web server tests
extremely easy, it also provides <a class="reference internal" href="#aiohttp-testing-framework-agnostic-utilities"><span class="std std-ref">test framework agnostic
utilities</span></a> for testing
with other frameworks such as <a class="reference internal" href="#aiohttp-testing-unittest-example"><span class="std std-ref">unittest</span></a>.</p>
<p>Before starting to write your tests, you may also be interested on
reading <a class="reference internal" href="#aiohttp-testing-writing-testable-services"><span class="std std-ref">how to write testable
services</span></a> that interact
with the loop.</p>
<p>For using pytest plugin please install <a class="reference external" href="https://pypi.python.org/pypi/pytest-aiohttp">pytest-aiohttp</a> library:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ pip install pytest-aiohttp
</pre></div>
</div>
<p>If you don’t want to install <em>pytest-aiohttp</em> for some reason you may
insert <code class="docutils literal notranslate"><span class="pre">pytest_plugins</span> <span class="pre">=</span> <span class="pre">'aiohttp.pytest_plugin'</span></code> line into
<code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> instead for the same functionality.</p>
<div class="section" id="provisional-status">
<h6>Provisional Status<a class="headerlink" href="#provisional-status" title="Permalink to this headline">¶</a></h6>
<p>The module is a <strong>provisional</strong>.</p>
<p><em>aiohttp</em> has a year and half period for removing deprecated API
(<a class="reference internal" href="index.html#aiohttp-backward-compatibility-policy"><span class="std std-ref">Policy for Backward Incompatible Changes</span></a>).</p>
<p>But for <code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.test_tools</span></code> the deprecation period could be reduced.</p>
<p>Moreover we may break <em>backward compatibility</em> without <em>deprecation
period</em> for some very strong reason.</p>
</div>
<div class="section" id="the-test-client-and-servers">
<h6>The Test Client and Servers<a class="headerlink" href="#the-test-client-and-servers" title="Permalink to this headline">¶</a></h6>
<p><em>aiohttp</em> test utils provides a scaffolding for testing aiohttp-based
web servers.</p>
<p>They are consist of two parts: running test server and making HTTP
requests to this server.</p>
<p><a class="reference internal" href="#aiohttp.test_utils.TestServer" title="aiohttp.test_utils.TestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestServer</span></code></a> runs <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a>
based server, <a class="reference internal" href="#aiohttp.test_utils.RawTestServer" title="aiohttp.test_utils.RawTestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">RawTestServer</span></code></a> starts
<code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.WebServer</span></code> low level server.</p>
<p>For performing HTTP requests to these servers you have to create a
test client: <a class="reference internal" href="#aiohttp.test_utils.TestClient" title="aiohttp.test_utils.TestClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestClient</span></code></a> instance.</p>
<p>The client incapsulates <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.ClientSession</span></code></a> by providing
proxy methods to the client for common operations such as
<em>ws_connect</em>, <em>get</em>, <em>post</em>, etc.</p>
</div>
<div class="section" id="pytest">
<h6>Pytest<a class="headerlink" href="#pytest" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#pytest_aiohttp.aiohttp_client" title="pytest_aiohttp.aiohttp_client"><code class="xref py py-data docutils literal notranslate"><span class="pre">aiohttp_client</span></code></a> fixture available from <a class="reference external" href="https://pypi.python.org/pypi/pytest-aiohttp">pytest-aiohttp</a> plugin
allows you to create a client to make requests to test your app.</p>
<p>A simple would be:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Hello, world&#39;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">test_hello</span><span class="p">(</span><span class="n">aiohttp_client</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">hello</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aiohttp_client</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="n">text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s1">&#39;Hello, world&#39;</span> <span class="ow">in</span> <span class="n">text</span>
</pre></div>
</div>
<p>It also provides access to the app instance allowing tests to check the state
of the app. Tests can be made even more succinct with a fixture to create an
app test client:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">previous</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">post</span><span class="p">())[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;thanks for the data&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span>
        <span class="n">body</span><span class="o">=</span><span class="s1">&#39;value: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">cli</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">aiohttp_client</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">previous</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">previous</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">aiohttp_client</span><span class="p">(</span><span class="n">app</span><span class="p">))</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">test_set_value</span><span class="p">(</span><span class="n">cli</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">cli</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;thanks for the data&#39;</span>
    <span class="k">assert</span> <span class="n">cli</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">test_get_value</span><span class="p">(</span><span class="n">cli</span><span class="p">):</span>
    <span class="n">cli</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">cli</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;value: bar&#39;</span>
</pre></div>
</div>
<p>Pytest tooling has the following fixtures:</p>
<dl class="data">
<dt id="pytest_aiohttp.aiohttp_server">
<code class="sig-prename descclassname">pytest_aiohttp.</code><code class="sig-name descname">aiohttp_server</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">*</em>, <em class="sig-param">port=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pytest_aiohttp.aiohttp_server" title="Permalink to this definition">¶</a></dt>
<dd><p>A fixture factory that creates
<a class="reference internal" href="#aiohttp.test_utils.TestServer" title="aiohttp.test_utils.TestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestServer</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">test_f</span><span class="p">(</span><span class="n">aiohttp_server</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="c1"># fill route table</span>

    <span class="n">server</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aiohttp_server</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>The server will be destroyed on exit from test function.</p>
<dl class="simple">
<dt><em>app</em> is the <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a> used</dt><dd><p>to start server.</p>
</dd>
</dl>
<p><em>port</em> optional, port the server is run at, if
not provided a random unused port is used.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
<dl class="simple">
<dt><em>kwargs</em> are parameters passed to</dt><dd><p><a class="reference internal" href="index.html#aiohttp.web.Application.make_handler" title="aiohttp.web.Application.make_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.web.Application.make_handler()</span></code></a></p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0.</span></p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.2: </span>The fixture was renamed from <code class="docutils literal notranslate"><span class="pre">test_server</span></code> to <code class="docutils literal notranslate"><span class="pre">aiohttp_server</span></code>.</p>
</div>
</dd></dl>

<dl class="data">
<dt id="pytest_aiohttp.aiohttp_client">
<code class="sig-prename descclassname">pytest_aiohttp.</code><code class="sig-name descname">aiohttp_client</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">server_kwargs=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pytest_aiohttp.aiohttp_client" title="Permalink to this definition">¶</a></dt>
<dt>
<code class="sig-prename descclassname">pytest_aiohttp.</code><code class="sig-name descname">aiohttp_client</code><span class="sig-paren">(</span><em class="sig-param">server</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span></dt>
<dt>
<code class="sig-prename descclassname">pytest_aiohttp.</code><code class="sig-name descname">aiohttp_client</code><span class="sig-paren">(</span><em class="sig-param">raw_server</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>A fixture factory that creates
<a class="reference internal" href="#aiohttp.test_utils.TestClient" title="aiohttp.test_utils.TestClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestClient</span></code></a> for access to tested server:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">test_f</span><span class="p">(</span><span class="n">aiohttp_client</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="c1"># fill route table</span>

    <span class="n">client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aiohttp_client</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><em>client</em> and responses are cleaned up after test function finishing.</p>
<p>The fixture accepts <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a>,
<a class="reference internal" href="#aiohttp.test_utils.TestServer" title="aiohttp.test_utils.TestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.test_utils.TestServer</span></code></a> or
<a class="reference internal" href="#aiohttp.test_utils.RawTestServer" title="aiohttp.test_utils.RawTestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.test_utils.RawTestServer</span></code></a> instance.</p>
<p><em>server_kwargs</em> are parameters passed to the test server if an app
is passed, else ignored.</p>
<p><em>kwargs</em> are parameters passed to
<a class="reference internal" href="#aiohttp.test_utils.TestClient" title="aiohttp.test_utils.TestClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.test_utils.TestClient</span></code></a> constructor.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The fixture was renamed from <code class="docutils literal notranslate"><span class="pre">test_client</span></code> to <code class="docutils literal notranslate"><span class="pre">aiohttp_client</span></code>.</p>
</div>
</dd></dl>

<dl class="data">
<dt id="pytest_aiohttp.aiohttp_raw_server">
<code class="sig-prename descclassname">pytest_aiohttp.</code><code class="sig-name descname">aiohttp_raw_server</code><span class="sig-paren">(</span><em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">port=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pytest_aiohttp.aiohttp_raw_server" title="Permalink to this definition">¶</a></dt>
<dd><p>A fixture factory that creates
<a class="reference internal" href="#aiohttp.test_utils.RawTestServer" title="aiohttp.test_utils.RawTestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">RawTestServer</span></code></a> instance from given web
handler.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">test_f</span><span class="p">(</span><span class="n">aiohttp_raw_server</span><span class="p">,</span> <span class="n">aiohttp_client</span><span class="p">):</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;OK&quot;</span><span class="p">)</span>

    <span class="n">raw_server</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aiohttp_raw_server</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aiohttp_client</span><span class="p">(</span><span class="n">raw_server</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><em>handler</em> should be a coroutine which accepts a request and returns
response, e.g.</p>
<p><em>port</em> optional, port the server is run at, if
not provided a random unused port is used.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</dd></dl>

<dl class="data">
<dt id="pytest_aiohttp.aiohttp_unused_port">
<code class="sig-prename descclassname">pytest_aiohttp.</code><code class="sig-name descname">aiohttp_unused_port</code><a class="headerlink" href="#pytest_aiohttp.aiohttp_unused_port" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to return an unused port number for IPv4 TCP protocol:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">test_f</span><span class="p">(</span><span class="n">aiohttp_client</span><span class="p">,</span> <span class="n">aiohttp_unused_port</span><span class="p">):</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">aiohttp_unused_port</span><span class="p">()</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="c1"># fill route table</span>

    <span class="n">client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aiohttp_client</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">server_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="n">port</span><span class="p">})</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>The fixture was renamed from <code class="docutils literal notranslate"><span class="pre">unused_port</span></code> to <code class="docutils literal notranslate"><span class="pre">aiohttp_unused_port</span></code>.</p>
</div>
</dd></dl>

</div>
<div class="section" id="unittest">
<span id="aiohttp-testing-unittest-style"></span><span id="aiohttp-testing-unittest-example"></span><h6>Unittest<a class="headerlink" href="#unittest" title="Permalink to this headline">¶</a></h6>
<p>To test applications with the standard library’s unittest or unittest-based
functionality, the AioHTTPTestCase is provided:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp.test_utils</span> <span class="k">import</span> <span class="n">AioHTTPTestCase</span><span class="p">,</span> <span class="n">unittest_run_loop</span>
<span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="k">class</span> <span class="nc">MyAppTestCase</span><span class="p">(</span><span class="n">AioHTTPTestCase</span><span class="p">):</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_application</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override the get_app method to return your application.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;Hello, world&#39;</span><span class="p">)</span>

        <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">hello</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">app</span>

    <span class="c1"># the unittest_run_loop decorator can be used in tandem with</span>
    <span class="c1"># the AioHTTPTestCase to simplify running</span>
    <span class="c1"># tests that are asynchronous</span>
    <span class="nd">@unittest_run_loop</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">test_example</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="n">text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">assert</span> <span class="s2">&quot;Hello, world&quot;</span> <span class="ow">in</span> <span class="n">text</span>

    <span class="c1"># a vanilla example</span>
    <span class="k">def</span> <span class="nf">test_example_vanilla</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">test_get_route</span><span class="p">():</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
            <span class="n">text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">assert</span> <span class="s2">&quot;Hello, world&quot;</span> <span class="ow">in</span> <span class="n">text</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">test_get_route</span><span class="p">())</span>
</pre></div>
</div>
<dl class="class">
<dt id="aiohttp.test_utils.AioHTTPTestCase">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.test_utils.</code><code class="sig-name descname">AioHTTPTestCase</code><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>A base class to allow for unittest web applications using aiohttp.</p>
<p>Derived from <a class="reference external" href="https://docs.python.org/3/library/unittest.html#unittest.TestCase" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">unittest.TestCase</span></code></a></p>
<p>Provides the following:</p>
<dl class="attribute">
<dt id="aiohttp.test_utils.AioHTTPTestCase.client">
<code class="sig-name descname">client</code><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase.client" title="Permalink to this definition">¶</a></dt>
<dd><p>an aiohttp test client, <a class="reference internal" href="#aiohttp.test_utils.TestClient" title="aiohttp.test_utils.TestClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestClient</span></code></a> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.AioHTTPTestCase.server">
<code class="sig-name descname">server</code><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase.server" title="Permalink to this definition">¶</a></dt>
<dd><p>an aiohttp test server, <a class="reference internal" href="#aiohttp.test_utils.TestServer" title="aiohttp.test_utils.TestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestServer</span></code></a> instance.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.AioHTTPTestCase.loop">
<code class="sig-name descname">loop</code><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase.loop" title="Permalink to this definition">¶</a></dt>
<dd><p>The event loop in which the application and server are running.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.5.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.AioHTTPTestCase.app">
<code class="sig-name descname">app</code><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase.app" title="Permalink to this definition">¶</a></dt>
<dd><p>The application returned by <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_app()</span></code>
(<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a> instance).</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.AioHTTPTestCase.get_client">
<em class="property">coroutine </em><code class="sig-name descname">get_client</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase.get_client" title="Permalink to this definition">¶</a></dt>
<dd><p>This async method can be overridden to return the <a class="reference internal" href="#aiohttp.test_utils.TestClient" title="aiohttp.test_utils.TestClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestClient</span></code></a>
object used in the test.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><a class="reference internal" href="#aiohttp.test_utils.TestClient" title="aiohttp.test_utils.TestClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestClient</span></code></a> instance.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.AioHTTPTestCase.get_server">
<em class="property">coroutine </em><code class="sig-name descname">get_server</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase.get_server" title="Permalink to this definition">¶</a></dt>
<dd><p>This async method can be overridden to return the <a class="reference internal" href="#aiohttp.test_utils.TestServer" title="aiohttp.test_utils.TestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestServer</span></code></a>
object used in the test.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><a class="reference internal" href="#aiohttp.test_utils.TestServer" title="aiohttp.test_utils.TestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestServer</span></code></a> instance.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.AioHTTPTestCase.get_application">
<em class="property">coroutine </em><code class="sig-name descname">get_application</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase.get_application" title="Permalink to this definition">¶</a></dt>
<dd><p>This async method should be overridden
to return the <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a>
object to test.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a> instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.AioHTTPTestCase.setUpAsync">
<em class="property">coroutine </em><code class="sig-name descname">setUpAsync</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase.setUpAsync" title="Permalink to this definition">¶</a></dt>
<dd><p>This async method do nothing by default and can be overridden to execute
asynchronous code during the <code class="docutils literal notranslate"><span class="pre">setUp</span></code> stage of the <code class="docutils literal notranslate"><span class="pre">TestCase</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.AioHTTPTestCase.tearDownAsync">
<em class="property">coroutine </em><code class="sig-name descname">tearDownAsync</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase.tearDownAsync" title="Permalink to this definition">¶</a></dt>
<dd><p>This async method do nothing by default and can be overridden to execute
asynchronous code during the <code class="docutils literal notranslate"><span class="pre">tearDown</span></code> stage of the <code class="docutils literal notranslate"><span class="pre">TestCase</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.AioHTTPTestCase.setUp">
<code class="sig-name descname">setUp</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase.setUp" title="Permalink to this definition">¶</a></dt>
<dd><p>Standard test initialization method.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.AioHTTPTestCase.tearDown">
<code class="sig-name descname">tearDown</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.AioHTTPTestCase.tearDown" title="Permalink to this definition">¶</a></dt>
<dd><p>Standard test finalization method.</p>
</dd></dl>

</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">TestClient</span></code>’s methods are asynchronous: you have to
execute function on the test client using asynchronous methods.</p>
<p>A basic test class wraps every test method by
<code class="xref py py-func docutils literal notranslate"><span class="pre">unittest_run_loop()</span></code> decorator:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestA</span><span class="p">(</span><span class="n">AioHTTPTestCase</span><span class="p">):</span>

    <span class="nd">@unittest_run_loop</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">test_f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="function">
<dt>
<code class="sig-name descname">unittest_run_loop:</code></dt>
<dd><p>A decorator dedicated to use with asynchronous methods of an
<a class="reference internal" href="#aiohttp.test_utils.AioHTTPTestCase" title="aiohttp.test_utils.AioHTTPTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">AioHTTPTestCase</span></code></a>.</p>
<p>Handles executing an asynchronous function, using
the <a class="reference internal" href="#aiohttp.test_utils.AioHTTPTestCase.loop" title="aiohttp.test_utils.AioHTTPTestCase.loop"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AioHTTPTestCase.loop</span></code></a> of the <a class="reference internal" href="#aiohttp.test_utils.AioHTTPTestCase" title="aiohttp.test_utils.AioHTTPTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">AioHTTPTestCase</span></code></a>.</p>
</dd></dl>

</div>
</div>
<div class="section" id="faking-request-object">
<h5>Faking request object<a class="headerlink" href="#faking-request-object" title="Permalink to this headline">¶</a></h5>
<p>aiohttp provides test utility for creating fake
<a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Request</span></code></a> objects:
<a class="reference internal" href="#aiohttp.test_utils.make_mocked_request" title="aiohttp.test_utils.make_mocked_request"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp.test_utils.make_mocked_request()</span></code></a>, it could be useful in
case of simple unit tests, like handler tests, or simulate error
conditions that hard to reproduce on real server:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>
<span class="kn">from</span> <span class="nn">aiohttp.test_utils</span> <span class="k">import</span> <span class="n">make_mocked_request</span>

<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_handler</span><span class="p">():</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">make_mocked_request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">})</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">body</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;data&#39;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>We don’t recommend to apply
<a class="reference internal" href="#aiohttp.test_utils.make_mocked_request" title="aiohttp.test_utils.make_mocked_request"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_mocked_request()</span></code></a> everywhere for
testing web-handler’s business object – please use test client and
real networking via ‘localhost’ as shown in examples before.</p>
<p><a class="reference internal" href="#aiohttp.test_utils.make_mocked_request" title="aiohttp.test_utils.make_mocked_request"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_mocked_request()</span></code></a> exists only for
testing complex cases (e.g. emulating network errors) which
are extremely hard or even impossible to test by conventional
way.</p>
</div>
<dl class="function">
<dt id="aiohttp.test_utils.make_mocked_request">
<code class="sig-prename descclassname">aiohttp.test_utils.</code><code class="sig-name descname">make_mocked_request</code><span class="sig-paren">(</span><em class="sig-param">method</em>, <em class="sig-param">path</em>, <em class="sig-param">headers=None</em>, <em class="sig-param">*</em>, <em class="sig-param">version=HttpVersion(1</em>, <em class="sig-param">1)</em>, <em class="sig-param">closing=False</em>, <em class="sig-param">app=None</em>, <em class="sig-param">match_info=sentinel</em>, <em class="sig-param">reader=sentinel</em>, <em class="sig-param">writer=sentinel</em>, <em class="sig-param">transport=sentinel</em>, <em class="sig-param">payload=sentinel</em>, <em class="sig-param">sslcontext=None</em>, <em class="sig-param">loop=...</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.make_mocked_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates mocked web.Request testing purposes.</p>
<p>Useful in unit tests, when spinning full web server is overkill or
specific conditions and errors are hard to trigger.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – str, that represents HTTP method, like; GET, POST.</p></li>
<li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – str, The URL including <em>PATH INFO</em> without the host or scheme</p></li>
<li><p><strong>headers</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a><em>, </em><a class="reference external" href="https://multidict.readthedocs.io/en/stable/multidict.html#multidict.CIMultiDict" title="(in multidict v4.5)"><em>multidict.CIMultiDict</em></a><em>, </em><em>list of pairs</em>) – mapping containing the headers. Can be anything accepted
by the multidict.CIMultiDict constructor.</p></li>
<li><p><strong>match_info</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – mapping containing the info to match with url parameters.</p></li>
<li><p><strong>version</strong> (<em>aiohttp.protocol.HttpVersion</em>) – namedtuple with encoded HTTP version</p></li>
<li><p><strong>closing</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – flag indicates that connection should be closed after
response.</p></li>
<li><p><strong>app</strong> (<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><em>aiohttp.web.Application</em></a>) – the aiohttp.web application attached for fake request</p></li>
<li><p><strong>writer</strong> (<em>aiohttp.StreamWriter</em>) – object for managing outcoming data</p></li>
<li><p><strong>transport</strong> (<em>asyncio.transports.Transport</em>) – asyncio transport instance</p></li>
<li><p><strong>payload</strong> (<a class="reference internal" href="index.html#aiohttp.StreamReader" title="aiohttp.StreamReader"><em>aiohttp.StreamReader</em></a>) – raw payload reader object</p></li>
<li><p><strong>sslcontext</strong> (<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext" title="(in Python v3.7)"><em>ssl.SSLContext</em></a>) – ssl.SSLContext object, for HTTPS connection</p></li>
<li><p><strong>loop</strong> (<a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.AbstractEventLoop" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.AbstractEventLoop</span></code></a>) – An event loop instance, mocked loop by default.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Request</span></code></a> object.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3: </span><em>match_info</em> parameter.</p>
</div>
</dd></dl>

<div class="section" id="framework-agnostic-utilities">
<span id="aiohttp-testing-framework-agnostic-utilities"></span><span id="aiohttp-testing-writing-testable-services"></span><h6>Framework Agnostic Utilities<a class="headerlink" href="#framework-agnostic-utilities" title="Permalink to this headline">¶</a></h6>
<p>High level test creation:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp.test_utils</span> <span class="k">import</span> <span class="n">TestClient</span><span class="p">,</span> <span class="n">TestServer</span><span class="p">,</span> <span class="n">loop_context</span>
<span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">request</span>

<span class="c1"># loop_context is provided as a utility. You can use any</span>
<span class="c1"># asyncio.BaseEventLoop class in its place.</span>
<span class="k">with</span> <span class="n">loop_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">loop</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">_create_example_app</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">TestServer</span><span class="p">(</span><span class="n">app</span><span class="p">),</span> <span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">test_get_route</span><span class="p">():</span>
            <span class="k">nonlocal</span> <span class="n">client</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
            <span class="n">text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="k">assert</span> <span class="s2">&quot;Hello, world&quot;</span> <span class="ow">in</span> <span class="n">text</span>

        <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">test_get_route</span><span class="p">())</span>
</pre></div>
</div>
<p>If it’s preferred to handle the creation / teardown on a more granular
basis, the TestClient object can be used directly:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp.test_utils</span> <span class="k">import</span> <span class="n">TestClient</span><span class="p">,</span> <span class="n">TestServer</span>

<span class="k">with</span> <span class="n">loop_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">loop</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">_create_example_app</span><span class="p">()</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">TestServer</span><span class="p">(</span><span class="n">app</span><span class="p">),</span> <span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">start_server</span><span class="p">())</span>
    <span class="n">root</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">test_get_route</span><span class="p">():</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="n">text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">assert</span> <span class="s2">&quot;Hello, world&quot;</span> <span class="ow">in</span> <span class="n">text</span>

    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">test_get_route</span><span class="p">())</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">())</span>
</pre></div>
</div>
<p>A full list of the utilities provided can be found at the
<code class="xref py py-data docutils literal notranslate"><span class="pre">api</span> <span class="pre">reference</span></code></p>
</div>
</div>
<div class="section" id="testing-api-reference">
<h5>Testing API Reference<a class="headerlink" href="#testing-api-reference" title="Permalink to this headline">¶</a></h5>
<div class="section" id="test-server">
<h6>Test server<a class="headerlink" href="#test-server" title="Permalink to this headline">¶</a></h6>
<p>Runs given <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a> instance on random TCP port.</p>
<p>After creation the server is not started yet, use
<code class="xref py py-meth docutils literal notranslate"><span class="pre">start_server()</span></code> for actual server
starting and <code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code> for
stopping/cleanup.</p>
<p>Test server usually works in conjunction with
<a class="reference internal" href="#aiohttp.test_utils.TestClient" title="aiohttp.test_utils.TestClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.test_utils.TestClient</span></code></a> which provides handy client methods
for accessing to the server.</p>
<dl class="class">
<dt id="aiohttp.test_utils.BaseTestServer">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.test_utils.</code><code class="sig-name descname">BaseTestServer</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">scheme='http'</em>, <em class="sig-param">host='127.0.0.1'</em>, <em class="sig-param">port=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.BaseTestServer" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for test servers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scheme</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – HTTP scheme, non-protected <code class="docutils literal notranslate"><span class="pre">&quot;http&quot;</span></code> by default.</p></li>
<li><p><strong>host</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – a host for TCP socket, IPv4 <em>local host</em>
(<code class="docutils literal notranslate"><span class="pre">'127.0.0.1'</span></code>) by default.</p></li>
<li><p><strong>port</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>optional port for TCP socket, if not provided a
random unused port is used.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.test_utils.BaseTestServer.scheme">
<code class="sig-name descname">scheme</code><a class="headerlink" href="#aiohttp.test_utils.BaseTestServer.scheme" title="Permalink to this definition">¶</a></dt>
<dd><p>A <em>scheme</em> for tested application, <code class="docutils literal notranslate"><span class="pre">'http'</span></code> for non-protected
run and <code class="docutils literal notranslate"><span class="pre">'https'</span></code> for TLS encrypted server.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.BaseTestServer.host">
<code class="sig-name descname">host</code><a class="headerlink" href="#aiohttp.test_utils.BaseTestServer.host" title="Permalink to this definition">¶</a></dt>
<dd><p><em>host</em> used to start a test server.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.BaseTestServer.port">
<code class="sig-name descname">port</code><a class="headerlink" href="#aiohttp.test_utils.BaseTestServer.port" title="Permalink to this definition">¶</a></dt>
<dd><p><em>port</em> used to start the test server.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.BaseTestServer.handler">
<code class="sig-name descname">handler</code><a class="headerlink" href="#aiohttp.test_utils.BaseTestServer.handler" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.WebServer</span></code> used for HTTP requests serving.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.BaseTestServer.server">
<code class="sig-name descname">server</code><a class="headerlink" href="#aiohttp.test_utils.BaseTestServer.server" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.AbstractServer</span></code> used for managing accepted connections.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.BaseTestServer.start_server">
<em class="property">coroutine </em><code class="sig-name descname">start_server</code><span class="sig-paren">(</span><em class="sig-param">loop=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.BaseTestServer.start_server" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>loop</strong> (<a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.AbstractEventLoop" title="(in Python v3.7)"><em>asyncio.AbstractEventLoop</em></a>) – the event_loop to use</p>
</dd>
</dl>
<p>Start a test server.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.BaseTestServer.close">
<em class="property">coroutine </em><code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.BaseTestServer.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop and finish executed test server.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.BaseTestServer.make_url">
<code class="sig-name descname">make_url</code><span class="sig-paren">(</span><em class="sig-param">path</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.BaseTestServer.make_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an <em>absolute</em> <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> for given <em>path</em>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.test_utils.RawTestServer">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.test_utils.</code><code class="sig-name descname">RawTestServer</code><span class="sig-paren">(</span><em class="sig-param">handler</em>, <em class="sig-param">*</em>, <em class="sig-param">scheme=&quot;http&quot;</em>, <em class="sig-param">host='127.0.0.1'</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.RawTestServer" title="Permalink to this definition">¶</a></dt>
<dd><p>Low-level test server (derived from <a class="reference internal" href="#aiohttp.test_utils.BaseTestServer" title="aiohttp.test_utils.BaseTestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseTestServer</span></code></a>).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>handler</strong> – <p>a coroutine for handling web requests. The
handler should accept
<a class="reference internal" href="index.html#aiohttp.web.BaseRequest" title="aiohttp.web.BaseRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.BaseRequest</span></code></a> and return a
response instance,
e.g. <a class="reference internal" href="index.html#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamResponse</span></code></a> or
<a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a>.</p>
<p>The handler could raise
<a class="reference internal" href="index.html#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPException</span></code></a> as a signal for
non-200 HTTP response.</p>
</p></li>
<li><p><strong>scheme</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – HTTP scheme, non-protected <code class="docutils literal notranslate"><span class="pre">&quot;http&quot;</span></code> by default.</p></li>
<li><p><strong>host</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – a host for TCP socket, IPv4 <em>local host</em>
(<code class="docutils literal notranslate"><span class="pre">'127.0.0.1'</span></code>) by default.</p></li>
<li><p><strong>port</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>optional port for TCP socket, if not provided a
random unused port is used.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="aiohttp.test_utils.TestServer">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.test_utils.</code><code class="sig-name descname">TestServer</code><span class="sig-paren">(</span><em class="sig-param">app</em>, <em class="sig-param">*</em>, <em class="sig-param">scheme=&quot;http&quot;</em>, <em class="sig-param">host='127.0.0.1'</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestServer" title="Permalink to this definition">¶</a></dt>
<dd><p>Test server (derived from <a class="reference internal" href="#aiohttp.test_utils.BaseTestServer" title="aiohttp.test_utils.BaseTestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseTestServer</span></code></a>) for starting
<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">Application</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>app</strong> – <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a> instance to run.</p></li>
<li><p><strong>scheme</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – HTTP scheme, non-protected <code class="docutils literal notranslate"><span class="pre">&quot;http&quot;</span></code> by default.</p></li>
<li><p><strong>host</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – a host for TCP socket, IPv4 <em>local host</em>
(<code class="docutils literal notranslate"><span class="pre">'127.0.0.1'</span></code>) by default.</p></li>
<li><p><strong>port</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – <p>optional port for TCP socket, if not provided a
random unused port is used.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.test_utils.TestServer.app">
<code class="sig-name descname">app</code><a class="headerlink" href="#aiohttp.test_utils.TestServer.app" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a> instance to run.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="test-client">
<h6>Test Client<a class="headerlink" href="#test-client" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="aiohttp.test_utils.TestClient">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.test_utils.</code><code class="sig-name descname">TestClient</code><span class="sig-paren">(</span><em class="sig-param">app_or_server</em>, <em class="sig-param">*</em>, <em class="sig-param">loop=None</em>, <em class="sig-param">scheme='http'</em>, <em class="sig-param">host='127.0.0.1'</em>, <em class="sig-param">cookie_jar=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient" title="Permalink to this definition">¶</a></dt>
<dd><p>A test client used for making calls to tested server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>app_or_server</strong> – <p><a class="reference internal" href="#aiohttp.test_utils.BaseTestServer" title="aiohttp.test_utils.BaseTestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseTestServer</span></code></a> instance for making
client requests to it.</p>
<p>In order to pass a <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a>
you need to convert it first to <a class="reference internal" href="#aiohttp.test_utils.TestServer" title="aiohttp.test_utils.TestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestServer</span></code></a>
first with <code class="docutils literal notranslate"><span class="pre">TestServer(app)</span></code>.</p>
</p></li>
<li><p><strong>cookie_jar</strong> – an optional <a class="reference internal" href="index.html#aiohttp.CookieJar" title="aiohttp.CookieJar"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.CookieJar</span></code></a> instance,
may be useful with <code class="docutils literal notranslate"><span class="pre">CookieJar(unsafe=True)</span></code>
option.</p></li>
<li><p><strong>scheme</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – HTTP scheme, non-protected <code class="docutils literal notranslate"><span class="pre">&quot;http&quot;</span></code> by default.</p></li>
<li><p><strong>loop</strong> (<a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.AbstractEventLoop" title="(in Python v3.7)"><em>asyncio.AbstractEventLoop</em></a>) – the event_loop to use</p></li>
<li><p><strong>host</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – a host for TCP socket, IPv4 <em>local host</em>
(<code class="docutils literal notranslate"><span class="pre">'127.0.0.1'</span></code>) by default.</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="aiohttp.test_utils.TestClient.scheme">
<code class="sig-name descname">scheme</code><a class="headerlink" href="#aiohttp.test_utils.TestClient.scheme" title="Permalink to this definition">¶</a></dt>
<dd><p>A <em>scheme</em> for tested application, <code class="docutils literal notranslate"><span class="pre">'http'</span></code> for non-protected
run and <code class="docutils literal notranslate"><span class="pre">'https'</span></code> for TLS encrypted server.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.TestClient.host">
<code class="sig-name descname">host</code><a class="headerlink" href="#aiohttp.test_utils.TestClient.host" title="Permalink to this definition">¶</a></dt>
<dd><p><em>host</em> used to start a test server.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.TestClient.port">
<code class="sig-name descname">port</code><a class="headerlink" href="#aiohttp.test_utils.TestClient.port" title="Permalink to this definition">¶</a></dt>
<dd><p><em>port</em> used to start the server</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.TestClient.server">
<code class="sig-name descname">server</code><a class="headerlink" href="#aiohttp.test_utils.TestClient.server" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#aiohttp.test_utils.BaseTestServer" title="aiohttp.test_utils.BaseTestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseTestServer</span></code></a> test server instance used in conjunction
with client.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.TestClient.app">
<code class="sig-name descname">app</code><a class="headerlink" href="#aiohttp.test_utils.TestClient.app" title="Permalink to this definition">¶</a></dt>
<dd><p>An alias for <code class="xref py py-attr docutils literal notranslate"><span class="pre">self.server.app</span></code>. return <code class="docutils literal notranslate"><span class="pre">None</span></code> if
<code class="docutils literal notranslate"><span class="pre">self.server</span></code> is not <a class="reference internal" href="#aiohttp.test_utils.TestServer" title="aiohttp.test_utils.TestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestServer</span></code></a>
instance(e.g. <a class="reference internal" href="#aiohttp.test_utils.RawTestServer" title="aiohttp.test_utils.RawTestServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">RawTestServer</span></code></a> instance for test low-level server).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.test_utils.TestClient.session">
<code class="sig-name descname">session</code><a class="headerlink" href="#aiohttp.test_utils.TestClient.session" title="Permalink to this definition">¶</a></dt>
<dd><p>An internal <a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.ClientSession</span></code></a>.</p>
<p>Unlike the methods on the <a class="reference internal" href="#aiohttp.test_utils.TestClient" title="aiohttp.test_utils.TestClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestClient</span></code></a>, client session
requests do not automatically include the host in the url
queried, and will require an absolute path to the resource.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.start_server">
<em class="property">coroutine </em><code class="sig-name descname">start_server</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.start_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Start a test server.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.close">
<em class="property">coroutine </em><code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop and finish executed test server.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.make_url">
<code class="sig-name descname">make_url</code><span class="sig-paren">(</span><em class="sig-param">path</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.make_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an <em>absolute</em> <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> for given <em>path</em>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.request">
<em class="property">coroutine </em><code class="sig-name descname">request</code><span class="sig-paren">(</span><em class="sig-param">method</em>, <em class="sig-param">path</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.request" title="Permalink to this definition">¶</a></dt>
<dd><p>Routes a request to tested http server.</p>
<p>The interface is identical to
<a class="reference internal" href="index.html#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.ClientSession.request()</span></code></a>, except the loop kwarg is
overridden by the instance used by the test server.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.get">
<em class="property">coroutine </em><code class="sig-name descname">get</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an HTTP GET request.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.post">
<em class="property">coroutine </em><code class="sig-name descname">post</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.post" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an HTTP POST request.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.options">
<em class="property">coroutine </em><code class="sig-name descname">options</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.options" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an HTTP OPTIONS request.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.head">
<em class="property">coroutine </em><code class="sig-name descname">head</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.head" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an HTTP HEAD request.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.put">
<em class="property">coroutine </em><code class="sig-name descname">put</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.put" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an HTTP PUT request.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.patch">
<em class="property">coroutine </em><code class="sig-name descname">patch</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.patch" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an HTTP PATCH request.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.delete">
<em class="property">coroutine </em><code class="sig-name descname">delete</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an HTTP DELETE request.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.test_utils.TestClient.ws_connect">
<em class="property">coroutine </em><code class="sig-name descname">ws_connect</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.TestClient.ws_connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Initiate websocket connection.</p>
<p>The api corresponds to <a class="reference internal" href="index.html#aiohttp.ClientSession.ws_connect" title="aiohttp.ClientSession.ws_connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.ClientSession.ws_connect()</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="utilities">
<h6>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h6>
<dl class="function">
<dt id="aiohttp.test_utils.make_mocked_coro">
<code class="sig-prename descclassname">aiohttp.test_utils.</code><code class="sig-name descname">make_mocked_coro</code><span class="sig-paren">(</span><em class="sig-param">return_value</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.make_mocked_coro" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a coroutine mock.</p>
<p>Behaves like a coroutine which returns <em>return_value</em>.  But it is
also a mock object, you might test it as usual
<a class="reference external" href="https://docs.python.org/3/library/unittest.mock.html#unittest.mock.Mock" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mock</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">mocked</span> <span class="o">=</span> <span class="n">make_mocked_coro</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="k">await</span> <span class="n">mocked</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">mocked</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>return_value</strong> – A value that the the mock object will return when
called.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A mock object that behaves as a coroutine which returns
<em>return_value</em> when called.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiohttp.test_utils.unused_port">
<code class="sig-prename descclassname">aiohttp.test_utils.</code><code class="sig-name descname">unused_port</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.unused_port" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an unused port number for IPv4 TCP protocol.</p>
<dl class="field-list simple">
<dt class="field-odd">Return int</dt>
<dd class="field-odd"><p>ephemeral port number which could be reused by test server.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="aiohttp.test_utils.loop_context">
<code class="sig-prename descclassname">aiohttp.test_utils.</code><code class="sig-name descname">loop_context</code><span class="sig-paren">(</span><em class="sig-param">loop_factory=&lt;function asyncio.new_event_loop&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.loop_context" title="Permalink to this definition">¶</a></dt>
<dd><p>A contextmanager that creates an event_loop, for test purposes.</p>
<p>Handles the creation and cleanup of a test loop.</p>
</dd></dl>

<dl class="function">
<dt id="aiohttp.test_utils.setup_test_loop">
<code class="sig-prename descclassname">aiohttp.test_utils.</code><code class="sig-name descname">setup_test_loop</code><span class="sig-paren">(</span><em class="sig-param">loop_factory=&lt;function asyncio.new_event_loop&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.setup_test_loop" title="Permalink to this definition">¶</a></dt>
<dd><p>Create and return an <a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.AbstractEventLoop" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.AbstractEventLoop</span></code></a> instance.</p>
<p>The caller should also call teardown_test_loop, once they are done
with the loop.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As side effect the function changes asyncio <em>default loop</em> by
<a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.set_event_loop" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.set_event_loop()</span></code></a> call.</p>
<p>Previous default loop is not restored.</p>
<p>It should not be a problem for test suite: every test expects a
new test loop instance anyway.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.1: </span>The function installs a created event loop as <em>default</em>.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="aiohttp.test_utils.teardown_test_loop">
<code class="sig-prename descclassname">aiohttp.test_utils.</code><code class="sig-name descname">teardown_test_loop</code><span class="sig-paren">(</span><em class="sig-param">loop</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.test_utils.teardown_test_loop" title="Permalink to this definition">¶</a></dt>
<dd><p>Teardown and cleanup an event_loop created by setup_test_loop.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>loop</strong> (<a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.AbstractEventLoop" title="(in Python v3.7)"><em>asyncio.AbstractEventLoop</em></a>) – the loop to teardown</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
</div>
<span id="document-deployment"></span><div class="section" id="server-deployment">
<span id="aiohttp-deployment"></span><h4>Server Deployment<a class="headerlink" href="#server-deployment" title="Permalink to this headline">¶</a></h4>
<p>There are several options for aiohttp server deployment:</p>
<ul class="simple">
<li><p>Standalone server</p></li>
<li><p>Running a pool of backend servers behind of <a class="reference internal" href="index.html#term-nginx"><span class="xref std std-term">nginx</span></a>, HAProxy
or other <em>reverse proxy server</em></p></li>
<li><p>Using <a class="reference internal" href="index.html#term-gunicorn"><span class="xref std std-term">gunicorn</span></a> behind of <em>reverse proxy</em></p></li>
</ul>
<p>Every method has own benefits and disadvantages.</p>
<div class="section" id="standalone">
<span id="aiohttp-deployment-standalone"></span><h5>Standalone<a class="headerlink" href="#standalone" title="Permalink to this headline">¶</a></h5>
<p>Just call <a class="reference internal" href="index.html#aiohttp.web.run_app" title="aiohttp.web.run_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp.web.run_app()</span></code></a> function passing
<a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a> instance.</p>
<p>The method is very simple and could be the best solution in some
trivial cases. But it does not utilize all CPU cores.</p>
<p>For running multiple aiohttp server instances use <em>reverse proxies</em>.</p>
</div>
<div class="section" id="nginx-supervisord">
<span id="aiohttp-deployment-nginx-supervisord"></span><h5>Nginx+supervisord<a class="headerlink" href="#nginx-supervisord" title="Permalink to this headline">¶</a></h5>
<p>Running aiohttp servers behind <a class="reference internal" href="index.html#term-nginx"><span class="xref std std-term">nginx</span></a> makes several advantages.</p>
<p>At first, nginx is the perfect frontend server. It may prevent many
attacks based on malformed http protocol etc.</p>
<p>Second, running several aiohttp instances behind nginx allows to
utilize all CPU cores.</p>
<p>Third, nginx serves static files much faster than built-in aiohttp
static file support.</p>
<p>But this way requires more complex configuration.</p>
<div class="section" id="nginx-configuration">
<h6>Nginx configuration<a class="headerlink" href="#nginx-configuration" title="Permalink to this headline">¶</a></h6>
<p>Here is short extraction about writing Nginx configuration file.
It does not cover all available Nginx options.</p>
<p>For full reference read <a class="reference external" href="https://www.nginx.com/resources/admin-guide/">Nginx tutorial</a> and <a class="reference external" href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html">official Nginx
documentation</a>.</p>
<p>First configure HTTP server itself:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">http</span> <span class="p">{</span>
  <span class="kn">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">client_max_body_size</span> <span class="s">4G</span><span class="p">;</span>

    <span class="kn">server_name</span> <span class="s">example.com</span><span class="p">;</span>

    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
      <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$http_host</span><span class="p">;</span>
      <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
      <span class="kn">proxy_redirect</span> <span class="no">off</span><span class="p">;</span>
      <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
      <span class="kn">proxy_pass</span> <span class="s">http://aiohttp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="s">/static</span> <span class="p">{</span>
      <span class="c1"># path for static files</span>
      <span class="kn">root</span> <span class="s">/path/to/app/static</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This config listens on port <code class="docutils literal notranslate"><span class="pre">80</span></code> for server named <code class="docutils literal notranslate"><span class="pre">example.com</span></code>
and redirects everything to <code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> backend group.</p>
<p>Also it serves static files from <code class="docutils literal notranslate"><span class="pre">/path/to/app/static</span></code> path as
<code class="docutils literal notranslate"><span class="pre">example.com/static</span></code>.</p>
<p>Next we need to configure <em>aiohttp upstream group</em>:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">http</span> <span class="p">{</span>
  <span class="kn">upstream</span> <span class="s">aiohttp</span> <span class="p">{</span>
    <span class="c1"># fail_timeout=0 means we always retry an upstream even if it failed</span>
    <span class="c1"># to return a good HTTP response</span>

    <span class="c1"># Unix domain servers</span>
    <span class="kn">server</span> <span class="s">unix:/tmp/example_1.sock</span> <span class="s">fail_timeout=0</span><span class="p">;</span>
    <span class="kn">server</span> <span class="s">unix:/tmp/example_2.sock</span> <span class="s">fail_timeout=0</span><span class="p">;</span>
    <span class="kn">server</span> <span class="s">unix:/tmp/example_3.sock</span> <span class="s">fail_timeout=0</span><span class="p">;</span>
    <span class="kn">server</span> <span class="s">unix:/tmp/example_4.sock</span> <span class="s">fail_timeout=0</span><span class="p">;</span>

    <span class="c1"># Unix domain sockets are used in this example due to their high performance,</span>
    <span class="c1"># but TCP/IP sockets could be used instead:</span>
    <span class="c1"># server 127.0.0.1:8081 fail_timeout=0;</span>
    <span class="c1"># server 127.0.0.1:8082 fail_timeout=0;</span>
    <span class="c1"># server 127.0.0.1:8083 fail_timeout=0;</span>
    <span class="c1"># server 127.0.0.1:8084 fail_timeout=0;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>All HTTP requests for <code class="docutils literal notranslate"><span class="pre">http://example.com</span></code> except ones for
<code class="docutils literal notranslate"><span class="pre">http://example.com/static</span></code> will be redirected to <code class="docutils literal notranslate"><span class="pre">example1.sock</span></code>,
<code class="docutils literal notranslate"><span class="pre">example2.sock</span></code>, <code class="docutils literal notranslate"><span class="pre">example3.sock</span></code> or <code class="docutils literal notranslate"><span class="pre">example4.sock</span></code>
backend servers. By default, Nginx uses round-robin algorithm for backend
selection.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nginx is not the only existing <em>reverse proxy server</em> but the most
popular one.  Alternatives like HAProxy may be used as well.</p>
</div>
</div>
<div class="section" id="supervisord">
<h6>Supervisord<a class="headerlink" href="#supervisord" title="Permalink to this headline">¶</a></h6>
<p>After configuring Nginx we need to start our aiohttp backends. Better
to use some tool for starting them automatically after system reboot
or backend crash.</p>
<p>There are very many ways to do it: Supervisord, Upstart, Systemd,
Gaffer, Circus, Runit etc.</p>
<p>Here we’ll use <a class="reference external" href="http://supervisord.org/">Supervisord</a> for example:</p>
<div class="highlight-cfg notranslate"><div class="highlight"><pre><span></span><span class="k">[program:aiohttp]</span>
<span class="na">numprocs</span> <span class="o">=</span> <span class="s">4</span>
<span class="na">numprocs_start</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">process_name</span> <span class="o">=</span> <span class="s">example_%(process_num)s</span>

<span class="c1">; Unix socket paths are specified by command line.</span>
<span class="na">command</span><span class="o">=</span><span class="s">/path/to/aiohttp_example.py --path=/tmp/example_%(process_num)s.sock</span>

<span class="c1">; We can just as easily pass TCP port numbers:</span>
<span class="c1">; command=/path/to/aiohttp_example.py --port=808%(process_num)s</span>

<span class="na">user</span><span class="o">=</span><span class="s">nobody</span>
<span class="na">autostart</span><span class="o">=</span><span class="s">true</span>
<span class="na">autorestart</span><span class="o">=</span><span class="s">true</span>
</pre></div>
</div>
</div>
<div class="section" id="aiohttp-server">
<h6>aiohttp server<a class="headerlink" href="#aiohttp-server" title="Permalink to this headline">¶</a></h6>
<p>The last step is preparing aiohttp server for working with supervisord.</p>
<p>Assuming we have properly configured <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a>
and port is specified by command line, the task is trivial:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># aiohttp_example.py</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;aiohttp server example&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--path&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--port&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="c1"># configure app</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
</pre></div>
</div>
<p>For real use cases we perhaps need to configure other things like
logging etc., but it’s out of scope of the topic.</p>
</div>
</div>
<div class="section" id="nginx-gunicorn">
<span id="aiohttp-deployment-gunicorn"></span><h5>Nginx+Gunicorn<a class="headerlink" href="#nginx-gunicorn" title="Permalink to this headline">¶</a></h5>
<p>aiohttp can be deployed using <a class="reference external" href="http://docs.gunicorn.org/en/latest/index.html">Gunicorn</a>, which is based on a
pre-fork worker model.  Gunicorn launches your app as worker processes
for handling incoming requests.</p>
<p>In opposite to deployment with <a class="reference internal" href="#aiohttp-deployment-nginx-supervisord"><span class="std std-ref">bare Nginx</span></a> the solution does not need to
manually run several aiohttp processes and use tool like supervisord
for monitoring it. But nothing is for free: running aiohttp
application under gunicorn is slightly slower.</p>
<div class="section" id="prepare-environment">
<h6>Prepare environment<a class="headerlink" href="#prepare-environment" title="Permalink to this headline">¶</a></h6>
<p>You firstly need to setup your deployment environment. This example is
based on <a class="reference external" href="https://www.ubuntu.com/">Ubuntu</a> 16.04.</p>
<p>Create a directory for your application:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">mkdir</span> <span class="n">myapp</span>
<span class="o">&gt;&gt;</span> <span class="n">cd</span> <span class="n">myapp</span>
</pre></div>
</div>
<p>Create Python virtual environment:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="n">venv</span>
<span class="o">&gt;&gt;</span> <span class="n">source</span> <span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
<p>Now that the virtual environment is ready, we’ll proceed to install
aiohttp and gunicorn:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">gunicorn</span>
<span class="o">&gt;&gt;</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">aiohttp</span>
</pre></div>
</div>
</div>
<div class="section" id="application">
<h6>Application<a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h6>
<p>Lets write a simple application, which we will save to file. We’ll
name this file <em>my_app_module.py</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Welcome home!&quot;</span><span class="p">)</span>


<span class="n">my_web_app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">my_web_app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="application-factory">
<h6>Application factory<a class="headerlink" href="#application-factory" title="Permalink to this headline">¶</a></h6>
<p>As an option an entry point could be a coroutine that accepts no
parameters and returns an application instance:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Welcome home!&quot;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">my_web_app</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>
</pre></div>
</div>
</div>
<div class="section" id="start-gunicorn">
<h6>Start Gunicorn<a class="headerlink" href="#start-gunicorn" title="Permalink to this headline">¶</a></h6>
<p>When <a class="reference external" href="http://docs.gunicorn.org/en/latest/run.html">Running Gunicorn</a>, you provide the name
of the module, i.e. <em>my_app_module</em>, and the name of the app or
application factory, i.e. <em>my_web_app</em>, along with other <a class="reference external" href="http://docs.gunicorn.org/en/latest/settings.html">Gunicorn
Settings</a> provided
as command line flags or in your config file.</p>
<p>In this case, we will use:</p>
<ul class="simple">
<li><p>the <code class="docutils literal notranslate"><span class="pre">--bind</span></code> flag to set the server’s socket address;</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">--worker-class</span></code> flag to tell Gunicorn that we want to use a
custom worker subclass instead of one of the Gunicorn default worker
types;</p></li>
<li><p>you may also want to use the <code class="docutils literal notranslate"><span class="pre">--workers</span></code> flag to tell Gunicorn how
many worker processes to use for handling requests. (See the
documentation for recommendations on <a class="reference external" href="http://docs.gunicorn.org/en/latest/design.html#how-many-workers">How Many Workers?</a>)</p></li>
<li><p>you may also want to use the <code class="docutils literal notranslate"><span class="pre">--accesslog</span></code> flag to enable the access
log to be populated. (See <a class="reference internal" href="index.html#gunicorn-accesslog"><span class="std std-ref">logging</span></a> for more information.)</p></li>
</ul>
<p>The custom worker subclass is defined in <code class="docutils literal notranslate"><span class="pre">aiohttp.GunicornWebWorker</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">gunicorn</span> <span class="n">my_app_module</span><span class="p">:</span><span class="n">my_web_app</span> <span class="o">--</span><span class="n">bind</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span> <span class="o">--</span><span class="n">worker</span><span class="o">-</span><span class="k">class</span> <span class="nc">aiohttp</span><span class="o">.</span><span class="n">GunicornWebWorker</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">18</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">21</span> <span class="o">+</span><span class="mi">0000</span><span class="p">]</span> <span class="p">[</span><span class="mi">1249</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Starting</span> <span class="n">gunicorn</span> <span class="mf">19.7</span><span class="o">.</span><span class="mi">1</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">18</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">21</span> <span class="o">+</span><span class="mi">0000</span><span class="p">]</span> <span class="p">[</span><span class="mi">1249</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Listening</span> <span class="n">at</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8080</span> <span class="p">(</span><span class="mi">1249</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">18</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">21</span> <span class="o">+</span><span class="mi">0000</span><span class="p">]</span> <span class="p">[</span><span class="mi">1249</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Using</span> <span class="n">worker</span><span class="p">:</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">GunicornWebWorker</span>
<span class="p">[</span><span class="mi">2015</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">18</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">21</span> <span class="o">+</span><span class="mi">0000</span><span class="p">]</span> <span class="p">[</span><span class="mi">1253</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Booting</span> <span class="n">worker</span> <span class="k">with</span> <span class="n">pid</span><span class="p">:</span> <span class="mi">1253</span>
</pre></div>
</div>
<p>Gunicorn is now running and ready to serve requests to your app’s
worker processes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to use an alternative asyncio event loop
<a class="reference external" href="https://github.com/MagicStack/uvloop">uvloop</a>, you can use the
<code class="docutils literal notranslate"><span class="pre">aiohttp.GunicornUVLoopWebWorker</span></code> worker class.</p>
</div>
</div>
<div class="section" id="more-information">
<h6>More information<a class="headerlink" href="#more-information" title="Permalink to this headline">¶</a></h6>
<p>The Gunicorn documentation recommends deploying Gunicorn behind an
Nginx proxy server. See the <a class="reference external" href="http://docs.gunicorn.org/en/latest/deploy.html">official documentation</a> for more
information about suggested nginx configuration.</p>
</div>
<div class="section" id="logging-configuration">
<h6>Logging configuration<a class="headerlink" href="#logging-configuration" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> and <code class="docutils literal notranslate"><span class="pre">gunicorn</span></code> use different format for specifying access log.</p>
<p>By default aiohttp uses own defaults:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1"> %t &quot;</span><span class="si">%r</span><span class="s1">&quot; </span><span class="si">%s</span><span class="s1"> %b &quot;%</span><span class="si">{Referer}</span><span class="s1">i&quot; &quot;%{User-Agent}i&quot;&#39;</span>
</pre></div>
</div>
<p>For more information please read <a class="reference internal" href="index.html#aiohttp-logging-access-log-format-spec"><span class="std std-ref">Format Specification for Access
Log</span></a>.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-utilities"></span><div class="section" id="utilities">
<span id="aiohttp-utilities"></span><h3>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h3>
<p>Miscellaneous API Shared between Client And Server.</p>
<div class="toctree-wrapper compound" id="id1">
<span id="document-abc"></span><div class="section" id="module-aiohttp.abc">
<span id="abstract-base-classes"></span><span id="aiohttp-abc"></span><h4>Abstract Base Classes<a class="headerlink" href="#module-aiohttp.abc" title="Permalink to this headline">¶</a></h4>
<div class="section" id="abstract-routing">
<h5>Abstract routing<a class="headerlink" href="#abstract-routing" title="Permalink to this headline">¶</a></h5>
<p>aiohttp has abstract classes for managing web interfaces.</p>
<p>The most part of <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> is not intended to be inherited
but few of them are.</p>
<p>aiohttp.web is built on top of few concepts: <em>application</em>, <em>router</em>,
<em>request</em> and <em>response</em>.</p>
<p><em>router</em> is a <em>pluggable</em> part: a library user may build a <em>router</em>
from scratch, all other parts should work with new router seamlessly.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractRouter</span></code> has the only mandatory method:
<code class="xref py py-meth docutils literal notranslate"><span class="pre">AbstractRouter.resolve()</span></code> coroutine. It must return an
<code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMatchInfo</span></code> instance.</p>
<p>If the requested URL handler is found
<code class="xref py py-meth docutils literal notranslate"><span class="pre">AbstractMatchInfo.handler()</span></code> is a <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a> for
requested URL and <code class="xref py py-attr docutils literal notranslate"><span class="pre">AbstractMatchInfo.http_exception</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>Otherwise <code class="xref py py-attr docutils literal notranslate"><span class="pre">AbstractMatchInfo.http_exception</span></code> is an instance of
<a class="reference internal" href="index.html#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPException</span></code></a> like <em>404: NotFound</em> or <em>405: Method
Not Allowed</em>. <code class="xref py py-meth docutils literal notranslate"><span class="pre">AbstractMatchInfo.handler()</span></code> raises
<code class="xref py py-attr docutils literal notranslate"><span class="pre">http_exception</span></code> on call.</p>
<dl class="class">
<dt id="aiohttp.abc.aiohttp.abc.AbstractRouter">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.abc.</code><code class="sig-name descname">AbstractRouter</code><a class="headerlink" href="#aiohttp.abc.aiohttp.abc.AbstractRouter" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstract router, <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a> accepts it as
<em>router</em> parameter and returns as
<a class="reference internal" href="index.html#aiohttp.web.Application.router" title="aiohttp.web.Application.router"><code class="xref py py-attr docutils literal notranslate"><span class="pre">aiohttp.web.Application.router</span></code></a>.</p>
<dl class="method">
<dt id="aiohttp.abc.aiohttp.abc.AbstractRouter.resolve">
<em class="property">coroutine </em><code class="sig-name descname">resolve</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.abc.aiohttp.abc.AbstractRouter.resolve" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs URL resolving. It’s an abstract method, should be
overridden in <em>router</em> implementation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>request</strong> – <a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Request</span></code></a> instance for
resolving, the request has
<a class="reference internal" href="index.html#aiohttp.web.Request.match_info" title="aiohttp.web.Request.match_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">aiohttp.web.Request.match_info</span></code></a> equals to
<code class="docutils literal notranslate"><span class="pre">None</span></code> at resolving stage.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMatchInfo</span></code> instance.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.abc.aiohttp.abc.AbstractMatchInfo">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.abc.</code><code class="sig-name descname">AbstractMatchInfo</code><a class="headerlink" href="#aiohttp.abc.aiohttp.abc.AbstractMatchInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstract <em>match info</em>, returned by <code class="xref py py-meth docutils literal notranslate"><span class="pre">AbstractRouter.resolve()</span></code> call.</p>
<dl class="attribute">
<dt id="aiohttp.abc.aiohttp.abc.AbstractMatchInfo.http_exception">
<code class="sig-name descname">http_exception</code><a class="headerlink" href="#aiohttp.abc.aiohttp.abc.AbstractMatchInfo.http_exception" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="index.html#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-exc docutils literal notranslate"><span class="pre">aiohttp.web.HTTPException</span></code></a> if no match was found, <code class="docutils literal notranslate"><span class="pre">None</span></code>
otherwise.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.abc.aiohttp.abc.AbstractMatchInfo.handler">
<em class="property">coroutine </em><code class="sig-name descname">handler</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.abc.aiohttp.abc.AbstractMatchInfo.handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstract method performing <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a> processing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>request</strong> – <a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Request</span></code></a> instance for
resolving, the request has
<a class="reference internal" href="index.html#aiohttp.web.Request.match_info" title="aiohttp.web.Request.match_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">aiohttp.web.Request.match_info</span></code></a> equals to
<code class="docutils literal notranslate"><span class="pre">None</span></code> at resolving stage.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><a class="reference internal" href="index.html#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.StreamResponse</span></code></a> or descendants.</p>
</dd>
<dt class="field-odd">Raise</dt>
<dd class="field-odd"><p><a class="reference internal" href="index.html#aiohttp.web.HTTPException" title="aiohttp.web.HTTPException"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.HTTPException</span></code></a> on error</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.abc.aiohttp.abc.AbstractMatchInfo.expect_handler">
<em class="property">coroutine </em><code class="sig-name descname">expect_handler</code><span class="sig-paren">(</span><em class="sig-param">request</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.abc.aiohttp.abc.AbstractMatchInfo.expect_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstract method for handling <em>100-continue</em> processing.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="abstract-class-based-views">
<h5>Abstract Class Based Views<a class="headerlink" href="#abstract-class-based-views" title="Permalink to this headline">¶</a></h5>
<p>For <em>class based view</em> support aiohttp has abstract
<a class="reference internal" href="#aiohttp.abc.AbstractView" title="aiohttp.abc.AbstractView"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractView</span></code></a> class which is <em>awaitable</em> (may be uses like
<code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">Cls()</span></code> or <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span> <span class="pre">Cls()</span></code> and has a <em>request</em> as an
attribute.</p>
<dl class="class">
<dt id="aiohttp.abc.AbstractView">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.abc.</code><code class="sig-name descname">AbstractView</code><a class="headerlink" href="#aiohttp.abc.AbstractView" title="Permalink to this definition">¶</a></dt>
<dd><p>An abstract class, base for all <em>class based views</em> implementations.</p>
<p>Methods <code class="docutils literal notranslate"><span class="pre">__iter__</span></code> and <code class="docutils literal notranslate"><span class="pre">__await__</span></code> should be overridden.</p>
<dl class="attribute">
<dt id="aiohttp.abc.AbstractView.request">
<code class="sig-name descname">request</code><a class="headerlink" href="#aiohttp.abc.AbstractView.request" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Request</span></code></a> instance for performing the request.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="abstract-cookie-jar">
<h5>Abstract Cookie Jar<a class="headerlink" href="#abstract-cookie-jar" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.abc.aiohttp.abc.AbstractCookieJar">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.abc.</code><code class="sig-name descname">AbstractCookieJar</code><a class="headerlink" href="#aiohttp.abc.aiohttp.abc.AbstractCookieJar" title="Permalink to this definition">¶</a></dt>
<dd><p>The cookie jar instance is available as <code class="xref py py-attr docutils literal notranslate"><span class="pre">ClientSession.cookie_jar</span></code>.</p>
<p>The jar contains <a class="reference external" href="https://docs.python.org/3/library/http.cookies.html#http.cookies.Morsel" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Morsel</span></code></a> items for storing
internal cookie data.</p>
<p>API provides a count of saved cookies:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">cookie_jar</span><span class="p">)</span>
</pre></div>
</div>
<p>These cookies may be iterated over:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">cookie_jar</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cookie</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cookie</span><span class="p">[</span><span class="s2">&quot;domain&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>An abstract class for cookie storage. Implements
<a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Iterable</span></code></a> and
<a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Sized" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Sized</span></code></a>.</p>
<dl class="method">
<dt id="aiohttp.abc.aiohttp.abc.AbstractCookieJar.update_cookies">
<code class="sig-name descname">update_cookies</code><span class="sig-paren">(</span><em class="sig-param">cookies</em>, <em class="sig-param">response_url=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.abc.aiohttp.abc.AbstractCookieJar.update_cookies" title="Permalink to this definition">¶</a></dt>
<dd><p>Update cookies returned by server in <code class="docutils literal notranslate"><span class="pre">Set-Cookie</span></code> header.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cookies</strong> – a <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Mapping</span></code></a>
(e.g. <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/http.cookies.html#http.cookies.SimpleCookie" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleCookie</span></code></a>) or
<em>iterable</em> of <em>pairs</em> with cookies returned by server’s
response.</p></li>
<li><p><strong>response_url</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – URL of response, <code class="docutils literal notranslate"><span class="pre">None</span></code> for <em>shared
cookies</em>.  Regular cookies are coupled with server’s URL and
are sent only to this server, shared ones are sent in every
client request.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.abc.aiohttp.abc.AbstractCookieJar.filter_cookies">
<code class="sig-name descname">filter_cookies</code><span class="sig-paren">(</span><em class="sig-param">request_url</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.abc.aiohttp.abc.AbstractCookieJar.filter_cookies" title="Permalink to this definition">¶</a></dt>
<dd><p>Return jar’s cookies acceptable for URL and available in
<code class="docutils literal notranslate"><span class="pre">Cookie</span></code> header for sending client requests for given URL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>response_url</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – request’s URL for which cookies are asked.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/http.cookies.html#http.cookies.SimpleCookie" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">http.cookies.SimpleCookie</span></code></a> with filtered
cookies for given URL.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="abstract-abstract-access-logger">
<h5>Abstract Abstract Access Logger<a class="headerlink" href="#abstract-abstract-access-logger" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="aiohttp.abc.aiohttp.abc.AbstractAccessLogger">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.abc.</code><code class="sig-name descname">AbstractAccessLogger</code><a class="headerlink" href="#aiohttp.abc.aiohttp.abc.AbstractAccessLogger" title="Permalink to this definition">¶</a></dt>
<dd><p>An abstract class, base for all <code class="xref py py-class docutils literal notranslate"><span class="pre">RequestHandler</span></code>
<code class="docutils literal notranslate"><span class="pre">access_logger</span></code> implementations</p>
<p>Method <code class="docutils literal notranslate"><span class="pre">log</span></code> should be overridden.</p>
<dl class="method">
<dt id="aiohttp.abc.aiohttp.abc.AbstractAccessLogger.log">
<code class="sig-name descname">log</code><span class="sig-paren">(</span><em class="sig-param">request</em>, <em class="sig-param">response</em>, <em class="sig-param">time</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.abc.aiohttp.abc.AbstractAccessLogger.log" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>request</strong> – <a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Request</span></code></a> object.</p></li>
<li><p><strong>response</strong> – <a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Response</span></code></a> object.</p></li>
<li><p><strong>time</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.7)"><em>float</em></a>) – Time taken to serve the request.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-multipart"></span><div class="section" id="working-with-multipart">
<span id="aiohttp-multipart"></span><h4>Working with Multipart<a class="headerlink" href="#working-with-multipart" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> supports a full featured multipart reader and writer. Both
are designed with steaming processing in mind to avoid unwanted
footprint which may be significant if you’re dealing with large
payloads, but this also means that most I/O operation are only
possible to be executed a single time.</p>
<div class="section" id="reading-multipart-responses">
<h5>Reading Multipart Responses<a class="headerlink" href="#reading-multipart-responses" title="Permalink to this headline">¶</a></h5>
<p>Assume you made a request, as usual, and want to process the response multipart
data:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>First, you need to wrap the response with a
<a class="reference internal" href="index.html#aiohttp.MultipartReader.from_response" title="aiohttp.MultipartReader.from_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MultipartReader.from_response()</span></code></a>. This needs to keep the implementation of
<a class="reference internal" href="index.html#aiohttp.MultipartReader" title="aiohttp.MultipartReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipartReader</span></code></a> separated from the response and the connection routines
which makes it more portable:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">reader</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">MultipartReader</span><span class="o">.</span><span class="n">from_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s assume with this response you’d received some JSON document and multiple
files for it, but you don’t need all of them, just a specific one.</p>
<p>So first you need to enter into a loop where the multipart body will
be processed:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">filedata</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">part</span> <span class="o">=</span> <span class="k">await</span> <span class="n">reader</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</pre></div>
</div>
<p>The returned type depends on what the next part is: if it’s a simple body part
then you’ll get <a class="reference internal" href="index.html#aiohttp.BodyPartReader" title="aiohttp.BodyPartReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">BodyPartReader</span></code></a> instance here, otherwise, it will
be another <a class="reference internal" href="index.html#aiohttp.MultipartReader" title="aiohttp.MultipartReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipartReader</span></code></a> instance for the nested multipart. Remember,
that multipart format is recursive and supports multiple levels of nested body
parts. When there are no more parts left to fetch, <code class="docutils literal notranslate"><span class="pre">None</span></code> value will be
returned - that’s the signal to break the loop:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">part</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">break</span>
</pre></div>
</div>
<p>Both <a class="reference internal" href="index.html#aiohttp.BodyPartReader" title="aiohttp.BodyPartReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">BodyPartReader</span></code></a> and <a class="reference internal" href="index.html#aiohttp.MultipartReader" title="aiohttp.MultipartReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipartReader</span></code></a> provides access to
body part headers: this allows you to filter parts by their attributes:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">hdrs</span><span class="o">.</span><span class="n">CONTENT_TYPE</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;application/json&#39;</span><span class="p">:</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="n">part</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">continue</span>
</pre></div>
</div>
<p>Nor <a class="reference internal" href="index.html#aiohttp.BodyPartReader" title="aiohttp.BodyPartReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">BodyPartReader</span></code></a> or <a class="reference internal" href="index.html#aiohttp.MultipartReader" title="aiohttp.MultipartReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipartReader</span></code></a> instances does not
read the whole body part data without explicitly asking for.
<a class="reference internal" href="index.html#aiohttp.BodyPartReader" title="aiohttp.BodyPartReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">BodyPartReader</span></code></a> provides a set of helpers methods
to fetch popular content types in friendly way:</p>
<ul class="simple">
<li><p><a class="reference internal" href="index.html#aiohttp.BodyPartReader.text" title="aiohttp.BodyPartReader.text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BodyPartReader.text()</span></code></a> for plain text data;</p></li>
<li><p><a class="reference internal" href="index.html#aiohttp.BodyPartReader.json" title="aiohttp.BodyPartReader.json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BodyPartReader.json()</span></code></a> for JSON;</p></li>
<li><p><a class="reference internal" href="index.html#aiohttp.BodyPartReader.form" title="aiohttp.BodyPartReader.form"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BodyPartReader.form()</span></code></a> for <cite>application/www-urlform-encode</cite></p></li>
</ul>
<p>Each of these methods automatically recognizes if content is compressed by
using <cite>gzip</cite> and <cite>deflate</cite> encoding (while it respects <cite>identity</cite> one), or if
transfer encoding is base64 or <cite>quoted-printable</cite> - in each case the result
will get automatically decoded. But in case you need to access to raw binary
data as it is, there are <a class="reference internal" href="index.html#aiohttp.BodyPartReader.read" title="aiohttp.BodyPartReader.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BodyPartReader.read()</span></code></a> and
<a class="reference internal" href="index.html#aiohttp.BodyPartReader.read_chunk" title="aiohttp.BodyPartReader.read_chunk"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BodyPartReader.read_chunk()</span></code></a> coroutine methods as well to read raw binary
data as it is all-in-single-shot or by chunks respectively.</p>
<p>When you have to deal with multipart files, the <code class="xref py py-attr docutils literal notranslate"><span class="pre">BodyPartReader.filename</span></code>
property comes to help. It’s a very smart helper which handles
<cite>Content-Disposition</cite> handler right and extracts the right filename attribute
from it:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">filename</span> <span class="o">!=</span> <span class="s1">&#39;secret.txt&#39;</span><span class="p">:</span>
    <span class="k">continue</span>
</pre></div>
</div>
<p>If current body part does not matches your expectation and you want to skip it
- just continue a loop to start a next iteration of it. Here is where magic
happens. Before fetching the next body part <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">reader.next()</span></code> it
ensures that the previous one was read completely. If it was not, all its content
sends to the void in term to fetch the next part. So you don’t have to care
about cleanup routines while you’re within a loop.</p>
<p>Once you’d found a part for the file you’d searched for, just read it. Let’s
handle it as it is without applying any decoding magic:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">filedata</span> <span class="o">=</span> <span class="k">await</span> <span class="n">part</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Later you may decide to decode the data. It’s still simple and possible
to do:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">filedata</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">filedata</span><span class="p">)</span>
</pre></div>
</div>
<p>Once you are done with multipart processing, just break a loop:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">break</span>
</pre></div>
</div>
</div>
<div class="section" id="sending-multipart-requests">
<h5>Sending Multipart Requests<a class="headerlink" href="#sending-multipart-requests" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="index.html#aiohttp.MultipartWriter" title="aiohttp.MultipartWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipartWriter</span></code></a> provides an interface to build multipart payload from
the Python data and serialize it into chunked binary stream. Since multipart
format is recursive and supports deeply nesting, you can use <code class="docutils literal notranslate"><span class="pre">with</span></code> statement
to design your multipart data closer to how it will be:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">MultipartWriter</span><span class="p">(</span><span class="s1">&#39;mixed&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mpwriter</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">MultipartWriter</span><span class="p">(</span><span class="s1">&#39;related&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">subwriter</span><span class="p">:</span>
        <span class="o">...</span>
    <span class="n">mpwriter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subwriter</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">MultipartWriter</span><span class="p">(</span><span class="s1">&#39;related&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">subwriter</span><span class="p">:</span>
        <span class="o">...</span>
        <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">MultipartWriter</span><span class="p">(</span><span class="s1">&#39;related&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">subsubwriter</span><span class="p">:</span>
            <span class="o">...</span>
        <span class="n">subwriter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subsubwriter</span><span class="p">)</span>
    <span class="n">mpwriter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subwriter</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">MultipartWriter</span><span class="p">(</span><span class="s1">&#39;related&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">subwriter</span><span class="p">:</span>
        <span class="o">...</span>
    <span class="n">mpwriter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subwriter</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="index.html#aiohttp.MultipartWriter.append" title="aiohttp.MultipartWriter.append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MultipartWriter.append()</span></code></a> is used to join new body parts into a
single stream. It accepts various inputs and determines what default headers
should be used for.</p>
<p>For text data default <cite>Content-Type</cite> is <em class="mimetype">text/plain; charset=utf-8</em>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpwriter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For binary data <em class="mimetype">application/octet-stream</em> is used:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpwriter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;aiohttp&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can always override these default by passing your own headers with
the second argument:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpwriter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;GIF89a...&#39;</span><span class="p">),</span>
                <span class="p">{</span><span class="s1">&#39;CONTENT-TYPE&#39;</span><span class="p">:</span> <span class="s1">&#39;image/gif&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>For file objects <cite>Content-Type</cite> will be determined by using Python’s
mod:<cite>mimetypes</cite> module and additionally <cite>Content-Disposition</cite> header
will include the file’s basename:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">part</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>If you want to send a file with a different name, just handle the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Payload</span></code> instance which <a class="reference internal" href="index.html#aiohttp.MultipartWriter.append" title="aiohttp.MultipartWriter.append"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MultipartWriter.append()</span></code></a> will
always return and set <cite>Content-Disposition</cite> explicitly by using
the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Payload.set_content_disposition()</span></code> helper:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">part</span><span class="o">.</span><span class="n">set_content_disposition</span><span class="p">(</span><span class="s1">&#39;attachment&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;secret.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Additionally, you may want to set other headers here:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">part</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">hdrs</span><span class="o">.</span><span class="n">CONTENT_ID</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;X-12345&#39;</span>
</pre></div>
</div>
<p>If you’d set <cite>Content-Encoding</cite>, it will be automatically applied to the
data on serialization (see below):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">part</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">hdrs</span><span class="o">.</span><span class="n">CONTENT_ENCODING</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gzip&#39;</span>
</pre></div>
</div>
<p>There are also <a class="reference internal" href="index.html#aiohttp.MultipartWriter.append_json" title="aiohttp.MultipartWriter.append_json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MultipartWriter.append_json()</span></code></a> and
<a class="reference internal" href="index.html#aiohttp.MultipartWriter.append_form" title="aiohttp.MultipartWriter.append_form"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MultipartWriter.append_form()</span></code></a> helpers which are useful to work with JSON
and form urlencoded data, so you don’t have to encode it every time manually:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpwriter</span><span class="o">.</span><span class="n">append_json</span><span class="p">({</span><span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">})</span>
<span class="n">mpwriter</span><span class="o">.</span><span class="n">append_form</span><span class="p">([(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p>When it’s done, to make a request just pass a root <a class="reference internal" href="index.html#aiohttp.MultipartWriter" title="aiohttp.MultipartWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipartWriter</span></code></a>
instance as <a class="reference internal" href="index.html#aiohttp.ClientSession.request" title="aiohttp.ClientSession.request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.ClientSession.request()</span></code></a> <code class="docutils literal notranslate"><span class="pre">data</span></code> argument:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mpwriter</span><span class="p">)</span>
</pre></div>
</div>
<p>Behind the scenes <a class="reference internal" href="index.html#aiohttp.MultipartWriter.write" title="aiohttp.MultipartWriter.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MultipartWriter.write()</span></code></a> will yield chunks of every
part and if body part has <cite>Content-Encoding</cite> or <cite>Content-Transfer-Encoding</cite>
they will be applied on streaming content.</p>
<p>Please note, that on <a class="reference internal" href="index.html#aiohttp.MultipartWriter.write" title="aiohttp.MultipartWriter.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MultipartWriter.write()</span></code></a> all the file objects
will be read until the end and there is no way to repeat a request without
rewinding their pointers to the start.</p>
<p>Example MJPEG Streaming <code class="docutils literal notranslate"><span class="pre">multipart/x-mixed-replace</span></code>. By default
<a class="reference internal" href="index.html#aiohttp.MultipartWriter.write" title="aiohttp.MultipartWriter.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MultipartWriter.write()</span></code></a> appends closing <code class="docutils literal notranslate"><span class="pre">--boundary--</span></code> and breaks your
content. Providing <cite>close_boundary = False</cite> prevents this.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_boundary</span> <span class="o">=</span> <span class="s1">&#39;some-boundary&#39;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">StreamResponse</span><span class="p">(</span>
    <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;OK&#39;</span><span class="p">,</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;multipart/x-mixed-replace;boundary=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">my_boundary</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">get_jpeg_frame</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">MultipartWriter</span><span class="p">(</span><span class="s1">&#39;image/jpeg&#39;</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="n">my_boundary</span><span class="p">)</span> <span class="k">as</span> <span class="n">mpwriter</span><span class="p">:</span>
        <span class="n">mpwriter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;image/jpeg&#39;</span>
        <span class="p">})</span>
        <span class="k">await</span> <span class="n">mpwriter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">close_boundary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">drain</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="hacking-multipart">
<h5>Hacking Multipart<a class="headerlink" href="#hacking-multipart" title="Permalink to this headline">¶</a></h5>
<p>The Internet is full of terror and sometimes you may find a server which
implements multipart support in strange ways when an oblivious solution
does not work.</p>
<p>For instance, is server used <code class="xref py py-class docutils literal notranslate"><span class="pre">cgi.FieldStorage</span></code> then you have
to ensure that no body part contains a <cite>Content-Length</cite> header:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">mpwriter</span><span class="p">:</span>
    <span class="n">part</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">hdrs</span><span class="o">.</span><span class="n">CONTENT_LENGTH</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>On the other hand, some server may require to specify <cite>Content-Length</cite> for the
whole multipart request. <cite>aiohttp</cite> does not do that since it sends multipart
using chunked transfer encoding by default. To overcome this issue, you have
to serialize a <a class="reference internal" href="index.html#aiohttp.MultipartWriter" title="aiohttp.MultipartWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipartWriter</span></code></a> by our own in the way to calculate its
size:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Writer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">Writer</span><span class="p">()</span>
<span class="n">mpwriter</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
<span class="k">await</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span>
                   <span class="n">data</span><span class="o">=</span><span class="n">writer</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">mpwriter</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
</pre></div>
</div>
<p>Sometimes the server response may not be well formed: it may or may not
contains nested parts. For instance, we request a resource which returns
JSON documents with the files attached to it. If the document has any
attachments, they are returned as a nested multipart.
If it has not it responds as plain body parts:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CONTENT-TYPE: multipart/mixed; boundary=--:

--:
CONTENT-TYPE: application/json

{&quot;_id&quot;: &quot;foo&quot;}
--:
CONTENT-TYPE: multipart/related; boundary=----:

----:
CONTENT-TYPE: application/json

{&quot;_id&quot;: &quot;bar&quot;}
----:
CONTENT-TYPE: text/plain
CONTENT-DISPOSITION: attachment; filename=bar.txt

bar! bar! bar!
----:--
--:
CONTENT-TYPE: application/json

{&quot;_id&quot;: &quot;boo&quot;}
--:
CONTENT-TYPE: multipart/related; boundary=----:

----:
CONTENT-TYPE: application/json

{&quot;_id&quot;: &quot;baz&quot;}
----:
CONTENT-TYPE: text/plain
CONTENT-DISPOSITION: attachment; filename=baz.txt

baz! baz! baz!
----:--
--:--
</pre></div>
</div>
<p>Reading such kind of data in single stream is possible, but is not clean at
all:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">part</span> <span class="o">=</span> <span class="k">await</span> <span class="n">reader</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">part</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">MultipartReader</span><span class="p">):</span>
        <span class="c1"># Fetching files</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">filepart</span> <span class="o">=</span> <span class="k">await</span> <span class="n">part</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">filepart</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="k">await</span> <span class="n">filepart</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Fetching document</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="k">await</span> <span class="n">part</span><span class="o">.</span><span class="n">json</span><span class="p">())])</span>
</pre></div>
</div>
<p>Let’s hack a reader in the way to return pairs of document and reader of the
related files on each iteration:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PairsMultipartReader</span><span class="p">(</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">MultipartReader</span><span class="p">):</span>

    <span class="c1"># keep reference on the original reader</span>
    <span class="n">multipart_reader_cls</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">MultipartReader</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Emits a tuple of document object (:class:`dict`) and multipart</span>
<span class="sd">        reader of the followed attachments (if any).</span>

<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_at_eof</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multipart_reader_cls</span><span class="p">):</span>
            <span class="n">part</span> <span class="o">=</span> <span class="k">await</span> <span class="n">reader</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">part</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">reader</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">doc</span><span class="p">,</span> <span class="n">reader</span>
</pre></div>
</div>
<p>And this gives us a more cleaner solution:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">reader</span> <span class="o">=</span> <span class="n">PairsMultipartReader</span><span class="o">.</span><span class="n">from_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">doc</span><span class="p">,</span> <span class="n">files_reader</span> <span class="o">=</span> <span class="k">await</span> <span class="n">reader</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">filepart</span> <span class="o">=</span> <span class="k">await</span> <span class="n">files_reader</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">part</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="k">await</span> <span class="n">filepart</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>

    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">doc</span><span class="p">,</span> <span class="n">files</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp-multipart-reference"><span class="std std-ref">Multipart reference</span></a></p>
</div>
</div>
</div>
<span id="document-multipart_reference"></span><div class="section" id="multipart-reference">
<span id="aiohttp-multipart-reference"></span><h4>Multipart reference<a class="headerlink" href="#multipart-reference" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="aiohttp.MultipartResponseWrapper">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">MultipartResponseWrapper</code><span class="sig-paren">(</span><em class="sig-param">resp</em>, <em class="sig-param">stream</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartResponseWrapper" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper around the <code class="xref py py-class docutils literal notranslate"><span class="pre">MultipartBodyReader</span></code> to take care about
underlying connection and close it when it needs in.</p>
<dl class="method">
<dt id="aiohttp.MultipartResponseWrapper.at_eof">
<code class="sig-name descname">at_eof</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartResponseWrapper.at_eof" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">True</span></code> when all response data had been read.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.MultipartResponseWrapper.next">
<em class="property">coroutine </em><code class="sig-name descname">next</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartResponseWrapper.next" title="Permalink to this definition">¶</a></dt>
<dd><p>Emits next multipart reader object.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.MultipartResponseWrapper.release">
<em class="property">coroutine </em><code class="sig-name descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartResponseWrapper.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Releases the connection gracefully, reading all the content
to the void.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.BodyPartReader">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">BodyPartReader</code><span class="sig-paren">(</span><em class="sig-param">boundary</em>, <em class="sig-param">headers</em>, <em class="sig-param">content</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BodyPartReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Multipart reader for single body part.</p>
<dl class="method">
<dt id="aiohttp.BodyPartReader.read">
<em class="property">coroutine </em><code class="sig-name descname">read</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">decode=False</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BodyPartReader.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads body part data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>decode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Decodes data following by encoding method
from <code class="docutils literal notranslate"><span class="pre">Content-Encoding</span></code> header. If it
missed data remains untouched</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.7)">bytearray</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BodyPartReader.read_chunk">
<em class="property">coroutine </em><code class="sig-name descname">read_chunk</code><span class="sig-paren">(</span><em class="sig-param">size=chunk_size</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BodyPartReader.read_chunk" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads body part content chunk of the specified size.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – chunk size</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.7)">bytearray</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BodyPartReader.readline">
<em class="property">coroutine </em><code class="sig-name descname">readline</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BodyPartReader.readline" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads body part by line by line.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.7)">bytearray</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BodyPartReader.release">
<em class="property">coroutine </em><code class="sig-name descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BodyPartReader.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#aiohttp.BodyPartReader.read" title="aiohttp.BodyPartReader.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a>, but reads all the data to the void.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)">None</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BodyPartReader.text">
<em class="property">coroutine </em><code class="sig-name descname">text</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">encoding=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BodyPartReader.text" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#aiohttp.BodyPartReader.read" title="aiohttp.BodyPartReader.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a>, but assumes that body part contains text data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Custom text encoding. Overrides specified
in charset param of <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BodyPartReader.json">
<em class="property">coroutine </em><code class="sig-name descname">json</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">encoding=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BodyPartReader.json" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#aiohttp.BodyPartReader.read" title="aiohttp.BodyPartReader.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a>, but assumes that body parts contains JSON data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Custom JSON encoding. Overrides specified
in charset param of <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BodyPartReader.form">
<em class="property">coroutine </em><code class="sig-name descname">form</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">encoding=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BodyPartReader.form" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#aiohttp.BodyPartReader.read" title="aiohttp.BodyPartReader.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a>, but assumes that body parts contains form
urlencoded data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>encoding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – Custom form encoding. Overrides specified
in charset param of <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BodyPartReader.at_eof">
<code class="sig-name descname">at_eof</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BodyPartReader.at_eof" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the boundary was reached or <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BodyPartReader.decode">
<code class="sig-name descname">decode</code><span class="sig-paren">(</span><em class="sig-param">data</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BodyPartReader.decode" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes data according the specified <code class="docutils literal notranslate"><span class="pre">Content-Encoding</span></code>
or <code class="docutils literal notranslate"><span class="pre">Content-Transfer-Encoding</span></code> headers value.</p>
<p>Supports <code class="docutils literal notranslate"><span class="pre">gzip</span></code>, <code class="docutils literal notranslate"><span class="pre">deflate</span></code> and <code class="docutils literal notranslate"><span class="pre">identity</span></code> encodings for
<code class="docutils literal notranslate"><span class="pre">Content-Encoding</span></code> header.</p>
<p>Supports <code class="docutils literal notranslate"><span class="pre">base64</span></code>, <code class="docutils literal notranslate"><span class="pre">quoted-printable</span></code>, <code class="docutils literal notranslate"><span class="pre">binary</span></code> encodings for
<code class="docutils literal notranslate"><span class="pre">Content-Transfer-Encoding</span></code> header.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytearray" title="(in Python v3.7)"><em>bytearray</em></a>) – Data to decode.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> - if encoding is unknown.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)">bytes</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.BodyPartReader.get_charset">
<code class="sig-name descname">get_charset</code><span class="sig-paren">(</span><em class="sig-param">default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.BodyPartReader.get_charset" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns charset parameter from <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code> header or default.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.BodyPartReader.name">
<code class="sig-name descname">name</code><a class="headerlink" href="#aiohttp.BodyPartReader.name" title="Permalink to this definition">¶</a></dt>
<dd><p>A field <em>name</em> specified in <code class="docutils literal notranslate"><span class="pre">Content-Disposition</span></code> header or <code class="docutils literal notranslate"><span class="pre">None</span></code>
if missed or header is malformed.</p>
<p>Readonly <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">name</code></dt>
<dd><p>A field <em>filename</em> specified in <code class="docutils literal notranslate"><span class="pre">Content-Disposition</span></code> header or <code class="docutils literal notranslate"><span class="pre">None</span></code>
if missed or header is malformed.</p>
<p>Readonly <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> property.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.MultipartReader">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">MultipartReader</code><span class="sig-paren">(</span><em class="sig-param">headers</em>, <em class="sig-param">content</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartReader" title="Permalink to this definition">¶</a></dt>
<dd><p>Multipart body reader.</p>
<dl class="method">
<dt id="aiohttp.MultipartReader.from_response">
<em class="property">classmethod </em><code class="sig-name descname">from_response</code><span class="sig-paren">(</span><em class="sig-param">cls</em>, <em class="sig-param">response</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartReader.from_response" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs reader instance from HTTP response.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>response</strong> – <code class="xref py py-class docutils literal notranslate"><span class="pre">ClientResponse</span></code> instance</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.MultipartReader.at_eof">
<code class="sig-name descname">at_eof</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartReader.at_eof" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the final boundary was reached or
<code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.MultipartReader.next">
<em class="property">coroutine </em><code class="sig-name descname">next</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartReader.next" title="Permalink to this definition">¶</a></dt>
<dd><p>Emits the next multipart body part.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.MultipartReader.release">
<em class="property">coroutine </em><code class="sig-name descname">release</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartReader.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads all the body parts to the void till the final boundary.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.MultipartReader.fetch_next_part">
<em class="property">coroutine </em><code class="sig-name descname">fetch_next_part</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartReader.fetch_next_part" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the next body part reader.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.MultipartWriter">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">MultipartWriter</code><span class="sig-paren">(</span><em class="sig-param">subtype='mixed'</em>, <em class="sig-param">boundary=None</em>, <em class="sig-param">close_boundary=True</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartWriter" title="Permalink to this definition">¶</a></dt>
<dd><p>Multipart body writer.</p>
<p><code class="docutils literal notranslate"><span class="pre">boundary</span></code> may be an ASCII-only string.</p>
<dl class="attribute">
<dt id="aiohttp.MultipartWriter.boundary">
<code class="sig-name descname">boundary</code><a class="headerlink" href="#aiohttp.MultipartWriter.boundary" title="Permalink to this definition">¶</a></dt>
<dd><p>The string (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) representation of the boundary.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span>Property type was changed from <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> to <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.MultipartWriter.append">
<code class="sig-name descname">append</code><span class="sig-paren">(</span><em class="sig-param">obj</em>, <em class="sig-param">headers=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartWriter.append" title="Permalink to this definition">¶</a></dt>
<dd><p>Append an object to writer.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.MultipartWriter.append_payload">
<code class="sig-name descname">append_payload</code><span class="sig-paren">(</span><em class="sig-param">payload</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartWriter.append_payload" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a new body part to multipart writer.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.MultipartWriter.append_json">
<code class="sig-name descname">append_json</code><span class="sig-paren">(</span><em class="sig-param">obj</em>, <em class="sig-param">headers=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartWriter.append_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper to append JSON part.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.MultipartWriter.append_form">
<code class="sig-name descname">append_form</code><span class="sig-paren">(</span><em class="sig-param">obj</em>, <em class="sig-param">headers=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartWriter.append_form" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper to append form urlencoded part.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.MultipartWriter.size">
<code class="sig-name descname">size</code><a class="headerlink" href="#aiohttp.MultipartWriter.size" title="Permalink to this definition">¶</a></dt>
<dd><p>Size of the payload.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.MultipartWriter.write">
<em class="property">coroutine </em><code class="sig-name descname">write</code><span class="sig-paren">(</span><em class="sig-param">writer</em>, <em class="sig-param">close_boundary=True</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.MultipartWriter.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write body.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>close_boundary</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – The (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>) that will emit
boundary closing. You may want to disable
when streaming (<code class="docutils literal notranslate"><span class="pre">multipart/x-mixed-replace</span></code>)</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.4: </span>Support <code class="docutils literal notranslate"><span class="pre">close_boundary</span></code> argument.</p>
</div>
</dd></dl>

</dd></dl>

</div>
<span id="document-streams"></span><div class="section" id="streaming-api">
<span id="aiohttp-streams"></span><h4>Streaming API<a class="headerlink" href="#streaming-api" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> uses streams for retrieving <em>BODIES</em>:
<code class="xref py py-attr docutils literal notranslate"><span class="pre">aiohttp.web.Request.content</span></code> and
<a class="reference internal" href="index.html#aiohttp.ClientResponse.content" title="aiohttp.ClientResponse.content"><code class="xref py py-attr docutils literal notranslate"><span class="pre">aiohttp.ClientResponse.content</span></code></a> are properties with stream API.</p>
<dl class="class">
<dt id="aiohttp.StreamReader">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">StreamReader</code><a class="headerlink" href="#aiohttp.StreamReader" title="Permalink to this definition">¶</a></dt>
<dd><p>The reader from incoming stream.</p>
<p>User should never instantiate streams manually but use existing
<code class="xref py py-attr docutils literal notranslate"><span class="pre">aiohttp.web.Request.content</span></code> and
<a class="reference internal" href="index.html#aiohttp.ClientResponse.content" title="aiohttp.ClientResponse.content"><code class="xref py py-attr docutils literal notranslate"><span class="pre">aiohttp.ClientResponse.content</span></code></a> properties for accessing raw
BODY data.</p>
</dd></dl>

<div class="section" id="reading-methods">
<h5>Reading Methods<a class="headerlink" href="#reading-methods" title="Permalink to this headline">¶</a></h5>
<dl class="method">
<dt id="aiohttp.StreamReader.read">
<em class="property">coroutine </em><code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">read</code><span class="sig-paren">(</span><em class="sig-param">n=-1</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read up to <em>n</em> bytes. If <em>n</em> is not provided, or set to <code class="docutils literal notranslate"><span class="pre">-1</span></code>, read until
EOF and return all read bytes.</p>
<p>If the EOF was received and the internal buffer is empty, return an
empty bytes object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>n</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – how many bytes to read, <code class="docutils literal notranslate"><span class="pre">-1</span></code> for the whole stream.</p>
</dd>
<dt class="field-even">Return bytes</dt>
<dd class="field-even"><p>the given data</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.StreamReader.readany">
<em class="property">coroutine </em><code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">readany</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.readany" title="Permalink to this definition">¶</a></dt>
<dd><p>Read next data portion for the stream.</p>
<p>Returns immediately if internal buffer has a data.</p>
<dl class="field-list simple">
<dt class="field-odd">Return bytes</dt>
<dd class="field-odd"><p>the given data</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.StreamReader.readexactly">
<em class="property">coroutine </em><code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">readexactly</code><span class="sig-paren">(</span><em class="sig-param">n</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.readexactly" title="Permalink to this definition">¶</a></dt>
<dd><p>Read exactly <em>n</em> bytes.</p>
<p>Raise an <a class="reference external" href="https://docs.python.org/3/library/asyncio-exceptions.html#asyncio.IncompleteReadError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">asyncio.IncompleteReadError</span></code></a> if the end of the
stream is reached before <em>n</em> can be read, the
<a class="reference external" href="https://docs.python.org/3/library/asyncio-exceptions.html#asyncio.IncompleteReadError.partial" title="(in Python v3.7)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">asyncio.IncompleteReadError.partial</span></code></a> attribute of the
exception contains the partial read bytes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>n</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – how many bytes to read.</p>
</dd>
<dt class="field-even">Return bytes</dt>
<dd class="field-even"><p>the given data</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.StreamReader.readline">
<em class="property">coroutine </em><code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">readline</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.readline" title="Permalink to this definition">¶</a></dt>
<dd><p>Read one line, where “line” is a sequence of bytes ending
with <code class="docutils literal notranslate"><span class="pre">\n</span></code>.</p>
<p>If EOF is received, and <code class="docutils literal notranslate"><span class="pre">\n</span></code> was not found, the method will
return the partial read bytes.</p>
<p>If the EOF was received and the internal buffer is empty, return an
empty bytes object.</p>
<dl class="field-list simple">
<dt class="field-odd">Return bytes</dt>
<dd class="field-odd"><p>the given line</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.StreamReader.readchunk">
<em class="property">coroutine </em><code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">readchunk</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.readchunk" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a chunk of data as it was received by the server.</p>
<p>Returns a tuple of (data, end_of_HTTP_chunk).</p>
<p>When chunked transfer encoding is used, end_of_HTTP_chunk is a <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>
indicating if the end of the data corresponds to the end of a HTTP chunk,
otherwise it is always <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return tuple[bytes, bool]</dt>
<dd class="field-odd"><p>a chunk of data and a <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> that is <code class="docutils literal notranslate"><span class="pre">True</span></code>
when the end of the returned chunk corresponds
to the end of a HTTP chunk.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="asynchronous-iteration-support">
<h5>Asynchronous Iteration Support<a class="headerlink" href="#asynchronous-iteration-support" title="Permalink to this headline">¶</a></h5>
<p>Stream reader supports asynchronous iteration over BODY.</p>
<p>By default it iterates over lines:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>Also there are methods for iterating over data chunks with maximum
size limit and over any available data.</p>
<dl class="method">
<dt id="aiohttp.StreamReader.iter_chunked">
<em class="property">async-for </em><code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">iter_chunked</code><span class="sig-paren">(</span><em class="sig-param">n</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.iter_chunked" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterates over data chunks with maximum size limit:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">iter_chunked</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.StreamReader.iter_any">
<em class="property">async-for </em><code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">iter_any</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.iter_any" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterates over data chunks in order of intaking them into the stream:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">iter_any</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.StreamReader.iter_chunks">
<em class="property">async-for </em><code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">iter_chunks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.iter_chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterates over data chunks as received from the server:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">iter_chunks</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>If chunked transfer encoding is used, the original http chunks formatting
can be retrieved by reading the second element of returned tuples:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">buffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>

<span class="k">async</span> <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">end_of_http_chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">iter_chunks</span><span class="p">():</span>
    <span class="n">buffer</span> <span class="o">+=</span> <span class="n">data</span>
    <span class="k">if</span> <span class="n">end_of_http_chunk</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="helpers">
<h5>Helpers<a class="headerlink" href="#helpers" title="Permalink to this headline">¶</a></h5>
<dl class="method">
<dt id="aiohttp.StreamReader.exception">
<code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">exception</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the exception occurred on data reading.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.is_eof">
<code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">is_eof</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.is_eof" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if EOF was reached.</p>
<p>Internal buffer may be not empty at the moment.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#aiohttp.StreamReader.at_eof" title="aiohttp.StreamReader.at_eof"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StreamReader.at_eof()</span></code></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.StreamReader.at_eof">
<code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">at_eof</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.at_eof" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the buffer is empty and EOF was reached.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.StreamReader.read_nowait">
<code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">read_nowait</code><span class="sig-paren">(</span><em class="sig-param">n=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.read_nowait" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns data from internal buffer if any, empty bytes object otherwise.</p>
<p>Raises <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> if other coroutine is waiting for stream.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>n</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – how many bytes to read, <code class="docutils literal notranslate"><span class="pre">-1</span></code> for the whole internal
buffer.</p>
</dd>
<dt class="field-even">Return bytes</dt>
<dd class="field-even"><p>the given data</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="aiohttp.StreamReader.unread_data">
<code class="sig-prename descclassname">StreamReader.</code><code class="sig-name descname">unread_data</code><span class="sig-paren">(</span><em class="sig-param">data</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.unread_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Rollback reading some data from stream, inserting it to buffer head.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – data to push back into the stream.</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The method does not wake up waiters.</p>
<p>E.g. <a class="reference internal" href="#aiohttp.StreamReader.read" title="aiohttp.StreamReader.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a> will not be resumed.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.wait_eof">
<em class="property">coroutine </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">wait_eof</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.wait_eof" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for EOF. The given data may be accessible by upcoming read calls.</p>
</dd></dl>

</div>
</div>
<span id="document-signals"></span><div class="section" id="signals">
<h4>Signals<a class="headerlink" href="#signals" title="Permalink to this headline">¶</a></h4>
<p>Signal is a list of registered asynchronous callbacks.</p>
<p>The signal’s life-cycle has two stages: after creation its content
could be filled by using standard list operations: <code class="docutils literal notranslate"><span class="pre">sig.append()</span></code>
etc.</p>
<p>After <code class="docutils literal notranslate"><span class="pre">sig.freeze()</span></code> call the signal is <em>frozen</em>: adding, removing
and dropping callbacks are forbidden.</p>
<p>The only available operation is calling previously registered
callbacks by <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">sig.send(data)</span></code>.</p>
<p>For concrete usage examples see <a class="reference internal" href="index.html#aiohttp-web-signals"><span class="std std-ref">signals in aiohttp.web</span></a> chapter.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.0: </span><code class="docutils literal notranslate"><span class="pre">sig.send()</span></code> call is forbidden for non-frozen signal.</p>
<p>Support for regular (non-async) callbacks is dropped. All callbacks
should be async functions.</p>
</div>
<dl class="class">
<dt id="aiohttp.Signal">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">Signal</code><a class="headerlink" href="#aiohttp.Signal" title="Permalink to this definition">¶</a></dt>
<dd><p>The signal, implements <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.MutableSequence" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.MutableSequence</span></code></a>
interface.</p>
<dl class="method">
<dt id="aiohttp.Signal.send">
<em class="property">coroutine </em><code class="sig-name descname">send</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.Signal.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Call all registered callbacks one by one starting from the begin
of list.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.Signal.frozen">
<code class="sig-name descname">frozen</code><a class="headerlink" href="#aiohttp.Signal.frozen" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if <a class="reference internal" href="#aiohttp.Signal.freeze" title="aiohttp.Signal.freeze"><code class="xref py py-meth docutils literal notranslate"><span class="pre">freeze()</span></code></a> was called, read-only property.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.Signal.freeze">
<code class="sig-name descname">freeze</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.Signal.freeze" title="Permalink to this definition">¶</a></dt>
<dd><p>Freeze the list. After the call any content modification is forbidden.</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-structures"></span><div class="section" id="module-aiohttp">
<span id="common-data-structures"></span><span id="aiohttp-structures"></span><h4>Common data structures<a class="headerlink" href="#module-aiohttp" title="Permalink to this headline">¶</a></h4>
<p>Common data structures used by <em>aiohttp</em> internally.</p>
<div class="section" id="frozenlist">
<h5>FrozenList<a class="headerlink" href="#frozenlist" title="Permalink to this headline">¶</a></h5>
<p>A list-like structure which implements
<a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.MutableSequence" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.MutableSequence</span></code></a>.</p>
<p>The list is <em>mutable</em> unless <a class="reference internal" href="#aiohttp.FrozenList.freeze" title="aiohttp.FrozenList.freeze"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FrozenList.freeze()</span></code></a> is called,
after that the list modification raises <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a>.</p>
<dl class="class">
<dt id="aiohttp.FrozenList">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">FrozenList</code><span class="sig-paren">(</span><em class="sig-param">items</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.FrozenList" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a new <em>non-frozen</em> list from <em>items</em> iterable.</p>
<p>The list implements all <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.MutableSequence" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.MutableSequence</span></code></a>
methods plus two additional APIs.</p>
<dl class="attribute">
<dt id="aiohttp.FrozenList.frozen">
<code class="sig-name descname">frozen</code><a class="headerlink" href="#aiohttp.FrozenList.frozen" title="Permalink to this definition">¶</a></dt>
<dd><p>A read-only property, <code class="docutils literal notranslate"><span class="pre">True</span></code> is the list is <em>frozen</em>
(modifications are forbidden).</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.FrozenList.freeze">
<code class="sig-name descname">freeze</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.FrozenList.freeze" title="Permalink to this definition">¶</a></dt>
<dd><p>Freeze the list. There is no way to <em>thaw</em> it back.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="chainmapproxy">
<h5>ChainMapProxy<a class="headerlink" href="#chainmapproxy" title="Permalink to this headline">¶</a></h5>
<p>An <em>immutable</em> version of <a class="reference external" href="https://docs.python.org/3/library/collections.html#collections.ChainMap" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.ChainMap</span></code></a>.  Internally
the proxy is a list of mappings (dictionaries), if the requested key
is not present in the first mapping the second is looked up and so on.</p>
<p>The class supports <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Mapping</span></code></a> interface.</p>
<dl class="class">
<dt id="aiohttp.ChainMapProxy">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">ChainMapProxy</code><span class="sig-paren">(</span><em class="sig-param">maps</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.ChainMapProxy" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new chained mapping proxy from a list of mappings (<em>maps</em>).</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.2.</span></p>
</div>
</dd></dl>

</div>
</div>
<span id="document-websocket_utilities"></span><div class="section" id="websocket-utilities">
<h4>WebSocket utilities<a class="headerlink" href="#websocket-utilities" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="aiohttp.WSCloseCode">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">WSCloseCode</code><a class="headerlink" href="#aiohttp.WSCloseCode" title="Permalink to this definition">¶</a></dt>
<dd><p>An <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.IntEnum" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntEnum</span></code></a> for keeping close message code.</p>
<dl class="attribute">
<dt id="aiohttp.WSCloseCode.OK">
<code class="sig-name descname">OK</code><a class="headerlink" href="#aiohttp.WSCloseCode.OK" title="Permalink to this definition">¶</a></dt>
<dd><p>A normal closure, meaning that the purpose for
which the connection was established has been fulfilled.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSCloseCode.GOING_AWAY">
<code class="sig-name descname">GOING_AWAY</code><a class="headerlink" href="#aiohttp.WSCloseCode.GOING_AWAY" title="Permalink to this definition">¶</a></dt>
<dd><p>An endpoint is “going away”, such as a server
going down or a browser having navigated away from a page.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSCloseCode.PROTOCOL_ERROR">
<code class="sig-name descname">PROTOCOL_ERROR</code><a class="headerlink" href="#aiohttp.WSCloseCode.PROTOCOL_ERROR" title="Permalink to this definition">¶</a></dt>
<dd><p>An endpoint is terminating the connection due
to a protocol error.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSCloseCode.UNSUPPORTED_DATA">
<code class="sig-name descname">UNSUPPORTED_DATA</code><a class="headerlink" href="#aiohttp.WSCloseCode.UNSUPPORTED_DATA" title="Permalink to this definition">¶</a></dt>
<dd><p>An endpoint is terminating the connection
because it has received a type of data it cannot accept (e.g., an
endpoint that understands only text data MAY send this if it
receives a binary message).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSCloseCode.INVALID_TEXT">
<code class="sig-name descname">INVALID_TEXT</code><a class="headerlink" href="#aiohttp.WSCloseCode.INVALID_TEXT" title="Permalink to this definition">¶</a></dt>
<dd><p>An endpoint is terminating the connection
because it has received data within a message that was not
consistent with the type of the message (e.g., non-UTF-8 <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3629.html"><strong>RFC 3629</strong></a>
data within a text message).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSCloseCode.POLICY_VIOLATION">
<code class="sig-name descname">POLICY_VIOLATION</code><a class="headerlink" href="#aiohttp.WSCloseCode.POLICY_VIOLATION" title="Permalink to this definition">¶</a></dt>
<dd><p>An endpoint is terminating the connection because it has
received a message that violates its policy.  This is a generic
status code that can be returned when there is no other more
suitable status code (e.g.,
<code class="xref py py-attr docutils literal notranslate"><span class="pre">unsupported_data</span></code> or
<code class="xref py py-attr docutils literal notranslate"><span class="pre">message_too_big</span></code>) or if there is a need to
hide specific details about the policy.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSCloseCode.MESSAGE_TOO_BIG">
<code class="sig-name descname">MESSAGE_TOO_BIG</code><a class="headerlink" href="#aiohttp.WSCloseCode.MESSAGE_TOO_BIG" title="Permalink to this definition">¶</a></dt>
<dd><p>An endpoint is terminating the connection
because it has received a message that is too big for it to
process.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSCloseCode.MANDATORY_EXTENSION">
<code class="sig-name descname">MANDATORY_EXTENSION</code><a class="headerlink" href="#aiohttp.WSCloseCode.MANDATORY_EXTENSION" title="Permalink to this definition">¶</a></dt>
<dd><p>An endpoint (client) is terminating the
connection because it has expected the server to negotiate one or
more extension, but the server did not return them in the response
message of the WebSocket handshake.  The list of extensions that
are needed should appear in the /reason/ part of the Close frame.
Note that this status code is not used by the server, because it
can fail the WebSocket handshake instead.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSCloseCode.INTERNAL_ERROR">
<code class="sig-name descname">INTERNAL_ERROR</code><a class="headerlink" href="#aiohttp.WSCloseCode.INTERNAL_ERROR" title="Permalink to this definition">¶</a></dt>
<dd><p>A server is terminating the connection because
it encountered an unexpected condition that prevented it from
fulfilling the request.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSCloseCode.SERVICE_RESTART">
<code class="sig-name descname">SERVICE_RESTART</code><a class="headerlink" href="#aiohttp.WSCloseCode.SERVICE_RESTART" title="Permalink to this definition">¶</a></dt>
<dd><p>The service is restarted. a client may reconnect, and if it
chooses to do, should reconnect using a randomized delay of 5-30s.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSCloseCode.TRY_AGAIN_LATER">
<code class="sig-name descname">TRY_AGAIN_LATER</code><a class="headerlink" href="#aiohttp.WSCloseCode.TRY_AGAIN_LATER" title="Permalink to this definition">¶</a></dt>
<dd><p>The service is experiencing overload. A client should only
connect to a different IP (when there are multiple for the
target) or reconnect to the same IP upon user action.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.WSMsgType">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">WSMsgType</code><a class="headerlink" href="#aiohttp.WSMsgType" title="Permalink to this definition">¶</a></dt>
<dd><p>An <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.IntEnum" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntEnum</span></code></a> for describing <a class="reference internal" href="#aiohttp.WSMessage" title="aiohttp.WSMessage"><code class="xref py py-class docutils literal notranslate"><span class="pre">WSMessage</span></code></a> type.</p>
<dl class="attribute">
<dt id="aiohttp.WSMsgType.CONTINUATION">
<code class="sig-name descname">CONTINUATION</code><a class="headerlink" href="#aiohttp.WSMsgType.CONTINUATION" title="Permalink to this definition">¶</a></dt>
<dd><p>A mark for continuation frame, user will never get the message
with this type.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSMsgType.TEXT">
<code class="sig-name descname">TEXT</code><a class="headerlink" href="#aiohttp.WSMsgType.TEXT" title="Permalink to this definition">¶</a></dt>
<dd><p>Text message, the value has <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> type.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSMsgType.BINARY">
<code class="sig-name descname">BINARY</code><a class="headerlink" href="#aiohttp.WSMsgType.BINARY" title="Permalink to this definition">¶</a></dt>
<dd><p>Binary message, the value has <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> type.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSMsgType.PING">
<code class="sig-name descname">PING</code><a class="headerlink" href="#aiohttp.WSMsgType.PING" title="Permalink to this definition">¶</a></dt>
<dd><p>Ping frame (sent by client peer).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSMsgType.PONG">
<code class="sig-name descname">PONG</code><a class="headerlink" href="#aiohttp.WSMsgType.PONG" title="Permalink to this definition">¶</a></dt>
<dd><p>Pong frame, answer on ping. Sent by server peer.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSMsgType.CLOSE">
<code class="sig-name descname">CLOSE</code><a class="headerlink" href="#aiohttp.WSMsgType.CLOSE" title="Permalink to this definition">¶</a></dt>
<dd><p>Close frame.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">CLOSED FRAME</code></dt>
<dd><p>Actually not frame but a flag indicating that websocket was
closed.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSMsgType.ERROR">
<code class="sig-name descname">ERROR</code><a class="headerlink" href="#aiohttp.WSMsgType.ERROR" title="Permalink to this definition">¶</a></dt>
<dd><p>Actually not frame but a flag indicating that websocket was
received an error.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="aiohttp.WSMessage">
<em class="property">class </em><code class="sig-prename descclassname">aiohttp.</code><code class="sig-name descname">WSMessage</code><a class="headerlink" href="#aiohttp.WSMessage" title="Permalink to this definition">¶</a></dt>
<dd><p>Websocket message, returned by <code class="docutils literal notranslate"><span class="pre">.receive()</span></code> calls.</p>
<dl class="attribute">
<dt id="aiohttp.WSMessage.type">
<code class="sig-name descname">type</code><a class="headerlink" href="#aiohttp.WSMessage.type" title="Permalink to this definition">¶</a></dt>
<dd><p>Message type, <a class="reference internal" href="#aiohttp.WSMsgType" title="aiohttp.WSMsgType"><code class="xref py py-class docutils literal notranslate"><span class="pre">WSMsgType</span></code></a> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSMessage.data">
<code class="sig-name descname">data</code><a class="headerlink" href="#aiohttp.WSMessage.data" title="Permalink to this definition">¶</a></dt>
<dd><p>Message payload.</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> for <a class="reference internal" href="#aiohttp.WSMsgType.TEXT" title="aiohttp.WSMsgType.TEXT"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WSMsgType.TEXT</span></code></a> messages.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> for <a class="reference internal" href="#aiohttp.WSMsgType.BINARY" title="aiohttp.WSMsgType.BINARY"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WSMsgType.BINARY</span></code></a> messages.</p></li>
<li><p><a class="reference internal" href="#aiohttp.WSCloseCode" title="aiohttp.WSCloseCode"><code class="xref py py-class docutils literal notranslate"><span class="pre">WSCloseCode</span></code></a> for <a class="reference internal" href="#aiohttp.WSMsgType.CLOSE" title="aiohttp.WSMsgType.CLOSE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WSMsgType.CLOSE</span></code></a> messages.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> for <a class="reference internal" href="#aiohttp.WSMsgType.PING" title="aiohttp.WSMsgType.PING"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WSMsgType.PING</span></code></a> messages.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> for <a class="reference internal" href="#aiohttp.WSMsgType.PONG" title="aiohttp.WSMsgType.PONG"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WSMsgType.PONG</span></code></a> messages.</p></li>
</ol>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.WSMessage.extra">
<code class="sig-name descname">extra</code><a class="headerlink" href="#aiohttp.WSMessage.extra" title="Permalink to this definition">¶</a></dt>
<dd><p>Additional info, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.</p>
<p>Makes sense only for <a class="reference internal" href="#aiohttp.WSMsgType.CLOSE" title="aiohttp.WSMsgType.CLOSE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WSMsgType.CLOSE</span></code></a> messages, contains
optional message description.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.WSMessage.json">
<code class="sig-name descname">json</code><span class="sig-paren">(</span><em class="sig-param">*</em>, <em class="sig-param">loads=json.loads</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.WSMessage.json" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns parsed JSON data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>loads</strong> – optional JSON decoder function.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
</div>
<span id="document-faq"></span><div class="section" id="faq">
<h3>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h3>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#are-there-plans-for-an-app-route-decorator-like-in-flask" id="id1">Are there plans for an &#64;app.route decorator like in Flask?</a></p></li>
<li><p><a class="reference internal" href="#does-aiohttp-have-a-concept-like-flask-s-blueprint-or-django-s-app" id="id2">Does aiohttp have a concept like Flask’s “blueprint” or Django’s “app”?</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-create-a-route-that-matches-urls-with-a-given-prefix" id="id3">How do I create a route that matches urls with a given prefix?</a></p></li>
<li><p><a class="reference internal" href="#where-do-i-put-my-database-connection-so-handlers-can-access-it" id="id4">Where do I put my database connection so handlers can access it?</a></p></li>
<li><p><a class="reference internal" href="#why-is-python-3-5-3-the-lowest-supported-version" id="id5">Why is Python 3.5.3 the lowest supported version?</a></p></li>
<li><p><a class="reference internal" href="#how-can-middleware-store-data-for-web-handlers-to-use" id="id6">How can middleware store data for web handlers to use?</a></p></li>
<li><p><a class="reference internal" href="#can-a-handler-receive-incoming-events-from-different-sources-in-parallel" id="id7">Can a handler receive incoming events from different sources in parallel?</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-programmatically-close-a-websocket-server-side" id="id8">How do I programmatically close a WebSocket server-side?</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-make-a-request-from-a-specific-ip-address" id="id9">How do I make a request from a specific IP address?</a></p></li>
<li><p><a class="reference internal" href="#what-is-the-api-stability-and-deprecation-policy" id="id10">What is the API stability and deprecation policy?</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-enable-gzip-compression-globally-for-my-entire-application" id="id11">How do I enable gzip compression globally for my entire application?</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-manage-a-clientsession-within-a-web-server" id="id12">How do I manage a ClientSession within a web server?</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-access-database-connections-from-a-subapplication" id="id13">How do I access database connections from a subapplication?</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-perform-operations-in-a-request-handler-after-sending-the-response" id="id14">How do I perform operations in a request handler after sending the response?</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-make-sure-my-custom-middleware-response-will-behave-correctly" id="id15">How do I make sure my custom middleware response will behave correctly?</a></p></li>
<li><p><a class="reference internal" href="#why-is-creating-a-clientsession-outside-of-an-event-loop-dangerous" id="id16">Why is creating a ClientSession outside of an event loop dangerous?</a></p></li>
</ul>
</div>
<div class="section" id="are-there-plans-for-an-app-route-decorator-like-in-flask">
<h4><a class="toc-backref" href="#id1">Are there plans for an &#64;app.route decorator like in Flask?</a><a class="headerlink" href="#are-there-plans-for-an-app-route-decorator-like-in-flask" title="Permalink to this headline">¶</a></h4>
<p>As of aiohttp 2.3, <a class="reference internal" href="index.html#aiohttp.web.RouteTableDef" title="aiohttp.web.RouteTableDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteTableDef</span></code></a> provides an API
similar to Flask’s <code class="docutils literal notranslate"><span class="pre">&#64;app.route</span></code>. See
<a class="reference internal" href="index.html#aiohttp-web-alternative-routes-definition"><span class="std std-ref">Alternative ways for registering routes</span></a>.</p>
<p>Unlike Flask’s <code class="docutils literal notranslate"><span class="pre">&#64;app.route</span></code>, <a class="reference internal" href="index.html#aiohttp.web.RouteTableDef" title="aiohttp.web.RouteTableDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteTableDef</span></code></a>
does not require an <code class="docutils literal notranslate"><span class="pre">app</span></code> in the module namespace (which often leads
to circular imports).</p>
<p>Instead, a <a class="reference internal" href="index.html#aiohttp.web.RouteTableDef" title="aiohttp.web.RouteTableDef"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteTableDef</span></code></a> is decoupled from an application instance:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">routes</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">RouteTableDef</span><span class="p">()</span>

<span class="nd">@routes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/get&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_get</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>


<span class="nd">@routes</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/post&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handle_post</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_routes</span><span class="p">(</span><span class="n">routes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="does-aiohttp-have-a-concept-like-flask-s-blueprint-or-django-s-app">
<h4><a class="toc-backref" href="#id2">Does aiohttp have a concept like Flask’s “blueprint” or Django’s “app”?</a><a class="headerlink" href="#does-aiohttp-have-a-concept-like-flask-s-blueprint-or-django-s-app" title="Permalink to this headline">¶</a></h4>
<p>If you’re writing a large application, you may want to consider
using <a class="reference internal" href="index.html#aiohttp-web-nested-applications"><span class="std std-ref">nested applications</span></a>, which
are similar to Flask’s “blueprints” or Django’s “apps”.</p>
<p>See: <a class="reference internal" href="index.html#aiohttp-web-nested-applications"><span class="std std-ref">Nested applications</span></a>.</p>
</div>
<div class="section" id="how-do-i-create-a-route-that-matches-urls-with-a-given-prefix">
<h4><a class="toc-backref" href="#id3">How do I create a route that matches urls with a given prefix?</a><a class="headerlink" href="#how-do-i-create-a-route-that-matches-urls-with-a-given-prefix" title="Permalink to this headline">¶</a></h4>
<p>You can do something like the following:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;/path/to/{tail:.+}&#39;</span><span class="p">,</span> <span class="n">sink_handler</span><span class="p">)</span>
</pre></div>
</div>
<p>The first argument, <code class="docutils literal notranslate"><span class="pre">*</span></code>,  matches any HTTP method
(<em>GET, POST, OPTIONS</em>, etc). The second argument matches URLS with the desired prefix.
The third argument is the handler function.</p>
</div>
<div class="section" id="where-do-i-put-my-database-connection-so-handlers-can-access-it">
<h4><a class="toc-backref" href="#id4">Where do I put my database connection so handlers can access it?</a><a class="headerlink" href="#where-do-i-put-my-database-connection-so-handlers-can-access-it" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a> object supports the <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>
interface and provides a place to store your database connections or any
other resource you want to share between handlers.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">go</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="k">await</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT 42&#39;</span><span class="p">)</span>
    <span class="c1"># ...</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;ok&#39;</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">init_app</span><span class="p">(</span><span class="n">loop</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>
    <span class="n">db</span> <span class="o">=</span> <span class="k">await</span> <span class="n">create_connection</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
    <span class="n">app</span><span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span>
    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">go</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>
</pre></div>
</div>
</div>
<div class="section" id="why-is-python-3-5-3-the-lowest-supported-version">
<h4><a class="toc-backref" href="#id5">Why is Python 3.5.3 the lowest supported version?</a><a class="headerlink" href="#why-is-python-3-5-3-the-lowest-supported-version" title="Permalink to this headline">¶</a></h4>
<p>Python 3.5.2 fixes the protocol for async iterators: <code class="docutils literal notranslate"><span class="pre">__aiter__()</span></code> is
not a coroutine but a regular function.</p>
<p>Python 3.5.3 has a more important change: <a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.get_event_loop" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.get_event_loop()</span></code></a>
returns the running loop instance if called from a coroutine.
Previously it returned a <em>default</em> loop, set by
<a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.set_event_loop" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.set_event_loop()</span></code></a>.</p>
<p>Previous to Python 3.5.3,
<a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.get_event_loop" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.get_event_loop()</span></code></a> was not reliable, so users were
forced to explicitly pass the event loop instance everywhere.
If a future object were created for one event loop
(e.g. the default loop) but a coroutine was run by another loop, the coroutine
was never awaited. As a result, the task would hang.</p>
<p>Keep in mind that every internal <code class="docutils literal notranslate"><span class="pre">await</span></code> expression either passed
instantly or paused, waiting for a future.</p>
<p>It’s extremely important that all tasks (coroutine runners) and
futures use the same event loop.</p>
</div>
<div class="section" id="how-can-middleware-store-data-for-web-handlers-to-use">
<h4><a class="toc-backref" href="#id6">How can middleware store data for web handlers to use?</a><a class="headerlink" href="#how-can-middleware-store-data-for-web-handlers-to-use" title="Permalink to this headline">¶</a></h4>
<p>Both <a class="reference internal" href="index.html#aiohttp.web.Request" title="aiohttp.web.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Request</span></code></a>  and <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a>
support the <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> interface.</p>
<p>Therefore, data may be stored inside a request object.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">request</span><span class="p">[</span><span class="s1">&#39;unique_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/aio-libs/aiohttp_session">https://github.com/aio-libs/aiohttp_session</a> code for an example.
The <code class="docutils literal notranslate"><span class="pre">aiohttp_session.get_session(request)</span></code> method uses <code class="docutils literal notranslate"><span class="pre">SESSION_KEY</span></code>
for saving request-specific session information.</p>
<p>As of aiohttp 3.0, all response objects are dict-like structures as
well.</p>
</div>
<div class="section" id="can-a-handler-receive-incoming-events-from-different-sources-in-parallel">
<span id="aiohttp-faq-parallel-event-sources"></span><h4><a class="toc-backref" href="#id7">Can a handler receive incoming events from different sources in parallel?</a><a class="headerlink" href="#can-a-handler-receive-incoming-events-from-different-sources-in-parallel" title="Permalink to this headline">¶</a></h4>
<p>Yes.</p>
<p>As an example, we may have two event sources:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>WebSocket for events from an end user</p></li>
<li><p>Redis PubSub for events from other parts of the application</p></li>
</ol>
</div></blockquote>
<p>The most native way to handle this is to create a separate task for
PubSub handling.</p>
<p>Parallel <a class="reference internal" href="index.html#aiohttp.web.WebSocketResponse.receive" title="aiohttp.web.WebSocketResponse.receive"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.web.WebSocketResponse.receive()</span></code></a> calls are forbidden;
a single task should perform WebSocket reading.
However, other tasks may use the same WebSocket object for sending data to
peers.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="n">ws</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">WebSocketResponse</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
        <span class="n">read_subscription</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span>
                          <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;redis&#39;</span><span class="p">]))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">:</span>
            <span class="c1"># handle incoming messages</span>
            <span class="c1"># use ws.send_str() to send data back</span>
            <span class="o">...</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">read_subscription</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">redis</span><span class="p">):</span>
    <span class="n">channel</span><span class="p">,</span> <span class="o">=</span> <span class="k">await</span> <span class="n">redis</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s1">&#39;channel:1&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">channel</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">process</span> <span class="n">message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">send_str</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">redis</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="s1">&#39;channel:1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-programmatically-close-a-websocket-server-side">
<span id="aiohttp-faq-terminating-websockets"></span><h4><a class="toc-backref" href="#id8">How do I programmatically close a WebSocket server-side?</a><a class="headerlink" href="#how-do-i-programmatically-close-a-websocket-server-side" title="Permalink to this headline">¶</a></h4>
<p>Let’s say we have an application with two endpoints:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/echo</span></code> a WebSocket echo server that authenticates the user</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/logout_user</span></code> that, when invoked, closes all open
WebSockets for that user.</p></li>
</ol>
</div></blockquote>
<p>One simple solution is to keep a shared registry of WebSocket
responses for a user in the <a class="reference internal" href="index.html#aiohttp.web.Application" title="aiohttp.web.Application"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Application</span></code></a> instance
and call <a class="reference internal" href="index.html#aiohttp.web.WebSocketResponse.close" title="aiohttp.web.WebSocketResponse.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.web.WebSocketResponse.close()</span></code></a> on all of them in
<code class="docutils literal notranslate"><span class="pre">/logout_user</span></code> handler:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">echo_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="n">ws</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">WebSocketResponse</span><span class="p">()</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">ws</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;websockets&#39;</span><span class="p">][</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">:</span>
            <span class="n">ws</span><span class="o">.</span><span class="n">send_str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;websockets&#39;</span><span class="p">][</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ws</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">logout_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="n">user_id</span> <span class="o">=</span> <span class="n">authenticate_user</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="n">ws_closers</span> <span class="o">=</span> <span class="p">[</span><span class="n">ws</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                  <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s1">&#39;websockets&#39;</span><span class="p">][</span><span class="n">user_id</span><span class="p">]</span>
                  <span class="k">if</span> <span class="ow">not</span> <span class="n">ws</span><span class="o">.</span><span class="n">closed</span><span class="p">]</span>

    <span class="c1"># Watch out, this will keep us from returing the response</span>
    <span class="c1"># until all are closed</span>
    <span class="n">ws_closers</span> <span class="ow">and</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">ws_closers</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;OK&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/echo&#39;</span><span class="p">,</span> <span class="n">echo_handler</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/logout&#39;</span><span class="p">,</span> <span class="n">logout_handler</span><span class="p">)</span>
    <span class="n">app</span><span class="p">[</span><span class="s1">&#39;websockets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
    <span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-make-a-request-from-a-specific-ip-address">
<h4><a class="toc-backref" href="#id9">How do I make a request from a specific IP address?</a><a class="headerlink" href="#how-do-i-make-a-request-from-a-specific-ip-address" title="Permalink to this headline">¶</a></h4>
<p>If your system has several IP interfaces, you may choose one which will
be used used to bind a socket locally:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">TCPConnector</span><span class="p">(</span><span class="n">local_addr</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>
<span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">connector</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="index.html#aiohttp.TCPConnector" title="aiohttp.TCPConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TCPConnector</span></code></a> and <code class="docutils literal notranslate"><span class="pre">local_addr</span></code> parameter.</p>
</div>
</div>
<div class="section" id="what-is-the-api-stability-and-deprecation-policy">
<h4><a class="toc-backref" href="#id10">What is the API stability and deprecation policy?</a><a class="headerlink" href="#what-is-the-api-stability-and-deprecation-policy" title="Permalink to this headline">¶</a></h4>
<p><em>aiohttp</em> follows strong <a class="reference external" href="https://semver.org">Semantic Versioning</a> (SemVer).</p>
<p>Obsolete attributes and methods are marked as <em>deprecated</em> in the
documentation and raise <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#DeprecationWarning" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> upon usage.</p>
<p>Assume aiohttp <code class="docutils literal notranslate"><span class="pre">X.Y.Z</span></code> where <code class="docutils literal notranslate"><span class="pre">X</span></code> is major version,
<code class="docutils literal notranslate"><span class="pre">Y</span></code> is minor version and <code class="docutils literal notranslate"><span class="pre">Z</span></code> is bugfix number.</p>
<p>For example, if the latest released version is <code class="docutils literal notranslate"><span class="pre">aiohttp==3.0.6</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">3.0.7</span></code> fixes some bugs but have no new features.</p>
<p><code class="docutils literal notranslate"><span class="pre">3.1.0</span></code> introduces new features and can deprecate some API but never
remove it, also all bug fixes from previous release are merged.</p>
<p><code class="docutils literal notranslate"><span class="pre">4.0.0</span></code> removes all deprecations collected from <code class="docutils literal notranslate"><span class="pre">3.Y</span></code> versions
<strong>except</strong> deprecations from the <strong>last</strong> <code class="docutils literal notranslate"><span class="pre">3.Y</span></code> release. These
deprecations will be removed by <code class="docutils literal notranslate"><span class="pre">5.0.0</span></code>.</p>
<p>Unfortunately we may have to break these rules when a <strong>security
vulnerability</strong> is found.
If a security problem cannot be fixed without breaking backward
compatibility, a bugfix release may break compatibility. This is unlikely, but
possible.</p>
<p>All backward incompatible changes are explicitly marked in
<a class="reference internal" href="index.html#aiohttp-changes"><span class="std std-ref">the changelog</span></a>.</p>
</div>
<div class="section" id="how-do-i-enable-gzip-compression-globally-for-my-entire-application">
<h4><a class="toc-backref" href="#id11">How do I enable gzip compression globally for my entire application?</a><a class="headerlink" href="#how-do-i-enable-gzip-compression-globally-for-my-entire-application" title="Permalink to this headline">¶</a></h4>
<p>It’s impossible. Choosing what to compress and what not to compress is
is a tricky matter.</p>
<p>If you need global compression, write a custom middleware. Or
enable compression in NGINX (you are deploying aiohttp behind reverse
proxy, right?).</p>
</div>
<div class="section" id="how-do-i-manage-a-clientsession-within-a-web-server">
<h4><a class="toc-backref" href="#id12">How do I manage a ClientSession within a web server?</a><a class="headerlink" href="#how-do-i-manage-a-clientsession-within-a-web-server" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="index.html#aiohttp.ClientSession" title="aiohttp.ClientSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.ClientSession</span></code></a> should be created once for the lifetime
of the server in order to benefit from connection pooling.</p>
<p>Sessions save cookies internally. If you don’t need cookie processing,
use <a class="reference internal" href="index.html#aiohttp.DummyCookieJar" title="aiohttp.DummyCookieJar"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.DummyCookieJar</span></code></a>. If you need separate cookies
for different http calls but process them in logical chains, use a single
<a class="reference internal" href="index.html#aiohttp.TCPConnector" title="aiohttp.TCPConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.TCPConnector</span></code></a> with separate
client sessions and <code class="docutils literal notranslate"><span class="pre">own_connector=False</span></code>.</p>
</div>
<div class="section" id="how-do-i-access-database-connections-from-a-subapplication">
<h4><a class="toc-backref" href="#id13">How do I access database connections from a subapplication?</a><a class="headerlink" href="#how-do-i-access-database-connections-from-a-subapplication" title="Permalink to this headline">¶</a></h4>
<p>Restricting access from subapplication to main (or outer) app is a
deliberate choice.</p>
<p>A subapplication is an isolated unit by design. If you need to share a
database object, do it explicitly:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">subapp</span><span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mainapp</span><span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span>
<span class="n">mainapp</span><span class="o">.</span><span class="n">add_subapp</span><span class="p">(</span><span class="s1">&#39;/prefix&#39;</span><span class="p">,</span> <span class="n">subapp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-perform-operations-in-a-request-handler-after-sending-the-response">
<h4><a class="toc-backref" href="#id14">How do I perform operations in a request handler after sending the response?</a><a class="headerlink" href="#how-do-i-perform-operations-in-a-request-handler-after-sending-the-response" title="Permalink to this headline">¶</a></h4>
<p>Middlewares can be written to handle post-response operations, but
they run after every request. You can explicitly send the response by
calling <code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.web.Response.write_eof()</span></code>, which starts sending
before the handler returns, giving you a chance to execute follow-up
operations:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ping_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Send PONG and increase DB counter.&quot;&quot;&quot;</span>

    <span class="c1"># explicitly send the response</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">json_response</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;PONG&#39;</span><span class="p">})</span>
    <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">write_eof</span><span class="p">()</span>

    <span class="c1"># increase the pong count</span>
    <span class="n">APP</span><span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">inc_pong</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">resp</span>
</pre></div>
</div>
<p>A <a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Response</span></code></a> object must be returned. This is
required by aiohttp web contracts, even though the response
already been sent.</p>
</div>
<div class="section" id="how-do-i-make-sure-my-custom-middleware-response-will-behave-correctly">
<h4><a class="toc-backref" href="#id15">How do I make sure my custom middleware response will behave correctly?</a><a class="headerlink" href="#how-do-i-make-sure-my-custom-middleware-response-will-behave-correctly" title="Permalink to this headline">¶</a></h4>
<p>Sometimes your middleware handlers might need to send a custom response.
This is just fine as long as you always create a new
<a class="reference internal" href="index.html#aiohttp.web.Response" title="aiohttp.web.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Response</span></code></a> object when required.</p>
<p>The response object is a Finite State Machine. Once it has been dispatched
by the server, it will reach its final state and cannot be used again.</p>
<p>The following middleware will make the server hang, once it serves the second
response:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="k">import</span> <span class="n">web</span>

<span class="k">def</span> <span class="nf">misbehaved_middleware</span><span class="p">():</span>
    <span class="c1"># don&#39;t do this!</span>
    <span class="n">cached</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Hi, I am cached!&#39;</span><span class="p">)</span>

    <span class="nd">@web</span><span class="o">.</span><span class="n">middleware</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">middleware</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="c1"># ignoring response for the sake of this example</span>
        <span class="n">_res</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cached</span>

    <span class="k">return</span> <span class="n">middleware</span>
</pre></div>
</div>
<p>The rule of thumb is <em>one request, one response</em>.</p>
</div>
<div class="section" id="why-is-creating-a-clientsession-outside-of-an-event-loop-dangerous">
<h4><a class="toc-backref" href="#id16">Why is creating a ClientSession outside of an event loop dangerous?</a><a class="headerlink" href="#why-is-creating-a-clientsession-outside-of-an-event-loop-dangerous" title="Permalink to this headline">¶</a></h4>
<p>Short answer is: life-cycle of all asyncio objects should be shorter
than life-cycle of event loop.</p>
<p>Full explanation is longer.  All asyncio object should be correctly
finished/disconnected/closed before event loop shutdown.  Otherwise
user can get unexpected behavior. In the best case it is a warning
about unclosed resource, in the worst case the program just hangs,
awaiting for coroutine is never resumed etc.</p>
<p>Consider the following code from <code class="docutils literal notranslate"><span class="pre">mod.py</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">aiohttp</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</pre></div>
</div>
<p>The session grabs current event loop instance and stores it in a
private variable.</p>
<p>The main module imports the module and installs <code class="docutils literal notranslate"><span class="pre">uvloop</span></code> (an
alternative fast event loop implementation).</p>
<p><code class="docutils literal notranslate"><span class="pre">main.py</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">uvloop</span>
<span class="kn">import</span> <span class="nn">mod</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop_policy</span><span class="p">(</span><span class="n">uvloop</span><span class="o">.</span><span class="n">EventLoopPolicy</span><span class="p">())</span>
<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>The code is broken: <code class="docutils literal notranslate"><span class="pre">session</span></code> is bound to default <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> loop
on import time but the loop is changed <strong>after the import</strong> by
<code class="docutils literal notranslate"><span class="pre">set_event_loop()</span></code>.  As result <code class="docutils literal notranslate"><span class="pre">fetch()</span></code> call hangs.</p>
<p>To avoid import dependency hell <em>aiohttp</em> encourages creation of
<code class="docutils literal notranslate"><span class="pre">ClientSession</span></code> from async function.  The same policy works for
<code class="docutils literal notranslate"><span class="pre">web.Application</span></code> too.</p>
<p>Another use case is unit test writing.  Very many test libraries
(<em>aiohttp test tools</em> first) creates a new loop instance for every
test function execution.  It’s done for sake of tests isolation.
Otherwise pending activity (timers, network packets etc.) from
previous test may interfere with current one producing very cryptic
and unstable test failure.</p>
<p>Note: <em>class variables</em> are hidden globals actually. The following
code has the same problem as <code class="docutils literal notranslate"><span class="pre">mod.py</span></code> example, <code class="docutils literal notranslate"><span class="pre">session</span></code> variable
is the hidden global object:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<span id="document-misc"></span><div class="section" id="miscellaneous">
<span id="aiohttp-misc"></span><h3>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h3>
<p>Helpful pages.</p>
<div class="toctree-wrapper compound" id="misc">
<span id="document-essays"></span><div class="section" id="essays">
<h4>Essays<a class="headerlink" href="#essays" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-new_router"></span><div class="section" id="router-refactoring-in-0-21">
<span id="aiohttp-router-refactoring-021"></span><h5>Router refactoring in 0.21<a class="headerlink" href="#router-refactoring-in-0-21" title="Permalink to this headline">¶</a></h5>
<div class="section" id="rationale">
<h6>Rationale<a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h6>
<p>First generation (v1) of router has mapped <code class="docutils literal notranslate"><span class="pre">(method,</span> <span class="pre">path)</span></code> pair to
<a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a>.  Mapping is named <strong>route</strong>. Routes used to have
unique names if any.</p>
<p>The main mistake with the design is coupling the <strong>route</strong> to
<code class="docutils literal notranslate"><span class="pre">(method,</span> <span class="pre">path)</span></code> pair while really URL construction operates with
<strong>resources</strong> (<strong>location</strong> is a synonym). HTTP method is not part of URI
but applied on sending HTTP request only.</p>
<p>Having different <strong>route names</strong> for the same path is confusing. Moreover
<strong>named routes</strong> constructed for the same path should have unique
non overlapping names which is cumbersome is certain situations.</p>
<p>From other side sometimes it’s desirable to bind several HTTP methods
to the same web handler. For <em>v1</em> router it can be solved by passing ‘*’
as HTTP method. Class based views require ‘*’ method also usually.</p>
</div>
<div class="section" id="implementation">
<h6>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h6>
<p>The change introduces <strong>resource</strong> as first class citizen:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="o">=</span> <span class="n">router</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="s1">&#39;/path/</span><span class="si">{to}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Resource</em> has a <strong>path</strong> (dynamic or constant) and optional <strong>name</strong>.</p>
<p>The name is <strong>unique</strong> in router context.</p>
<p><em>Resource</em> has <strong>routes</strong>.</p>
<p><em>Route</em> corresponds to <em>HTTP method</em> and <a class="reference internal" href="index.html#term-web-handler"><span class="xref std std-term">web-handler</span></a> for the method:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">route</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
<p>User still may use wildcard for accepting all HTTP methods (maybe we
will add something like <code class="docutils literal notranslate"><span class="pre">resource.add_wildcard(handler)</span></code> later).</p>
<p>Since <strong>names</strong> belongs to <strong>resources</strong> now <code class="docutils literal notranslate"><span class="pre">app.router['name']</span></code>
returns a <strong>resource</strong> instance instead of <code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Route</span></code>.</p>
<p><strong>resource</strong> has <code class="docutils literal notranslate"><span class="pre">.url()</span></code> method, so
<code class="docutils literal notranslate"><span class="pre">app.router['name'].url(parts={'a':</span> <span class="pre">'b'},</span> <span class="pre">query={'arg':</span> <span class="pre">'param'})</span></code>
still works as usual.</p>
<p>The change allows to rewrite static file handling and implement nested
applications as well.</p>
<p>Decoupling of <em>HTTP location</em> and <em>HTTP method</em> makes life easier.</p>
</div>
<div class="section" id="backward-compatibility">
<h6>Backward compatibility<a class="headerlink" href="#backward-compatibility" title="Permalink to this headline">¶</a></h6>
<p>The refactoring is 99% compatible with previous implementation.</p>
<p>99% means all example and the most of current code works without
modifications but we have subtle API backward incompatibles.</p>
<p><code class="docutils literal notranslate"><span class="pre">app.router['name']</span></code> returns a <code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.BaseResource</span></code>
instance instead of <code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Route</span></code> but resource has the
same <code class="docutils literal notranslate"><span class="pre">resource.url(...)</span></code> most useful method, so end user should feel no
difference.</p>
<p><code class="docutils literal notranslate"><span class="pre">route.match(...)</span></code> is <strong>not</strong> supported anymore, use
<a class="reference internal" href="index.html#aiohttp.web.AbstractResource.resolve" title="aiohttp.web.AbstractResource.resolve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aiohttp.web.AbstractResource.resolve()</span></code></a> instead.</p>
<p><code class="docutils literal notranslate"><span class="pre">app.router.add_route(method,</span> <span class="pre">path,</span> <span class="pre">handler,</span> <span class="pre">name='name')</span></code> now is just
shortcut for:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<span class="n">route</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
<span class="k">return</span> <span class="n">route</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">app.router.register_route(...)</span></code> is still supported, it creates
<code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.ResourceAdapter</span></code> for every call (but it’s deprecated now).</p>
</div>
</div>
<span id="document-whats_new_1_1"></span><div class="section" id="what-s-new-in-aiohttp-1-1">
<h5>What’s new in aiohttp 1.1<a class="headerlink" href="#what-s-new-in-aiohttp-1-1" title="Permalink to this headline">¶</a></h5>
<div class="section" id="yarl-and-url-encoding">
<h6>YARL and URL encoding<a class="headerlink" href="#yarl-and-url-encoding" title="Permalink to this headline">¶</a></h6>
<p>Since aiohttp 1.1 the library uses <a class="reference internal" href="index.html#term-yarl"><span class="xref std std-term">yarl</span></a> for URL processing.</p>
<div class="section" id="new-api">
<h7>New API<a class="headerlink" href="#new-api" title="Permalink to this headline">¶</a></h7>
<p><a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">yarl.URL</span></code></a> gives handy methods for URL operations etc.</p>
<p>Client API still accepts <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> everywhere <em>url</em> is used,
e.g. <code class="docutils literal notranslate"><span class="pre">session.get('http://example.com')</span></code> works as well as
<code class="docutils literal notranslate"><span class="pre">session.get(yarl.URL('http://example.com'))</span></code>.</p>
<p>Internal API has been switched to <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">yarl.URL</span></code></a>.
<a class="reference internal" href="index.html#aiohttp.CookieJar" title="aiohttp.CookieJar"><code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.CookieJar</span></code></a> accepts <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">URL</span></code></a> instances only.</p>
<p>On server side has added <code class="xref py py-class docutils literal notranslate"><span class="pre">web.Request.url</span></code> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">web.Request.rel_url</span></code> properties for representing relative and
absolute request’s URL.</p>
<p>URL using is the recommended way, already existed properties for
retrieving URL parts are deprecated and will be eventually removed.</p>
<p>Redirection web exceptions accepts <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">yarl.URL</span></code></a> as <em>location</em>
parameter. <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> is still supported and will be supported forever.</p>
<p>Reverse URL processing for <em>router</em> has been changed.</p>
<p>The main API is <code class="xref py py-class docutils literal notranslate"><span class="pre">aiohttp.web.Request.url_for(name,</span> <span class="pre">**kwargs)</span></code>
which returns a <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">yarl.URL</span></code></a> instance for named resource. It
does not support <em>query args</em> but adding <em>args</em> is trivial:
<code class="docutils literal notranslate"><span class="pre">request.url_for('named_resource',</span> <span class="pre">param='a').with_query(arg='val')</span></code>.</p>
<p>The method returns a <em>relative</em> URL, absolute URL may be constructed by
<code class="docutils literal notranslate"><span class="pre">request.url.join(request.url_for(...)</span></code> call.</p>
</div>
<div class="section" id="url-encoding">
<h7>URL encoding<a class="headerlink" href="#url-encoding" title="Permalink to this headline">¶</a></h7>
<p>YARL encodes all non-ASCII symbols on <a class="reference external" href="https://yarl.readthedocs.io/en/stable/api.html#yarl.URL" title="(in yarl v1.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">yarl.URL</span></code></a> creation.</p>
<p>Thus <code class="docutils literal notranslate"><span class="pre">URL('https://www.python.org/путь')</span></code> becomes
<code class="docutils literal notranslate"><span class="pre">'https://www.python.org/%D0%BF%D1%83%D1%82%D1%8C'</span></code>.</p>
<p>On filling route table it’s possible to use both non-ASCII and percent
encoded paths:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/путь&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/%D0%BF%D1</span><span class="si">%83%</span><span class="s1">D1</span><span class="si">%82%</span><span class="s1">D1%8C&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
<p>are the same. Internally <code class="docutils literal notranslate"><span class="pre">'/путь'</span></code> is converted into
percent-encoding representation.</p>
<p>Route matching also accepts both URL forms: raw and encoded by
converting the route pattern to <em>canonical</em> (encoded) form on route
registration.</p>
</div>
</div>
<div class="section" id="sub-applications">
<h6>Sub-Applications<a class="headerlink" href="#sub-applications" title="Permalink to this headline">¶</a></h6>
<p>Sub applications are designed for solving the problem of the big
monolithic code base.
Let’s assume we have a project with own business logic and tools like
administration panel and debug toolbar.</p>
<p>Administration panel is a separate application by its own nature but all
toolbar URLs are served by prefix like <code class="docutils literal notranslate"><span class="pre">/admin</span></code>.</p>
<p>Thus we’ll create a totally separate application named <code class="docutils literal notranslate"><span class="pre">admin</span></code> and
connect it to main app with prefix:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">admin</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="c1"># setup admin routes, signals and middlewares</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_subapp</span><span class="p">(</span><span class="s1">&#39;/admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="p">)</span>
</pre></div>
</div>
<p>Middlewares and signals from <code class="docutils literal notranslate"><span class="pre">app</span></code> and <code class="docutils literal notranslate"><span class="pre">admin</span></code> are chained.</p>
<p>It means that if URL is <code class="docutils literal notranslate"><span class="pre">'/admin/something'</span></code> middlewares from
<code class="docutils literal notranslate"><span class="pre">app</span></code> are applied first and <code class="docutils literal notranslate"><span class="pre">admin.middlewares</span></code> are the next in
the call chain.</p>
<p>The same is going for
<a class="reference internal" href="index.html#aiohttp.web.Application.on_response_prepare" title="aiohttp.web.Application.on_response_prepare"><code class="xref py py-attr docutils literal notranslate"><span class="pre">on_response_prepare</span></code></a> signal – the
signal is delivered to both top level <code class="docutils literal notranslate"><span class="pre">app</span></code> and <code class="docutils literal notranslate"><span class="pre">admin</span></code> if
processing URL is routed to <code class="docutils literal notranslate"><span class="pre">admin</span></code> sub-application.</p>
<p>Common signals like <a class="reference internal" href="index.html#aiohttp.web.Application.on_startup" title="aiohttp.web.Application.on_startup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">on_startup</span></code></a>,
<a class="reference internal" href="index.html#aiohttp.web.Application.on_shutdown" title="aiohttp.web.Application.on_shutdown"><code class="xref py py-attr docutils literal notranslate"><span class="pre">on_shutdown</span></code></a> and
<a class="reference internal" href="index.html#aiohttp.web.Application.on_cleanup" title="aiohttp.web.Application.on_cleanup"><code class="xref py py-attr docutils literal notranslate"><span class="pre">on_cleanup</span></code></a> are delivered to all
registered sub-applications. The passed parameter is sub-application
instance, not top-level application.</p>
<p>Third level sub-applications can be nested into second level ones –
there are no limitation for nesting level.</p>
<div class="section" id="url-reversing">
<h7>Url reversing<a class="headerlink" href="#url-reversing" title="Permalink to this headline">¶</a></h7>
<p>Url reversing for sub-applications should generate urls with proper prefix.</p>
<p>But for getting URL sub-application’s router should be used:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">admin</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_get</span><span class="p">(</span><span class="s1">&#39;/resource&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_subapp</span><span class="p">(</span><span class="s1">&#39;/admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="n">admin</span><span class="o">.</span><span class="n">router</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">url_for</span><span class="p">()</span>
</pre></div>
</div>
<p>The generated <code class="docutils literal notranslate"><span class="pre">url</span></code> from example will have a value
<code class="docutils literal notranslate"><span class="pre">URL('/admin/resource')</span></code>.</p>
</div>
</div>
<div class="section" id="application-freezing">
<h6>Application freezing<a class="headerlink" href="#application-freezing" title="Permalink to this headline">¶</a></h6>
<p>Application can be used either as main app (<code class="docutils literal notranslate"><span class="pre">app.make_handler()</span></code>) or as
sub-application – not both cases at the same time.</p>
<p>After connecting application by <code class="docutils literal notranslate"><span class="pre">.add_subapp()</span></code> call or starting
serving web-server as toplevel application the application is
<strong>frozen</strong>.</p>
<p>It means that registering new routes, signals and middlewares is
forbidden.  Changing state (<code class="docutils literal notranslate"><span class="pre">app['name']</span> <span class="pre">=</span> <span class="pre">'value'</span></code>) of frozen application is
deprecated and will be eventually removed.</p>
</div>
</div>
<span id="document-migration_to_2xx"></span><div class="section" id="migration-to-2-x">
<span id="aiohttp-migration"></span><h5>Migration to 2.x<a class="headerlink" href="#migration-to-2-x" title="Permalink to this headline">¶</a></h5>
<div class="section" id="client">
<h6>Client<a class="headerlink" href="#client" title="Permalink to this headline">¶</a></h6>
<div class="section" id="chunking">
<h7>chunking<a class="headerlink" href="#chunking" title="Permalink to this headline">¶</a></h7>
<p>aiohttp does not support custom chunking sizes. It is up to the developer
to decide how to chunk data streams. If chunking is enabled, aiohttp
encodes the provided chunks in the “Transfer-encoding: chunked” format.</p>
<p>aiohttp does not enable chunked encoding automatically even if a
<em>transfer-encoding</em> header is supplied: <em>chunked</em> has to be set
explicitly. If <em>chunked</em> is set, then the <em>Transfer-encoding</em> and
<em>content-length</em> headers are disallowed.</p>
</div>
<div class="section" id="compression">
<h7>compression<a class="headerlink" href="#compression" title="Permalink to this headline">¶</a></h7>
<p>Compression has to be enabled explicitly with the <em>compress</em> parameter.
If compression is enabled, adding a <em>content-encoding</em> header is not allowed.
Compression also enables the <em>chunked</em> transfer-encoding.
Compression can not be combined with a <em>Content-Length</em> header.</p>
</div>
<div class="section" id="client-connector">
<h7>Client Connector<a class="headerlink" href="#client-connector" title="Permalink to this headline">¶</a></h7>
<ol class="arabic simple">
<li><p>By default a connector object manages a total number of concurrent
connections.  This limit was a per host rule in version 1.x. In
2.x, the <cite>limit</cite> parameter defines how many concurrent connection
connector can open and a new <cite>limit_per_host</cite> parameter defines the
limit per host. By default there is no per-host limit.</p></li>
<li><p>BaseConnector.close is now a normal function as opposed to
coroutine in version 1.x</p></li>
<li><p>BaseConnector.conn_timeout was moved to ClientSession</p></li>
</ol>
</div>
<div class="section" id="clientresponse-release">
<h7>ClientResponse.release<a class="headerlink" href="#clientresponse-release" title="Permalink to this headline">¶</a></h7>
<p>Internal implementation was significantly redesigned. It is not
required to call <cite>release</cite> on the response object. When the client
fully receives the payload, the underlying connection automatically
returns back to pool. If the payload is not fully read, the connection
is closed</p>
</div>
<div class="section" id="client-exceptions">
<h7>Client exceptions<a class="headerlink" href="#client-exceptions" title="Permalink to this headline">¶</a></h7>
<p>Exception hierarchy has been significantly modified. aiohttp now defines only
exceptions that covers connection handling and server response misbehaviors.
For developer specific mistakes, aiohttp uses python standard exceptions
like ValueError or TypeError.</p>
<p>Reading a response content may raise a ClientPayloadError
exception. This exception indicates errors specific to the payload
encoding. Such as invalid compressed data, malformed chunked-encoded
chunks or not enough data that satisfy the content-length header.</p>
<p>All exceptions are moved from <cite>aiohttp.errors</cite> module to top level
<cite>aiohttp</cite> module.</p>
<p>New hierarchy of exceptions:</p>
<ul class="simple">
<li><p><cite>ClientError</cite> - Base class for all client specific exceptions</p>
<ul>
<li><p><cite>ClientResponseError</cite> - exceptions that could happen after we get
response from server</p>
<ul>
<li><p><cite>WSServerHandshakeError</cite> - web socket server response error</p>
<ul>
<li><p><cite>ClientHttpProxyError</cite> - proxy response</p></li>
</ul>
</li>
</ul>
</li>
<li><p><cite>ClientConnectionError</cite> - exceptions related to low-level
connection problems</p>
<ul>
<li><p><cite>ClientOSError</cite> - subset of connection errors that are initiated
by an OSError exception</p>
<ul>
<li><p><cite>ClientConnectorError</cite> - connector related exceptions</p>
<ul>
<li><p><cite>ClientProxyConnectionError</cite> - proxy connection initialization error</p>
<ul>
<li><p><cite>ServerConnectionError</cite> - server connection related errors</p></li>
</ul>
</li>
<li><p><cite>ServerDisconnectedError</cite> - server disconnected</p></li>
<li><p><cite>ServerTimeoutError</cite> - server operation timeout, (read timeout, etc)</p></li>
<li><p><cite>ServerFingerprintMismatch</cite> - server fingerprint mismatch</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><cite>ClientPayloadError</cite> - This exception can only be raised while
reading the response payload if one of these errors occurs:
invalid compression, malformed chunked encoding or not enough data
that satisfy content-length header.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="client-payload-form-data">
<h7>Client payload (form-data)<a class="headerlink" href="#client-payload-form-data" title="Permalink to this headline">¶</a></h7>
<p>To unify form-data/payload handling a new <cite>Payload</cite> system was
introduced. It handles customized handling of existing types and
provide implementation for user-defined types.</p>
<ol class="arabic">
<li><p>FormData.__call__ does not take an encoding arg anymore
and its return value changes from an iterator or bytes to a Payload instance.
aiohttp provides payload adapters for some standard types like <cite>str</cite>, <cite>byte</cite>,
<cite>io.IOBase</cite>, <cite>StreamReader</cite> or <cite>DataQueue</cite>.</p></li>
<li><p>a generator is not supported as data provider anymore, <cite>streamer</cite>
can be used instead.  For example, to upload data from file:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@aiohttp</span><span class="o">.</span><span class="n">streamer</span>
<span class="k">def</span> <span class="nf">file_sender</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
          <span class="n">chunk</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span>
          <span class="k">while</span> <span class="n">chunk</span><span class="p">:</span>
              <span class="k">yield from</span> <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
              <span class="n">chunk</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Then you can use `file_sender` like this:</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">file_sender</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;huge_file&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
       <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="various">
<h7>Various<a class="headerlink" href="#various" title="Permalink to this headline">¶</a></h7>
<ol class="arabic simple">
<li><p>the <cite>encoding</cite> parameter is deprecated in <cite>ClientSession.request()</cite>.
Payload encoding is controlled at the payload level.
It is possible to specify an encoding for each payload instance.</p></li>
<li><p>the <cite>version</cite> parameter is removed in <cite>ClientSession.request()</cite>
client version can be specified in the <cite>ClientSession</cite> constructor.</p></li>
<li><p><cite>aiohttp.MsgType</cite> dropped, use <cite>aiohttp.WSMsgType</cite> instead.</p></li>
<li><p><cite>ClientResponse.url</cite> is an instance of <cite>yarl.URL</cite> class (<cite>url_obj</cite>
is deprecated)</p></li>
<li><p><cite>ClientResponse.raise_for_status()</cite> raises
<a class="reference internal" href="index.html#aiohttp.ClientResponseError" title="aiohttp.ClientResponseError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">aiohttp.ClientResponseError</span></code></a> exception</p></li>
<li><p><cite>ClientResponse.json()</cite> is strict about response’s content type. if
content type does not match, it raises
<a class="reference internal" href="index.html#aiohttp.ClientResponseError" title="aiohttp.ClientResponseError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">aiohttp.ClientResponseError</span></code></a> exception.  To disable content
type check you can pass <code class="docutils literal notranslate"><span class="pre">None</span></code> as <cite>content_type</cite> parameter.</p></li>
</ol>
</div>
</div>
<div class="section" id="server">
<h6>Server<a class="headerlink" href="#server" title="Permalink to this headline">¶</a></h6>
<div class="section" id="serverhttpprotocol-and-low-level-details">
<h7>ServerHttpProtocol and low-level details<a class="headerlink" href="#serverhttpprotocol-and-low-level-details" title="Permalink to this headline">¶</a></h7>
<p>Internal implementation was significantly redesigned to provide
better performance and support HTTP pipelining.
ServerHttpProtocol is dropped, implementation is merged with RequestHandler
a lot of low-level api’s are dropped.</p>
</div>
<div class="section" id="application">
<h7>Application<a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h7>
<ol class="arabic simple">
<li><p>Constructor parameter <cite>loop</cite> is deprecated. Loop is get configured by application runner,
<cite>run_app</cite> function for any of gunicorn workers.</p></li>
<li><p><cite>Application.router.add_subapp</cite> is dropped, use <cite>Application.add_subapp</cite> instead</p></li>
<li><p><cite>Application.finished</cite> is dropped, use <cite>Application.cleanup</cite> instead</p></li>
</ol>
</div>
<div class="section" id="webrequest-and-webresponse">
<h7>WebRequest and WebResponse<a class="headerlink" href="#webrequest-and-webresponse" title="Permalink to this headline">¶</a></h7>
<ol class="arabic">
<li><p>the <cite>GET</cite> and <cite>POST</cite> attributes no longer exist. Use the <cite>query</cite> attribute instead of <cite>GET</cite></p></li>
<li><p>Custom chunking size is not support <cite>WebResponse.chunked</cite> - developer is
responsible for actual chunking.</p></li>
<li><p>Payloads are supported as body. So it is possible to use client response’s content
object as body parameter for <cite>WebResponse</cite></p></li>
<li><p><cite>FileSender</cite> api is dropped, it is replaced with more general <cite>FileResponse</cite> class:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">FileResponse</span><span class="p">(</span><span class="s1">&#39;path-to-file.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><cite>WebSocketResponse.protocol</cite> is renamed to <cite>WebSocketResponse.ws_protocol</cite>.
<cite>WebSocketResponse.protocol</cite> is instance of <cite>RequestHandler</cite> class.</p></li>
</ol>
</div>
<div class="section" id="requestpayloaderror">
<h7>RequestPayloadError<a class="headerlink" href="#requestpayloaderror" title="Permalink to this headline">¶</a></h7>
<p>Reading request’s payload may raise a <cite>RequestPayloadError</cite> exception. The behavior is similar
to <cite>ClientPayloadError</cite>.</p>
</div>
<div class="section" id="wsgi">
<h7>WSGI<a class="headerlink" href="#wsgi" title="Permalink to this headline">¶</a></h7>
<p><em>WSGI</em> support has been dropped, as well as gunicorn wsgi support. We still provide default and uvloop gunicorn workers for <cite>web.Application</cite></p>
</div>
</div>
</div>
<span id="document-whats_new_3_0"></span><div class="section" id="what-s-new-in-aiohttp-3-0">
<span id="aiohttp-whats-new-3-0"></span><h5>What’s new in aiohttp 3.0<a class="headerlink" href="#what-s-new-in-aiohttp-3-0" title="Permalink to this headline">¶</a></h5>
<div class="section" id="async-await-everywhere">
<h6>async/await everywhere<a class="headerlink" href="#async-await-everywhere" title="Permalink to this headline">¶</a></h6>
<p>The main change is dropping <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> support and using
<code class="docutils literal notranslate"><span class="pre">async</span></code>/<code class="docutils literal notranslate"><span class="pre">await</span></code> everywhere. Farewell, Python 3.4.</p>
<p>The minimal supported Python version is <strong>3.5.3</strong> now.</p>
<p>Why not <em>3.5.0</em>?  Because <em>3.5.3</em> has a crucial change:
<a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.get_event_loop" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.get_event_loop()</span></code></a> returns the running loop instead of
<em>default</em>, which may be different, e.g.:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">new_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">f</span><span class="p">())</span>
</pre></div>
</div>
<p>Note, <a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.set_event_loop" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.set_event_loop()</span></code></a> was not called and default loop
is not equal to actually executed one.</p>
</div>
<div class="section" id="application-runners">
<h6>Application Runners<a class="headerlink" href="#application-runners" title="Permalink to this headline">¶</a></h6>
<p>People constantly asked about ability to run aiohttp servers together
with other asyncio code, but <a class="reference internal" href="index.html#aiohttp.web.run_app" title="aiohttp.web.run_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiohttp.web.run_app()</span></code></a> is blocking
synchronous call.</p>
<p>aiohttp had support for starting the application without <code class="docutils literal notranslate"><span class="pre">run_app</span></code> but the API
was very low-level and cumbersome.</p>
<p>Now application runners solve the task in a few lines of code, see
<a class="reference internal" href="index.html#aiohttp-web-app-runners"><span class="std std-ref">Application runners</span></a> for details.</p>
</div>
<div class="section" id="client-tracing">
<h6>Client Tracing<a class="headerlink" href="#client-tracing" title="Permalink to this headline">¶</a></h6>
<p>Other long awaited feature is tracing client request life cycle to
figure out when and why client request spends a time waiting for
connection establishment, getting server response headers etc.</p>
<p>Now it is possible by registering special signal handlers on every
request processing stage.  <a class="reference internal" href="index.html#aiohttp-client-tracing"><span class="std std-ref">Client Tracing</span></a> provides more
info about the feature.</p>
</div>
<div class="section" id="https-support">
<h6>HTTPS support<a class="headerlink" href="#https-support" title="Permalink to this headline">¶</a></h6>
<p>Unfortunately asyncio has a bug with checking SSL certificates for
non-ASCII site DNS names, e.g. <a class="reference external" href="https://историк.рф">https://историк.рф</a> or
<a class="reference external" href="https://雜草工作室.香港">https://雜草工作室.香港</a>.</p>
<p>The bug has been fixed in upcoming Python 3.7 only (the change
requires breaking backward compatibility in <a class="reference external" href="https://docs.python.org/3/library/ssl.html#module-ssl" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> API).</p>
<p>aiohttp installs a fix for older Python versions (3.5 and 3.6).</p>
</div>
<div class="section" id="dropped-obsolete-api">
<h6>Dropped obsolete API<a class="headerlink" href="#dropped-obsolete-api" title="Permalink to this headline">¶</a></h6>
<p>A switch to new major version is a great chance for dropping already
deprecated features.</p>
<p>The release dropped a lot, see <a class="reference internal" href="index.html#aiohttp-changes"><span class="std std-ref">Changelog</span></a> for details.</p>
<p>All removals was already marked as deprecated or related to very low
level implementation details.</p>
<p>If user code did not raise <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#DeprecationWarning" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> it is compatible
with aiohttp 3.0 most likely.</p>
</div>
<div class="section" id="summary">
<h6>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h6>
<p>Enjoy aiohttp 3.0 release!</p>
<p>The full change log is here: <a class="reference internal" href="index.html#aiohttp-changes"><span class="std std-ref">Changelog</span></a>.</p>
</div>
</div>
</div>
</div>
<span id="document-glossary"></span><div class="section" id="glossary">
<span id="aiohttp-glossary"></span><h4>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h4>
<dl class="glossary">
<dt id="term-aiodns">aiodns</dt><dd><p>DNS resolver for asyncio.</p>
<p><a class="reference external" href="https://pypi.python.org/pypi/aiodns">https://pypi.python.org/pypi/aiodns</a></p>
</dd>
<dt id="term-asyncio">asyncio</dt><dd><p>The library for writing single-threaded concurrent code using
coroutines, multiplexing I/O access over sockets and other
resources, running network clients and servers, and other
related primitives.</p>
<p>Reference implementation of <span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3156"><strong>PEP 3156</strong></a></p>
<p><a class="reference external" href="https://pypi.python.org/pypi/asyncio/">https://pypi.python.org/pypi/asyncio/</a></p>
</dd>
<dt id="term-callable">callable</dt><dd><p>Any object that can be called. Use <a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">callable()</span></code></a> to check
that.</p>
</dd>
<dt id="term-cchardet">cchardet</dt><dd><p>cChardet is high speed universal character encoding detector -
binding to charsetdetect.</p>
<p><a class="reference external" href="https://pypi.python.org/pypi/cchardet/">https://pypi.python.org/pypi/cchardet/</a></p>
</dd>
<dt id="term-chardet">chardet</dt><dd><p>The Universal Character Encoding Detector</p>
<p><a class="reference external" href="https://pypi.python.org/pypi/chardet/">https://pypi.python.org/pypi/chardet/</a></p>
</dd>
<dt id="term-gunicorn">gunicorn</dt><dd><p>Gunicorn ‘Green Unicorn’ is a Python WSGI HTTP Server for
UNIX.</p>
<p><a class="reference external" href="http://gunicorn.org/">http://gunicorn.org/</a></p>
</dd>
<dt id="term-idna">IDNA</dt><dd><p>An Internationalized Domain Name in Applications (IDNA) is an
industry standard for encoding Internet Domain Names that contain in
whole or in part, in a language-specific script or alphabet,
such as Arabic, Chinese, Cyrillic, Tamil, Hebrew or the Latin
alphabet-based characters with diacritics or ligatures, such as
French. These writing systems are encoded by computers in
multi-byte Unicode. Internationalized domain names are stored
in the Domain Name System as ASCII strings using Punycode
transcription.</p>
</dd>
<dt id="term-keep-alive">keep-alive</dt><dd><p>A technique for communicating between HTTP client and server
when connection is not closed after sending response but kept
open for sending next request through the same socket.</p>
<p>It makes communication faster by getting rid of connection
establishment for every request.</p>
</dd>
<dt id="term-nginx">nginx</dt><dd><p>Nginx [engine x] is an HTTP and reverse proxy server, a mail
proxy server, and a generic TCP/UDP proxy server.</p>
<p><a class="reference external" href="https://nginx.org/en/">https://nginx.org/en/</a></p>
</dd>
<dt id="term-percent-encoding">percent-encoding</dt><dd><p>A mechanism for encoding information in a Uniform Resource
Locator (URL) if URL parts don’t fit in safe characters space.</p>
</dd>
<dt id="term-requoting">requoting</dt><dd><p>Applying <a class="reference internal" href="#term-percent-encoding"><span class="xref std std-term">percent-encoding</span></a> to non-safe symbols and decode
percent encoded safe symbols back.</p>
<p>According to <span class="target" id="index-1"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc3986.html"><strong>RFC 3986</strong></a> allowed path symbols are:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">allowed</span>       <span class="o">=</span> <span class="n">unreserved</span> <span class="o">/</span> <span class="n">pct</span><span class="o">-</span><span class="n">encoded</span> <span class="o">/</span> <span class="n">sub</span><span class="o">-</span><span class="n">delims</span>
                <span class="o">/</span> <span class="s2">&quot;:&quot;</span> <span class="o">/</span> <span class="s2">&quot;@&quot;</span> <span class="o">/</span> <span class="s2">&quot;/&quot;</span>

<span class="n">pct</span><span class="o">-</span><span class="n">encoded</span>   <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="n">HEXDIG</span> <span class="n">HEXDIG</span>

<span class="n">unreserved</span>    <span class="o">=</span> <span class="n">ALPHA</span> <span class="o">/</span> <span class="n">DIGIT</span> <span class="o">/</span> <span class="s2">&quot;-&quot;</span> <span class="o">/</span> <span class="s2">&quot;.&quot;</span> <span class="o">/</span> <span class="s2">&quot;_&quot;</span> <span class="o">/</span> <span class="s2">&quot;~&quot;</span>

<span class="n">sub</span><span class="o">-</span><span class="n">delims</span>    <span class="o">=</span> <span class="s2">&quot;!&quot;</span> <span class="o">/</span> <span class="s2">&quot;$&quot;</span> <span class="o">/</span> <span class="s2">&quot;&amp;&quot;</span> <span class="o">/</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">/</span> <span class="s2">&quot;(&quot;</span> <span class="o">/</span> <span class="s2">&quot;)&quot;</span>
                <span class="o">/</span> <span class="s2">&quot;*&quot;</span> <span class="o">/</span> <span class="s2">&quot;+&quot;</span> <span class="o">/</span> <span class="s2">&quot;,&quot;</span> <span class="o">/</span> <span class="s2">&quot;;&quot;</span> <span class="o">/</span> <span class="s2">&quot;=&quot;</span>
</pre></div>
</div>
</dd>
<dt id="term-resource">resource</dt><dd><p>A concept reflects the HTTP <strong>path</strong>, every resource corresponds
to <em>URI</em>.</p>
<p>May have a unique name.</p>
<p>Contains <a class="reference internal" href="#term-route"><span class="xref std std-term">route</span></a>’s for different HTTP methods.</p>
</dd>
<dt id="term-route">route</dt><dd><p>A part of <a class="reference internal" href="#term-resource"><span class="xref std std-term">resource</span></a>, resource’s <em>path</em> coupled with HTTP method.</p>
</dd>
<dt id="term-web-handler">web-handler</dt><dd><p>An endpoint that returns HTTP response.</p>
</dd>
<dt id="term-websocket">websocket</dt><dd><p>A protocol providing full-duplex communication channels over a
single TCP connection. The WebSocket protocol was standardized
by the IETF as <span class="target" id="index-2"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc6455.html"><strong>RFC 6455</strong></a></p>
</dd>
<dt id="term-yarl">yarl</dt><dd><p>A library for operating with URL objects.</p>
<p><a class="reference external" href="https://pypi.python.org/pypi/yarl">https://pypi.python.org/pypi/yarl</a></p>
</dd>
</dl>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-changes"></span><div class="section" id="changelog">
<span id="aiohttp-changes"></span><h4>Changelog<a class="headerlink" href="#changelog" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>3.6.2 (2019-10-09)<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<div class="section" id="features">
<h6>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Made exceptions pickleable. Also changed the repr of some exceptions.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4077">#4077</a></p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">Iterable</span></code> type hint instead of <code class="docutils literal notranslate"><span class="pre">Sequence</span></code> for <code class="docutils literal notranslate"><span class="pre">Application</span></code> <em>middleware</em>
parameter.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4125">#4125</a></p></li>
</ul>
</div>
<div class="section" id="bugfixes">
<h6>Bugfixes<a class="headerlink" href="#bugfixes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Reset the <code class="docutils literal notranslate"><span class="pre">sock_read</span></code> timeout each time data is received for a
<code class="docutils literal notranslate"><span class="pre">aiohttp.ClientResponse</span></code>.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3808">#3808</a></p></li>
<li><p>Fix handling of expired cookies so they are not stored in CookieJar.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4063">#4063</a></p></li>
<li><p>Fix misleading message in the string representation of <code class="docutils literal notranslate"><span class="pre">ClientConnectorError</span></code>;
<code class="docutils literal notranslate"><span class="pre">self.ssl</span> <span class="pre">==</span> <span class="pre">None</span></code> means default SSL context, not SSL disabled <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4097">#4097</a></p></li>
<li><p>Don’t clobber HTTP status when using FileResponse.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4106">#4106</a></p></li>
</ul>
</div>
<div class="section" id="improved-documentation">
<h6>Improved Documentation<a class="headerlink" href="#improved-documentation" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Added minimal required logging configuration to logging documentation.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/2469">#2469</a></p></li>
<li><p>Update docs to reflect proxy support.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4100">#4100</a></p></li>
<li><p>Fix typo in code example in testing docs.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4108">#4108</a></p></li>
</ul>
</div>
<div class="section" id="misc">
<h6>Misc<a class="headerlink" href="#misc" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4102">#4102</a></p></li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id12">
<h5>3.6.1 (2019-09-19)<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id13">
<h6>Features<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Compatibility with Python 3.8.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4056">#4056</a></p></li>
</ul>
</div>
<div class="section" id="id15">
<h6>Bugfixes<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>correct some exception string format
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4068">#4068</a></p></li>
<li><p>Emit a warning when <code class="docutils literal notranslate"><span class="pre">ssl.OP_NO_COMPRESSION</span></code> is
unavailable because the runtime is built against
an outdated OpenSSL.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4052">#4052</a></p></li>
<li><p>Update multidict requirement to &gt;= 4.5
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4057">#4057</a></p></li>
</ul>
</div>
<div class="section" id="id19">
<h6>Improved Documentation<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Provide pytest-aiohttp namespace for pytest fixtures in docs.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3723">#3723</a></p></li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id21">
<h5>3.6.0 (2019-09-06)<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id22">
<h6>Features<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Add support for Named Pipes (Site and Connector) under Windows. This feature requires
Proactor event loop to work.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3629">#3629</a></p></li>
<li><p>Removed <code class="docutils literal notranslate"><span class="pre">Transfer-Encoding:</span> <span class="pre">chunked</span></code> header from websocket responses to be
compatible with more http proxy servers.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3798">#3798</a></p></li>
<li><p>Accept non-GET request for starting websocket handshake on server side.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3980">#3980</a></p></li>
</ul>
</div>
<div class="section" id="id26">
<h6>Bugfixes<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p>Raise a ClientResponseError instead of an AssertionError for a blank
HTTP Reason Phrase.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3532">#3532</a></p></li>
<li><p>Fix an issue where cookies would sometimes not be set during a redirect.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3576">#3576</a></p></li>
<li><p>Change normalize_path_middleware to use 308 redirect instead of 301.</p>
<p>This behavior should prevent clients from being unable to use PUT/POST
methods on endpoints that are redirected because of a trailing slash.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3579">#3579</a></p>
</li>
<li><p>Drop the processed task from <code class="docutils literal notranslate"><span class="pre">all_tasks()</span></code> list early. It prevents logging about a
task with unhandled exception when the server is used in conjunction with
<code class="docutils literal notranslate"><span class="pre">asyncio.run()</span></code>.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3587">#3587</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Signal</span></code> type annotation changed from <code class="docutils literal notranslate"><span class="pre">Signal[Callable[['TraceConfig'],</span>
<span class="pre">Awaitable[None]]]</span></code> to <code class="docutils literal notranslate"><span class="pre">Signal[Callable[ClientSession,</span> <span class="pre">SimpleNamespace,</span> <span class="pre">...]</span></code>.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3595">#3595</a></p></li>
<li><p>Use sanitized URL as Location header in redirects
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3614">#3614</a></p></li>
<li><p>Improve typing annotations for multipart.py along with changes required
by mypy in files that references multipart.py.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3621">#3621</a></p></li>
<li><p>Close session created inside <code class="docutils literal notranslate"><span class="pre">aiohttp.request</span></code> when unhandled exception occurs
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3628">#3628</a></p></li>
<li><p>Cleanup per-chunk data in generic data read. Memory leak fixed.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3631">#3631</a></p></li>
<li><p>Use correct type for add_view and family
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3633">#3633</a></p></li>
<li><p>Fix _keepalive field in __slots__ of <code class="docutils literal notranslate"><span class="pre">RequestHandler</span></code>.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3644">#3644</a></p></li>
<li><p>Properly handle ConnectionResetError, to silence the “Cannot write to closing
transport” exception when clients disconnect uncleanly.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3648">#3648</a></p></li>
<li><p>Suppress pytest warnings due to <code class="docutils literal notranslate"><span class="pre">test_utils</span></code> classes
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3660">#3660</a></p></li>
<li><p>Fix overshadowing of overlapped sub-application prefixes.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3701">#3701</a></p></li>
<li><p>Fixed return type annotation for WSMessage.json()
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3720">#3720</a></p></li>
<li><p>Properly expose TooManyRedirects publicly as documented.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3818">#3818</a></p></li>
<li><p>Fix missing brackets for IPv6 in proxy CONNECT request
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3841">#3841</a></p></li>
<li><p>Make the signature of <code class="docutils literal notranslate"><span class="pre">aiohttp.test_utils.TestClient.request</span></code> match
<code class="docutils literal notranslate"><span class="pre">asyncio.ClientSession.request</span></code> according to the docs <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3852">#3852</a></p></li>
<li><p>Use correct style for re-exported imports, makes mypy <code class="docutils literal notranslate"><span class="pre">--strict</span></code> mode happy.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3868">#3868</a></p></li>
<li><p>Fixed type annotation for add_view method of UrlDispatcher to accept any subclass of
View <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3880">#3880</a></p></li>
<li><p>Made cython HTTP parser set Reason-Phrase of the response to an empty string if it is
missing.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3906">#3906</a></p></li>
<li><p>Add URL to the string representation of ClientResponseError.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3959">#3959</a></p></li>
<li><p>Accept <code class="docutils literal notranslate"><span class="pre">istr</span></code> keys in <code class="docutils literal notranslate"><span class="pre">LooseHeaders</span></code> type hints.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3976">#3976</a></p></li>
<li><p>Fixed race conditions in _resolve_host caching and throttling when tracing is enabled.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4013">#4013</a></p></li>
<li><p>For URLs like “unix://localhost/…” set Host HTTP header to “localhost” instead of
“localhost:None”.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/4039">#4039</a></p></li>
</ul>
</div>
<div class="section" id="id52">
<h6>Improved Documentation<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Modify documentation for Background Tasks to remove deprecated usage of event loop.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3526">#3526</a></p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__':</span></code> in server examples.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3775">#3775</a></p></li>
<li><p>Update documentation reference to the default access logger.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3783">#3783</a></p></li>
<li><p>Improve documentation for <code class="docutils literal notranslate"><span class="pre">web.BaseRequest.path</span></code> and <code class="docutils literal notranslate"><span class="pre">web.BaseRequest.raw_path</span></code>.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3791">#3791</a></p></li>
<li><p>Removed deprecation warning in tracing example docs
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3964">#3964</a></p></li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id58">
<h5>3.5.4 (2019-01-12)<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id59">
<h6>Bugfixes<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Fix stream <code class="docutils literal notranslate"><span class="pre">.read()</span></code> / <code class="docutils literal notranslate"><span class="pre">.readany()</span></code> / <code class="docutils literal notranslate"><span class="pre">.iter_any()</span></code> which used to return a
partial content only in case of compressed content
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3525">#3525</a></p></li>
</ul>
</div>
</div>
<div class="section" id="id61">
<h5>3.5.3 (2019-01-10)<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id62">
<h6>Bugfixes<a class="headerlink" href="#id62" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Fix type stubs for <code class="docutils literal notranslate"><span class="pre">aiohttp.web.run_app(access_log=True)</span></code> and fix edge case of
<code class="docutils literal notranslate"><span class="pre">access_log=True</span></code> and the event loop being in debug mode.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3504">#3504</a></p></li>
<li><p>Fix <code class="docutils literal notranslate"><span class="pre">aiohttp.ClientTimeout</span></code> type annotations to accept <code class="docutils literal notranslate"><span class="pre">None</span></code> for fields
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3511">#3511</a></p></li>
<li><p>Send custom per-request cookies even if session jar is empty
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3515">#3515</a></p></li>
<li><p>Restore Linux binary wheels publishing on PyPI</p></li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id66">
<h5>3.5.2 (2019-01-08)<a class="headerlink" href="#id66" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id67">
<h6>Features<a class="headerlink" href="#id67" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FileResponse</span></code> from <code class="docutils literal notranslate"><span class="pre">web_fileresponse.py</span></code> uses a <code class="docutils literal notranslate"><span class="pre">ThreadPoolExecutor</span></code> to work
with files asynchronously.  I/O based payloads from <code class="docutils literal notranslate"><span class="pre">payload.py</span></code> uses a
<code class="docutils literal notranslate"><span class="pre">ThreadPoolExecutor</span></code> to work with I/O objects asynchronously.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3313">#3313</a></p></li>
<li><p>Internal Server Errors in plain text if the browser does not support HTML.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3483">#3483</a></p></li>
</ul>
</div>
<div class="section" id="id70">
<h6>Bugfixes<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Preserve MultipartWriter parts headers on write.  Refactor the way how
<code class="docutils literal notranslate"><span class="pre">Payload.headers</span></code> are handled. Payload instances now always have headers and
Content-Type defined.  Fix Payload Content-Disposition header reset after initial
creation.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3035">#3035</a></p></li>
<li><p>Log suppressed exceptions in <code class="docutils literal notranslate"><span class="pre">GunicornWebWorker</span></code>.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3464">#3464</a></p></li>
<li><p>Remove wildcard imports.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3468">#3468</a></p></li>
<li><p>Use the same task for app initialization and web server handling in gunicorn workers.
It allows to use Python3.7 context vars smoothly.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3471">#3471</a></p></li>
<li><p>Fix handling of chunked+gzipped response when first chunk does not give uncompressed
data <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3477">#3477</a></p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">collections.MutableMapping</span></code> with <code class="docutils literal notranslate"><span class="pre">collections.abc.MutableMapping</span></code> to
avoid a deprecation warning.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3480">#3480</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Payload.size</span></code> type annotation changed from <code class="docutils literal notranslate"><span class="pre">Optional[float]</span></code> to
<code class="docutils literal notranslate"><span class="pre">Optional[int]</span></code>.  <a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3484">#3484</a></p></li>
<li><p>Ignore done tasks when cancels pending activities on <code class="docutils literal notranslate"><span class="pre">web.run_app</span></code> finalization.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3497">#3497</a></p></li>
</ul>
</div>
<div class="section" id="id79">
<h6>Improved Documentation<a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Add documentation for <code class="docutils literal notranslate"><span class="pre">aiohttp.web.HTTPException</span></code>.
<a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3490">#3490</a></p></li>
</ul>
</div>
<div class="section" id="id81">
<h6>Misc<a class="headerlink" href="#id81" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/aio-libs/aiohttp/issues/3487">#3487</a></p></li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="section" id="id83">
<h5>3.5.1 (2018-12-24)<a class="headerlink" href="#id83" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix a regression about <code class="docutils literal notranslate"><span class="pre">ClientSession._requote_redirect_url</span></code> modification in debug
mode.</p></li>
</ul>
</div>
<div class="section" id="id84">
<h5>3.5.0 (2018-12-22)<a class="headerlink" href="#id84" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id85">
<h6>Features<a class="headerlink" href="#id85" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>The library type annotations are checked in strict mode now.</p></li>
<li><p>Add support for setting cookies for individual request (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2387">#2387</a>)</p></li>
<li><p>Application.add_domain implementation (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2809">#2809</a>)</p></li>
<li><p>The default <code class="docutils literal notranslate"><span class="pre">app</span></code> in the request returned by <code class="docutils literal notranslate"><span class="pre">test_utils.make_mocked_request</span></code> can
now have objects assigned to it and retrieved using the <code class="docutils literal notranslate"><span class="pre">[]</span></code> operator. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3174">#3174</a>)</p></li>
<li><p>Make <code class="docutils literal notranslate"><span class="pre">request.url</span></code> accessible when transport is closed. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3177">#3177</a>)</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">zlib_executor_size</span></code> argument to <code class="docutils literal notranslate"><span class="pre">Response</span></code> constructor to allow compression
to run in a background executor to avoid blocking the main thread and potentially
triggering health check failures. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3205">#3205</a>)</p></li>
<li><p>Enable users to set <code class="docutils literal notranslate"><span class="pre">ClientTimeout</span></code> in <code class="docutils literal notranslate"><span class="pre">aiohttp.request</span></code> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3213">#3213</a>)</p></li>
<li><p>Don’t raise a warning if <code class="docutils literal notranslate"><span class="pre">NETRC</span></code> environment variable is not set and <code class="docutils literal notranslate"><span class="pre">~/.netrc</span></code>
file doesn’t exist. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3267">#3267</a>)</p></li>
<li><p>Add default logging handler to web.run_app If the <code class="docutils literal notranslate"><span class="pre">Application.debug`</span></code> flag is set
and the default logger <code class="docutils literal notranslate"><span class="pre">aiohttp.access</span></code> is used, access logs will now be output
using a <em>stderr</em> <code class="docutils literal notranslate"><span class="pre">StreamHandler</span></code> if no handlers are attached. Furthermore, if the
default logger has no log level set, the log level will be set to <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3324">#3324</a>)</p></li>
<li><p>Add method argument to <code class="docutils literal notranslate"><span class="pre">session.ws_connect()</span></code>.  Sometimes server API requires a
different HTTP method for WebSocket connection establishment.  For example, <code class="docutils literal notranslate"><span class="pre">Docker</span>
<span class="pre">exec</span></code> needs POST. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3378">#3378</a>)</p></li>
<li><p>Create a task per request handling. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3406">#3406</a>)</p></li>
</ul>
</div>
<div class="section" id="id96">
<h6>Bugfixes<a class="headerlink" href="#id96" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Enable passing <code class="docutils literal notranslate"><span class="pre">access_log_class</span></code> via <code class="docutils literal notranslate"><span class="pre">handler_args</span></code> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3158">#3158</a>)</p></li>
<li><p>Return empty bytes with end-of-chunk marker in empty stream reader. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3186">#3186</a>)</p></li>
<li><p>Accept <code class="docutils literal notranslate"><span class="pre">CIMultiDictProxy</span></code> instances for <code class="docutils literal notranslate"><span class="pre">headers</span></code> argument in <code class="docutils literal notranslate"><span class="pre">web.Response</span></code>
constructor. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3207">#3207</a>)</p></li>
<li><p>Don’t uppercase HTTP method in parser (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3233">#3233</a>)</p></li>
<li><p>Make method match regexp RFC-7230 compliant (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3235">#3235</a>)</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">app.pre_frozen</span></code> state to properly handle startup signals in
sub-applications. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3237">#3237</a>)</p></li>
<li><p>Enhanced parsing and validation of helpers.BasicAuth.decode. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3239">#3239</a>)</p></li>
<li><p>Change imports from collections module in preparation for 3.8. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3258">#3258</a>)</p></li>
<li><p>Ensure Host header is added first to ClientRequest to better replicate browser (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3265">#3265</a>)</p></li>
<li><p>Fix forward compatibility with Python 3.8: importing ABCs directly from the
collections module will not be supported anymore. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3273">#3273</a>)</p></li>
<li><p>Keep the query string by <code class="docutils literal notranslate"><span class="pre">normalize_path_middleware</span></code>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3278">#3278</a>)</p></li>
<li><p>Fix missing parameter <code class="docutils literal notranslate"><span class="pre">raise_for_status</span></code> for aiohttp.request() (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3290">#3290</a>)</p></li>
<li><p>Bracket IPv6 addresses in the HOST header (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3304">#3304</a>)</p></li>
<li><p>Fix default message for server ping and pong frames. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3308">#3308</a>)</p></li>
<li><p>Fix tests/test_connector.py typo and tests/autobahn/server.py duplicate loop
def. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3337">#3337</a>)</p></li>
<li><p>Fix false-negative indicator end_of_HTTP_chunk in StreamReader.readchunk function
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3361">#3361</a>)</p></li>
<li><p>Release HTTP response before raising status exception (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3364">#3364</a>)</p></li>
<li><p>Fix task cancellation when <code class="docutils literal notranslate"><span class="pre">sendfile()</span></code> syscall is used by static file
handling. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3383">#3383</a>)</p></li>
<li><p>Fix stack trace for <code class="docutils literal notranslate"><span class="pre">asyncio.TimeoutError</span></code> which was not logged, when it is caught
in the handler. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3414">#3414</a>)</p></li>
</ul>
</div>
<div class="section" id="id116">
<h6>Improved Documentation<a class="headerlink" href="#id116" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Improve documentation of <code class="docutils literal notranslate"><span class="pre">Application.make_handler</span></code> parameters. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3152">#3152</a>)</p></li>
<li><p>Fix BaseRequest.raw_headers doc. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3215">#3215</a>)</p></li>
<li><p>Fix typo in TypeError exception reason in <code class="docutils literal notranslate"><span class="pre">web.Application._handle</span></code> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3229">#3229</a>)</p></li>
<li><p>Make server access log format placeholder %b documentation reflect
behavior and docstring. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3307">#3307</a>)</p></li>
</ul>
</div>
<div class="section" id="deprecations-and-removals">
<h6>Deprecations and Removals<a class="headerlink" href="#deprecations-and-removals" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Deprecate modification of <code class="docutils literal notranslate"><span class="pre">session.requote_redirect_url</span></code> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2278">#2278</a>)</p></li>
<li><p>Deprecate <code class="docutils literal notranslate"><span class="pre">stream.unread_data()</span></code> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3260">#3260</a>)</p></li>
<li><p>Deprecated use of boolean in <code class="docutils literal notranslate"><span class="pre">resp.enable_compression()</span></code> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3318">#3318</a>)</p></li>
<li><p>Encourage creation of aiohttp public objects inside a coroutine (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3331">#3331</a>)</p></li>
<li><p>Drop dead <code class="docutils literal notranslate"><span class="pre">Connection.detach()</span></code> and <code class="docutils literal notranslate"><span class="pre">Connection.writer</span></code>. Both methods were broken
for more than 2 years. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3358">#3358</a>)</p></li>
<li><p>Deprecate <code class="docutils literal notranslate"><span class="pre">app.loop</span></code>, <code class="docutils literal notranslate"><span class="pre">request.loop</span></code>, <code class="docutils literal notranslate"><span class="pre">client.loop</span></code> and <code class="docutils literal notranslate"><span class="pre">connector.loop</span></code>
properties. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3374">#3374</a>)</p></li>
<li><p>Deprecate explicit debug argument. Use asyncio debug mode instead. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3381">#3381</a>)</p></li>
<li><p>Deprecate body parameter in HTTPException (and derived classes) constructor. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3385">#3385</a>)</p></li>
<li><p>Deprecate bare connector close, use <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span> <span class="pre">connector:</span></code> and <code class="docutils literal notranslate"><span class="pre">await</span>
<span class="pre">connector.close()</span></code> instead. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3417">#3417</a>)</p></li>
<li><p>Deprecate obsolete <code class="docutils literal notranslate"><span class="pre">read_timeout</span></code> and <code class="docutils literal notranslate"><span class="pre">conn_timeout</span></code> in <code class="docutils literal notranslate"><span class="pre">ClientSession</span></code>
constructor. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3438">#3438</a>)</p></li>
</ul>
</div>
<div class="section" id="id131">
<h6>Misc<a class="headerlink" href="#id131" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>#3341, #3351</p></li>
</ul>
</div>
</div>
<div class="section" id="id132">
<h5>3.4.4 (2018-09-05)<a class="headerlink" href="#id132" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix installation from sources when compiling toolkit is not available (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3241">#3241</a>)</p></li>
</ul>
</div>
<div class="section" id="id134">
<h5>3.4.3 (2018-09-04)<a class="headerlink" href="#id134" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">app.pre_frozen</span></code> state to properly handle startup signals in sub-applications. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3237">#3237</a>)</p></li>
</ul>
</div>
<div class="section" id="id136">
<h5>3.4.2 (2018-09-01)<a class="headerlink" href="#id136" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix <code class="docutils literal notranslate"><span class="pre">iter_chunks</span></code> type annotation (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3230">#3230</a>)</p></li>
</ul>
</div>
<div class="section" id="id138">
<h5>3.4.1 (2018-08-28)<a class="headerlink" href="#id138" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix empty header parsing regression. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3218">#3218</a>)</p></li>
<li><p>Fix BaseRequest.raw_headers doc. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3215">#3215</a>)</p></li>
<li><p>Fix documentation building on ReadTheDocs (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3221">#3221</a>)</p></li>
</ul>
</div>
<div class="section" id="id142">
<h5>3.4.0 (2018-08-25)<a class="headerlink" href="#id142" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id143">
<h6>Features<a class="headerlink" href="#id143" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Add type hints (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3049">#3049</a>)</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">raise_for_status</span></code> request parameter (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3073">#3073</a>)</p></li>
<li><p>Add type hints to HTTP client (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3092">#3092</a>)</p></li>
<li><p>Minor server optimizations (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3095">#3095</a>)</p></li>
<li><p>Preserve the cause when <cite>HTTPException</cite> is raised from another exception. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3096">#3096</a>)</p></li>
<li><p>Add <cite>close_boundary</cite> option in <cite>MultipartWriter.write</cite> method. Support streaming (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3104">#3104</a>)</p></li>
<li><p>Added a <code class="docutils literal notranslate"><span class="pre">remove_slash</span></code> option to the <code class="docutils literal notranslate"><span class="pre">normalize_path_middleware</span></code> factory. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3173">#3173</a>)</p></li>
<li><p>The class <cite>AbstractRouteDef</cite> is importable from <cite>aiohttp.web</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3183">#3183</a>)</p></li>
</ul>
</div>
<div class="section" id="id152">
<h6>Bugfixes<a class="headerlink" href="#id152" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Prevent double closing when client connection is released before the
last <code class="docutils literal notranslate"><span class="pre">data_received()</span></code> callback. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3031">#3031</a>)</p></li>
<li><p>Make redirect with <cite>normalize_path_middleware</cite> work when using url encoded paths. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3051">#3051</a>)</p></li>
<li><p>Postpone web task creation to connection establishment. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3052">#3052</a>)</p></li>
<li><p>Fix <code class="docutils literal notranslate"><span class="pre">sock_read</span></code> timeout. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3053">#3053</a>)</p></li>
<li><p>When using a server-request body as the <cite>data=</cite> argument of a client request, iterate over the content with <cite>readany</cite> instead of <cite>readline</cite> to avoid <cite>Line too long</cite> errors. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3054">#3054</a>)</p></li>
<li><p>fix <cite>UrlDispatcher</cite> has no attribute <cite>add_options</cite>, add <cite>web.options</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3062">#3062</a>)</p></li>
<li><p>correct filename in content-disposition with multipart body (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3064">#3064</a>)</p></li>
<li><p>Many HTTP proxies has buggy keepalive support.
Let’s not reuse connection but close it after processing every response. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3070">#3070</a>)</p></li>
<li><p>raise 413 “Payload Too Large” rather than raising ValueError in request.post()
Add helpful debug message to 413 responses (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3087">#3087</a>)</p></li>
<li><p>Fix <cite>StreamResponse</cite> equality, now that they are <cite>MutableMapping</cite> objects. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3100">#3100</a>)</p></li>
<li><p>Fix server request objects comparison (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3116">#3116</a>)</p></li>
<li><p>Do not hang on <cite>206 Partial Content</cite> response with <cite>Content-Encoding: gzip</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3123">#3123</a>)</p></li>
<li><p>Fix timeout precondition checkers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3145">#3145</a>)</p></li>
</ul>
</div>
<div class="section" id="id166">
<h6>Improved Documentation<a class="headerlink" href="#id166" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Add a new FAQ entry that clarifies that you should not reuse response
objects in middleware functions. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3020">#3020</a>)</p></li>
<li><p>Add FAQ section “Why is creating a ClientSession outside of an event loop dangerous?” (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3072">#3072</a>)</p></li>
<li><p>Fix link to Rambler (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3115">#3115</a>)</p></li>
<li><p>Fix TCPSite documentation on the Server Reference page. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3146">#3146</a>)</p></li>
<li><p>Fix documentation build configuration file for Windows. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3147">#3147</a>)</p></li>
<li><p>Remove no longer existing lingering_timeout parameter of Application.make_handler from documentation. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3151">#3151</a>)</p></li>
<li><p>Mention that <code class="docutils literal notranslate"><span class="pre">app.make_handler</span></code> is deprecated, recommend to use runners
API instead. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3157">#3157</a>)</p></li>
</ul>
</div>
<div class="section" id="id174">
<h6>Deprecations and Removals<a class="headerlink" href="#id174" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Drop <code class="docutils literal notranslate"><span class="pre">loop.current_task()</span></code> from <code class="docutils literal notranslate"><span class="pre">helpers.current_task()</span></code> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2826">#2826</a>)</p></li>
<li><p>Drop <code class="docutils literal notranslate"><span class="pre">reader</span></code> parameter from <code class="docutils literal notranslate"><span class="pre">request.multipart()</span></code>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3090">#3090</a>)</p></li>
</ul>
</div>
</div>
<div class="section" id="id177">
<h5>3.3.2 (2018-06-12)<a class="headerlink" href="#id177" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Many HTTP proxies has buggy keepalive support. Let’s not reuse connection but
close it after processing every response. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3070">#3070</a>)</p></li>
<li><p>Provide vendor source files in tarball (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3076">#3076</a>)</p></li>
</ul>
</div>
<div class="section" id="id180">
<h5>3.3.1 (2018-06-05)<a class="headerlink" href="#id180" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix <code class="docutils literal notranslate"><span class="pre">sock_read</span></code> timeout. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3053">#3053</a>)</p></li>
<li><p>When using a server-request body as the <code class="docutils literal notranslate"><span class="pre">data=</span></code> argument of a client request,
iterate over the content with <code class="docutils literal notranslate"><span class="pre">readany</span></code> instead of <code class="docutils literal notranslate"><span class="pre">readline</span></code> to avoid <code class="docutils literal notranslate"><span class="pre">Line</span>
<span class="pre">too</span> <span class="pre">long</span></code> errors. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3054">#3054</a>)</p></li>
</ul>
</div>
<div class="section" id="id183">
<h5>3.3.0 (2018-06-01)<a class="headerlink" href="#id183" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id184">
<h6>Features<a class="headerlink" href="#id184" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Raise <code class="docutils literal notranslate"><span class="pre">ConnectionResetError</span></code> instead of <code class="docutils literal notranslate"><span class="pre">CancelledError</span></code> on trying to
write to a closed stream. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2499">#2499</a>)</p></li>
<li><p>Implement <code class="docutils literal notranslate"><span class="pre">ClientTimeout</span></code> class and support socket read timeout. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2768">#2768</a>)</p></li>
<li><p>Enable logging when <code class="docutils literal notranslate"><span class="pre">aiohttp.web</span></code> is used as a program (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2956">#2956</a>)</p></li>
<li><p>Add canonical property to resources (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2968">#2968</a>)</p></li>
<li><p>Forbid reading response BODY after release (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2983">#2983</a>)</p></li>
<li><p>Implement base protocol class to avoid a dependency from internal
<code class="docutils literal notranslate"><span class="pre">asyncio.streams.FlowControlMixin</span></code> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2986">#2986</a>)</p></li>
<li><p>Cythonize <code class="docutils literal notranslate"><span class="pre">&#64;helpers.reify</span></code>, 5% boost on macro benchmark (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2995">#2995</a>)</p></li>
<li><p>Optimize HTTP parser (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3015">#3015</a>)</p></li>
<li><p>Implement <code class="docutils literal notranslate"><span class="pre">runner.addresses</span></code> property. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3036">#3036</a>)</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">bytearray</span></code> instead of a list of <code class="docutils literal notranslate"><span class="pre">bytes</span></code> in websocket reader. It
improves websocket message reading a little. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3039">#3039</a>)</p></li>
<li><p>Remove heartbeat on closing connection on keepalive timeout. The used hack
violates HTTP protocol. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3041">#3041</a>)</p></li>
<li><p>Limit websocket message size on reading to 4 MB by default. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3045">#3045</a>)</p></li>
</ul>
</div>
<div class="section" id="id197">
<h6>Bugfixes<a class="headerlink" href="#id197" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Don’t reuse a connection with the same URL but different proxy/TLS settings
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2981">#2981</a>)</p></li>
<li><p>When parsing the Forwarded header, the optional port number is now preserved.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3009">#3009</a>)</p></li>
</ul>
</div>
<div class="section" id="id200">
<h6>Improved Documentation<a class="headerlink" href="#id200" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Make Change Log more visible in docs (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3029">#3029</a>)</p></li>
<li><p>Make style and grammar improvements on the FAQ page. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3030">#3030</a>)</p></li>
<li><p>Document that signal handlers should be async functions since aiohttp 3.0
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3032">#3032</a>)</p></li>
</ul>
</div>
<div class="section" id="id204">
<h6>Deprecations and Removals<a class="headerlink" href="#id204" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Deprecate custom application’s router. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/3021">#3021</a>)</p></li>
</ul>
</div>
<div class="section" id="id206">
<h6>Misc<a class="headerlink" href="#id206" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>#3008, #3011</p></li>
</ul>
</div>
</div>
<div class="section" id="id207">
<h5>3.2.1 (2018-05-10)<a class="headerlink" href="#id207" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Don’t reuse a connection with the same URL but different proxy/TLS settings
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2981">#2981</a>)</p></li>
</ul>
</div>
<div class="section" id="id209">
<h5>3.2.0 (2018-05-06)<a class="headerlink" href="#id209" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id210">
<h6>Features<a class="headerlink" href="#id210" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Raise <code class="docutils literal notranslate"><span class="pre">TooManyRedirects</span></code> exception when client gets redirected too many
times instead of returning last response. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2631">#2631</a>)</p></li>
<li><p>Extract route definitions into separate <code class="docutils literal notranslate"><span class="pre">web_routedef.py</span></code> file (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2876">#2876</a>)</p></li>
<li><p>Raise an exception on request body reading after sending response. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2895">#2895</a>)</p></li>
<li><p>ClientResponse and RequestInfo now have real_url property, which is request
url without fragment part being stripped (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2925">#2925</a>)</p></li>
<li><p>Speed up connector limiting (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2937">#2937</a>)</p></li>
<li><p>Added and links property for ClientResponse object (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2948">#2948</a>)</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">request.config_dict</span></code> for exposing nested applications data. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2949">#2949</a>)</p></li>
<li><p>Speed up HTTP headers serialization, server micro-benchmark runs 5% faster
now. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2957">#2957</a>)</p></li>
<li><p>Apply assertions in debug mode only (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2966">#2966</a>)</p></li>
</ul>
</div>
<div class="section" id="id220">
<h6>Bugfixes<a class="headerlink" href="#id220" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>expose property <cite>app</cite> for TestClient (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2891">#2891</a>)</p></li>
<li><p>Call on_chunk_sent when write_eof takes as a param the last chunk (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2909">#2909</a>)</p></li>
<li><p>A closing bracket was added to <cite>__repr__</cite> of resources (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2935">#2935</a>)</p></li>
<li><p>Fix compression of FileResponse (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2942">#2942</a>)</p></li>
<li><p>Fixes some bugs in the limit connection feature (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2964">#2964</a>)</p></li>
</ul>
</div>
<div class="section" id="id226">
<h6>Improved Documentation<a class="headerlink" href="#id226" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Drop <code class="docutils literal notranslate"><span class="pre">async_timeout</span></code> usage from documentation for client API in favor of
<code class="docutils literal notranslate"><span class="pre">timeout</span></code> parameter. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2865">#2865</a>)</p></li>
<li><p>Improve Gunicorn logging documentation (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2921">#2921</a>)</p></li>
<li><p>Replace multipart writer <cite>.serialize()</cite> method with <cite>.write()</cite> in
documentation. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2965">#2965</a>)</p></li>
</ul>
</div>
<div class="section" id="id230">
<h6>Deprecations and Removals<a class="headerlink" href="#id230" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Deprecate Application.make_handler() (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2938">#2938</a>)</p></li>
</ul>
</div>
<div class="section" id="id232">
<h6>Misc<a class="headerlink" href="#id232" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>#2958</p></li>
</ul>
</div>
</div>
<div class="section" id="id233">
<h5>3.1.3 (2018-04-12)<a class="headerlink" href="#id233" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix cancellation broadcast during DNS resolve (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2910">#2910</a>)</p></li>
</ul>
</div>
<div class="section" id="id235">
<h5>3.1.2 (2018-04-05)<a class="headerlink" href="#id235" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Make <code class="docutils literal notranslate"><span class="pre">LineTooLong</span></code> exception more detailed about actual data size (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2863">#2863</a>)</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">on_chunk_sent</span></code> when write_eof takes as a param the last chunk (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2909">#2909</a>)</p></li>
</ul>
</div>
<div class="section" id="id238">
<h5>3.1.1 (2018-03-27)<a class="headerlink" href="#id238" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Support <em>asynchronous iterators</em> (and <em>asynchronous generators</em> as
well) in both client and server API as request / response BODY
payloads. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2802">#2802</a>)</p></li>
</ul>
</div>
<div class="section" id="id240">
<h5>3.1.0 (2018-03-21)<a class="headerlink" href="#id240" title="Permalink to this headline">¶</a></h5>
<p>Welcome to aiohttp 3.1 release.</p>
<p>This is an <em>incremental</em> release, fully backward compatible with <em>aiohttp 3.0</em>.</p>
<p>But we have added several new features.</p>
<p>The most visible one is <code class="docutils literal notranslate"><span class="pre">app.add_routes()</span></code> (an alias for existing
<code class="docutils literal notranslate"><span class="pre">app.router.add_routes()</span></code>. The addition is very important because
all <em>aiohttp</em> docs now uses <code class="docutils literal notranslate"><span class="pre">app.add_routes()</span></code> call in code
snippets. All your existing code still do register routes / resource
without any warning but you’ve got the idea for a favorite way: noisy
<code class="docutils literal notranslate"><span class="pre">app.router.add_get()</span></code> is replaced by <code class="docutils literal notranslate"><span class="pre">app.add_routes()</span></code>.</p>
<p>The library does not make a preference between decorators:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">routes</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">RouteTableDef</span><span class="p">()</span>

<span class="nd">@routes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">(</span><span class="n">routes</span><span class="p">)</span>
</pre></div>
</div>
<p>and route tables as a list:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">hello</span><span class="p">)])</span>
</pre></div>
</div>
<p>Both ways are equal, user may decide basing on own code taste.</p>
<p>Also we have a lot of minor features, bug fixes and documentation
updates, see below.</p>
<div class="section" id="id241">
<h6>Features<a class="headerlink" href="#id241" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Relax JSON content-type checking in the <code class="docutils literal notranslate"><span class="pre">ClientResponse.json()</span></code> to allow
“application/xxx+json” instead of strict “application/json”. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2206">#2206</a>)</p></li>
<li><p>Bump C HTTP parser to version 2.8 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2730">#2730</a>)</p></li>
<li><p>Accept a coroutine as an application factory in <code class="docutils literal notranslate"><span class="pre">web.run_app</span></code> and gunicorn
worker. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2739">#2739</a>)</p></li>
<li><p>Implement application cleanup context (<code class="docutils literal notranslate"><span class="pre">app.cleanup_ctx</span></code> property). (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2747">#2747</a>)</p></li>
<li><p>Make <code class="docutils literal notranslate"><span class="pre">writer.write_headers</span></code> a coroutine. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2762">#2762</a>)</p></li>
<li><p>Add tracking signals for getting request/response bodies. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2767">#2767</a>)</p></li>
<li><p>Deprecate ClientResponseError.code in favor of .status to keep similarity
with response classes. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2781">#2781</a>)</p></li>
<li><p>Implement <code class="docutils literal notranslate"><span class="pre">app.add_routes()</span></code> method. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2787">#2787</a>)</p></li>
<li><p>Implement <code class="docutils literal notranslate"><span class="pre">web.static()</span></code> and <code class="docutils literal notranslate"><span class="pre">RouteTableDef.static()</span></code> API. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2795">#2795</a>)</p></li>
<li><p>Install a test event loop as default by <code class="docutils literal notranslate"><span class="pre">asyncio.set_event_loop()</span></code>. The
change affects aiohttp test utils but backward compatibility is not broken
for 99.99% of use cases. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2804">#2804</a>)</p></li>
<li><p>Refactor <code class="docutils literal notranslate"><span class="pre">ClientResponse</span></code> constructor: make logically required constructor
arguments mandatory, drop <code class="docutils literal notranslate"><span class="pre">_post_init()</span></code> method. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2820">#2820</a>)</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">app.add_routes()</span></code> in server docs everywhere (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2830">#2830</a>)</p></li>
<li><p>Websockets refactoring, all websocket writer methods are converted into
coroutines. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2836">#2836</a>)</p></li>
<li><p>Provide <code class="docutils literal notranslate"><span class="pre">Content-Range</span></code> header for <code class="docutils literal notranslate"><span class="pre">Range</span></code> requests (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2844">#2844</a>)</p></li>
</ul>
</div>
<div class="section" id="id256">
<h6>Bugfixes<a class="headerlink" href="#id256" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Fix websocket client return EofStream. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2784">#2784</a>)</p></li>
<li><p>Fix websocket demo. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2789">#2789</a>)</p></li>
<li><p>Property <code class="docutils literal notranslate"><span class="pre">BaseRequest.http_range</span></code> now returns a python-like slice when
requesting the tail of the range. It’s now indicated by a negative value in
<code class="docutils literal notranslate"><span class="pre">range.start</span></code> rather then in <code class="docutils literal notranslate"><span class="pre">range.stop</span></code> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2805">#2805</a>)</p></li>
<li><p>Close a connection if an unexpected exception occurs while sending a request
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2827">#2827</a>)</p></li>
<li><p>Fix firing DNS tracing events. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2841">#2841</a>)</p></li>
</ul>
</div>
<div class="section" id="id262">
<h6>Improved Documentation<a class="headerlink" href="#id262" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Document behavior when cchardet detects encodings that are unknown to Python.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2732">#2732</a>)</p></li>
<li><p>Add diagrams for tracing request life style. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2748">#2748</a>)</p></li>
<li><p>Drop removed functionality for passing <code class="docutils literal notranslate"><span class="pre">StreamReader</span></code> as data at client
side. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2793">#2793</a>)</p></li>
</ul>
</div>
</div>
<div class="section" id="id266">
<h5>3.0.9 (2018-03-14)<a class="headerlink" href="#id266" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Close a connection if an unexpected exception occurs while sending a request
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2827">#2827</a>)</p></li>
</ul>
</div>
<div class="section" id="id268">
<h5>3.0.8 (2018-03-12)<a class="headerlink" href="#id268" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">asyncio.current_task()</span></code> on Python 3.7 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2825">#2825</a>)</p></li>
</ul>
</div>
<div class="section" id="id270">
<h5>3.0.7 (2018-03-08)<a class="headerlink" href="#id270" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix SSL proxy support by client. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2810">#2810</a>)</p></li>
<li><p>Restore an imperative check in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> for python version. The check
works in parallel to environment marker. As effect an error about unsupported
Python versions is raised even on outdated systems with very old
<code class="docutils literal notranslate"><span class="pre">setuptools</span></code> version installed. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2813">#2813</a>)</p></li>
</ul>
</div>
<div class="section" id="id273">
<h5>3.0.6 (2018-03-05)<a class="headerlink" href="#id273" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">_reuse_address</span></code> and <code class="docutils literal notranslate"><span class="pre">_reuse_port</span></code> to
<code class="docutils literal notranslate"><span class="pre">web_runner.TCPSite.__slots__</span></code>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2792">#2792</a>)</p></li>
</ul>
</div>
<div class="section" id="id275">
<h5>3.0.5 (2018-02-27)<a class="headerlink" href="#id275" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix <code class="docutils literal notranslate"><span class="pre">InvalidStateError</span></code> on processing a sequence of two
<code class="docutils literal notranslate"><span class="pre">RequestHandler.data_received</span></code> calls on web server. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2773">#2773</a>)</p></li>
</ul>
</div>
<div class="section" id="id277">
<h5>3.0.4 (2018-02-26)<a class="headerlink" href="#id277" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix <code class="docutils literal notranslate"><span class="pre">IndexError</span></code> in HTTP request handling by server. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2752">#2752</a>)</p></li>
<li><p>Fix MultipartWriter.append* no longer returning part/payload. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2759">#2759</a>)</p></li>
</ul>
</div>
<div class="section" id="id280">
<h5>3.0.3 (2018-02-25)<a class="headerlink" href="#id280" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Relax <code class="docutils literal notranslate"><span class="pre">attrs</span></code> dependency to minimal actually supported version
17.0.3 The change allows to avoid version conflicts with currently
existing test tools.</p></li>
</ul>
</div>
<div class="section" id="id281">
<h5>3.0.2 (2018-02-23)<a class="headerlink" href="#id281" title="Permalink to this headline">¶</a></h5>
<div class="section" id="security-fix">
<h6>Security Fix<a class="headerlink" href="#security-fix" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Prevent Windows absolute URLs in static files.  Paths like
<code class="docutils literal notranslate"><span class="pre">/static/D:\path</span></code> and <code class="docutils literal notranslate"><span class="pre">/static/\\hostname\drive\path</span></code> are
forbidden.</p></li>
</ul>
</div>
</div>
<div class="section" id="id282">
<h5>3.0.1<a class="headerlink" href="#id282" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Technical release for fixing distribution problems.</p></li>
</ul>
</div>
<div class="section" id="id283">
<h5>3.0.0 (2018-02-12)<a class="headerlink" href="#id283" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id284">
<h6>Features<a class="headerlink" href="#id284" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Speed up the <cite>PayloadWriter.write</cite> method for large request bodies. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2126">#2126</a>)</p></li>
<li><p>StreamResponse and Response are now MutableMappings. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2246">#2246</a>)</p></li>
<li><p>ClientSession publishes a set of signals to track the HTTP request execution.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2313">#2313</a>)</p></li>
<li><p>Content-Disposition fast access in ClientResponse (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2455">#2455</a>)</p></li>
<li><p>Added support to Flask-style decorators with class-based Views. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2472">#2472</a>)</p></li>
<li><p>Signal handlers (registered callbacks) should be coroutines. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2480">#2480</a>)</p></li>
<li><p>Support <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span> <span class="pre">test_client.ws_connect(...)</span></code> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2525">#2525</a>)</p></li>
<li><p>Introduce <em>site</em> and <em>application runner</em> as underlying API for <cite>web.run_app</cite>
implementation. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2530">#2530</a>)</p></li>
<li><p>Only quote multipart boundary when necessary and sanitize input (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2544">#2544</a>)</p></li>
<li><p>Make the <cite>aiohttp.ClientResponse.get_encoding</cite> method public with the
processing of invalid charset while detecting content encoding. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2549">#2549</a>)</p></li>
<li><p>Add optional configurable per message compression for
<cite>ClientWebSocketResponse</cite> and <cite>WebSocketResponse</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2551">#2551</a>)</p></li>
<li><p>Add hysteresis to <cite>StreamReader</cite> to prevent flipping between paused and
resumed states too often. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2555">#2555</a>)</p></li>
<li><p>Support <cite>.netrc</cite> by <cite>trust_env</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2581">#2581</a>)</p></li>
<li><p>Avoid to create a new resource when adding a route with the same name and
path of the last added resource (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2586">#2586</a>)</p></li>
<li><p><cite>MultipartWriter.boundary</cite> is <cite>str</cite> now. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2589">#2589</a>)</p></li>
<li><p>Allow a custom port to be used by <cite>TestServer</cite> (and associated pytest
fixtures) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2613">#2613</a>)</p></li>
<li><p>Add param access_log_class to web.run_app function (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2615">#2615</a>)</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">ssl</span></code> parameter to client API (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2626">#2626</a>)</p></li>
<li><p>Fixes performance issue introduced by #2577. When there are no middlewares
installed by the user, no additional and useless code is executed. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2629">#2629</a>)</p></li>
<li><p>Rename PayloadWriter to StreamWriter (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2654">#2654</a>)</p></li>
<li><p>New options <em>reuse_port</em>, <em>reuse_address</em> are added to <cite>run_app</cite> and
<cite>TCPSite</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2679">#2679</a>)</p></li>
<li><p>Use custom classes to pass client signals parameters (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2686">#2686</a>)</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">attrs</span></code> library for data classes, replace <cite>namedtuple</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2690">#2690</a>)</p></li>
<li><p>Pytest fixtures renaming, add <code class="docutils literal notranslate"><span class="pre">aiohttp_</span></code> prefix (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2578">#2578</a>)</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">aiohttp-</span></code> prefix for <code class="docutils literal notranslate"><span class="pre">pytest-aiohttp</span></code> command line
parameters (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2578">#2578</a>)</p></li>
</ul>
</div>
<div class="section" id="id310">
<h6>Bugfixes<a class="headerlink" href="#id310" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Correctly process upgrade request from server to HTTP2. <code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> does not
support HTTP2 yet, the protocol is not upgraded but response is handled
correctly. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2277">#2277</a>)</p></li>
<li><p>Fix ClientConnectorSSLError and ClientProxyConnectionError for proxy
connector (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2408">#2408</a>)</p></li>
<li><p>Fix connector convert OSError to ClientConnectorError (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2423">#2423</a>)</p></li>
<li><p>Fix connection attempts for multiple dns hosts (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2424">#2424</a>)</p></li>
<li><p>Fix writing to closed transport by raising <cite>asyncio.CancelledError</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2499">#2499</a>)</p></li>
<li><p>Fix warning in <cite>ClientSession.__del__</cite> by stopping to try to close it.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2523">#2523</a>)</p></li>
<li><p>Fixed race-condition for iterating addresses from the DNSCache. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2620">#2620</a>)</p></li>
<li><p>Fix default value of <cite>access_log_format</cite> argument in <cite>web.run_app</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2649">#2649</a>)</p></li>
<li><p>Freeze sub-application on adding to parent app (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2656">#2656</a>)</p></li>
<li><p>Do percent encoding for <cite>.url_for()</cite> parameters (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2668">#2668</a>)</p></li>
<li><p>Correctly process request start time and multiple request/response
headers in access log extra (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2641">#2641</a>)</p></li>
</ul>
</div>
<div class="section" id="id322">
<h6>Improved Documentation<a class="headerlink" href="#id322" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Improve tutorial docs, using <cite>literalinclude</cite> to link to the actual files.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2396">#2396</a>)</p></li>
<li><p>Small improvement docs: better example for file uploads. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2401">#2401</a>)</p></li>
<li><p>Rename <cite>from_env</cite> to <cite>trust_env</cite> in client reference. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2451">#2451</a>)</p></li>
<li><p>﻿Fixed mistype in <cite>Proxy Support</cite> section where <cite>trust_env</cite> parameter was
used in <cite>session.get(“http://python.org”, trust_env=True)</cite> method instead of
aiohttp.ClientSession constructor as follows:
<cite>aiohttp.ClientSession(trust_env=True)</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2688">#2688</a>)</p></li>
<li><p>Fix issue with unittest example not compiling in testing docs. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2717">#2717</a>)</p></li>
</ul>
</div>
<div class="section" id="id328">
<h6>Deprecations and Removals<a class="headerlink" href="#id328" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Simplify HTTP pipelining implementation (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2109">#2109</a>)</p></li>
<li><p>Drop <cite>StreamReaderPayload</cite> and <cite>DataQueuePayload</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2257">#2257</a>)</p></li>
<li><p>Drop <cite>md5</cite> and <cite>sha1</cite> finger-prints (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2267">#2267</a>)</p></li>
<li><p>Drop WSMessage.tp (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2321">#2321</a>)</p></li>
<li><p>Drop Python 3.4 and Python 3.5.0, 3.5.1, 3.5.2. Minimal supported Python
versions are 3.5.3 and 3.6.0. <cite>yield from</cite> is gone, use <cite>async/await</cite> syntax.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2343">#2343</a>)</p></li>
<li><p>Drop <cite>aiohttp.Timeout</cite> and use <cite>async_timeout.timeout</cite> instead. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2348">#2348</a>)</p></li>
<li><p>Drop <cite>resolve</cite> param from TCPConnector. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2377">#2377</a>)</p></li>
<li><p>Add DeprecationWarning for returning HTTPException (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2415">#2415</a>)</p></li>
<li><p><cite>send_str()</cite>, <cite>send_bytes()</cite>, <cite>send_json()</cite>, <cite>ping()</cite> and <cite>pong()</cite> are
genuine async functions now. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2475">#2475</a>)</p></li>
<li><p>Drop undocumented <cite>app.on_pre_signal</cite> and <cite>app.on_post_signal</cite>. Signal
handlers should be coroutines, support for regular functions is dropped.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2480">#2480</a>)</p></li>
<li><p><cite>StreamResponse.drain()</cite> is not a part of public API anymore, just use <cite>await
StreamResponse.write()</cite>. <cite>StreamResponse.write</cite> is converted to async
function. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2483">#2483</a>)</p></li>
<li><p>Drop deprecated <cite>slow_request_timeout</cite> param and <cite>**kwargs`</cite> from
<cite>RequestHandler</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2500">#2500</a>)</p></li>
<li><p>Drop deprecated <cite>resource.url()</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2501">#2501</a>)</p></li>
<li><p>Remove <cite>%u</cite> and <cite>%l</cite> format specifiers from access log format. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2506">#2506</a>)</p></li>
<li><p>Drop deprecated <cite>request.GET</cite> property. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2547">#2547</a>)</p></li>
<li><p>Simplify stream classes: drop <cite>ChunksQueue</cite> and <cite>FlowControlChunksQueue</cite>,
merge <cite>FlowControlStreamReader</cite> functionality into <cite>StreamReader</cite>, drop
<cite>FlowControlStreamReader</cite> name. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2555">#2555</a>)</p></li>
<li><p>Do not create a new resource on <cite>router.add_get(…, allow_head=True)</cite>
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2585">#2585</a>)</p></li>
<li><p>Drop access to TCP tuning options from PayloadWriter and Response classes
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2604">#2604</a>)</p></li>
<li><p>Drop deprecated <cite>encoding</cite> parameter from client API (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2606">#2606</a>)</p></li>
<li><p>Deprecate <code class="docutils literal notranslate"><span class="pre">verify_ssl</span></code>, <code class="docutils literal notranslate"><span class="pre">ssl_context</span></code> and <code class="docutils literal notranslate"><span class="pre">fingerprint</span></code> parameters in
client API (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2626">#2626</a>)</p></li>
<li><p>Get rid of the legacy class StreamWriter. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2651">#2651</a>)</p></li>
<li><p>Forbid non-strings in <cite>resource.url_for()</cite> parameters. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2668">#2668</a>)</p></li>
<li><p>Deprecate inheritance from <code class="docutils literal notranslate"><span class="pre">ClientSession</span></code> and <code class="docutils literal notranslate"><span class="pre">web.Application</span></code> and
custom user attributes for <code class="docutils literal notranslate"><span class="pre">ClientSession</span></code>, <code class="docutils literal notranslate"><span class="pre">web.Request</span></code> and
<code class="docutils literal notranslate"><span class="pre">web.Application</span></code> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2691">#2691</a>)</p></li>
<li><p>Drop <cite>resp = await aiohttp.request(…)</cite> syntax for sake of <cite>async with
aiohttp.request(…) as resp:</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2540">#2540</a>)</p></li>
<li><p>Forbid synchronous context managers for <cite>ClientSession</cite> and test
server/client. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2362">#2362</a>)</p></li>
</ul>
</div>
<div class="section" id="id354">
<h6>Misc<a class="headerlink" href="#id354" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>#2552</p></li>
</ul>
</div>
</div>
<div class="section" id="id355">
<h5>2.3.10 (2018-02-02)<a class="headerlink" href="#id355" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix 100% CPU usage on HTTP GET and websocket connection just after it (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1955">#1955</a>)</p></li>
<li><p>Patch broken <cite>ssl.match_hostname()</cite> on Python&lt;3.7 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2674">#2674</a>)</p></li>
</ul>
</div>
<div class="section" id="id358">
<h5>2.3.9 (2018-01-16)<a class="headerlink" href="#id358" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix colon handing in path for dynamic resources (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2670">#2670</a>)</p></li>
</ul>
</div>
<div class="section" id="id360">
<h5>2.3.8 (2018-01-15)<a class="headerlink" href="#id360" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Do not use <cite>yarl.unquote</cite> internal function in aiohttp.  Fix
incorrectly unquoted path part in URL dispatcher (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2662">#2662</a>)</p></li>
<li><p>Fix compatibility with <cite>yarl==1.0.0</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2662">#2662</a>)</p></li>
</ul>
</div>
<div class="section" id="id363">
<h5>2.3.7 (2017-12-27)<a class="headerlink" href="#id363" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fixed race-condition for iterating addresses from the DNSCache. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2620">#2620</a>)</p></li>
<li><p>Fix docstring for request.host (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2591">#2591</a>)</p></li>
<li><p>Fix docstring for request.remote (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2592">#2592</a>)</p></li>
</ul>
</div>
<div class="section" id="id367">
<h5>2.3.6 (2017-12-04)<a class="headerlink" href="#id367" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Correct <cite>request.app</cite> context (for handlers not just middlewares). (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2577">#2577</a>)</p></li>
</ul>
</div>
<div class="section" id="id369">
<h5>2.3.5 (2017-11-30)<a class="headerlink" href="#id369" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix compatibility with <cite>pytest</cite> 3.3+ (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2565">#2565</a>)</p></li>
</ul>
</div>
<div class="section" id="id371">
<h5>2.3.4 (2017-11-29)<a class="headerlink" href="#id371" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Make <cite>request.app</cite> point to proper application instance when using nested
applications (with middlewares). (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2550">#2550</a>)</p></li>
<li><p>Change base class of ClientConnectorSSLError to ClientSSLError from
ClientConnectorError. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2563">#2563</a>)</p></li>
<li><p>Return client connection back to free pool on error in <cite>connector.connect()</cite>.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2567">#2567</a>)</p></li>
</ul>
</div>
<div class="section" id="id375">
<h5>2.3.3 (2017-11-17)<a class="headerlink" href="#id375" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Having a <cite>;</cite> in Response content type does not assume it contains a charset
anymore. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2197">#2197</a>)</p></li>
<li><p>Use <cite>getattr(asyncio, ‘async’)</cite> for keeping compatibility with Python 3.7.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2476">#2476</a>)</p></li>
<li><p>Ignore <cite>NotImplementedError</cite> raised by <cite>set_child_watcher</cite> from <cite>uvloop</cite>.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2491">#2491</a>)</p></li>
<li><p>Fix warning in <cite>ClientSession.__del__</cite> by stopping to try to close it.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2523">#2523</a>)</p></li>
<li><p>Fixed typo’s in Third-party libraries page. And added async-v20 to the list
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2510">#2510</a>)</p></li>
</ul>
</div>
<div class="section" id="id381">
<h5>2.3.2 (2017-11-01)<a class="headerlink" href="#id381" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix passing client max size on cloning request obj. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2385">#2385</a>)</p></li>
<li><p>Fix ClientConnectorSSLError and ClientProxyConnectionError for proxy
connector. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2408">#2408</a>)</p></li>
<li><p>Drop generated <cite>_http_parser</cite> shared object from tarball distribution. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2414">#2414</a>)</p></li>
<li><p>Fix connector convert OSError to ClientConnectorError. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2423">#2423</a>)</p></li>
<li><p>Fix connection attempts for multiple dns hosts. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2424">#2424</a>)</p></li>
<li><p>Fix ValueError for AF_INET6 sockets if a preexisting INET6 socket to the
<cite>aiohttp.web.run_app</cite> function. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2431">#2431</a>)</p></li>
<li><p><cite>_SessionRequestContextManager</cite> closes the session properly now. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2441">#2441</a>)</p></li>
<li><p>Rename <cite>from_env</cite> to <cite>trust_env</cite> in client reference. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2451">#2451</a>)</p></li>
</ul>
</div>
<div class="section" id="id390">
<h5>2.3.1 (2017-10-18)<a class="headerlink" href="#id390" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Relax attribute lookup in warning about old-styled middleware (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2340">#2340</a>)</p></li>
</ul>
</div>
<div class="section" id="id392">
<h5>2.3.0 (2017-10-18)<a class="headerlink" href="#id392" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id393">
<h6>Features<a class="headerlink" href="#id393" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Add SSL related params to <cite>ClientSession.request</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1128">#1128</a>)</p></li>
<li><p>Make enable_compression work on HTTP/1.0 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1828">#1828</a>)</p></li>
<li><p>Deprecate registering synchronous web handlers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1993">#1993</a>)</p></li>
<li><p>Switch to <cite>multidict 3.0</cite>. All HTTP headers preserve casing now but compared
in case-insensitive way. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1994">#1994</a>)</p></li>
<li><p>Improvement for <cite>normalize_path_middleware</cite>. Added possibility to handle URLs
with query string. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1995">#1995</a>)</p></li>
<li><p>Use towncrier for CHANGES.txt build (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1997">#1997</a>)</p></li>
<li><p>Implement <cite>trust_env=True</cite> param in <cite>ClientSession</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1998">#1998</a>)</p></li>
<li><p>Added variable to customize proxy headers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2001">#2001</a>)</p></li>
<li><p>Implement <cite>router.add_routes</cite> and router decorators. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2004">#2004</a>)</p></li>
<li><p>Deprecated <cite>BaseRequest.has_body</cite> in favor of
<cite>BaseRequest.can_read_body</cite> Added <cite>BaseRequest.body_exists</cite>
attribute that stays static for the lifetime of the request (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2005">#2005</a>)</p></li>
<li><p>Provide <cite>BaseRequest.loop</cite> attribute (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2024">#2024</a>)</p></li>
<li><p>Make <cite>_CoroGuard</cite> awaitable and fix <cite>ClientSession.close</cite> warning message
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2026">#2026</a>)</p></li>
<li><p>Responses to redirects without Location header are returned instead of
raising a RuntimeError (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2030">#2030</a>)</p></li>
<li><p>Added <cite>get_client</cite>, <cite>get_server</cite>, <cite>setUpAsync</cite> and <cite>tearDownAsync</cite> methods to
AioHTTPTestCase (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2032">#2032</a>)</p></li>
<li><p>Add automatically a SafeChildWatcher to the test loop (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2058">#2058</a>)</p></li>
<li><p>add ability to disable automatic response decompression (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2110">#2110</a>)</p></li>
<li><p>Add support for throttling DNS request, avoiding the requests saturation when
there is a miss in the DNS cache and many requests getting into the connector
at the same time. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2111">#2111</a>)</p></li>
<li><p>Use request for getting access log information instead of message/transport
pair. Add <cite>RequestBase.remote</cite> property for accessing to IP of client
initiated HTTP request. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2123">#2123</a>)</p></li>
<li><p>json() raises a ContentTypeError exception if the content-type does not meet
the requirements instead of raising a generic ClientResponseError. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2136">#2136</a>)</p></li>
<li><p>Make the HTTP client able to return HTTP chunks when chunked transfer
encoding is used. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2150">#2150</a>)</p></li>
<li><p>add <cite>append_version</cite> arg into <cite>StaticResource.url</cite> and
<cite>StaticResource.url_for</cite> methods for getting an url with hash (version) of
the file. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2157">#2157</a>)</p></li>
<li><p>Fix parsing the Forwarded header. * commas and semicolons are allowed inside
quoted-strings; * empty forwarded-pairs (as in for=_1;;by=_2) are allowed; *
non-standard parameters are allowed (although this alone could be easily done
in the previous parser). (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2173">#2173</a>)</p></li>
<li><p>Don’t require ssl module to run. aiohttp does not require SSL to function.
The code paths involved with SSL will only be hit upon SSL usage. Raise
<cite>RuntimeError</cite> if HTTPS protocol is required but ssl module is not present.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2221">#2221</a>)</p></li>
<li><p>Accept coroutine fixtures in pytest plugin (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2223">#2223</a>)</p></li>
<li><p>Call <cite>shutdown_asyncgens</cite> before event loop closing on Python 3.6. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2227">#2227</a>)</p></li>
<li><p>Speed up Signals when there are no receivers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2229">#2229</a>)</p></li>
<li><p>Raise <cite>InvalidURL</cite> instead of <cite>ValueError</cite> on fetches with invalid URL.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2241">#2241</a>)</p></li>
<li><p>Move <cite>DummyCookieJar</cite> into <cite>cookiejar.py</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2242">#2242</a>)</p></li>
<li><p><cite>run_app</cite>: Make <cite>print=None</cite> disable printing (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2260">#2260</a>)</p></li>
<li><p>Support <cite>brotli</cite> encoding (generic-purpose lossless compression algorithm)
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2270">#2270</a>)</p></li>
<li><p>Add server support for WebSockets Per-Message Deflate. Add client option to
add deflate compress header in WebSockets request header. If calling
ClientSession.ws_connect() with <cite>compress=15</cite> the client will support deflate
compress negotiation. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2273">#2273</a>)</p></li>
<li><p>Support <cite>verify_ssl</cite>, <cite>fingerprint</cite>, <cite>ssl_context</cite> and <cite>proxy_headers</cite> by
<cite>client.ws_connect</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2292">#2292</a>)</p></li>
<li><p>Added <cite>aiohttp.ClientConnectorSSLError</cite> when connection fails due
<cite>ssl.SSLError</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2294">#2294</a>)</p></li>
<li><p><cite>aiohttp.web.Application.make_handler</cite> support <cite>access_log_class</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2315">#2315</a>)</p></li>
<li><p>Build HTTP parser extension in non-strict mode by default. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2332">#2332</a>)</p></li>
</ul>
</div>
<div class="section" id="id429">
<h6>Bugfixes<a class="headerlink" href="#id429" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Clear auth information on redirecting to other domain (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1699">#1699</a>)</p></li>
<li><p>Fix missing app.loop on startup hooks during tests (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2060">#2060</a>)</p></li>
<li><p>Fix issue with synchronous session closing when using <cite>ClientSession</cite> as an
asynchronous context manager. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2063">#2063</a>)</p></li>
<li><p>Fix issue with <cite>CookieJar</cite> incorrectly expiring cookies in some edge cases.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2084">#2084</a>)</p></li>
<li><p>Force use of IPv4 during test, this will make tests run in a Docker container
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2104">#2104</a>)</p></li>
<li><p>Warnings about unawaited coroutines now correctly point to the user’s code.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2106">#2106</a>)</p></li>
<li><p>Fix issue with <cite>IndexError</cite> being raised by the <cite>StreamReader.iter_chunks()</cite>
generator. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2112">#2112</a>)</p></li>
<li><p>Support HTTP 308 Permanent redirect in client class. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2114">#2114</a>)</p></li>
<li><p>Fix <cite>FileResponse</cite> sending empty chunked body on 304. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2143">#2143</a>)</p></li>
<li><p>Do not add <cite>Content-Length: 0</cite> to GET/HEAD/TRACE/OPTIONS requests by default.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2167">#2167</a>)</p></li>
<li><p>Fix parsing the Forwarded header according to RFC 7239. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2170">#2170</a>)</p></li>
<li><p>Securely determining remote/scheme/host #2171 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2171">#2171</a>)</p></li>
<li><p>Fix header name parsing, if name is split into multiple lines (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2183">#2183</a>)</p></li>
<li><p>Handle session close during connection, <cite>KeyError:
&lt;aiohttp.connector._TransportPlaceholder&gt;</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2193">#2193</a>)</p></li>
<li><p>Fixes uncaught <cite>TypeError</cite> in <cite>helpers.guess_filename</cite> if <cite>name</cite> is not a
string (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2201">#2201</a>)</p></li>
<li><p>Raise OSError on async DNS lookup if resolved domain is an alias for another
one, which does not have an A or CNAME record. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2231">#2231</a>)</p></li>
<li><p>Fix incorrect warning in <cite>StreamReader</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2251">#2251</a>)</p></li>
<li><p>Properly clone state of web request (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2284">#2284</a>)</p></li>
<li><p>Fix C HTTP parser for cases when status line is split into different TCP
packets. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2311">#2311</a>)</p></li>
<li><p>Fix <cite>web.FileResponse</cite> overriding user supplied Content-Type (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2317">#2317</a>)</p></li>
</ul>
</div>
<div class="section" id="id450">
<h6>Improved Documentation<a class="headerlink" href="#id450" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Add a note about possible performance degradation in <cite>await resp.text()</cite> if
charset was not provided by <cite>Content-Type</cite> HTTP header. Pass explicit
encoding to solve it. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1811">#1811</a>)</p></li>
<li><p>Drop <cite>disqus</cite> widget from documentation pages. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2018">#2018</a>)</p></li>
<li><p>Add a graceful shutdown section to the client usage documentation. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2039">#2039</a>)</p></li>
<li><p>Document <cite>connector_owner</cite> parameter. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2072">#2072</a>)</p></li>
<li><p>Update the doc of web.Application (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2081">#2081</a>)</p></li>
<li><p>Fix mistake about access log disabling. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2085">#2085</a>)</p></li>
<li><p>Add example usage of on_startup and on_shutdown signals by creating and
disposing an aiopg connection engine. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2131">#2131</a>)</p></li>
<li><p>Document <cite>encoded=True</cite> for <cite>yarl.URL</cite>, it disables all yarl transformations.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2198">#2198</a>)</p></li>
<li><p>Document that all app’s middleware factories are run for every request.
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2225">#2225</a>)</p></li>
<li><p>Reflect the fact that default resolver is threaded one starting from aiohttp
1.1 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2228">#2228</a>)</p></li>
</ul>
</div>
<div class="section" id="id461">
<h6>Deprecations and Removals<a class="headerlink" href="#id461" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>Drop deprecated <cite>Server.finish_connections</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2006">#2006</a>)</p></li>
<li><p>Drop %O format from logging, use %b instead. Drop %e format from logging,
environment variables are not supported anymore. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2123">#2123</a>)</p></li>
<li><p>Drop deprecated secure_proxy_ssl_header support (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2171">#2171</a>)</p></li>
<li><p>Removed TimeService in favor of simple caching. TimeService also had a bug
where it lost about 0.5 seconds per second. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2176">#2176</a>)</p></li>
<li><p>Drop unused response_factory from static files API (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2290">#2290</a>)</p></li>
</ul>
</div>
<div class="section" id="id467">
<h6>Misc<a class="headerlink" href="#id467" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p>#2013, #2014, #2048, #2094, #2149, #2187, #2214, #2225, #2243, #2248</p></li>
</ul>
</div>
</div>
<div class="section" id="id468">
<h5>2.2.5 (2017-08-03)<a class="headerlink" href="#id468" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Don’t raise deprecation warning on
<cite>loop.run_until_complete(client.close())</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2065">#2065</a>)</p></li>
</ul>
</div>
<div class="section" id="id470">
<h5>2.2.4 (2017-08-02)<a class="headerlink" href="#id470" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix issue with synchronous session closing when using ClientSession
as an asynchronous context manager.  (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2063">#2063</a>)</p></li>
</ul>
</div>
<div class="section" id="id472">
<h5>2.2.3 (2017-07-04)<a class="headerlink" href="#id472" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix <cite>_CoroGuard</cite> for python 3.4</p></li>
</ul>
</div>
<div class="section" id="id473">
<h5>2.2.2 (2017-07-03)<a class="headerlink" href="#id473" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Allow <cite>await session.close()</cite> along with <cite>yield from session.close()</cite></p></li>
</ul>
</div>
<div class="section" id="id474">
<h5>2.2.1 (2017-07-02)<a class="headerlink" href="#id474" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Relax <cite>yarl</cite> requirement to 0.11+</p></li>
<li><p>Backport #2026: <cite>session.close</cite> <em>is</em> a coroutine (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/2029">#2029</a>)</p></li>
</ul>
</div>
<div class="section" id="id476">
<h5>2.2.0 (2017-06-20)<a class="headerlink" href="#id476" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Add doc for add_head, update doc for add_get. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1944">#1944</a>)</p></li>
<li><p>Fixed consecutive calls for <cite>Response.write_eof</cite>.</p></li>
<li><p>Retain method attributes (e.g. <code class="code docutils literal notranslate"><span class="pre">__doc__</span></code>) when registering synchronous
handlers for resources. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1953">#1953</a>)</p></li>
<li><p>Added signal TERM handling in <cite>run_app</cite> to gracefully exit (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1932">#1932</a>)</p></li>
<li><p>Fix websocket issues caused by frame fragmentation. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1962">#1962</a>)</p></li>
<li><p>Raise RuntimeError is you try to set the Content Length and enable
chunked encoding at the same time (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1941">#1941</a>)</p></li>
<li><p>Small update for <cite>unittest_run_loop</cite></p></li>
<li><p>Use CIMultiDict for ClientRequest.skip_auto_headers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1970">#1970</a>)</p></li>
<li><p>Fix wrong startup sequence: test server and <cite>run_app()</cite> are not raise
<cite>DeprecationWarning</cite> now (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1947">#1947</a>)</p></li>
<li><p>Make sure cleanup signal is sent if startup signal has been sent (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1959">#1959</a>)</p></li>
<li><p>Fixed server keep-alive handler, could cause 100% cpu utilization (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1955">#1955</a>)</p></li>
<li><p>Connection can be destroyed before response get processed if
<cite>await aiohttp.request(..)</cite> is used (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1981">#1981</a>)</p></li>
<li><p>MultipartReader does not work with -OO (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1969">#1969</a>)</p></li>
<li><p>Fixed <cite>ClientPayloadError</cite> with blank <cite>Content-Encoding</cite> header (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1931">#1931</a>)</p></li>
<li><p>Support <cite>deflate</cite> encoding implemented in <cite>httpbin.org/deflate</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1918">#1918</a>)</p></li>
<li><p>Fix BadStatusLine caused by extra <cite>CRLF</cite> after <cite>POST</cite> data (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1792">#1792</a>)</p></li>
<li><p>Keep a reference to <cite>ClientSession</cite> in response object (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1985">#1985</a>)</p></li>
<li><p>Deprecate undocumented <cite>app.on_loop_available</cite> signal (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1978">#1978</a>)</p></li>
</ul>
</div>
<div class="section" id="id493">
<h5>2.1.0 (2017-05-26)<a class="headerlink" href="#id493" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Added support for experimental <cite>async-tokio</cite> event loop written in Rust
<a class="reference external" href="https://github.com/PyO3/tokio">https://github.com/PyO3/tokio</a></p></li>
<li><p>Write to transport <code class="docutils literal notranslate"><span class="pre">\r\n</span></code> before closing after keepalive timeout,
otherwise client can not detect socket disconnection. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1883">#1883</a>)</p></li>
<li><p>Only call <cite>loop.close</cite> in <cite>run_app</cite> if the user did <em>not</em> supply a loop.
Useful for allowing clients to specify their own cleanup before closing the
asyncio loop if they wish to tightly control loop behavior</p></li>
<li><p>Content disposition with semicolon in filename (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/917">#917</a>)</p></li>
<li><p>Added <cite>request_info</cite> to response object and <cite>ClientResponseError</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1733">#1733</a>)</p></li>
<li><p>Added <cite>history</cite> to <cite>ClientResponseError</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1741">#1741</a>)</p></li>
<li><p>Allow to disable redirect url re-quoting (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1474">#1474</a>)</p></li>
<li><p>Handle RuntimeError from transport (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1790">#1790</a>)</p></li>
<li><p>Dropped “%O” in access logger (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1673">#1673</a>)</p></li>
<li><p>Added <cite>args</cite> and <cite>kwargs</cite> to <cite>unittest_run_loop</cite>. Useful with other
decorators, for example <cite>&#64;patch</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1803">#1803</a>)</p></li>
<li><p>Added <cite>iter_chunks</cite> to response.content object. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1805">#1805</a>)</p></li>
<li><p>Avoid creating TimerContext when there is no timeout to allow
compatibility with Tornado. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1817">#1817</a>) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1180">#1180</a>)</p></li>
<li><p>Add <cite>proxy_from_env</cite> to <cite>ClientRequest</cite> to read from environment
variables. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1791">#1791</a>)</p></li>
<li><p>Add DummyCookieJar helper. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1830">#1830</a>)</p></li>
<li><p>Fix assertion errors in Python 3.4 from noop helper. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1847">#1847</a>)</p></li>
<li><p>Do not unquote <cite>+</cite> in match_info values (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1816">#1816</a>)</p></li>
<li><p>Use Forwarded, X-Forwarded-Scheme and X-Forwarded-Host for better scheme and
host resolution. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1134">#1134</a>)</p></li>
<li><p>Fix sub-application middlewares resolution order (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1853">#1853</a>)</p></li>
<li><p>Fix applications comparison (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1866">#1866</a>)</p></li>
<li><p>Fix static location in index when prefix is used (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1662">#1662</a>)</p></li>
<li><p>Make test server more reliable (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1896">#1896</a>)</p></li>
<li><p>Extend list of web exceptions, add HTTPUnprocessableEntity,
HTTPFailedDependency, HTTPInsufficientStorage status codes (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1920">#1920</a>)</p></li>
</ul>
</div>
<div class="section" id="id515">
<h5>2.0.7 (2017-04-12)<a class="headerlink" href="#id515" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix <em>pypi</em> distribution</p></li>
<li><p>Fix exception description (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1807">#1807</a>)</p></li>
<li><p>Handle socket error in FileResponse (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1773">#1773</a>)</p></li>
<li><p>Cancel websocket heartbeat on close (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1793">#1793</a>)</p></li>
</ul>
</div>
<div class="section" id="id519">
<h5>2.0.6 (2017-04-04)<a class="headerlink" href="#id519" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Keeping blank values for <cite>request.post()</cite> and <cite>multipart.form()</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1765">#1765</a>)</p></li>
<li><p>TypeError in data_received of ResponseHandler (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1770">#1770</a>)</p></li>
<li><p>Fix <code class="docutils literal notranslate"><span class="pre">web.run_app</span></code> not to bind to default host-port pair if only socket is
passed (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1786">#1786</a>)</p></li>
</ul>
</div>
<div class="section" id="id523">
<h5>2.0.5 (2017-03-29)<a class="headerlink" href="#id523" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Memory leak with aiohttp.request (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1756">#1756</a>)</p></li>
<li><p>Disable cleanup closed ssl transports by default.</p></li>
<li><p>Exception in request handling if the server responds before the body
is sent (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1761">#1761</a>)</p></li>
</ul>
</div>
<div class="section" id="id526">
<h5>2.0.4 (2017-03-27)<a class="headerlink" href="#id526" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Memory leak with aiohttp.request (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1756">#1756</a>)</p></li>
<li><p>Encoding is always UTF-8 in POST data (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1750">#1750</a>)</p></li>
<li><p>Do not add “Content-Disposition” header by default (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1755">#1755</a>)</p></li>
</ul>
</div>
<div class="section" id="id530">
<h5>2.0.3 (2017-03-24)<a class="headerlink" href="#id530" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Call https website through proxy will cause error (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1745">#1745</a>)</p></li>
<li><p>Fix exception on multipart/form-data post if content-type is not set (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1743">#1743</a>)</p></li>
</ul>
</div>
<div class="section" id="id533">
<h5>2.0.2 (2017-03-21)<a class="headerlink" href="#id533" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fixed Application.on_loop_available signal (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1739">#1739</a>)</p></li>
<li><p>Remove debug code</p></li>
</ul>
</div>
<div class="section" id="id535">
<h5>2.0.1 (2017-03-21)<a class="headerlink" href="#id535" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix allow-head to include name on route (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1737">#1737</a>)</p></li>
<li><p>Fixed AttributeError in WebSocketResponse.can_prepare (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1736">#1736</a>)</p></li>
</ul>
</div>
<div class="section" id="id538">
<h5>2.0.0 (2017-03-20)<a class="headerlink" href="#id538" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Added <cite>json</cite> to <cite>ClientSession.request()</cite> method (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1726">#1726</a>)</p></li>
<li><p>Added session’s <cite>raise_for_status</cite> parameter, automatically calls
raise_for_status() on any request. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1724">#1724</a>)</p></li>
<li><p><cite>response.json()</cite> raises <cite>ClientReponseError</cite> exception if response’s
content type does not match (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1723">#1723</a>)</p>
<ul>
<li><p>Cleanup timer and loop handle on any client exception.</p></li>
</ul>
</li>
<li><p>Deprecate <cite>loop</cite> parameter for Application’s constructor</p></li>
</ul>
</div>
<div class="section" id="rc1-2017-03-15">
<h5><cite>2.0.0rc1</cite> (2017-03-15)<a class="headerlink" href="#rc1-2017-03-15" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Properly handle payload errors (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1710">#1710</a>)</p></li>
<li><p>Added <cite>ClientWebSocketResponse.get_extra_info()</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1717">#1717</a>)</p></li>
<li><p>It is not possible to combine Transfer-Encoding and chunked parameter,
same for compress and Content-Encoding (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1655">#1655</a>)</p></li>
<li><p>Connector’s <cite>limit</cite> parameter indicates total concurrent connections.
New <cite>limit_per_host</cite> added, indicates total connections per endpoint. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1601">#1601</a>)</p></li>
<li><p>Use url’s <cite>raw_host</cite> for name resolution (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1685">#1685</a>)</p></li>
<li><p>Change <cite>ClientResponse.url</cite> to <cite>yarl.URL</cite> instance (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1654">#1654</a>)</p></li>
<li><p>Add max_size parameter to web.Request reading methods (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1133">#1133</a>)</p></li>
<li><p>Web Request.post() stores data in temp files (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1469">#1469</a>)</p></li>
<li><p>Add the <cite>allow_head=True</cite> keyword argument for <cite>add_get</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1618">#1618</a>)</p></li>
<li><p><cite>run_app</cite> and the Command Line Interface now support serving over
Unix domain sockets for faster inter-process communication.</p></li>
<li><p><cite>run_app</cite> now supports passing a preexisting socket object. This can be useful
e.g. for socket-based activated applications, when binding of a socket is
done by the parent process.</p></li>
<li><p>Implementation for Trailer headers parser is broken (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1619">#1619</a>)</p></li>
<li><p>Fix FileResponse to not fall on bad request (range out of file size)</p></li>
<li><p>Fix FileResponse to correct stream video to Chromes</p></li>
<li><p>Deprecate public low-level api (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1657">#1657</a>)</p></li>
<li><p>Deprecate <cite>encoding</cite> parameter for ClientSession.request() method</p></li>
<li><p>Dropped aiohttp.wsgi (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1108">#1108</a>)</p></li>
<li><p>Dropped <cite>version</cite> from ClientSession.request() method</p></li>
<li><p>Dropped websocket version 76 support (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1160">#1160</a>)</p></li>
<li><p>Dropped: <cite>aiohttp.protocol.HttpPrefixParser</cite>  (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1590">#1590</a>)</p></li>
<li><p>Dropped: Servers response’s <cite>.started</cite>, <cite>.start()</cite> and
<cite>.can_start()</cite> method (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1591">#1591</a>)</p></li>
<li><p>Dropped:  Adding <cite>sub app</cite> via <cite>app.router.add_subapp()</cite> is deprecated
use <cite>app.add_subapp()</cite> instead (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1592">#1592</a>)</p></li>
<li><p>Dropped: <cite>Application.finish()</cite> and <cite>Application.register_on_finish()</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1602">#1602</a>)</p></li>
<li><p>Dropped: <cite>web.Request.GET</cite> and <cite>web.Request.POST</cite></p></li>
<li><p>Dropped: aiohttp.get(), aiohttp.options(), aiohttp.head(),
aiohttp.post(), aiohttp.put(), aiohttp.patch(), aiohttp.delete(), and
aiohttp.ws_connect() (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1593">#1593</a>)</p></li>
<li><p>Dropped: <cite>aiohttp.web.WebSocketResponse.receive_msg()</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1605">#1605</a>)</p></li>
<li><p>Dropped: <cite>ServerHttpProtocol.keep_alive_timeout</cite> attribute and
<cite>keep-alive</cite>, <cite>keep_alive_on</cite>, <cite>timeout</cite>, <cite>log</cite> constructor parameters (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1606">#1606</a>)</p></li>
<li><p>Dropped: <cite>TCPConnector’s`</cite> <cite>.resolve</cite>, <cite>.resolved_hosts</cite>,
<cite>.clear_resolved_hosts()</cite> attributes and <cite>resolve</cite> constructor
parameter (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1607">#1607</a>)</p></li>
<li><p>Dropped <cite>ProxyConnector</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1609">#1609</a>)</p></li>
</ul>
</div>
<div class="section" id="id564">
<h5>1.3.5 (2017-03-16)<a class="headerlink" href="#id564" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fixed None timeout support (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1720">#1720</a>)</p></li>
</ul>
</div>
<div class="section" id="id566">
<h5>1.3.4 (2017-03-14)<a class="headerlink" href="#id566" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Revert timeout handling in client request</p></li>
<li><p>Fix StreamResponse representation after eof</p></li>
<li><p>Fix file_sender to not fall on bad request (range out of file size)</p></li>
<li><p>Fix file_sender to correct stream video to Chromes</p></li>
<li><p>Fix NotImplementedError server exception (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1703">#1703</a>)</p></li>
<li><p>Clearer error message for URL without a host name. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1691">#1691</a>)</p></li>
<li><p>Silence deprecation warning in __repr__ (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1690">#1690</a>)</p></li>
<li><p>IDN + HTTPS = <cite>ssl.CertificateError</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1685">#1685</a>)</p></li>
</ul>
</div>
<div class="section" id="id571">
<h5>1.3.3 (2017-02-19)<a class="headerlink" href="#id571" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fixed memory leak in time service (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1656">#1656</a>)</p></li>
</ul>
</div>
<div class="section" id="id573">
<h5>1.3.2 (2017-02-16)<a class="headerlink" href="#id573" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Awaiting on WebSocketResponse.send_* does not work (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1645">#1645</a>)</p></li>
<li><p>Fix multiple calls to client ws_connect when using a shared header
dict (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1643">#1643</a>)</p></li>
<li><p>Make CookieJar.filter_cookies() accept plain string parameter. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1636">#1636</a>)</p></li>
</ul>
</div>
<div class="section" id="id577">
<h5>1.3.1 (2017-02-09)<a class="headerlink" href="#id577" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Handle CLOSING in WebSocketResponse.__anext__</p></li>
<li><p>Fixed AttributeError ‘drain’ for server websocket handler (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1613">#1613</a>)</p></li>
</ul>
</div>
<div class="section" id="id579">
<h5>1.3.0 (2017-02-08)<a class="headerlink" href="#id579" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Multipart writer validates the data on append instead of on a
request send (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/920">#920</a>)</p></li>
<li><p>Multipart reader accepts multipart messages with or without their epilogue
to consistently handle valid and legacy behaviors (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1526">#1526</a>) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1581">#1581</a>)</p></li>
<li><p>Separate read + connect + request timeouts # 1523</p></li>
<li><p>Do not swallow Upgrade header (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1587">#1587</a>)</p></li>
<li><p>Fix polls demo run application (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1487">#1487</a>)</p></li>
<li><p>Ignore unknown 1XX status codes in client (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1353">#1353</a>)</p></li>
<li><p>Fix sub-Multipart messages missing their headers on serialization (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1525">#1525</a>)</p></li>
<li><p>Do not use readline when reading the content of a part
in the multipart reader (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1535">#1535</a>)</p></li>
<li><p>Add optional flag for quoting <cite>FormData</cite> fields (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/916">#916</a>)</p></li>
<li><p>416 Range Not Satisfiable if requested range end &gt; file size (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1588">#1588</a>)</p></li>
<li><p>Having a <cite>:</cite> or <cite>&#64;</cite> in a route does not work (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1552">#1552</a>)</p></li>
<li><p>Added <cite>receive_timeout</cite> timeout for websocket to receive complete
message. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1325">#1325</a>)</p></li>
<li><p>Added <cite>heartbeat</cite> parameter for websocket to automatically send
<cite>ping</cite> message. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1024">#1024</a>) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/777">#777</a>)</p></li>
<li><p>Remove <cite>web.Application</cite> dependency from <cite>web.UrlDispatcher</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1510">#1510</a>)</p></li>
<li><p>Accepting back-pressure from slow websocket clients (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1367">#1367</a>)</p></li>
<li><p>Do not pause transport during set_parser stage (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1211">#1211</a>)</p></li>
<li><p>Lingering close does not terminate before timeout (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1559">#1559</a>)</p></li>
<li><p><cite>setsockopt</cite> may raise <cite>OSError</cite> exception if socket is closed already (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1595">#1595</a>)</p></li>
<li><p>Lots of CancelledError when requests are interrupted (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1565">#1565</a>)</p></li>
<li><p>Allow users to specify what should happen to decoding errors
when calling a responses <cite>text()</cite> method (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1542">#1542</a>)</p></li>
<li><p>Back port std module <cite>http.cookies</cite> for python3.4.2 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1566">#1566</a>)</p></li>
<li><p>Maintain url’s fragment in client response (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1314">#1314</a>)</p></li>
<li><p>Allow concurrently close WebSocket connection (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/754">#754</a>)</p></li>
<li><p>Gzipped responses with empty body raises ContentEncodingError (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/609">#609</a>)</p></li>
<li><p>Return 504 if request handle raises TimeoutError.</p></li>
<li><p>Refactor how we use keep-alive and close lingering timeouts.</p></li>
<li><p>Close response connection if we can not consume whole http
message during client response release</p></li>
<li><p>Abort closed ssl client transports, broken servers can keep socket
open un-limit time (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1568">#1568</a>)</p></li>
<li><p>Log warning instead of <cite>RuntimeError</cite> is websocket connection is closed.</p></li>
<li><p>Deprecated: <cite>aiohttp.protocol.HttpPrefixParser</cite>
will be removed in 1.4 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1590">#1590</a>)</p></li>
<li><p>Deprecated: Servers response’s <cite>.started</cite>, <cite>.start()</cite> and
<cite>.can_start()</cite> method will be removed in 1.4 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1591">#1591</a>)</p></li>
<li><p>Deprecated: Adding <cite>sub app</cite> via <cite>app.router.add_subapp()</cite> is deprecated
use <cite>app.add_subapp()</cite> instead, will be removed in 1.4 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1592">#1592</a>)</p></li>
<li><p>Deprecated: aiohttp.get(), aiohttp.options(), aiohttp.head(), aiohttp.post(),
aiohttp.put(), aiohttp.patch(), aiohttp.delete(), and aiohttp.ws_connect()
will be removed in 1.4 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1593">#1593</a>)</p></li>
<li><p>Deprecated: <cite>Application.finish()</cite> and <cite>Application.register_on_finish()</cite>
will be removed in 1.4 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1602">#1602</a>)</p></li>
</ul>
</div>
<div class="section" id="id611">
<h5>1.2.0 (2016-12-17)<a class="headerlink" href="#id611" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Extract <cite>BaseRequest</cite> from <cite>web.Request</cite>, introduce <cite>web.Server</cite>
(former <cite>RequestHandlerFactory</cite>), introduce new low-level web server
which is not coupled with <cite>web.Application</cite> and routing (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1362">#1362</a>)</p></li>
<li><p>Make <cite>TestServer.make_url</cite> compatible with <cite>yarl.URL</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1389">#1389</a>)</p></li>
<li><p>Implement range requests for static files (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1382">#1382</a>)</p></li>
<li><p>Support task attribute for StreamResponse (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1410">#1410</a>)</p></li>
<li><p>Drop <cite>TestClient.app</cite> property, use <cite>TestClient.server.app</cite> instead
(BACKWARD INCOMPATIBLE)</p></li>
<li><p>Drop <cite>TestClient.handler</cite> property, use <cite>TestClient.server.handler</cite> instead
(BACKWARD INCOMPATIBLE)</p></li>
<li><p><cite>TestClient.server</cite> property returns a test server instance, was
<cite>asyncio.AbstractServer</cite> (BACKWARD INCOMPATIBLE)</p></li>
<li><p>Follow gunicorn’s signal semantics in <cite>Gunicorn[UVLoop]WebWorker</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1201">#1201</a>)</p></li>
<li><p>Call worker_int and worker_abort callbacks in
<cite>Gunicorn[UVLoop]WebWorker</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1202">#1202</a>)</p></li>
<li><p>Has functional tests for client proxy (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1218">#1218</a>)</p></li>
<li><p>Fix bugs with client proxy target path and proxy host with port (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1413">#1413</a>)</p></li>
<li><p>Fix bugs related to the use of unicode hostnames (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1444">#1444</a>)</p></li>
<li><p>Preserve cookie quoting/escaping (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1453">#1453</a>)</p></li>
<li><p>FileSender will send gzipped response if gzip version available (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1426">#1426</a>)</p></li>
<li><p>Don’t override <cite>Content-Length</cite> header in <cite>web.Response</cite> if no body
was set (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1400">#1400</a>)</p></li>
<li><p>Introduce <cite>router.post_init()</cite> for solving (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1373">#1373</a>)</p></li>
<li><p>Fix raise error in case of multiple calls of <cite>TimeServive.stop()</cite></p></li>
<li><p>Allow to raise web exceptions on router resolving stage (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1460">#1460</a>)</p></li>
<li><p>Add a warning for session creation outside of coroutine (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1468">#1468</a>)</p></li>
<li><p>Avoid a race when application might start accepting incoming requests
but startup signals are not processed yet e98e8c6</p></li>
<li><p>Raise a <cite>RuntimeError</cite> when trying to change the status of the HTTP response
after the headers have been sent (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1480">#1480</a>)</p></li>
<li><p>Fix bug with https proxy acquired cleanup (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1340">#1340</a>)</p></li>
<li><p>Use UTF-8 as the default encoding for multipart text parts (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1484">#1484</a>)</p></li>
</ul>
</div>
<div class="section" id="id630">
<h5>1.1.6 (2016-11-28)<a class="headerlink" href="#id630" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix <cite>BodyPartReader.read_chunk</cite> bug about returns zero bytes before
<cite>EOF</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1428">#1428</a>)</p></li>
</ul>
</div>
<div class="section" id="id632">
<h5>1.1.5 (2016-11-16)<a class="headerlink" href="#id632" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix static file serving in fallback mode (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1401">#1401</a>)</p></li>
</ul>
</div>
<div class="section" id="id634">
<h5>1.1.4 (2016-11-14)<a class="headerlink" href="#id634" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Make <cite>TestServer.make_url</cite> compatible with <cite>yarl.URL</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1389">#1389</a>)</p></li>
<li><p>Generate informative exception on redirects from server which
does not provide redirection headers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1396">#1396</a>)</p></li>
</ul>
</div>
<div class="section" id="id637">
<h5>1.1.3 (2016-11-10)<a class="headerlink" href="#id637" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Support <em>root</em> resources for sub-applications (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1379">#1379</a>)</p></li>
</ul>
</div>
<div class="section" id="id639">
<h5>1.1.2 (2016-11-08)<a class="headerlink" href="#id639" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Allow starting variables with an underscore (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1379">#1379</a>)</p></li>
<li><p>Properly process UNIX sockets by gunicorn worker (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1375">#1375</a>)</p></li>
<li><p>Fix ordering for <cite>FrozenList</cite></p></li>
<li><p>Don’t propagate pre and post signals to sub-application (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1377">#1377</a>)</p></li>
</ul>
</div>
<div class="section" id="id643">
<h5>1.1.1 (2016-11-04)<a class="headerlink" href="#id643" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix documentation generation (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1120">#1120</a>)</p></li>
</ul>
</div>
<div class="section" id="id645">
<h5>1.1.0 (2016-11-03)<a class="headerlink" href="#id645" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p>Drop deprecated <cite>WSClientDisconnectedError</cite> (BACKWARD INCOMPATIBLE)</p></li>
<li><p>Use <cite>yarl.URL</cite> in client API. The change is 99% backward compatible
but <cite>ClientResponse.url</cite> is an <cite>yarl.URL</cite> instance now. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1217">#1217</a>)</p></li>
<li><p>Close idle keep-alive connections on shutdown (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1222">#1222</a>)</p></li>
<li><p>Modify regex in AccessLogger to accept underscore and numbers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1225">#1225</a>)</p></li>
<li><p>Use <cite>yarl.URL</cite> in web server API. <cite>web.Request.rel_url</cite> and
<cite>web.Request.url</cite> are added. URLs and templates are percent-encoded
now. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1224">#1224</a>)</p></li>
<li><p>Accept <cite>yarl.URL</cite> by server redirections (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1278">#1278</a>)</p></li>
<li><p>Return <cite>yarl.URL</cite> by <cite>.make_url()</cite> testing utility (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1279">#1279</a>)</p></li>
<li><p>Properly format IPv6 addresses by <cite>aiohttp.web.run_app</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1139">#1139</a>)</p></li>
<li><p>Use <cite>yarl.URL</cite> by server API (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1288">#1288</a>)</p>
<ul class="simple">
<li><p>Introduce <cite>resource.url_for()</cite>, deprecate <cite>resource.url()</cite>.</p></li>
<li><p>Implement <cite>StaticResource</cite>.</p></li>
<li><p>Inherit <cite>SystemRoute</cite> from <cite>AbstractRoute</cite></p></li>
<li><p>Drop old-style routes: <cite>Route</cite>, <cite>PlainRoute</cite>, <cite>DynamicRoute</cite>,
<cite>StaticRoute</cite>, <cite>ResourceAdapter</cite>.</p></li>
</ul>
</li>
<li><p>Revert <cite>resp.url</cite> back to <cite>str</cite>, introduce <cite>resp.url_obj</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1292">#1292</a>)</p></li>
<li><p>Raise ValueError if BasicAuth login has a “:” character (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1307">#1307</a>)</p></li>
<li><p>Fix bug when ClientRequest send payload file with opened as
open(‘filename’, ‘r+b’) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1306">#1306</a>)</p></li>
<li><p>Enhancement to AccessLogger (pass <em>extra</em> dict) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1303">#1303</a>)</p></li>
<li><p>Show more verbose message on import errors (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1319">#1319</a>)</p></li>
<li><p>Added save and load functionality for <cite>CookieJar</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1219">#1219</a>)</p></li>
<li><p>Added option on <cite>StaticRoute</cite> to follow symlinks (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1299">#1299</a>)</p></li>
<li><p>Force encoding of <cite>application/json</cite> content type to utf-8 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1339">#1339</a>)</p></li>
<li><p>Fix invalid invocations of <cite>errors.LineTooLong</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1335">#1335</a>)</p></li>
<li><p>Websockets: Stop <cite>async for</cite> iteration when connection is closed (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1144">#1144</a>)</p></li>
<li><p>Ensure TestClient HTTP methods return a context manager (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1318">#1318</a>)</p></li>
<li><p>Raise <cite>ClientDisconnectedError</cite> to <cite>FlowControlStreamReader</cite> read function
if <cite>ClientSession</cite> object is closed by client when reading data. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1323">#1323</a>)</p></li>
<li><p>Document deployment without <cite>Gunicorn</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1120">#1120</a>)</p></li>
<li><p>Add deprecation warning for MD5 and SHA1 digests when used for fingerprint
of site certs in TCPConnector. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1186">#1186</a>)</p></li>
<li><p>Implement sub-applications (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1301">#1301</a>)</p></li>
<li><p>Don’t inherit <cite>web.Request</cite> from <cite>dict</cite> but implement
<cite>MutableMapping</cite> protocol.</p></li>
<li><p>Implement frozen signals</p></li>
<li><p>Don’t inherit <cite>web.Application</cite> from <cite>dict</cite> but implement
<cite>MutableMapping</cite> protocol.</p></li>
<li><p>Support freezing for web applications</p></li>
<li><p>Accept access_log parameter in <cite>web.run_app</cite>, use <cite>None</cite> to disable logging</p></li>
<li><p>Don’t flap <cite>tcp_cork</cite> and <cite>tcp_nodelay</cite> in regular request handling.
<cite>tcp_nodelay</cite> is still enabled by default.</p></li>
<li><p>Improve performance of web server by removing premature computing of
Content-Type if the value was set by <cite>web.Response</cite> constructor.</p>
<p>While the patch boosts speed of trivial <cite>web.Response(text=’OK’,
content_type=’text/plain)</cite> very well please don’t expect significant
boost of your application – a couple DB requests and business logic
is still the main bottleneck.</p>
</li>
<li><p>Boost performance by adding a custom time service (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1350">#1350</a>)</p></li>
<li><p>Extend <cite>ClientResponse</cite> with <cite>content_type</cite> and <cite>charset</cite>
properties like in <cite>web.Request</cite>. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1349">#1349</a>)</p></li>
<li><p>Disable aiodns by default (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/559">#559</a>)</p></li>
<li><p>Don’t flap <cite>tcp_cork</cite> in client code, use TCP_NODELAY mode by default.</p></li>
<li><p>Implement <cite>web.Request.clone()</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1361">#1361</a>)</p></li>
</ul>
</div>
<div class="section" id="id673">
<h5>1.0.5 (2016-10-11)<a class="headerlink" href="#id673" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix StreamReader._read_nowait to return all available
data up to the requested amount (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1297">#1297</a>)</p></li>
</ul>
</div>
<div class="section" id="id675">
<h5>1.0.4 (2016-09-22)<a class="headerlink" href="#id675" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix FlowControlStreamReader.read_nowait so that it checks
whether the transport is paused (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1206">#1206</a>)</p></li>
</ul>
</div>
<div class="section" id="id677">
<h5>1.0.2 (2016-09-22)<a class="headerlink" href="#id677" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Make CookieJar compatible with 32-bit systems (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1188">#1188</a>)</p></li>
<li><p>Add missing <cite>WSMsgType</cite> to <cite>web_ws.__all__</cite>, see (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1200">#1200</a>)</p></li>
<li><p>Fix <cite>CookieJar</cite> ctor when called with <cite>loop=None</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1203">#1203</a>)</p></li>
<li><p>Fix broken upper-casing in wsgi support (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1197">#1197</a>)</p></li>
</ul>
</div>
<div class="section" id="id682">
<h5>1.0.1 (2016-09-16)<a class="headerlink" href="#id682" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Restore <cite>aiohttp.web.MsgType</cite> alias for <cite>aiohttp.WSMsgType</cite> for sake
of backward compatibility (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1178">#1178</a>)</p></li>
<li><p>Tune alabaster schema.</p></li>
<li><p>Use <cite>text/html</cite> content type for displaying index pages by static
file handler.</p></li>
<li><p>Fix <cite>AssertionError</cite> in static file handling (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1177">#1177</a>)</p></li>
<li><p>Fix access log formats <cite>%O</cite> and <cite>%b</cite> for static file handling</p></li>
<li><p>Remove <cite>debug</cite> setting of GunicornWorker, use <cite>app.debug</cite>
to control its debug-mode instead</p></li>
</ul>
</div>
<div class="section" id="id685">
<h5>1.0.0 (2016-09-16)<a class="headerlink" href="#id685" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Change default size for client session’s connection pool from
unlimited to 20 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/977">#977</a>)</p></li>
<li><p>Add IE support for cookie deletion. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/994">#994</a>)</p></li>
<li><p>Remove deprecated <cite>WebSocketResponse.wait_closed</cite> method (BACKWARD
INCOMPATIBLE)</p></li>
<li><p>Remove deprecated <cite>force</cite> parameter for <cite>ClientResponse.close</cite>
method (BACKWARD INCOMPATIBLE)</p></li>
<li><p>Avoid using of mutable CIMultiDict kw param in make_mocked_request
(<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/997">#997</a>)</p></li>
<li><p>Make WebSocketResponse.close a little bit faster by avoiding new
task creating just for timeout measurement</p></li>
<li><p>Add <cite>proxy</cite> and <cite>proxy_auth</cite> params to <cite>client.get()</cite> and family,
deprecate <cite>ProxyConnector</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/998">#998</a>)</p></li>
<li><p>Add support for websocket send_json and receive_json, synchronize
server and client API for websockets (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/984">#984</a>)</p></li>
<li><p>Implement router shourtcuts for most useful HTTP methods, use
<cite>app.router.add_get()</cite>, <cite>app.router.add_post()</cite> etc. instead of
<cite>app.router.add_route()</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/986">#986</a>)</p></li>
<li><p>Support SSL connections for gunicorn worker (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1003">#1003</a>)</p></li>
<li><p>Move obsolete examples to legacy folder</p></li>
<li><p>Switch to multidict 2.0 and title-cased strings (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1015">#1015</a>)</p></li>
<li><p><cite>{FOO}e</cite> logger format is case-sensitive now</p></li>
<li><p>Fix logger report for unix socket 8e8469b</p></li>
<li><p>Rename aiohttp.websocket to aiohttp._ws_impl</p></li>
<li><p>Rename aiohttp.MsgType tp aiohttp.WSMsgType</p></li>
<li><p>Introduce aiohttp.WSMessage officially</p></li>
<li><p>Rename Message -&gt; WSMessage</p></li>
<li><p>Remove deprecated decode param from resp.read(decode=True)</p></li>
<li><p>Use 5min default client timeout (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1028">#1028</a>)</p></li>
<li><p>Relax HTTP method validation in UrlDispatcher (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1037">#1037</a>)</p></li>
<li><p>Pin minimal supported asyncio version to 3.4.2+ (<cite>loop.is_close()</cite>
should be present)</p></li>
<li><p>Remove aiohttp.websocket module (BACKWARD INCOMPATIBLE)
Please use high-level client and server approaches</p></li>
<li><p>Link header for 451 status code is mandatory</p></li>
<li><p>Fix test_client fixture to allow multiple clients per test (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1072">#1072</a>)</p></li>
<li><p>make_mocked_request now accepts dict as headers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1073">#1073</a>)</p></li>
<li><p>Add Python 3.5.2/3.6+ compatibility patch for async generator
protocol change (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1082">#1082</a>)</p></li>
<li><p>Improvement test_client can accept instance object (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1083">#1083</a>)</p></li>
<li><p>Simplify ServerHttpProtocol implementation (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1060">#1060</a>)</p></li>
<li><p>Add a flag for optional showing directory index for static file
handling (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/921">#921</a>)</p></li>
<li><p>Define <cite>web.Application.on_startup()</cite> signal handler (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1103">#1103</a>)</p></li>
<li><p>Drop ChunkedParser and LinesParser (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1111">#1111</a>)</p></li>
<li><p>Call <cite>Application.startup</cite> in GunicornWebWorker (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1105">#1105</a>)</p></li>
<li><p>Fix client handling hostnames with 63 bytes when a port is given in
the url (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1044">#1044</a>)</p></li>
<li><p>Implement proxy support for ClientSession.ws_connect (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1025">#1025</a>)</p></li>
<li><p>Return named tuple from WebSocketResponse.can_prepare (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1016">#1016</a>)</p></li>
<li><p>Fix access_log_format in <cite>GunicornWebWorker</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1117">#1117</a>)</p></li>
<li><p>Setup Content-Type to application/octet-stream by default (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1124">#1124</a>)</p></li>
<li><p>Deprecate debug parameter from app.make_handler(), use
<cite>Application(debug=True)</cite> instead (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1121">#1121</a>)</p></li>
<li><p>Remove fragment string in request path (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/846">#846</a>)</p></li>
<li><p>Use aiodns.DNSResolver.gethostbyname() if available (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1136">#1136</a>)</p></li>
<li><p>Fix static file sending on uvloop when sendfile is available (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1093">#1093</a>)</p></li>
<li><p>Make prettier urls if query is empty dict (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1143">#1143</a>)</p></li>
<li><p>Fix redirects for HEAD requests (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1147">#1147</a>)</p></li>
<li><p>Default value for <cite>StreamReader.read_nowait</cite> is -1 from now (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1150">#1150</a>)</p></li>
<li><p><cite>aiohttp.StreamReader</cite> is not inherited from <cite>asyncio.StreamReader</cite> from now
(BACKWARD INCOMPATIBLE) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1150">#1150</a>)</p></li>
<li><p>Streams documentation added (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1150">#1150</a>)</p></li>
<li><p>Add <cite>multipart</cite> coroutine method for web Request object (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1067">#1067</a>)</p></li>
<li><p>Publish ClientSession.loop property (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1149">#1149</a>)</p></li>
<li><p>Fix static file with spaces (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1140">#1140</a>)</p></li>
<li><p>Fix piling up asyncio loop by cookie expiration callbacks (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1061">#1061</a>)</p></li>
<li><p>Drop <cite>Timeout</cite> class for sake of <cite>async_timeout</cite> external library.
<cite>aiohttp.Timeout</cite> is an alias for <cite>async_timeout.timeout</cite></p></li>
<li><p><cite>use_dns_cache</cite> parameter of <cite>aiohttp.TCPConnector</cite> is <cite>True</cite> by
default (BACKWARD INCOMPATIBLE) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1152">#1152</a>)</p></li>
<li><p><cite>aiohttp.TCPConnector</cite> uses asynchronous DNS resolver if available by
default (BACKWARD INCOMPATIBLE) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1152">#1152</a>)</p></li>
<li><p>Conform to RFC3986 - do not include url fragments in client requests (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1174">#1174</a>)</p></li>
<li><p>Drop <cite>ClientSession.cookies</cite> (BACKWARD INCOMPATIBLE) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1173">#1173</a>)</p></li>
<li><p>Refactor <cite>AbstractCookieJar</cite> public API (BACKWARD INCOMPATIBLE) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1173">#1173</a>)</p></li>
<li><p>Fix clashing cookies with have the same name but belong to different
domains (BACKWARD INCOMPATIBLE) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1125">#1125</a>)</p></li>
<li><p>Support binary Content-Transfer-Encoding (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1169">#1169</a>)</p></li>
</ul>
</div>
<div class="section" id="id730">
<h5>0.22.5 (08-02-2016)<a class="headerlink" href="#id730" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Pin miltidict version to &gt;=1.2.2</p></li>
</ul>
</div>
<div class="section" id="id731">
<h5>0.22.3 (07-26-2016)<a class="headerlink" href="#id731" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Do not filter cookies if unsafe flag provided (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/1005">#1005</a>)</p></li>
</ul>
</div>
<div class="section" id="id733">
<h5>0.22.2 (07-23-2016)<a class="headerlink" href="#id733" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Suppress CancelledError when Timeout raises TimeoutError (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/970">#970</a>)</p></li>
<li><p>Don’t expose <cite>aiohttp.__version__</cite></p></li>
<li><p>Add unsafe parameter to CookieJar (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/968">#968</a>)</p></li>
<li><p>Use unsafe cookie jar in test client tools</p></li>
<li><p>Expose aiohttp.CookieJar name</p></li>
</ul>
</div>
<div class="section" id="id736">
<h5>0.22.1 (07-16-2016)<a class="headerlink" href="#id736" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Large cookie expiration/max-age does not break an event loop from now
(fixes (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/967">#967</a>))</p></li>
</ul>
</div>
<div class="section" id="id738">
<h5>0.22.0 (07-15-2016)<a class="headerlink" href="#id738" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix bug in serving static directory (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/803">#803</a>)</p></li>
<li><p>Fix command line arg parsing (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/797">#797</a>)</p></li>
<li><p>Fix a documentation chapter about cookie usage (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/790">#790</a>)</p></li>
<li><p>Handle empty body with gzipped encoding (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/758">#758</a>)</p></li>
<li><p>Support 451 Unavailable For Legal Reasons http status  (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/697">#697</a>)</p></li>
<li><p>Fix Cookie share example and few small typos in docs (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/817">#817</a>)</p></li>
<li><p>UrlDispatcher.add_route with partial coroutine handler (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/814">#814</a>)</p></li>
<li><p>Optional support for aiodns (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/728">#728</a>)</p></li>
<li><p>Add ServiceRestart and TryAgainLater websocket close codes (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/828">#828</a>)</p></li>
<li><p>Fix prompt message for <cite>web.run_app</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/832">#832</a>)</p></li>
<li><p>Allow to pass None as a timeout value to disable timeout logic (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/834">#834</a>)</p></li>
<li><p>Fix leak of connection slot during connection error (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/835">#835</a>)</p></li>
<li><p>Gunicorn worker with uvloop support
<cite>aiohttp.worker.GunicornUVLoopWebWorker</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/878">#878</a>)</p></li>
<li><p>Don’t send body in response to HEAD request (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/838">#838</a>)</p></li>
<li><p>Skip the preamble in MultipartReader (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/881">#881</a>)</p></li>
<li><p>Implement BasicAuth decode classmethod. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/744">#744</a>)</p></li>
<li><p>Don’t crash logger when transport is None (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/889">#889</a>)</p></li>
<li><p>Use a create_future compatibility wrapper instead of creating
Futures directly (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/896">#896</a>)</p></li>
<li><p>Add test utilities to aiohttp (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/902">#902</a>)</p></li>
<li><p>Improve Request.__repr__ (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/875">#875</a>)</p></li>
<li><p>Skip DNS resolving if provided host is already an ip address (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/874">#874</a>)</p></li>
<li><p>Add headers to ClientSession.ws_connect (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/785">#785</a>)</p></li>
<li><p>Document that server can send pre-compressed data (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/906">#906</a>)</p></li>
<li><p>Don’t add Content-Encoding and Transfer-Encoding if no body (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/891">#891</a>)</p></li>
<li><p>Add json() convenience methods to websocket message objects (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/897">#897</a>)</p></li>
<li><p>Add client_resp.raise_for_status() (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/908">#908</a>)</p></li>
<li><p>Implement cookie filter (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/799">#799</a>)</p></li>
<li><p>Include an example of middleware to handle error pages (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/909">#909</a>)</p></li>
<li><p>Fix error handling in StaticFileMixin (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/856">#856</a>)</p></li>
<li><p>Add mocked request helper (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/900">#900</a>)</p></li>
<li><p>Fix empty ALLOW Response header for cls based View (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/929">#929</a>)</p></li>
<li><p>Respect CONNECT method to implement a proxy server (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/847">#847</a>)</p></li>
<li><p>Add pytest_plugin (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/914">#914</a>)</p></li>
<li><p>Add tutorial</p></li>
<li><p>Add backlog option to support more than 128 (default value in
“create_server” function) concurrent connections (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/892">#892</a>)</p></li>
<li><p>Allow configuration of header size limits (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/912">#912</a>)</p></li>
<li><p>Separate sending file logic from StaticRoute dispatcher (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/901">#901</a>)</p></li>
<li><p>Drop deprecated share_cookies connector option (BACKWARD INCOMPATIBLE)</p></li>
<li><p>Drop deprecated support for tuple as auth parameter.
Use aiohttp.BasicAuth instead (BACKWARD INCOMPATIBLE)</p></li>
<li><p>Remove deprecated <cite>request.payload</cite> property, use <cite>content</cite> instead.
(BACKWARD INCOMPATIBLE)</p></li>
<li><p>Drop all mentions about api changes in documentation for versions
older than 0.16</p></li>
<li><p>Allow to override default cookie jar (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/963">#963</a>)</p></li>
<li><p>Add manylinux wheel builds</p></li>
<li><p>Dup a socket for sendfile usage (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/964">#964</a>)</p></li>
</ul>
</div>
<div class="section" id="id777">
<h5>0.21.6 (05-05-2016)<a class="headerlink" href="#id777" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Drop initial query parameters on redirects (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/853">#853</a>)</p></li>
</ul>
</div>
<div class="section" id="id779">
<h5>0.21.5 (03-22-2016)<a class="headerlink" href="#id779" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix command line arg parsing (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/797">#797</a>)</p></li>
</ul>
</div>
<div class="section" id="id781">
<h5>0.21.4 (03-12-2016)<a class="headerlink" href="#id781" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix ResourceAdapter: don’t add method to allowed if resource is not
match (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/826">#826</a>)</p></li>
<li><p>Fix Resource: append found method to returned allowed methods</p></li>
</ul>
</div>
<div class="section" id="id783">
<h5>0.21.2 (02-16-2016)<a class="headerlink" href="#id783" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix a regression: support for handling ~/path in static file routes was
broken (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/782">#782</a>)</p></li>
</ul>
</div>
<div class="section" id="id785">
<h5>0.21.1 (02-10-2016)<a class="headerlink" href="#id785" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Make new resources classes public (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/767">#767</a>)</p></li>
<li><p>Add <cite>router.resources()</cite> view</p></li>
<li><p>Fix cmd-line parameter names in doc</p></li>
</ul>
</div>
<div class="section" id="id787">
<h5>0.21.0 (02-04-2016)<a class="headerlink" href="#id787" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p>Introduce on_shutdown signal (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/722">#722</a>)</p></li>
<li><p>Implement raw input headers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/726">#726</a>)</p></li>
<li><p>Implement web.run_app utility function (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/734">#734</a>)</p></li>
<li><p>Introduce on_cleanup signal</p></li>
<li><p>Deprecate Application.finish() / Application.register_on_finish() in favor of
on_cleanup.</p></li>
<li><p>Get rid of bare aiohttp.request(), aiohttp.get() and family in docs (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/729">#729</a>)</p></li>
<li><p>Deprecate bare aiohttp.request(), aiohttp.get() and family (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/729">#729</a>)</p></li>
<li><p>Refactor keep-alive support (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/737">#737</a>):</p>
<ul>
<li><p>Enable keepalive for HTTP 1.0 by default</p></li>
<li><p>Disable it for HTTP 0.9 (who cares about 0.9, BTW?)</p></li>
<li><p>For keepalived connections</p>
<blockquote>
<div><ul class="simple">
<li><p>Send <cite>Connection: keep-alive</cite> for HTTP 1.0 only</p></li>
<li><p>don’t send <cite>Connection</cite> header for HTTP 1.1</p></li>
</ul>
</div></blockquote>
</li>
<li><p>For non-keepalived connections</p>
<blockquote>
<div><ul class="simple">
<li><p>Send <cite>Connection: close</cite> for HTTP 1.1 only</p></li>
<li><p>don’t send <cite>Connection</cite> header for HTTP 1.0</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</li>
<li><p>Add version parameter to ClientSession constructor,
deprecate it for session.request() and family (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/736">#736</a>)</p></li>
<li><p>Enable access log by default (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/735">#735</a>)</p></li>
<li><p>Deprecate app.router.register_route() (the method was not documented
intentionally BTW).</p></li>
<li><p>Deprecate app.router.named_routes() in favor of app.router.named_resources()</p></li>
<li><p>route.add_static accepts pathlib.Path now (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/743">#743</a>)</p></li>
<li><p>Add command line support: <cite>$ python -m aiohttp.web package.main</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/740">#740</a>)</p></li>
<li><p>FAQ section was added to docs. Enjoy and fill free to contribute new topics</p></li>
<li><p>Add async context manager support to ClientSession</p></li>
<li><p>Document ClientResponse’s host, method, url properties</p></li>
<li><p>Use CORK/NODELAY in client API (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/748">#748</a>)</p></li>
<li><p>ClientSession.close and Connector.close are coroutines now</p></li>
<li><p>Close client connection on exception in ClientResponse.release()</p></li>
<li><p>Allow to read multipart parts without content-length specified (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/750">#750</a>)</p></li>
<li><p>Add support for unix domain sockets to gunicorn worker (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/470">#470</a>)</p></li>
<li><p>Add test for default Expect handler (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/601">#601</a>)</p></li>
<li><p>Add the first demo project</p></li>
<li><p>Rename <cite>loader</cite> keyword argument in <cite>web.Request.json</cite> method. (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/646">#646</a>)</p></li>
<li><p>Add local socket binding for TCPConnector (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/678">#678</a>)</p></li>
</ul>
</div>
<div class="section" id="id804">
<h5>0.20.2 (01-07-2016)<a class="headerlink" href="#id804" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Enable use of <cite>await</cite> for a class based view (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/717">#717</a>)</p></li>
<li><p>Check address family to fill wsgi env properly (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/718">#718</a>)</p></li>
<li><p>Fix memory leak in headers processing (thanks to Marco Paolini) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/723">#723</a>)</p></li>
</ul>
</div>
<div class="section" id="id808">
<h5>0.20.1 (12-30-2015)<a class="headerlink" href="#id808" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Raise RuntimeError is Timeout context manager was used outside of
task context.</p></li>
<li><p>Add number of bytes to stream.read_nowait (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/700">#700</a>)</p></li>
<li><p>Use X-FORWARDED-PROTO for wsgi.url_scheme when available</p></li>
</ul>
</div>
<div class="section" id="id810">
<h5>0.20.0 (12-28-2015)<a class="headerlink" href="#id810" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Extend list of web exceptions, add HTTPMisdirectedRequest,
HTTPUpgradeRequired, HTTPPreconditionRequired, HTTPTooManyRequests,
HTTPRequestHeaderFieldsTooLarge, HTTPVariantAlsoNegotiates,
HTTPNotExtended, HTTPNetworkAuthenticationRequired status codes (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/644">#644</a>)</p></li>
<li><p>Do not remove AUTHORIZATION header by WSGI handler (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/649">#649</a>)</p></li>
<li><p>Fix broken support for https proxies with authentication (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/617">#617</a>)</p></li>
<li><p>Get REMOTE_* and SEVER_* http vars from headers when listening on
unix socket (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/654">#654</a>)</p></li>
<li><p>Add HTTP 308 support (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/663">#663</a>)</p></li>
<li><p>Add Tf format (time to serve request in seconds, %06f format) to
access log (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/669">#669</a>)</p></li>
<li><p>Remove one and a half years long deprecated
ClientResponse.read_and_close() method</p></li>
<li><p>Optimize chunked encoding: use a single syscall instead of 3 calls
on sending chunked encoded data</p></li>
<li><p>Use TCP_CORK and TCP_NODELAY to optimize network latency and
throughput (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/680">#680</a>)</p></li>
<li><p>Websocket XOR performance improved (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/687">#687</a>)</p></li>
<li><p>Avoid sending cookie attributes in Cookie header (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/613">#613</a>)</p></li>
<li><p>Round server timeouts to seconds for grouping pending calls.  That
leads to less amount of poller syscalls e.g. epoll.poll(). (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/702">#702</a>)</p></li>
<li><p>Close connection on websocket handshake error (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/703">#703</a>)</p></li>
<li><p>Implement class based views (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/684">#684</a>)</p></li>
<li><p>Add <em>headers</em> parameter to ws_connect() (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/709">#709</a>)</p></li>
<li><p>Drop unused function <cite>parse_remote_addr()</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/708">#708</a>)</p></li>
<li><p>Close session on exception (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/707">#707</a>)</p></li>
<li><p>Store http code and headers in WSServerHandshakeError (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/706">#706</a>)</p></li>
<li><p>Make some low-level message properties readonly (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/710">#710</a>)</p></li>
</ul>
</div>
<div class="section" id="id828">
<h5>0.19.0 (11-25-2015)<a class="headerlink" href="#id828" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Memory leak in ParserBuffer (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/579">#579</a>)</p></li>
<li><p>Support gunicorn’s <cite>max_requests</cite> settings in gunicorn worker</p></li>
<li><p>Fix wsgi environment building (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/573">#573</a>)</p></li>
<li><p>Improve access logging (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/572">#572</a>)</p></li>
<li><p>Drop unused host and port from low-level server (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/586">#586</a>)</p></li>
<li><p>Add Python 3.5 <cite>async for</cite> implementation to server websocket (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/543">#543</a>)</p></li>
<li><p>Add Python 3.5 <cite>async for</cite> implementation to client websocket</p></li>
<li><p>Add Python 3.5 <cite>async with</cite> implementation to client websocket</p></li>
<li><p>Add charset parameter to web.Response constructor (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/593">#593</a>)</p></li>
<li><p>Forbid passing both Content-Type header and content_type or charset
params into web.Response constructor</p></li>
<li><p>Forbid duplicating of web.Application and web.Request (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/602">#602</a>)</p></li>
<li><p>Add an option to pass Origin header in ws_connect (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/607">#607</a>)</p></li>
<li><p>Add json_response function (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/592">#592</a>)</p></li>
<li><p>Make concurrent connections respect limits (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/581">#581</a>)</p></li>
<li><p>Collect history of responses if redirects occur (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/614">#614</a>)</p></li>
<li><p>Enable passing pre-compressed data in requests (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/621">#621</a>)</p></li>
<li><p>Expose named routes via UrlDispatcher.named_routes() (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/622">#622</a>)</p></li>
<li><p>Allow disabling sendfile by environment variable AIOHTTP_NOSENDFILE (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/629">#629</a>)</p></li>
<li><p>Use ensure_future if available</p></li>
<li><p>Always quote params for Content-Disposition (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/641">#641</a>)</p></li>
<li><p>Support async for in multipart reader (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/640">#640</a>)</p></li>
<li><p>Add Timeout context manager (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/611">#611</a>)</p></li>
</ul>
</div>
<div class="section" id="id846">
<h5>0.18.4 (13-11-2015)<a class="headerlink" href="#id846" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Relax rule for router names again by adding dash to allowed
characters: they may contain identifiers, dashes, dots and columns</p></li>
</ul>
</div>
<div class="section" id="id847">
<h5>0.18.3 (25-10-2015)<a class="headerlink" href="#id847" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix formatting for _RequestContextManager helper (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/590">#590</a>)</p></li>
</ul>
</div>
<div class="section" id="id849">
<h5>0.18.2 (22-10-2015)<a class="headerlink" href="#id849" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix regression for OpenSSL &lt; 1.0.0 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/583">#583</a>)</p></li>
</ul>
</div>
<div class="section" id="id851">
<h5>0.18.1 (20-10-2015)<a class="headerlink" href="#id851" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Relax rule for router names: they may contain dots and columns
starting from now</p></li>
</ul>
</div>
<div class="section" id="id852">
<h5>0.18.0 (19-10-2015)<a class="headerlink" href="#id852" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p>Use errors.HttpProcessingError.message as HTTP error reason and
message (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/459">#459</a>)</p></li>
<li><p>Optimize cythonized multidict a bit</p></li>
<li><p>Change repr’s of multidicts and multidict views</p></li>
<li><p>default headers in ClientSession are now case-insensitive</p></li>
<li><p>Make ‘=’ char and ‘wss://’ schema safe in urls (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/477">#477</a>)</p></li>
<li><p><cite>ClientResponse.close()</cite> forces connection closing by default from now (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/479">#479</a>)</p>
<p>N.B. Backward incompatible change: was <cite>.close(force=False) Using
`force</cite> parameter for the method is deprecated: use <cite>.release()</cite>
instead.</p>
</li>
<li><p>Properly requote URL’s path (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/480">#480</a>)</p></li>
<li><p>add <cite>skip_auto_headers</cite> parameter for client API (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/486">#486</a>)</p></li>
<li><p>Properly parse URL path in aiohttp.web.Request (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/489">#489</a>)</p></li>
<li><p>Raise RuntimeError when chunked enabled and HTTP is 1.0 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/488">#488</a>)</p></li>
<li><p>Fix a bug with processing io.BytesIO as data parameter for client API (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/500">#500</a>)</p></li>
<li><p>Skip auto-generation of Content-Type header (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/507">#507</a>)</p></li>
<li><p>Use sendfile facility for static file handling (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/503">#503</a>)</p></li>
<li><p>Default <cite>response_factory</cite> in <cite>app.router.add_static</cite> now is
<cite>StreamResponse</cite>, not <cite>None</cite>. The functionality is not changed if
default is not specified.</p></li>
<li><p>Drop <cite>ClientResponse.message</cite> attribute, it was always implementation detail.</p></li>
<li><p>Streams are optimized for speed and mostly memory in case of a big
HTTP message sizes (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/496">#496</a>)</p></li>
<li><p>Fix a bug for server-side cookies for dropping cookie and setting it
again without Max-Age parameter.</p></li>
<li><p>Don’t trim redirect URL in client API (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/499">#499</a>)</p></li>
<li><p>Extend precision of access log “D” to milliseconds (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/527">#527</a>)</p></li>
<li><p>Deprecate <cite>StreamResponse.start()</cite> method in favor of
<cite>StreamResponse.prepare()</cite> coroutine (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/525">#525</a>)</p>
<p><cite>.start()</cite> is still supported but responses begun with <cite>.start()</cite>
does not call signal for response preparing to be sent.</p>
</li>
<li><p>Add <cite>StreamReader.__repr__</cite></p></li>
<li><p>Drop Python 3.3 support, from now minimal required version is Python
3.4.1 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/541">#541</a>)</p></li>
<li><p>Add <cite>async with</cite> support for <cite>ClientSession.request()</cite> and family (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/536">#536</a>)</p></li>
<li><p>Ignore message body on 204 and 304 responses (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/505">#505</a>)</p></li>
<li><p><cite>TCPConnector</cite> processed both IPv4 and IPv6 by default (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/559">#559</a>)</p></li>
<li><p>Add <cite>.routes()</cite> view for urldispatcher (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/519">#519</a>)</p></li>
<li><p>Route name should be a valid identifier name from now (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/567">#567</a>)</p></li>
<li><p>Implement server signals (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/562">#562</a>)</p></li>
<li><p>Drop a year-old deprecated <em>files</em> parameter from client API.</p></li>
<li><p>Added <cite>async for</cite> support for aiohttp stream (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/542">#542</a>)</p></li>
</ul>
</div>
<div class="section" id="id875">
<h5>0.17.4 (09-29-2015)<a class="headerlink" href="#id875" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Properly parse URL path in aiohttp.web.Request (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/489">#489</a>)</p></li>
<li><p>Add missing coroutine decorator, the client api is await-compatible now</p></li>
</ul>
</div>
<div class="section" id="id877">
<h5>0.17.3 (08-28-2015)<a class="headerlink" href="#id877" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Remove Content-Length header on compressed responses (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/450">#450</a>)</p></li>
<li><p>Support Python 3.5</p></li>
<li><p>Improve performance of transport in-use list (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/472">#472</a>)</p></li>
<li><p>Fix connection pooling (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/473">#473</a>)</p></li>
</ul>
</div>
<div class="section" id="id881">
<h5>0.17.2 (08-11-2015)<a class="headerlink" href="#id881" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Don’t forget to pass <cite>data</cite> argument forward (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/462">#462</a>)</p></li>
<li><p>Fix multipart read bytes count (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/463">#463</a>)</p></li>
</ul>
</div>
<div class="section" id="id884">
<h5>0.17.1 (08-10-2015)<a class="headerlink" href="#id884" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix multidict comparison to arbitrary abc.Mapping</p></li>
</ul>
</div>
<div class="section" id="id885">
<h5>0.17.0 (08-04-2015)<a class="headerlink" href="#id885" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Make StaticRoute support Last-Modified and If-Modified-Since headers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/386">#386</a>)</p></li>
<li><p>Add Request.if_modified_since and Stream.Response.last_modified properties</p></li>
<li><p>Fix deflate compression when writing a chunked response (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/395">#395</a>)</p></li>
<li><p>Request`s content-length header is cleared now after redirect from
POST method (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/391">#391</a>)</p></li>
<li><p>Return a 400 if server received a non HTTP content (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/405">#405</a>)</p></li>
<li><p>Fix keep-alive support for aiohttp clients (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/406">#406</a>)</p></li>
<li><p>Allow gzip compression in high-level server response interface (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/403">#403</a>)</p></li>
<li><p>Rename TCPConnector.resolve and family to dns_cache (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/415">#415</a>)</p></li>
<li><p>Make UrlDispatcher ignore quoted characters during url matching (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/414">#414</a>)
Backward-compatibility warning: this may change the url matched by
your queries if they send quoted character (like %2F for /) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/414">#414</a>)</p></li>
<li><p>Use optional cchardet accelerator if present (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/418">#418</a>)</p></li>
<li><p>Borrow loop from Connector in ClientSession if loop is not set</p></li>
<li><p>Add context manager support to ClientSession for session closing.</p></li>
<li><p>Add toplevel get(), post(), put(), head(), delete(), options(),
patch() coroutines.</p></li>
<li><p>Fix IPv6 support for client API (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/425">#425</a>)</p></li>
<li><p>Pass SSL context through proxy connector (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/421">#421</a>)</p></li>
<li><p>Make the rule: path for add_route should start with slash</p></li>
<li><p>Don’t process request finishing by low-level server on closed event loop</p></li>
<li><p>Don’t override data if multiple files are uploaded with same key (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/433">#433</a>)</p></li>
<li><p>Ensure multipart.BodyPartReader.read_chunk read all the necessary data
to avoid false assertions about malformed multipart payload</p></li>
<li><p>Don’t send body for 204, 205 and 304 http exceptions (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/442">#442</a>)</p></li>
<li><p>Correctly skip Cython compilation in MSVC not found (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/453">#453</a>)</p></li>
<li><p>Add response factory to StaticRoute (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/456">#456</a>)</p></li>
<li><p>Don’t append trailing CRLF for multipart.BodyPartReader (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/454">#454</a>)</p></li>
</ul>
</div>
<div class="section" id="id903">
<h5>0.16.6 (07-15-2015)<a class="headerlink" href="#id903" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Skip compilation on Windows if vcvarsall.bat cannot be found (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/438">#438</a>)</p></li>
</ul>
</div>
<div class="section" id="id905">
<h5>0.16.5 (06-13-2015)<a class="headerlink" href="#id905" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Get rid of all comprehensions and yielding in _multidict (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/410">#410</a>)</p></li>
</ul>
</div>
<div class="section" id="id907">
<h5>0.16.4 (06-13-2015)<a class="headerlink" href="#id907" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Don’t clear current exception in multidict’s <cite>__repr__</cite> (cythonized
versions) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/410">#410</a>)</p></li>
</ul>
</div>
<div class="section" id="id909">
<h5>0.16.3 (05-30-2015)<a class="headerlink" href="#id909" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix StaticRoute vulnerability to directory traversal attacks (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/380">#380</a>)</p></li>
</ul>
</div>
<div class="section" id="id911">
<h5>0.16.2 (05-27-2015)<a class="headerlink" href="#id911" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Update python version required for <cite>__del__</cite> usage: it’s actually
3.4.1 instead of 3.4.0</p></li>
<li><p>Add check for presence of loop.is_closed() method before call the
former (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/378">#378</a>)</p></li>
</ul>
</div>
<div class="section" id="id913">
<h5>0.16.1 (05-27-2015)<a class="headerlink" href="#id913" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix regression in static file handling (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/377">#377</a>)</p></li>
</ul>
</div>
<div class="section" id="id915">
<h5>0.16.0 (05-26-2015)<a class="headerlink" href="#id915" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Unset waiter future after cancellation (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/363">#363</a>)</p></li>
<li><p>Update request url with query parameters (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/372">#372</a>)</p></li>
<li><p>Support new <cite>fingerprint</cite> param of TCPConnector to enable verifying
SSL certificates via MD5, SHA1, or SHA256 digest (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/366">#366</a>)</p></li>
<li><p>Setup uploaded filename if field value is binary and transfer
encoding is not specified (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/349">#349</a>)</p></li>
<li><p>Implement <cite>ClientSession.close()</cite> method</p></li>
<li><p>Implement <cite>connector.closed</cite> readonly property</p></li>
<li><p>Implement <cite>ClientSession.closed</cite> readonly property</p></li>
<li><p>Implement <cite>ClientSession.connector</cite> readonly property</p></li>
<li><p>Implement <cite>ClientSession.detach</cite> method</p></li>
<li><p>Add <cite>__del__</cite> to client-side objects: sessions, connectors,
connections, requests, responses.</p></li>
<li><p>Refactor connections cleanup by connector (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/357">#357</a>)</p></li>
<li><p>Add <cite>limit</cite> parameter to connector constructor (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/358">#358</a>)</p></li>
<li><p>Add <cite>request.has_body</cite> property (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/364">#364</a>)</p></li>
<li><p>Add <cite>response_class</cite> parameter to <cite>ws_connect()</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/367">#367</a>)</p></li>
<li><p><cite>ProxyConnector</cite> does not support keep-alive requests by default
starting from now (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/368">#368</a>)</p></li>
<li><p>Add <cite>connector.force_close</cite> property</p></li>
<li><p>Add ws_connect to ClientSession (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/374">#374</a>)</p></li>
<li><p>Support optional <cite>chunk_size</cite> parameter in <cite>router.add_static()</cite></p></li>
</ul>
</div>
<div class="section" id="id926">
<h5>0.15.3 (04-22-2015)<a class="headerlink" href="#id926" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix graceful shutdown handling</p></li>
<li><p>Fix <cite>Expect</cite> header handling for not found and not allowed routes (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/340">#340</a>)</p></li>
</ul>
</div>
<div class="section" id="id928">
<h5>0.15.2 (04-19-2015)<a class="headerlink" href="#id928" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Flow control subsystem refactoring</p></li>
<li><p>HTTP server performance optimizations</p></li>
<li><p>Allow to match any request method with <cite>*</cite></p></li>
<li><p>Explicitly call drain on transport (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/316">#316</a>)</p></li>
<li><p>Make chardet module dependency mandatory (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/318">#318</a>)</p></li>
<li><p>Support keep-alive for HTTP 1.0 (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/325">#325</a>)</p></li>
<li><p>Do not chunk single file during upload (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/327">#327</a>)</p></li>
<li><p>Add ClientSession object for cookie storage and default headers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/328">#328</a>)</p></li>
<li><p>Add <cite>keep_alive_on</cite> argument for HTTP server handler.</p></li>
</ul>
</div>
<div class="section" id="id934">
<h5>0.15.1 (03-31-2015)<a class="headerlink" href="#id934" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Pass Autobahn Testsuite tests</p></li>
<li><p>Fixed websocket fragmentation</p></li>
<li><p>Fixed websocket close procedure</p></li>
<li><p>Fixed parser buffer limits</p></li>
<li><p>Added <cite>timeout</cite> parameter to WebSocketResponse ctor</p></li>
<li><p>Added <cite>WebSocketResponse.close_code</cite> attribute</p></li>
</ul>
</div>
<div class="section" id="id935">
<h5>0.15.0 (03-27-2015)<a class="headerlink" href="#id935" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Client WebSockets support</p></li>
<li><p>New Multipart system (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/273">#273</a>)</p></li>
<li><p>Support for “Except” header (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/287">#287</a>) (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/267">#267</a>)</p></li>
<li><p>Set default Content-Type for post requests (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/184">#184</a>)</p></li>
<li><p>Fix issue with construction dynamic route with regexps and trailing slash (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/266">#266</a>)</p></li>
<li><p>Add repr to web.Request</p></li>
<li><p>Add repr to web.Response</p></li>
<li><p>Add repr for NotFound and NotAllowed match infos</p></li>
<li><p>Add repr for web.Application</p></li>
<li><p>Add repr to UrlMappingMatchInfo (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/217">#217</a>)</p></li>
<li><p>Gunicorn 19.2.x compatibility</p></li>
</ul>
</div>
<div class="section" id="id942">
<h5>0.14.4 (01-29-2015)<a class="headerlink" href="#id942" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix issue with error during constructing of url with regex parts (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/264">#264</a>)</p></li>
</ul>
</div>
<div class="section" id="id944">
<h5>0.14.3 (01-28-2015)<a class="headerlink" href="#id944" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Use path=’/’ by default for cookies (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/261">#261</a>)</p></li>
</ul>
</div>
<div class="section" id="id946">
<h5>0.14.2 (01-23-2015)<a class="headerlink" href="#id946" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Connections leak in BaseConnector (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/253">#253</a>)</p></li>
<li><p>Do not swallow websocket reader exceptions (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/255">#255</a>)</p></li>
<li><p>web.Request’s read, text, json are memorized (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/250">#250</a>)</p></li>
</ul>
</div>
<div class="section" id="id950">
<h5>0.14.1 (01-15-2015)<a class="headerlink" href="#id950" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>HttpMessage._add_default_headers does not overwrite existing headers (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/216">#216</a>)</p></li>
<li><p>Expose multidict classes at package level</p></li>
<li><p>add <cite>aiohttp.web.WebSocketResponse</cite></p></li>
<li><p>According to RFC 6455 websocket subprotocol preference order is
provided by client, not by server</p></li>
<li><p>websocket’s ping and pong accept optional message parameter</p></li>
<li><p>multidict views do not accept <cite>getall</cite> parameter anymore, it
returns the full body anyway.</p></li>
<li><p>multidicts have optional Cython optimization, cythonized version of
multidicts is about 5 times faster than pure Python.</p></li>
<li><p>multidict.getall() returns <cite>list</cite>, not <cite>tuple</cite>.</p></li>
<li><p>Backward incompatible change: now there are two mutable multidicts
(<cite>MultiDict</cite>, <cite>CIMultiDict</cite>) and two immutable multidict proxies
(<cite>MultiDictProxy</cite> and <cite>CIMultiDictProxy</cite>). Previous edition of
multidicts was not a part of public API BTW.</p></li>
<li><p>Router refactoring to push Not Allowed and Not Found in middleware processing</p></li>
<li><p>Convert <cite>ConnectionError</cite> to <cite>aiohttp.DisconnectedError</cite> and don’t
eat <cite>ConnectionError</cite> exceptions from web handlers.</p></li>
<li><p>Remove hop headers from Response class, wsgi response still uses hop headers.</p></li>
<li><p>Allow to send raw chunked encoded response.</p></li>
<li><p>Allow to encode output bytes stream into chunked encoding.</p></li>
<li><p>Allow to compress output bytes stream with <cite>deflate</cite> encoding.</p></li>
<li><p>Server has 75 seconds keepalive timeout now, was non-keepalive by default.</p></li>
<li><p>Application does not accept <cite>**kwargs</cite> anymore ((<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/243">#243</a>)).</p></li>
<li><p>Request is inherited from dict now for making per-request storage to
middlewares ((<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/242">#242</a>)).</p></li>
</ul>
</div>
<div class="section" id="id954">
<h5>0.13.1 (12-31-2014)<a class="headerlink" href="#id954" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Add <cite>aiohttp.web.StreamResponse.started</cite> property (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/213">#213</a>)</p></li>
<li><p>HTML escape traceback text in <cite>ServerHttpProtocol.handle_error</cite></p></li>
<li><p>Mention handler and middlewares in <cite>aiohttp.web.RequestHandler.handle_request</cite>
on error ((<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/218">#218</a>))</p></li>
</ul>
</div>
<div class="section" id="id957">
<h5>0.13.0 (12-29-2014)<a class="headerlink" href="#id957" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p><cite>StreamResponse.charset</cite> converts value to lower-case on assigning.</p></li>
<li><p>Chain exceptions when raise <cite>ClientRequestError</cite>.</p></li>
<li><p>Support custom regexps in route variables (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/204">#204</a>)</p></li>
<li><p>Fixed graceful shutdown, disable keep-alive on connection closing.</p></li>
<li><p>Decode HTTP message with <cite>utf-8</cite> encoding, some servers send headers
in utf-8 encoding (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/207">#207</a>)</p></li>
<li><p>Support <cite>aiohtt.web</cite> middlewares (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/209">#209</a>)</p></li>
<li><p>Add ssl_context to TCPConnector (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/206">#206</a>)</p></li>
</ul>
</div>
<div class="section" id="id962">
<h5>0.12.0 (12-12-2014)<a class="headerlink" href="#id962" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Deep refactoring of <cite>aiohttp.web</cite> in backward-incompatible manner.
Sorry, we have to do this.</p></li>
<li><p>Automatically force aiohttp.web handlers to coroutines in
<cite>UrlDispatcher.add_route()</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/186">#186</a>)</p></li>
<li><p>Rename <cite>Request.POST()</cite> function to <cite>Request.post()</cite></p></li>
<li><p>Added POST attribute</p></li>
<li><p>Response processing refactoring: constructor does not accept Request
instance anymore.</p></li>
<li><p>Pass application instance to finish callback</p></li>
<li><p>Exceptions refactoring</p></li>
<li><p>Do not unquote query string in <cite>aiohttp.web.Request</cite></p></li>
<li><p>Fix concurrent access to payload in <cite>RequestHandle.handle_request()</cite></p></li>
<li><p>Add access logging to <cite>aiohttp.web</cite></p></li>
<li><p>Gunicorn worker for <cite>aiohttp.web</cite></p></li>
<li><p>Removed deprecated <cite>AsyncGunicornWorker</cite></p></li>
<li><p>Removed deprecated HttpClient</p></li>
</ul>
</div>
<div class="section" id="id964">
<h5>0.11.0 (11-29-2014)<a class="headerlink" href="#id964" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Support named routes in <cite>aiohttp.web.UrlDispatcher</cite> (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/179">#179</a>)</p></li>
<li><p>Make websocket subprotocols conform to spec (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/181">#181</a>)</p></li>
</ul>
</div>
<div class="section" id="id967">
<h5>0.10.2 (11-19-2014)<a class="headerlink" href="#id967" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Don’t unquote <cite>environ[‘PATH_INFO’]</cite> in wsgi.py (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/177">#177</a>)</p></li>
</ul>
</div>
<div class="section" id="id969">
<h5>0.10.1 (11-17-2014)<a class="headerlink" href="#id969" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>aiohttp.web.HTTPException and descendants now files response body
with string like <cite>404: NotFound</cite></p></li>
<li><p>Fix multidict <cite>__iter__</cite>, the method should iterate over keys, not
(key, value) pairs.</p></li>
</ul>
</div>
<div class="section" id="id970">
<h5>0.10.0 (11-13-2014)<a class="headerlink" href="#id970" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Add aiohttp.web subpackage for highlevel HTTP server support.</p></li>
<li><p>Add <em>reason</em> optional parameter to aiohttp.protocol.Response ctor.</p></li>
<li><p>Fix aiohttp.client bug for sending file without content-type.</p></li>
<li><p>Change error text for connection closed between server responses
from ‘Can not read status line’ to explicit ‘Connection closed by
server’</p></li>
<li><p>Drop closed connections from connector (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/173">#173</a>)</p></li>
<li><p>Set server.transport to None on .closing() (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/172">#172</a>)</p></li>
</ul>
</div>
<div class="section" id="id973">
<h5>0.9.3 (10-30-2014)<a class="headerlink" href="#id973" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix compatibility with asyncio 3.4.1+ (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/170">#170</a>)</p></li>
</ul>
</div>
<div class="section" id="id975">
<h5>0.9.2 (10-16-2014)<a class="headerlink" href="#id975" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Improve redirect handling (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/157">#157</a>)</p></li>
<li><p>Send raw files as is (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/153">#153</a>)</p></li>
<li><p>Better websocket support (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/150">#150</a>)</p></li>
</ul>
</div>
<div class="section" id="id979">
<h5>0.9.1 (08-30-2014)<a class="headerlink" href="#id979" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Added MultiDict support for client request params and data (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/114">#114</a>).</p></li>
<li><p>Fixed parameter type for IncompleteRead exception (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/118">#118</a>).</p></li>
<li><p>Strictly require ASCII headers names and values (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/137">#137</a>)</p></li>
<li><p>Keep port in ProxyConnector (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/128">#128</a>).</p></li>
<li><p>Python 3.4.1 compatibility (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/131">#131</a>).</p></li>
</ul>
</div>
<div class="section" id="id985">
<h5>0.9.0 (07-08-2014)<a class="headerlink" href="#id985" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Better client basic authentication support (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/112">#112</a>).</p></li>
<li><p>Fixed incorrect line splitting in HttpRequestParser (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/97">#97</a>).</p></li>
<li><p>Support StreamReader and DataQueue as request data.</p></li>
<li><p>Client files handling refactoring (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/20">#20</a>).</p></li>
<li><p>Backward incompatible: Replace DataQueue with StreamReader for
request payload (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/87">#87</a>).</p></li>
</ul>
</div>
<div class="section" id="id990">
<h5>0.8.4 (07-04-2014)<a class="headerlink" href="#id990" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Change ProxyConnector authorization parameters.</p></li>
</ul>
</div>
<div class="section" id="id991">
<h5>0.8.3 (07-03-2014)<a class="headerlink" href="#id991" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Publish TCPConnector properties: verify_ssl, family, resolve, resolved_hosts.</p></li>
<li><p>Don’t parse message body for HEAD responses.</p></li>
<li><p>Refactor client response decoding.</p></li>
</ul>
</div>
<div class="section" id="id992">
<h5>0.8.2 (06-22-2014)<a class="headerlink" href="#id992" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Make ProxyConnector.proxy immutable property.</p></li>
<li><p>Make UnixConnector.path immutable property.</p></li>
<li><p>Fix resource leak for aiohttp.request() with implicit connector.</p></li>
<li><p>Rename Connector’s reuse_timeout to keepalive_timeout.</p></li>
</ul>
</div>
<div class="section" id="id993">
<h5>0.8.1 (06-18-2014)<a class="headerlink" href="#id993" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Use case insensitive multidict for server request/response headers.</p></li>
<li><p>MultiDict.getall() accepts default value.</p></li>
<li><p>Catch server ConnectionError.</p></li>
<li><p>Accept MultiDict (and derived) instances in aiohttp.request header argument.</p></li>
<li><p>Proxy ‘CONNECT’ support.</p></li>
</ul>
</div>
<div class="section" id="id994">
<h5>0.8.0 (06-06-2014)<a class="headerlink" href="#id994" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Add support for utf-8 values in HTTP headers</p></li>
<li><p>Allow to use custom response class instead of HttpResponse</p></li>
<li><p>Use MultiDict for client request headers</p></li>
<li><p>Use MultiDict for server request/response headers</p></li>
<li><p>Store response headers in ClientResponse.headers attribute</p></li>
<li><p>Get rid of timeout parameter in aiohttp.client API</p></li>
<li><p>Exceptions refactoring</p></li>
</ul>
</div>
<div class="section" id="id995">
<h5>0.7.3 (05-20-2014)<a class="headerlink" href="#id995" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Simple HTTP proxy support.</p></li>
</ul>
</div>
<div class="section" id="id996">
<h5>0.7.2 (05-14-2014)<a class="headerlink" href="#id996" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Get rid of <cite>__del__</cite> methods</p></li>
<li><p>Use ResourceWarning instead of logging warning record.</p></li>
</ul>
</div>
<div class="section" id="id997">
<h5>0.7.1 (04-28-2014)<a class="headerlink" href="#id997" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Do not unquote client request urls.</p></li>
<li><p>Allow multiple waiters on transport drain.</p></li>
<li><p>Do not return client connection to pool in case of exceptions.</p></li>
<li><p>Rename SocketConnector to TCPConnector and UnixSocketConnector to
UnixConnector.</p></li>
</ul>
</div>
<div class="section" id="id998">
<h5>0.7.0 (04-16-2014)<a class="headerlink" href="#id998" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Connection flow control.</p></li>
<li><p>HTTP client session/connection pool refactoring.</p></li>
<li><p>Better handling for bad server requests.</p></li>
</ul>
</div>
<div class="section" id="id999">
<h5>0.6.5 (03-29-2014)<a class="headerlink" href="#id999" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Added client session reuse timeout.</p></li>
<li><p>Better client request cancellation support.</p></li>
<li><p>Better handling responses without content length.</p></li>
<li><p>Added HttpClient verify_ssl parameter support.</p></li>
</ul>
</div>
<div class="section" id="id1000">
<h5>0.6.4 (02-27-2014)<a class="headerlink" href="#id1000" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Log content-length missing warning only for put and post requests.</p></li>
</ul>
</div>
<div class="section" id="id1001">
<h5>0.6.3 (02-27-2014)<a class="headerlink" href="#id1001" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Better support for server exit.</p></li>
<li><p>Read response body until EOF if content-length is not defined (<a class="reference external" href="https://github.com/aio-libs/aiohttp/pull/14">#14</a>)</p></li>
</ul>
</div>
<div class="section" id="id1003">
<h5>0.6.2 (02-18-2014)<a class="headerlink" href="#id1003" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix trailing char in allowed_methods.</p></li>
<li><p>Start slow request timer for first request.</p></li>
</ul>
</div>
<div class="section" id="id1004">
<h5>0.6.1 (02-17-2014)<a class="headerlink" href="#id1004" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Added utility method HttpResponse.read_and_close()</p></li>
<li><p>Added slow request timeout.</p></li>
<li><p>Enable socket SO_KEEPALIVE if available.</p></li>
</ul>
</div>
<div class="section" id="id1005">
<h5>0.6.0 (02-12-2014)<a class="headerlink" href="#id1005" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Better handling for process exit.</p></li>
</ul>
</div>
<div class="section" id="id1006">
<h5>0.5.0 (01-29-2014)<a class="headerlink" href="#id1006" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Allow to use custom HttpRequest client class.</p></li>
<li><p>Use gunicorn keepalive setting for asynchronous worker.</p></li>
<li><p>Log leaking responses.</p></li>
<li><p>python 3.4 compatibility</p></li>
</ul>
</div>
<div class="section" id="id1007">
<h5>0.4.4 (11-15-2013)<a class="headerlink" href="#id1007" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Resolve only AF_INET family, because it is not clear how to pass
extra info to asyncio.</p></li>
</ul>
</div>
<div class="section" id="id1008">
<h5>0.4.3 (11-15-2013)<a class="headerlink" href="#id1008" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Allow to wait completion of request with <cite>HttpResponse.wait_for_close()</cite></p></li>
</ul>
</div>
<div class="section" id="id1009">
<h5>0.4.2 (11-14-2013)<a class="headerlink" href="#id1009" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Handle exception in client request stream.</p></li>
<li><p>Prevent host resolving for each client request.</p></li>
</ul>
</div>
<div class="section" id="id1010">
<h5>0.4.1 (11-12-2013)<a class="headerlink" href="#id1010" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Added client support for <cite>expect: 100-continue</cite> header.</p></li>
</ul>
</div>
<div class="section" id="id1011">
<h5>0.4 (11-06-2013)<a class="headerlink" href="#id1011" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Added custom wsgi application close procedure</p></li>
<li><p>Fixed concurrent host failure in HttpClient</p></li>
</ul>
</div>
<div class="section" id="id1012">
<h5>0.3 (11-04-2013)<a class="headerlink" href="#id1012" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Added PortMapperWorker</p></li>
<li><p>Added HttpClient</p></li>
<li><p>Added TCP connection timeout to HTTP client</p></li>
<li><p>Better client connection errors handling</p></li>
<li><p>Gracefully handle process exit</p></li>
</ul>
</div>
<div class="section" id="id1013">
<h5>0.2<a class="headerlink" href="#id1013" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Fix packaging</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h4>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>
</div>
<span id="document-external"></span><div class="section" id="who-uses-aiohttp">
<h3>Who uses aiohttp?<a class="headerlink" href="#who-uses-aiohttp" title="Permalink to this headline">¶</a></h3>
<p>The list of <em>aiohttp</em> users: both libraries, big projects and web sites.</p>
<p>Please don’t hesitate to add your awesome project to the list by
making a Pull Request on <a class="reference external" href="https://github.com/aio-libs/aiohttp">GitHub</a>.</p>
<p>If you like the project – please go to <a class="reference external" href="https://github.com/aio-libs/aiohttp">GitHub</a> and press <em>Star</em> button!</p>
<div class="toctree-wrapper compound">
<span id="document-third_party"></span><div class="section" id="third-party-libraries">
<span id="aiohttp-3rd-party"></span><h4>Third-Party libraries<a class="headerlink" href="#third-party-libraries" title="Permalink to this headline">¶</a></h4>
<p>aiohttp is not the library for making HTTP requests and creating WEB
server only.</p>
<p>It is the grand basement for libraries built <em>on top</em> of aiohttp.</p>
<p>This page is a list of these tools.</p>
<p>Please feel free to add your open sourced library if it’s not enlisted
yet by making Pull Request to <a class="reference external" href="https://github.com/aio-libs/aiohttp/">https://github.com/aio-libs/aiohttp/</a></p>
<ul class="simple">
<li><p>Why do you might want to include your awesome library into the list?</p></li>
<li><p>Just because the list increases your library visibility. People
will have an easy way to find it.</p></li>
</ul>
<div class="section" id="officially-supported">
<h5>Officially supported<a class="headerlink" href="#officially-supported" title="Permalink to this headline">¶</a></h5>
<p>This list contains libraries which are supported by <em>aio-libs</em> team
and located on <a class="reference external" href="https://github.com/aio-libs">https://github.com/aio-libs</a></p>
<div class="section" id="aiohttp-extensions">
<h6>aiohttp extensions<a class="headerlink" href="#aiohttp-extensions" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/aio-libs/aiohttp-session">aiohttp-session</a></dt><dd><p>provides sessions for <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a>.</p>
</dd>
</dl>
</li>
<li><p><a class="reference external" href="https://github.com/aio-libs/aiohttp-debugtoolbar">aiohttp-debugtoolbar</a>
is a library for <em>debug toolbar</em> support for <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a>.</p></li>
<li><p><a class="reference external" href="https://github.com/aio-libs/aiohttp-security">aiohttp-security</a>
auth and permissions for <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a>.</p></li>
<li><p><a class="reference external" href="https://github.com/aio-libs/aiohttp-devtools">aiohttp-devtools</a>
provides development tools for <a class="reference internal" href="index.html#module-aiohttp.web" title="aiohttp.web"><code class="xref py py-mod docutils literal notranslate"><span class="pre">aiohttp.web</span></code></a> applications.</p></li>
<li><p><a class="reference external" href="https://github.com/aio-libs/aiohttp-cors">aiohttp-cors</a> CORS
support for aiohttp.</p></li>
<li><p><a class="reference external" href="https://github.com/aio-libs/aiohttp-sse">aiohttp-sse</a> Server-sent
events support for aiohttp.</p></li>
<li><p><a class="reference external" href="https://github.com/aio-libs/pytest-aiohttp">pytest-aiohttp</a>
pytest plugin for aiohttp support.</p></li>
<li><p><a class="reference external" href="https://github.com/aio-libs/aiohttp-mako">aiohttp-mako</a> Mako
template renderer for aiohttp.web.</p></li>
<li><p><a class="reference external" href="https://github.com/aio-libs/aiohttp-jinja2">aiohttp-jinja2</a> Jinja2
template renderer for aiohttp.web.</p></li>
<li><p><a class="reference external" href="https://github.com/aio-libs/aiozipkin">aiozipkin</a> distributed
tracing instrumentation for <cite>aiohttp</cite> client and server.</p></li>
</ul>
</div>
<div class="section" id="database-drivers">
<h6>Database drivers<a class="headerlink" href="#database-drivers" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/aio-libs/aiopg">aiopg</a> PostgreSQL async driver.</p></li>
<li><p><a class="reference external" href="https://github.com/aio-libs/aiomysql">aiomysql</a> MySql async driver.</p></li>
<li><p><a class="reference external" href="https://github.com/aio-libs/aioredis">aioredis</a> Redis async driver.</p></li>
</ul>
</div>
<div class="section" id="other-tools">
<h6>Other tools<a class="headerlink" href="#other-tools" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/aio-libs/aiodocker">aiodocker</a> Python Docker
API client based on asyncio and aiohttp.</p></li>
<li><p><a class="reference external" href="https://github.com/aio-libs/aiobotocore">aiobotocore</a> asyncio
support for botocore library using aiohttp.</p></li>
</ul>
</div>
</div>
<div class="section" id="approved-third-party-libraries">
<h5>Approved third-party libraries<a class="headerlink" href="#approved-third-party-libraries" title="Permalink to this headline">¶</a></h5>
<p>The libraries are not part of <code class="docutils literal notranslate"><span class="pre">aio-libs</span></code> but they are proven to be very
well written and highly recommended for usage.</p>
<ul>
<li><p><a class="reference external" href="https://github.com/MagicStack/uvloop">uvloop</a> Ultra fast
implementation of asyncio event loop on top of <code class="docutils literal notranslate"><span class="pre">libuv</span></code>.</p>
<p>We are highly recommending to use it instead of standard <code class="docutils literal notranslate"><span class="pre">asyncio</span></code>.</p>
</li>
</ul>
<div class="section" id="id1">
<h6>Database drivers<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/MagicStack/asyncpg">asyncpg</a> Another
PostgreSQL async driver. It’s much faster than <code class="docutils literal notranslate"><span class="pre">aiopg</span></code> but it is
not drop-in replacement – the API is different. Anyway please take
a look on it – the driver is really incredible fast.</p></li>
</ul>
</div>
</div>
<div class="section" id="others">
<h5>Others<a class="headerlink" href="#others" title="Permalink to this headline">¶</a></h5>
<p>The list of libraries which are exists but not enlisted in former categories.</p>
<p>They may be perfect or not – we don’t know.</p>
<p>Please add your library reference here first and after some time
period ask to raise the status.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/cr0hn/aiohttp-cache">aiohttp-cache</a> A cache
system for aiohttp server.</p></li>
<li><p><a class="reference external" href="https://github.com/argaen/aiocache">aiocache</a> Caching for asyncio
with multiple backends (framework agnostic)</p></li>
<li><p><a class="reference external" href="https://github.com/gaojiuli/gain">gain</a> Web crawling framework
based on asyncio for everyone.</p></li>
<li><p><a class="reference external" href="https://github.com/cr0hn/aiohttp-swagger">aiohttp-swagger</a>
Swagger API Documentation builder for aiohttp server.</p></li>
<li><p><a class="reference external" href="https://github.com/dchaplinsky/aiohttp_swaggerify">aiohttp-swaggerify</a>
Library to automatically generate swagger2.0 definition for aiohttp endpoints.</p></li>
<li><p><a class="reference external" href="https://github.com/dchaplinsky/aiohttp_validate">aiohttp-validate</a>
Simple library that helps you validate your API endpoints requests/responses with json schema.</p></li>
<li><p><a class="reference external" href="https://github.com/getsentry/raven-aiohttp">raven-aiohttp</a> An
aiohttp transport for raven-python (Sentry client).</p></li>
<li><p><a class="reference external" href="https://github.com/sloria/webargs">webargs</a> A friendly library
for parsing HTTP request arguments, with built-in support for
popular web frameworks, including Flask, Django, Bottle, Tornado,
Pyramid, webapp2, Falcon, and aiohttp.</p></li>
<li><p><a class="reference external" href="https://github.com/klen/aioauth-client">aioauth-client</a> OAuth
client for aiohttp.</p></li>
<li><p><a class="reference external" href="https://github.com/CenterForOpenScience/aiohttpretty">aiohttpretty</a> A simple
asyncio compatible httpretty mock using aiohttp.</p></li>
<li><p><a class="reference external" href="https://github.com/pnuckowski/aioresponses">aioresponses</a> a
helper for mock/fake web requests in python aiohttp package.</p></li>
<li><p><a class="reference external" href="https://github.com/toumorokoshi/aiohttp-transmute">aiohttp-transmute</a> A transmute
implementation for aiohttp.</p></li>
<li><p><a class="reference external" href="https://github.com/aamalev/aiohttp_apiset">aiohttp_apiset</a>
Package to build routes using swagger specification.</p></li>
<li><p><a class="reference external" href="https://github.com/imbolc/aiohttp-login">aiohttp-login</a>
Registration and authorization (including social) for aiohttp
applications.</p></li>
<li><p><a class="reference external" href="https://github.com/sloria/aiohttp_utils">aiohttp_utils</a> Handy
utilities for building aiohttp.web applications.</p></li>
<li><p><a class="reference external" href="https://github.com/jmehnle/aiohttpproxy">aiohttpproxy</a> Simple
aiohttp HTTP proxy.</p></li>
<li><p><a class="reference external" href="https://github.com/zzzsochi/aiohttp_traversal">aiohttp_traversal</a>
Traversal based router for aiohttp.web.</p></li>
<li><p><a class="reference external" href="https://github.com/anti1869/aiohttp_autoreload">aiohttp_autoreload</a> Makes aiohttp
server auto-reload on source code change.</p></li>
<li><p><a class="reference external" href="https://github.com/brettcannon/gidgethub">gidgethub</a> An async
GitHub API library for Python.</p></li>
<li><p><a class="reference external" href="https://github.com/zloidemon/aiohttp_jrpc">aiohttp_jrpc</a> aiohttp
JSON-RPC service.</p></li>
<li><p><a class="reference external" href="https://github.com/cdunklau/fbemissary">fbemissary</a> A bot
framework for the Facebook Messenger platform, built on asyncio and
aiohttp.</p></li>
<li><p><a class="reference external" href="https://github.com/wikibusiness/aioslacker">aioslacker</a> slacker
wrapper for asyncio.</p></li>
<li><p><a class="reference external" href="https://github.com/and800/aioreloader">aioreloader</a> Port of
tornado reloader to asyncio.</p></li>
<li><p><a class="reference external" href="https://github.com/jie/aiohttp_babel">aiohttp_babel</a> Babel
localization support for aiohttp.</p></li>
<li><p><a class="reference external" href="https://github.com/mindflayer/python-mocket">python-mocket</a> a
socket mock framework - for all kinds of socket animals, web-clients
included.</p></li>
<li><p><a class="reference external" href="https://github.com/lisael/aioraft">aioraft</a> asyncio RAFT
algorithm based on aiohttp.</p></li>
<li><p><a class="reference external" href="https://github.com/home-assistant/home-assistant">home-assistant</a>
Open-source home automation platform running on Python 3.</p></li>
<li><p><a class="reference external" href="https://github.com/Rapptz/discord.py">discord.py</a> Discord client library.</p></li>
<li><p><a class="reference external" href="https://github.com/graphql-python/aiohttp-graphql">aiohttp-graphql</a>
GraphQL and GraphIQL interface for aiohttp.</p></li>
<li><p><a class="reference external" href="https://github.com/underyx/aiohttp-sentry">aiohttp-sentry</a>
An aiohttp middleware for reporting errors to Sentry. Python 3.5+ is required.</p></li>
<li><p><a class="reference external" href="https://github.com/underyx/aiohttp-datadog">aiohttp-datadog</a>
An aiohttp middleware for reporting metrics to DataDog. Python 3.5+ is required.</p></li>
<li><p><a class="reference external" href="https://github.com/jamespeterschinner/async_v20">async-v20</a>
Asynchronous FOREX client for OANDA’s v20 API. Python 3.6+</p></li>
<li><p><a class="reference external" href="https://github.com/hzlmn/aiohttp-jwt">aiohttp-jwt</a>
An aiohttp middleware for JWT(JSON Web Token) support. Python 3.5+ is required.</p></li>
<li><p><a class="reference external" href="https://github.com/aws/aws-xray-sdk-python">AWS Xray Python SDK</a>
Native tracing support for Aiohttp applications.</p></li>
<li><p><a class="reference external" href="https://github.com/fantix/gino">GINO</a>
An asyncio ORM on top of SQLAlchemy core, delivered with an aiohttp extension.</p></li>
<li><p><a class="reference external" href="https://github.com/maximdanilchenko/aiohttp-apispec">aiohttp-apispec</a>
Build and document REST APIs with <code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> and <code class="docutils literal notranslate"><span class="pre">apispec</span></code>.</p></li>
<li><p><a class="reference external" href="https://github.com/eider-rpc/eider-py">eider-py</a> Python implementation of
the <a class="reference external" href="http://eider.readthedocs.io/">Eider RPC protocol</a>.</p></li>
<li><p><a class="reference external" href="https://github.com/RobertoPrevato/asynapplicationinsights">asynapplicationinsights</a> A client
for <a class="reference external" href="https://azure.microsoft.com/en-us/services/application-insights/">Azure Application Insights</a>
implemented using <code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> client, including a middleware for <code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> servers to collect web apps
telemetry.</p></li>
<li><p><a class="reference external" href="https://github.com/hzlmn/aiogmaps">aiogmaps</a>
Asynchronous client for Google Maps API Web Services. Python 3.6+ required.</p></li>
</ul>
</div>
</div>
<span id="document-built_with"></span><div class="section" id="built-with-aiohttp">
<span id="aiohttp-built-with"></span><h4>Built with aiohttp<a class="headerlink" href="#built-with-aiohttp" title="Permalink to this headline">¶</a></h4>
<p>aiohttp is used to build useful libraries built on top of it,
and there’s a page dedicated to list them: <a class="reference internal" href="index.html#aiohttp-3rd-party"><span class="std std-ref">Third-Party libraries</span></a>.</p>
<p>There are also projects that leverage the power of aiohttp to
provide end-user tools, like command lines or software with
full user interfaces.</p>
<p>This page aims to list those projects. If you are using aiohttp
in your software and if it’s playing a central role, you
can add it here in this list.</p>
<p>You can also add a <strong>Built with aiohttp</strong> link somewhere in your
project, pointing to <a class="reference external" href="https://github.com/aio-libs/aiohttp">https://github.com/aio-libs/aiohttp</a>.</p>
<ul class="simple">
<li><p><a class="reference external" href="http://molotov.readthedocs.io">Molotov</a> Load testing tool.</p></li>
<li><p><a class="reference external" href="https://github.com/hde/arsenic">Arsenic</a> Async WebDriver.</p></li>
<li><p><a class="reference external" href="https://home-assistant.io">Home Assistant</a> Home Automation Platform.</p></li>
<li><p><a class="reference external" href="https://backend.ai">Backend.AI</a> Code execution API service.</p></li>
<li><p><a class="reference external" href="https://github.com/facebookexperimental/doh-proxy">doh-proxy</a> DNS Over HTTPS Proxy.</p></li>
</ul>
</div>
<span id="document-powered_by"></span><div class="section" id="powered-by-aiohttp">
<span id="aiohttp-powered-by"></span><h4>Powered by aiohttp<a class="headerlink" href="#powered-by-aiohttp" title="Permalink to this headline">¶</a></h4>
<p>Web sites powered by aiohttp.</p>
<p>Feel free to fork documentation on github, add a link to your site and
make a Pull Request!</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.farmersbusinessnetwork.com">Farmer Business Network</a></p></li>
<li><p><a class="reference external" href="https://home-assistant.io">Home Assistant</a></p></li>
<li><p><a class="reference external" href="https://www.getkeepsafe.com/">KeepSafe</a></p></li>
<li><p><a class="reference external" href="https://www.skyscanner.net/hotels">Skyscanner Hotels</a></p></li>
<li><p><a class="reference external" href="https://ocean.io/">Ocean S.A.</a></p></li>
<li><p><a class="reference external" href="http://gns3.com">GNS3</a></p></li>
<li><p><a class="reference external" href="https://tutorcruncher.com/features/tutorcruncher-socket/">TutorCruncher socket</a></p></li>
<li><p><a class="reference external" href="https://github.com/tutorcruncher/morpheus">Morpheus messaging microservice</a></p></li>
<li><p><a class="reference external" href="http://www.eyepea.eu">Eyepea - Custom telephony solutions</a></p></li>
<li><p><a class="reference external" href="https://www.allocloud.com">ALLOcloud - Telephony in the cloud</a></p></li>
<li><p><a class="reference external" href="https://helpmanual.io/">helpmanual - comprehensive help and man page database</a></p></li>
<li><p><a class="reference external" href="https://github.com/python/bedevere">bedevere</a> - CPython’s GitHub
bot, helps maintain and identify issues with a CPython pull request.</p></li>
<li><p><a class="reference external" href="https://github.com/python/miss-islington">miss-islington</a> -
CPython’s GitHub bot, backports and merge CPython’s pull requests</p></li>
<li><p><a class="reference external" href="https://noa.one/">noa technologies - Bike-sharing management platform</a> - SSE endpoint, pushes real time updates of
bikes location.</p></li>
<li><p><a class="reference external" href="https://worldoftanks.ru/">Wargaming: World of Tanks</a></p></li>
<li><p><a class="reference external" href="https://yandex.ru">Yandex</a></p></li>
<li><p><a class="reference external" href="https://rambler.ru">Rambler</a></p></li>
<li><p><a class="reference external" href="https://escargot.log1p.xyz">Escargot</a> - Chat server</p></li>
<li><p><a class="reference external" href="https://prom.ua/">Prom.ua</a> - Online trading platform</p></li>
<li><p><a class="reference external" href="https://www.globo.com/">globo.com</a> - (some parts) Brazilian largest media portal</p></li>
<li><p><a class="reference external" href="https://www.glose.com/">Glose</a> - Social reader for E-Books</p></li>
<li><p><a class="reference external" href="https://emoji-gen.ninja">Emoji Generator</a> - Text icon generator</p></li>
</ul>
</div>
</div>
</div>
<span id="document-contributing"></span><div class="section" id="contributing">
<span id="aiohttp-contributing"></span><h3>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h3>
<div class="section" id="instructions-for-contributors">
<h4>Instructions for contributors<a class="headerlink" href="#instructions-for-contributors" title="Permalink to this headline">¶</a></h4>
<p>In order to make a clone of the <a class="reference external" href="https://github.com/aio-libs/aiohttp">GitHub</a> repo: open the link and press the
“Fork” button on the upper-right menu of the web page.</p>
<p>I hope everybody knows how to work with git and github nowadays :)</p>
<p>Workflow is pretty straightforward:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Clone the <a class="reference external" href="https://github.com/aio-libs/aiohttp">GitHub</a> repo using <code class="docutils literal notranslate"><span class="pre">--recurse-submodules</span></code> argument</p></li>
<li><p>Make a change</p></li>
<li><p>Make sure all tests passed</p></li>
<li><p>Add a file into <code class="docutils literal notranslate"><span class="pre">CHANGES</span></code> folder (<a class="reference internal" href="#changelog-update">Changelog update</a>).</p></li>
<li><p>Commit changes to own aiohttp clone</p></li>
<li><p>Make pull request from github page for your clone against master branch</p></li>
<li><p>Optionally make backport Pull Request(s) for landing a bug fix
into released aiohttp versions.</p></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The project uses <em>Squash-and-Merge</em> strategy for <em>GitHub Merge</em> button.</p>
<p>Basically it means that there is <strong>no need to rebase</strong> a Pull Request against
<em>master</em> branch. Just <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">merge</span></code> <em>master</em> into your working copy (a fork) if
needed. The Pull Request is automatically squashed into the single commit
once the PR is accepted.</p>
</div>
</div>
<div class="section" id="preconditions-for-running-aiohttp-test-suite">
<h4>Preconditions for running aiohttp test suite<a class="headerlink" href="#preconditions-for-running-aiohttp-test-suite" title="Permalink to this headline">¶</a></h4>
<p>We expect you to use a python virtual environment to run our tests.</p>
<p>There are several ways to make a virtual environment.</p>
<p>If you like to use <em>virtualenv</em> please run:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> aiohttp
$ virtualenv --python<span class="o">=</span><span class="sb">`</span>which python3<span class="sb">`</span> venv
$ . venv/bin/activate
</pre></div>
</div>
<p>For standard python <em>venv</em>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> aiohttp
$ python3 -m venv venv
$ . venv/bin/activate
</pre></div>
</div>
<p>For <em>virtualenvwrapper</em>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> aiohttp
$ mkvirtualenv --python<span class="o">=</span><span class="sb">`</span>which python3<span class="sb">`</span> aiohttp
</pre></div>
</div>
<p>There are other tools like <em>pyvenv</em> but you know the rule of thumb
now: create a python3 virtual environment and activate it.</p>
<p>After that please install libraries required for development:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ pip install -r requirements/dev.txt
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you plan to use <code class="docutils literal notranslate"><span class="pre">pdb</span></code> or <code class="docutils literal notranslate"><span class="pre">ipdb</span></code> within the test suite, execute:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ py.test tests -s
</pre></div>
</div>
<p>command to run the tests with disabled output capturing.</p>
</div>
<p>Congratulations, you are ready to run the test suite!</p>
</div>
<div class="section" id="run-aiohttp-test-suite">
<h4>Run aiohttp test suite<a class="headerlink" href="#run-aiohttp-test-suite" title="Permalink to this headline">¶</a></h4>
<p>After all the preconditions are met you can run tests typing the next
command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ make <span class="nb">test</span>
</pre></div>
</div>
<p>The command at first will run the <em>flake8</em> tool (sorry, we don’t accept
pull requests with pep8 or pyflakes errors).</p>
<p>On <em>flake8</em> success the tests will be run.</p>
<p>Please take a look on the produced output.</p>
<p>Any extra texts (print statements and so on) should be removed.</p>
</div>
<div class="section" id="tests-coverage">
<h4>Tests coverage<a class="headerlink" href="#tests-coverage" title="Permalink to this headline">¶</a></h4>
<p>We are trying hard to have good test coverage; please don’t make it worse.</p>
<p>Use:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ make cov
</pre></div>
</div>
<p>to run test suite and collect coverage information. Once the command
has finished check your coverage at the file that appears in the last
line of the output:
<code class="docutils literal notranslate"><span class="pre">open</span> <span class="pre">file:///.../aiohttp/htmlcov/index.html</span></code></p>
<p>Please go to the link and make sure that your code change is covered.</p>
<p>The project uses <em>codecov.io</em> for storing coverage results. Visit
<a class="reference external" href="https://codecov.io/gh/aio-libs/aiohttp">https://codecov.io/gh/aio-libs/aiohttp</a> for looking on coverage of
master branch, history, pull requests etc.</p>
<p>The browser extension <a class="reference external" href="https://docs.codecov.io/docs/browser-extension">https://docs.codecov.io/docs/browser-extension</a>
is highly recommended for analyzing the coverage just in <em>Files
Changed</em> tab on <em>GitHub Pull Request</em> review page.</p>
</div>
<div class="section" id="documentation">
<h4>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h4>
<p>We encourage documentation improvements.</p>
<p>Please before making a Pull Request about documentation changes run:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ make doc
</pre></div>
</div>
<p>Once it finishes it will output the index html page
<code class="docutils literal notranslate"><span class="pre">open</span> <span class="pre">file:///.../aiohttp/docs/_build/html/index.html</span></code>.</p>
<p>Go to the link and make sure your doc changes looks good.</p>
</div>
<div class="section" id="spell-checking">
<h4>Spell checking<a class="headerlink" href="#spell-checking" title="Permalink to this headline">¶</a></h4>
<p>We use <code class="docutils literal notranslate"><span class="pre">pyenchant</span></code> and <code class="docutils literal notranslate"><span class="pre">sphinxcontrib-spelling</span></code> for running spell
checker for documentation:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ make doc-spelling
</pre></div>
</div>
<p>Unfortunately there are problems with running spell checker on MacOS X.</p>
<p>To run spell checker on Linux box you should install it first:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install enchant
$ pip install sphinxcontrib-spelling
</pre></div>
</div>
</div>
<div class="section" id="changelog-update">
<h4>Changelog update<a class="headerlink" href="#changelog-update" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">CHANGES.rst</span></code> file is managed using <a class="reference external" href="https://github.com/hawkowl/towncrier">towncrier</a> tool and all non trivial
changes must be accompanied by a news entry.</p>
<p>To add an entry to the news file, first you need to have created an
issue describing the change you want to make. A Pull Request itself
<em>may</em> function as such, but it is preferred to have a dedicated issue
(for example, in case the PR ends up rejected due to code quality
reasons).</p>
<p>Once you have an issue or pull request, you take the number and you
create a file inside of the <code class="docutils literal notranslate"><span class="pre">CHANGES/</span></code> directory named after that
issue number with an extension of <code class="docutils literal notranslate"><span class="pre">.removal</span></code>, <code class="docutils literal notranslate"><span class="pre">.feature</span></code>,
<code class="docutils literal notranslate"><span class="pre">.bugfix</span></code>, or <code class="docutils literal notranslate"><span class="pre">.doc</span></code>.  Thus if your issue or PR number is <code class="docutils literal notranslate"><span class="pre">1234</span></code> and
this change is fixing a bug, then you would create a file
<code class="docutils literal notranslate"><span class="pre">CHANGES/1234.bugfix</span></code>. PRs can span multiple categories by creating
multiple files (for instance, if you added a feature and
deprecated/removed the old feature at the same time, you would create
<code class="docutils literal notranslate"><span class="pre">CHANGES/NNNN.feature</span></code> and <code class="docutils literal notranslate"><span class="pre">CHANGES/NNNN.removal</span></code>). Likewise if a PR touches
multiple issues/PRs you may create a file for each of them with the
exact same contents and <em>Towncrier</em> will deduplicate them.</p>
<p>The contents of this file are <em>reStructuredText</em> formatted text that
will be used as the content of the news file entry. You do not need to
reference the issue or PR numbers here as <em>towncrier</em> will automatically
add a reference to all of the affected issues when rendering the news
file.</p>
</div>
<div class="section" id="making-a-pull-request">
<h4>Making a Pull Request<a class="headerlink" href="#making-a-pull-request" title="Permalink to this headline">¶</a></h4>
<p>After finishing all steps make a <a class="reference external" href="https://github.com/aio-libs/aiohttp">GitHub</a> Pull Request with <em>master</em> base branch.</p>
</div>
<div class="section" id="backporting">
<h4>Backporting<a class="headerlink" href="#backporting" title="Permalink to this headline">¶</a></h4>
<p>All Pull Requests are created against <em>master</em> git branch.</p>
<p>If the Pull Request is not a new functionality but bug fixing
<em>backport</em> to maintenance branch would be desirable.</p>
<p><em>aiohttp</em> project committer may ask for making a <em>backport</em> of the PR
into maintained branch(es), in this case he or she adds a github label
like <em>needs backport to 3.1</em>.</p>
<dl class="simple">
<dt><em>Backporting</em> is performed <em>after</em> main PR merging into master.</dt><dd><p>Please do the following steps:</p>
</dd>
</dl>
<ol class="arabic">
<li><p>Find <em>Pull Request’s commit</em> for cherry-picking.</p>
<p><em>aiohttp</em> does <em>squashing</em> PRs on merging, so open your PR page on
github and scroll down to message like <code class="docutils literal notranslate"><span class="pre">asvetlov</span> <span class="pre">merged</span> <span class="pre">commit</span>
<span class="pre">f7b8921</span> <span class="pre">into</span> <span class="pre">master</span> <span class="pre">9</span> <span class="pre">days</span> <span class="pre">ago</span></code>.  <code class="docutils literal notranslate"><span class="pre">f7b8921</span></code> is the required commit number.</p>
</li>
<li><p>Run <a class="reference external" href="https://github.com/python/core-workflow/tree/master/cherry_picker">cherry_picker</a>
tool for making backport PR (the tool is already pre-installed from
<code class="docutils literal notranslate"><span class="pre">./requirements/dev.txt</span></code>), e.g. <code class="docutils literal notranslate"><span class="pre">cherry_picker</span> <span class="pre">f7b8921</span> <span class="pre">3.1</span></code>.</p></li>
<li><p>In case of conflicts fix them and continue cherry-picking by
<code class="docutils literal notranslate"><span class="pre">cherry_picker</span> <span class="pre">--continue</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">cherry_picker</span> <span class="pre">--abort</span></code> stops the process.</p>
<p><code class="docutils literal notranslate"><span class="pre">cherry_picker</span> <span class="pre">--status</span></code> shows current cherry-picking status
(like <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">status</span></code>)</p>
</li>
<li><p>After all conflicts are done the tool opens a New Pull Request page
in a browser with pre-filed information.  Create a backport Pull
Request and wait for review/merging.</p></li>
<li><p><em>aiohttp</em> <em>committer</em> should remove <em>backport Git label</em> after
merging the backport.</p></li>
</ol>
</div>
<div class="section" id="how-to-become-an-aiohttp-committer">
<h4>How to become an aiohttp committer<a class="headerlink" href="#how-to-become-an-aiohttp-committer" title="Permalink to this headline">¶</a></h4>
<p>Contribute!</p>
<p>The easiest way is providing Pull Requests for issues in our bug
tracker.  But if you have a great idea for the library improvement
– please make an issue and Pull Request.</p>
<p>The rules for committers are simple:</p>
<ol class="arabic simple">
<li><p>No wild commits! Everything should go through PRs.</p></li>
<li><p>Take a part in reviews. It’s very important part of maintainer’s activity.</p></li>
<li><p>Pickup issues created by others, especially if they are simple.</p></li>
<li><p>Keep test suite comprehensive. In practice it means leveling up
coverage. 97% is not bad but we wish to have 100% someday. Well, 99%
is good target too.</p></li>
<li><p>Don’t hesitate to improve our docs. Documentation is very important
thing, it’s the key for project success. The documentation should
not only cover our public API but help newbies to start using the
project and shed a light on non-obvious gotchas.</p></li>
</ol>
<p>After positive answer aiohttp committer creates an issue on github
with the proposal for nomination.  If the proposal will collect only
positive votes and no strong objection – you’ll be a new member in
our team.</p>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html#document-index">
    <img class="logo" src="_static/aiohttp-icon-128x128.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">Async HTTP client/server for asyncio and Python</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=aio-libs&repo=aiohttp&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>








<ul class="badges">
  
  <li><a href="https://travis-ci.com/aio-libs/aiohttp">
    <img src="https://travis-ci.com/aio-libs/aiohttp.svg?branch=master"
	 alt="Travis CI status"
	 height="20"
    />
  </a>
  
  <li><a href="https://codecov.io/github/aio-libs/aiohttp">
    <img src="https://codecov.io/github/aio-libs/aiohttp/coverage.svg?branch=master"
	 alt="Code coverage status"
	 height="20"
    />
  </a>
  
  <li><a href="https://badge.fury.io/py/aiohttp">
    <img src="https://badge.fury.io/py/aiohttp.svg"
	 alt="Latest PyPI package version"
	 height="20"
    />
  </a>
  
  <li><a href="https://gitter.im/aio-libs/Lobby">
    <img src="https://badges.gitter.im/Join%20Chat.svg"
	 alt="Chat on Gitter"
	 height="20"
    />
  </a>
  
</ul>
<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-client">Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-web">Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-utilities">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-faq">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-misc">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-external">Who uses aiohttp?</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-contributing">Contributing</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2013-2018, Aiohttp contributors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      
    </div>

    
    <a href="https://github.com/aio-libs/aiohttp" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>